„

VB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Properties\AssemblyInfo.cs
[		 
assembly		 	
:			 

AssemblyVersion		 
(		 
$str		 $
)		$ %
]		% &
[

 
assembly

 	
:

	 

AssemblyCompany

 
(

 
$str

 +
)

+ ,
]

, -
[ 
assembly 	
:	 
!
AssemblyConfiguration  
(  !
$str! (
)( )
]) *
[ 
assembly 	
:	 

AssemblyFileVersion 
( 
$str (
)( )
]) *
[ 
assembly 	
:	 
(
AssemblyInformationalVersion '
(' (
$str( /
)/ 0
]0 1
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str +
)+ ,
], -
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str )
)) *
]* +
[ 
assembly 	
:	 

SecurityPermission 
( 
SecurityAction ,
., -
RequestMinimum- ;
,; <
SkipVerification= M
=N O
trueP T
)T U
]U Vø
ZB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Threading\MainThreadInvoker.cs
	namespace 	
DigitalStorage
 
. 
	Threading "
{ 
public 

static 
class 
MainThreadInvoker )
{ 
private		 
static		 
readonly		 
ConcurrentQueue		  /
<		/ 0
Action		0 6
>		6 7
queue		8 =
=		> ?
new		@ C
ConcurrentQueue		D S
<		S T
Action		T Z
>		Z [
(		[ \
)		\ ]
;		] ^
public 
static 
void 
Enqueue "
(" #
Action# )
action* 0
)0 1
{ 	
if 
( 
action 
== 
null 
) 
{ 
return 
; 
} 
queue 
. 
Enqueue 
( 
action  
)  !
;! "
} 	
internal 
static 
void 
	FlushOnce &
(& '
)' (
{ 	
int 

maxExecute 
= 
$num  
;  !
while 
( 

maxExecute 
-- 
>  !
$num" #
&&$ &
queue' ,
., -

TryDequeue- 7
(7 8
out8 ;
Action< B
actionC I
)I J
)J K
{ 
try 
{ 
action 
( 
) 
; 
} 
catch 
( 
	Exception  
ex! #
)# $
{   
Log!! 
.!! 
Error!! 
(!! 
$"!!  
$str!!  H
{!!H I
ex!!I K
}!!K L
"!!L M
)!!M N
;!!N O
}"" 
}## 
}$$ 	
public&& 
static&& 
int&& 
PendingCount&& &
=>&&' )
queue&&* /
.&&/ 0
Count&&0 5
;&&5 6
}'' 
}(( Æ5
UB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Threading\JobScheduler.cs
	namespace 	
DigitalStorage
 
. 
	Threading "
{ 
public 

sealed 
class 
JobScheduler $
{		 
public

 
static

 
readonly

 
JobScheduler

 +
Instance

, 4
=

5 6
new

7 :
JobScheduler

; G
(

G H
)

H I
;

I J
private 
readonly 
ConcurrentQueue (
<( )
Action) /
>/ 0
queue1 6
=7 8
new9 <
ConcurrentQueue= L
<L M
ActionM S
>S T
(T U
)U V
;V W
private 
readonly 
AutoResetEvent '
signal( .
=/ 0
new1 4
AutoResetEvent5 C
(C D
falseD I
)I J
;J K
private 
readonly 
Thread 
[  
]  !
workers" )
;) *
private 
volatile 
bool 
running %
=& '
true( ,
;, -
private 
int 
pending 
; 
private 
const 
int 
MaxQueue "
=# $
$num% +
;+ ,
private 
JobScheduler 
( 
) 
{ 	
int 
workerCount 
= 
Math "
." #
Max# &
(& '
$num' (
,( )
Math* .
.. /
Min/ 2
(2 3
Environment3 >
.> ?
ProcessorCount? M
-N O
$numP Q
,Q R
$numS T
)T U
)U V
;V W
this 
. 
workers 
= 
new 
Thread %
[% &
workerCount& 1
]1 2
;2 3
for 
( 
int 
i 
= 
$num 
; 
i 
< 
workerCount  +
;+ ,
i- .
++. 0
)0 1
{ 
this 
. 
workers 
[ 
i 
] 
=  !
new" %
Thread& ,
(, -

WorkerLoop- 7
)7 8
{ 
Name 
= 
$" 
$str 3
{3 4
i4 5
}5 6
"6 7
,7 8
IsBackground  
=! "
true# '
} 
; 
this   
.   
workers   
[   
i   
]   
.    
Start    %
(  % &
)  & '
;  ' (
}!! 
}"" 	
private$$ 
void$$ 

WorkerLoop$$ 
($$  
)$$  !
{%% 	
while&& 
(&& 
this&& 
.&& 
running&& 
)&&  
{'' 
if(( 
((( 
this(( 
.(( 
queue(( 
.(( 

TryDequeue(( )
((() *
out((* -
Action((. 4
action((5 ;
)((; <
)((< =
{)) 
try** 
{++ 
action,, 
(,, 
),,  
;,,  !
}-- 
catch.. 
(.. 
	Exception.. $
ex..% '
)..' (
{// 
Log00 
.00 
Error00 !
(00! "
$"00" $
$str00$ =
{00= >
ex00> @
}00@ A
"00A B
)00B C
;00C D
}11 
finally22 
{33 
Interlocked44 #
.44# $
	Decrement44$ -
(44- .
ref44. 1
this442 6
.446 7
pending447 >
)44> ?
;44? @
}55 
}66 
else77 
{88 
this99 
.99 
signal99 
.99  
WaitOne99  '
(99' (
$num99( )
)99) *
;99* +
}:: 
};; 
}<< 	
public>> 
bool>> 

TryEnqueue>> 
(>> 
Action>> %
job>>& )
)>>) *
{?? 	
if@@ 
(@@ 
job@@ 
==@@ 
null@@ 
)@@ 
{AA 
returnBB 
falseBB 
;BB 
}CC 
ifEE 
(EE 
InterlockedEE 
.EE 
	IncrementEE %
(EE% &
refEE& )
thisEE* .
.EE. /
pendingEE/ 6
)EE6 7
>EE8 9
MaxQueueEE: B
)EEB C
{FF 
InterlockedGG 
.GG 
	DecrementGG %
(GG% &
refGG& )
thisGG* .
.GG. /
pendingGG/ 6
)GG6 7
;GG7 8
returnHH 
falseHH 
;HH 
}II 
thisKK 
.KK 
queueKK 
.KK 
EnqueueKK 
(KK 
jobKK "
)KK" #
;KK# $
thisLL 
.LL 
signalLL 
.LL 
SetLL 
(LL 
)LL 
;LL 
returnMM 
trueMM 
;MM 
}NN 	
publicPP 
intPP 
PendingPP 
=>PP 
thisPP "
.PP" #
pendingPP# *
;PP* +
publicRR 
voidRR 
StopRR 
(RR 
)RR 
{SS 	
thisTT 
.TT 
runningTT 
=TT 
falseTT  
;TT  !
forUU 
(UU 
intUU 
iUU 
=UU 
$numUU 
;UU 
iUU 
<UU 
thisUU  $
.UU$ %
workersUU% ,
.UU, -
LengthUU- 3
;UU3 4
iUU5 6
++UU6 8
)UU8 9
{VV 
thisWW 
.WW 
signalWW 
.WW 
SetWW 
(WW  
)WW  !
;WW! "
}XX 
foreachZZ 
(ZZ 
ThreadZZ 
workerZZ "
inZZ# %
thisZZ& *
.ZZ* +
workersZZ+ 2
)ZZ2 3
{[[ 
try\\ 
{]] 
worker^^ 
.^^ 
Join^^ 
(^^  
$num^^  #
)^^# $
;^^$ %
}__ 
catch`` 
{aa 
}cc 
}dd 
}ee 	
}ff 
}gg ∂M
VB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\UI\Dialog_ExtractAmount.cs
	namespace 	
DigitalStorage
 
. 
UI 
{ 
public 

class  
Dialog_ExtractAmount %
:& '
Window( .
{ 
private 
StoredItemData 
item #
;# $
private !
Dialog_VirtualStorage %
parentDialog& 2
;2 3
private 
string 
amountBuffer #
;# $
private 
int 
	maxAmount 
; 
public 
override 
Vector2 
InitialSize  +
=>, .
new/ 2
Vector23 :
(: ;
$num; ?
,? @
$numA E
)E F
;F G
public  
Dialog_ExtractAmount #
(# $
StoredItemData$ 2
item3 7
,7 8!
Dialog_VirtualStorage9 N
parentDialogO [
)[ \
{ 	
this 
. 
item 
= 
item 
; 
this 
. 
parentDialog 
= 
parentDialog  ,
;, -
this 
. 
	maxAmount 
= 
Mathf "
." #
Min# &
(& '
item' +
.+ ,

stackCount, 6
,6 7
item8 <
.< =
def= @
?@ A
.A B

stackLimitB L
??M O
$numP Q
)Q R
;R S
this 
. 
amountBuffer 
= 
this  $
.$ %
	maxAmount% .
.. /
ToString/ 7
(7 8
)8 9
;9 :
this 
. 
doCloseButton 
=  
false! &
;& '
this 
. 
doCloseX 
= 
true  
;  !
this 
. 

forcePause 
= 
true "
;" #
this 
. #
absorbInputAroundWindow (
=) *
true+ /
;/ 0
} 	
public!! 
override!! 
void!! 
DoWindowContents!! -
(!!- .
Rect!!. 2
inRect!!3 9
)!!9 :
{"" 	
Text## 
.## 
Font## 
=## 
GameFont##  
.##  !
Small##! &
;##& '
float%% 
curY%% 
=%% 
$num%% 
;%% 
Rect'' 
	titleRect'' 
='' 
new''  
Rect''! %
(''% &
$num''& (
,''( )
curY''* .
,''. /
inRect''0 6
.''6 7
width''7 <
,''< =
$num''> A
)''A B
;''B C
Text(( 
.(( 
Font(( 
=(( 
GameFont((  
.((  !
Medium((! '
;((' (
Widgets)) 
.)) 
Label)) 
()) 
	titleRect)) #
,))# $
$str))% +
)))+ ,
;)), -
Text** 
.** 
Font** 
=** 
GameFont**  
.**  !
Small**! &
;**& '
curY++ 
+=++ 
$num++ 
;++ 
Rect-- 
itemLabelRect-- 
=--  
new--! $
Rect--% )
(--) *
$num--* ,
,--, -
curY--. 2
,--2 3
inRect--4 :
.--: ;
width--; @
,--@ A
$num--B E
)--E F
;--F G
string.. 
	itemLabel.. 
=.. 
GetItemLabel.. +
(..+ ,
).., -
;..- .
Widgets// 
.// 
Label// 
(// 
itemLabelRect// '
,//' (
$"//) +
$str//+ /
{/// 0
	itemLabel//0 9
}//9 :
"//: ;
)//; <
;//< =
curY00 
+=00 
$num00 
;00 
Rect22 
availableRect22 
=22  
new22! $
Rect22% )
(22) *
$num22* ,
,22, -
curY22. 2
,222 3
inRect224 :
.22: ;
width22; @
,22@ A
$num22B E
)22E F
;22F G
Widgets33 
.33 
Label33 
(33 
availableRect33 '
,33' (
$"33) +
$str33+ /
{33/ 0
item330 4
.334 5

stackCount335 ?
}33? @
$str33@ I
{33I J
item33J N
.33N O
def33O R
?33R S
.33S T

stackLimit33T ^
??33_ a
$num33b c
}33c d
$str33d e
"33e f
)33f g
;33g h
curY44 
+=44 
$num44 
;44 
Rect66 
	inputRect66 
=66 
new66  
Rect66! %
(66% &
$num66& (
,66( )
curY66* .
,66. /
inRect660 6
.666 7
width667 <
-66= >
$num66? B
,66B C
$num66D G
)66G H
;66H I
amountBuffer77 
=77 
Widgets77 "
.77" #
	TextField77# ,
(77, -
	inputRect77- 6
,776 7
amountBuffer778 D
)77D E
;77E F
curY88 
+=88 
$num88 
;88 
float:: 
buttonWidth:: 
=:: 
(::  !
inRect::! '
.::' (
width::( -
-::. /
$num::0 3
)::3 4
/::5 6
$num::7 9
;::9 :
Rect<< 
confirmRect<< 
=<< 
new<< "
Rect<<# '
(<<' (
$num<<( *
,<<* +
curY<<, 0
,<<0 1
buttonWidth<<2 =
,<<= >
$num<<? B
)<<B C
;<<C D
if== 
(== 
Widgets== 
.== 

ButtonText== "
(==" #
confirmRect==# .
,==. /
$str==0 4
)==4 5
)==5 6
{>> 

TryExtract?? 
(?? 
)?? 
;?? 
}@@ 
RectBB 

cancelRectBB 
=BB 
newBB !
RectBB" &
(BB& '
buttonWidthBB' 2
+BB3 4
$numBB5 8
,BB8 9
curYBB: >
,BB> ?
buttonWidthBB@ K
,BBK L
$numBBM P
)BBP Q
;BBQ R
ifCC 
(CC 
WidgetsCC 
.CC 

ButtonTextCC "
(CC" #

cancelRectCC# -
,CC- .
$strCC/ 3
)CC3 4
)CC4 5
{DD 
CloseEE 
(EE 
)EE 
;EE 
}FF 
}GG 	
privateII 
voidII 

TryExtractII 
(II  
)II  !
{JJ 	
ifKK 
(KK 
!KK 
intKK 
.KK 
TryParseKK 
(KK 
amountBufferKK *
,KK* +
outKK, /
intKK0 3
amountKK4 :
)KK: ;
)KK; <
{LL 
MessagesMM 
.MM 
MessageMM  
(MM  !
$strMM! +
,MM+ ,
MessageTypeDefOfMM- =
.MM= >
RejectInputMM> I
)MMI J
;MMJ K
returnNN 
;NN 
}OO 
ifQQ 
(QQ 
amountQQ 
<=QQ 
$numQQ 
)QQ 
{RR 
MessagesSS 
.SS 
MessageSS  
(SS  !
$strSS! +
,SS+ ,
MessageTypeDefOfSS- =
.SS= >
RejectInputSS> I
)SSI J
;SSJ K
returnTT 
;TT 
}UU 
ifWW 
(WW 
amountWW 
>WW 
	maxAmountWW "
)WW" #
{XX 
MessagesYY 
.YY 
MessageYY  
(YY  !
$"YY! #
$strYY# *
{YY* +
	maxAmountYY+ 4
}YY4 5
"YY5 6
,YY6 7
MessageTypeDefOfYY8 H
.YYH I
RejectInputYYI T
)YYT U
;YYU V
returnZZ 
;ZZ 
}[[ 
if]] 
(]] 
parentDialog]] 
!=]] 
null]]  $
)]]$ %
{^^ 
parentDialog__ 
.__ 
ExtractItemPublic__ .
(__. /
item__/ 3
,__3 4
amount__5 ;
)__; <
;__< =
}`` 
Closebb 
(bb 
)bb 
;bb 
}cc 	
privateee 
stringee 
GetItemLabelee #
(ee# $
)ee$ %
{ff 	
ifgg 
(gg 
itemgg 
.gg 
defgg 
==gg 
nullgg  
)gg  !
{hh 
returnii 
$strii 
;ii 
}jj 
stringll 
labelll 
=ll 
itemll 
.ll  
defll  #
.ll# $
labelll$ )
;ll) *
ifmm 
(mm 
itemmm 
.mm 
stuffDefmm 
!=mm  
nullmm! %
)mm% &
{nn 
labeloo 
=oo 
itemoo 
.oo 
stuffDefoo %
.oo% &
labeloo& +
+oo, -
labeloo. 3
;oo3 4
}pp 
returnrr 
labelrr 
.rr 
CapitalizeFirstrr (
(rr( )
)rr) *
;rr* +
}ss 	
}tt 
}uu ⁄Ã
WB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\UI\Dialog_VirtualStorage.cs
	namespace		 	
DigitalStorage		
 
.		 
UI		 
{

 
public 

class !
Dialog_VirtualStorage &
:' (
Window) /
{ 
private  
Building_StorageCore $
core% )
;) *
private 
string 

searchText !
=" #
$str$ &
;& '
private 
Vector2 
scrollPosition &
=' (
Vector2) 0
.0 1
zero1 5
;5 6
private 
List 
< 
StoredItemData #
># $
filteredItems% 2
=3 4
new5 8
List9 =
<= >
StoredItemData> L
>L M
(M N
)N O
;O P
private 
const 
float 
	RowHeight %
=& '
$num( +
;+ ,
private 
const 
float 
SearchBarHeight +
=, -
$num. 1
;1 2
private 
const 
float 
HeaderHeight (
=) *
$num+ .
;. /
private 
const 
float 
ButtonWidth '
=( )
$num* .
;. /
private 
const 
float 
IconSize $
=% &
$num' *
;* +
public 
override 
Vector2 
InitialSize  +
=>, .
new/ 2
Vector23 :
(: ;
$num; @
,@ A
$numB F
)F G
;G H
public !
Dialog_VirtualStorage $
($ % 
Building_StorageCore% 9
core: >
)> ?
{ 	
this 
. 
core 
= 
core 
; 
this   
.   
doCloseButton   
=    
true  ! %
;  % &
this!! 
.!! 
doCloseX!! 
=!! 
true!!  
;!!  !
this"" 
."" 

forcePause"" 
="" 
false"" #
;""# $
this## 
.## #
absorbInputAroundWindow## (
=##) *
true##+ /
;##/ 0
UpdateFilteredItems$$ 
($$  
)$$  !
;$$! "
}%% 	
public'' 
override'' 
void'' 
DoWindowContents'' -
(''- .
Rect''. 2
inRect''3 9
)''9 :
{(( 	
Text)) 
.)) 
Font)) 
=)) 
GameFont))  
.))  !
Small))! &
;))& '
float++ 
curY++ 
=++ 
$num++ 
;++ 
Rect.. 
	titleRect.. 
=.. 
new..  
Rect..! %
(..% &
$num..& (
,..( )
curY..* .
,... /
inRect..0 6
...6 7
width..7 <
,..< =
HeaderHeight..> J
)..J K
;..K L
Text// 
.// 
Font// 
=// 
GameFont//  
.//  !
Medium//! '
;//' (
Widgets00 
.00 
Label00 
(00 
	titleRect00 #
,00# $
$"00% '
$str00' .
{00. /
core00/ 3
.003 4
NetworkName004 ?
}00? @
"00@ A
)00A B
;00B C
Text11 
.11 
Font11 
=11 
GameFont11  
.11  !
Small11! &
;11& '
curY22 
+=22 
HeaderHeight22  
;22  !
Rect55 
capacityRect55 
=55 
new55  #
Rect55$ (
(55( )
$num55) +
,55+ ,
curY55- 1
,551 2
inRect553 9
.559 :
width55: ?
,55? @
$num55A D
)55D E
;55E F
string66 
capacityText66 
=66  !
$"66" $
$str66$ (
{66( )
core66) -
.66- .
GetUsedCapacity66. =
(66= >
)66> ?
}66? @
$str66@ C
{66C D
core66D H
.66H I
GetCapacity66I T
(66T U
)66U V
}66V W
$str66W b
{66b c
filteredItems66c p
.66p q
Count66q v
}66v w
"66w x
;66x y
Widgets77 
.77 
Label77 
(77 
capacityRect77 &
,77& '
capacityText77( 4
)774 5
;775 6
curY88 
+=88 
$num88 
;88 
Rect;; 

searchRect;; 
=;; 
new;; !
Rect;;" &
(;;& '
$num;;' )
,;;) *
curY;;+ /
,;;/ 0
inRect;;1 7
.;;7 8
width;;8 =
-;;> ?
$num;;@ D
,;;D E
SearchBarHeight;;F U
);;U V
;;;V W
string<< 
newSearchText<<  
=<<! "
Widgets<<# *
.<<* +
	TextField<<+ 4
(<<4 5

searchRect<<5 ?
,<<? @

searchText<<A K
)<<K L
;<<L M
if== 
(== 
newSearchText== 
!===  

searchText==! +
)==+ ,
{>> 

searchText?? 
=?? 
newSearchText?? *
;??* +
UpdateFilteredItems@@ #
(@@# $
)@@$ %
;@@% &
}AA 
RectDD 
clearButtonRectDD  
=DD! "
newDD# &
RectDD' +
(DD+ ,
inRectDD, 2
.DD2 3
widthDD3 8
-DD9 :
$numDD; >
,DD> ?
curYDD@ D
,DDD E
$numDDF I
,DDI J
SearchBarHeightDDK Z
)DDZ [
;DD[ \
ifEE 
(EE 
WidgetsEE 
.EE 

ButtonTextEE "
(EE" #
clearButtonRectEE# 2
,EE2 3
$strEE4 8
)EE8 9
)EE9 :
{FF 

searchTextGG 
=GG 
$strGG 
;GG  
UpdateFilteredItemsHH #
(HH# $
)HH$ %
;HH% &
}II 
curYJJ 
+=JJ 
SearchBarHeightJJ #
+JJ$ %
$numJJ& )
;JJ) *
RectMM 

headerRectMM 
=MM 
newMM !
RectMM" &
(MM& '
$numMM' )
,MM) *
curYMM+ /
,MM/ 0
inRectMM1 7
.MM7 8
widthMM8 =
,MM= >
$numMM? B
)MMB C
;MMC D
DrawListHeaderNN 
(NN 

headerRectNN %
)NN% &
;NN& '
curYOO 
+=OO 
$numOO 
;OO 
RectRR 
scrollViewRectRR 
=RR  !
newRR" %
RectRR& *
(RR* +
$numRR+ -
,RR- .
curYRR/ 3
,RR3 4
inRectRR5 ;
.RR; <
widthRR< A
,RRA B
inRectRRC I
.RRI J
heightRRJ P
-RRQ R
curYRRS W
-RRX Y
$numRRZ ]
)RR] ^
;RR^ _
RectSS 
scrollContentRectSS "
=SS# $
newSS% (
RectSS) -
(SS- .
$numSS. 0
,SS0 1
$numSS2 4
,SS4 5
scrollViewRectSS6 D
.SSD E
widthSSE J
-SSK L
$numSSM P
,SSP Q
filteredItemsSSR _
.SS_ `
CountSS` e
*SSf g
	RowHeightSSh q
)SSq r
;SSr s
WidgetsUU 
.UU 
BeginScrollViewUU #
(UU# $
scrollViewRectUU$ 2
,UU2 3
refUU4 7
scrollPositionUU8 F
,UUF G
scrollContentRectUUH Y
)UUY Z
;UUZ [
floatWW 
itemYWW 
=WW 
$numWW 
;WW 
forXX 
(XX 
intXX 
iXX 
=XX 
$numXX 
;XX 
iXX 
<XX 
filteredItemsXX  -
.XX- .
CountXX. 3
;XX3 4
iXX5 6
++XX6 8
)XX8 9
{YY 
StoredItemDataZZ 
itemZZ #
=ZZ$ %
filteredItemsZZ& 3
[ZZ3 4
iZZ4 5
]ZZ5 6
;ZZ6 7
Rect[[ 
rowRect[[ 
=[[ 
new[[ "
Rect[[# '
([[' (
$num[[( *
,[[* +
itemY[[, 1
,[[1 2
scrollContentRect[[3 D
.[[D E
width[[E J
,[[J K
	RowHeight[[L U
)[[U V
;[[V W
DrawItemRow\\ 
(\\ 
rowRect\\ #
,\\# $
item\\% )
,\\) *
i\\+ ,
)\\, -
;\\- .
itemY]] 
+=]] 
	RowHeight]] "
;]]" #
}^^ 
Widgets`` 
.`` 
EndScrollView`` !
(``! "
)``" #
;``# $
}aa 	
privatecc 
voidcc 
DrawListHeadercc #
(cc# $
Rectcc$ (
rectcc) -
)cc- .
{dd 	
GUIee 
.ee 
coloree 
=ee 
newee 
Coloree !
(ee! "
$numee" &
,ee& '
$numee( ,
,ee, -
$numee. 2
,ee2 3
$numee4 6
)ee6 7
;ee7 8
Widgetsff 
.ff 
DrawLineHorizontalff &
(ff& '
rectff' +
.ff+ ,
xff, -
,ff- .
rectff/ 3
.ff3 4
yff4 5
,ff5 6
rectff7 ;
.ff; <
widthff< A
)ffA B
;ffB C
Widgetsgg 
.gg 
DrawLineHorizontalgg &
(gg& '
rectgg' +
.gg+ ,
xgg, -
,gg- .
rectgg/ 3
.gg3 4
yMaxgg4 8
,gg8 9
rectgg: >
.gg> ?
widthgg? D
)ggD E
;ggE F
GUIhh 
.hh 
colorhh 
=hh 
Colorhh 
.hh 
whitehh #
;hh# $
Textjj 
.jj 
Anchorjj 
=jj 

TextAnchorjj $
.jj$ %

MiddleLeftjj% /
;jj/ 0
Rectll 
iconRectll 
=ll 
newll 
Rectll  $
(ll$ %
rectll% )
.ll) *
xll* +
+ll, -
$numll. 0
,ll0 1
rectll2 6
.ll6 7
yll7 8
,ll8 9
$numll: =
,ll= >
rectll? C
.llC D
heightllD J
)llJ K
;llK L
Widgetsmm 
.mm 
Labelmm 
(mm 
iconRectmm "
,mm" #
$strmm$ (
)mm( )
;mm) *
Rectoo 
nameRectoo 
=oo 
newoo 
Rectoo  $
(oo$ %
rectoo% )
.oo) *
xoo* +
+oo, -
$numoo. 1
,oo1 2
rectoo3 7
.oo7 8
yoo8 9
,oo9 :
$numoo; ?
,oo? @
rectooA E
.ooE F
heightooF L
)ooL M
;ooM N
Widgetspp 
.pp 
Labelpp 
(pp 
nameRectpp "
,pp" #
$strpp$ (
)pp( )
;pp) *
Rectrr 
qualityRectrr 
=rr 
newrr "
Rectrr# '
(rr' (
rectrr( ,
.rr, -
xrr- .
+rr/ 0
$numrr1 5
,rr5 6
rectrr7 ;
.rr; <
yrr< =
,rr= >
$numrr? C
,rrC D
rectrrE I
.rrI J
heightrrJ P
)rrP Q
;rrQ R
Widgetsss 
.ss 
Labelss 
(ss 
qualityRectss %
,ss% &
$strss' +
)ss+ ,
;ss, -
Rectuu 
	countRectuu 
=uu 
newuu  
Rectuu! %
(uu% &
rectuu& *
.uu* +
xuu+ ,
+uu- .
$numuu/ 3
,uu3 4
rectuu5 9
.uu9 :
yuu: ;
,uu; <
$numuu= A
,uuA B
rectuuC G
.uuG H
heightuuH N
)uuN O
;uuO P
Widgetsvv 
.vv 
Labelvv 
(vv 
	countRectvv #
,vv# $
$strvv% )
)vv) *
;vv* +
Rectxx 
hpRectxx 
=xx 
newxx 
Rectxx "
(xx" #
rectxx# '
.xx' (
xxx( )
+xx* +
$numxx, 0
,xx0 1
rectxx2 6
.xx6 7
yxx7 8
,xx8 9
$numxx: =
,xx= >
rectxx? C
.xxC D
heightxxD J
)xxJ K
;xxK L
Widgetsyy 
.yy 
Labelyy 
(yy 
hpRectyy  
,yy  !
$stryy" &
)yy& '
;yy' (
Text{{ 
.{{ 
Anchor{{ 
={{ 

TextAnchor{{ $
.{{$ %
	UpperLeft{{% .
;{{. /
}|| 	
private~~ 
void~~ 
DrawItemRow~~  
(~~  !
Rect~~! %
rect~~& *
,~~* +
StoredItemData~~, :
item~~; ?
,~~? @
int~~A D
index~~E J
)~~J K
{ 	
if
ÄÄ 
(
ÄÄ 
index
ÄÄ 
%
ÄÄ 
$num
ÄÄ 
==
ÄÄ 
$num
ÄÄ 
)
ÄÄ 
{
ÅÅ 
Widgets
ÇÇ 
.
ÇÇ  
DrawLightHighlight
ÇÇ *
(
ÇÇ* +
rect
ÇÇ+ /
)
ÇÇ/ 0
;
ÇÇ0 1
}
ÉÉ 
if
ÖÖ 
(
ÖÖ 
Mouse
ÖÖ 
.
ÖÖ 
IsOver
ÖÖ 
(
ÖÖ 
rect
ÖÖ !
)
ÖÖ! "
)
ÖÖ" #
{
ÜÜ 
Widgets
áá 
.
áá 
DrawHighlight
áá %
(
áá% &
rect
áá& *
)
áá* +
;
áá+ ,
}
àà 
Rect
ää 
iconRect
ää 
=
ää 
new
ää 
Rect
ää  $
(
ää$ %
rect
ää% )
.
ää) *
x
ää* +
+
ää, -
$num
ää. 0
,
ää0 1
rect
ää2 6
.
ää6 7
y
ää7 8
+
ää9 :
(
ää; <
rect
ää< @
.
ää@ A
height
ääA G
-
ääH I
IconSize
ääJ R
)
ääR S
/
ääT U
$num
ääV X
,
ääX Y
IconSize
ääZ b
,
ääb c
IconSize
ääd l
)
ääl m
;
ääm n
if
ãã 
(
ãã 
item
ãã 
.
ãã 
def
ãã 
!=
ãã 
null
ãã  
)
ãã  !
{
åå 
Widgets
çç 
.
çç 
	ThingIcon
çç !
(
çç! "
iconRect
çç" *
,
çç* +
item
çç, 0
.
çç0 1
def
çç1 4
,
çç4 5
item
çç6 :
.
çç: ;
stuffDef
çç; C
)
ççC D
;
ççD E
if
èè 
(
èè 
Mouse
èè 
.
èè 
IsOver
èè  
(
èè  !
iconRect
èè! )
)
èè) *
)
èè* +
{
êê 
TooltipHandler
ëë "
.
ëë" #
	TipRegion
ëë# ,
(
ëë, -
iconRect
ëë- 5
,
ëë5 6
GetItemTooltip
ëë7 E
(
ëëE F
item
ëëF J
)
ëëJ K
)
ëëK L
;
ëëL M
}
íí 
}
ìì 
Text
ïï 
.
ïï 
Anchor
ïï 
=
ïï 

TextAnchor
ïï $
.
ïï$ %

MiddleLeft
ïï% /
;
ïï/ 0
Rect
óó 
nameRect
óó 
=
óó 
new
óó 
Rect
óó  $
(
óó$ %
rect
óó% )
.
óó) *
x
óó* +
+
óó, -
$num
óó. 1
,
óó1 2
rect
óó3 7
.
óó7 8
y
óó8 9
,
óó9 :
$num
óó; ?
,
óó? @
rect
óóA E
.
óóE F
height
óóF L
)
óóL M
;
óóM N
string
òò 
label
òò 
=
òò 
GetItemLabel
òò '
(
òò' (
item
òò( ,
)
òò, -
;
òò- .
Widgets
ôô 
.
ôô 
Label
ôô 
(
ôô 
nameRect
ôô "
,
ôô" #
label
ôô$ )
)
ôô) *
;
ôô* +
Rect
õõ 
qualityRect
õõ 
=
õõ 
new
õõ "
Rect
õõ# '
(
õõ' (
rect
õõ( ,
.
õõ, -
x
õõ- .
+
õõ/ 0
$num
õõ1 5
,
õõ5 6
rect
õõ7 ;
.
õõ; <
y
õõ< =
,
õõ= >
$num
õõ? C
,
õõC D
rect
õõE I
.
õõI J
height
õõJ P
)
õõP Q
;
õõQ R
if
úú 
(
úú 
item
úú 
.
úú 
quality
úú 
!=
úú 
QualityCategory
úú  /
.
úú/ 0
Normal
úú0 6
)
úú6 7
{
ùù 
GUI
ûû 
.
ûû 
color
ûû 
=
ûû 
GetQualityColor
ûû +
(
ûû+ ,
item
ûû, 0
.
ûû0 1
quality
ûû1 8
)
ûû8 9
;
ûû9 :
Widgets
üü 
.
üü 
Label
üü 
(
üü 
qualityRect
üü )
,
üü) *
item
üü+ /
.
üü/ 0
quality
üü0 7
.
üü7 8
GetLabel
üü8 @
(
üü@ A
)
üüA B
)
üüB C
;
üüC D
GUI
†† 
.
†† 
color
†† 
=
†† 
Color
†† !
.
††! "
white
††" '
;
††' (
}
°° 
Rect
££ 
	countRect
££ 
=
££ 
new
££  
Rect
££! %
(
££% &
rect
££& *
.
££* +
x
££+ ,
+
££- .
$num
££/ 3
,
££3 4
rect
££5 9
.
££9 :
y
££: ;
,
££; <
$num
££= A
,
££A B
rect
££C G
.
££G H
height
££H N
)
££N O
;
££O P
Widgets
§§ 
.
§§ 
Label
§§ 
(
§§ 
	countRect
§§ #
,
§§# $
item
§§% )
.
§§) *

stackCount
§§* 4
.
§§4 5
ToString
§§5 =
(
§§= >
)
§§> ?
)
§§? @
;
§§@ A
Rect
¶¶ 
hpRect
¶¶ 
=
¶¶ 
new
¶¶ 
Rect
¶¶ "
(
¶¶" #
rect
¶¶# '
.
¶¶' (
x
¶¶( )
+
¶¶* +
$num
¶¶, 0
,
¶¶0 1
rect
¶¶2 6
.
¶¶6 7
y
¶¶7 8
,
¶¶8 9
$num
¶¶: =
,
¶¶= >
rect
¶¶? C
.
¶¶C D
height
¶¶D J
)
¶¶J K
;
¶¶K L
if
ßß 
(
ßß 
item
ßß 
.
ßß 
	hitPoints
ßß 
>
ßß  
$num
ßß! "
&&
ßß# %
item
ßß& *
.
ßß* +
def
ßß+ .
!=
ßß/ 1
null
ßß2 6
)
ßß6 7
{
®® 
float
©© 
	hpPercent
©© 
=
©©  !
(
©©" #
float
©©# (
)
©©( )
item
©©) -
.
©©- .
	hitPoints
©©. 7
/
©©8 9
item
©©: >
.
©©> ?
def
©©? B
.
©©B C
BaseMaxHitPoints
©©C S
;
©©S T
string
™™ 
hpText
™™ 
=
™™ 
$"
™™  "
{
™™" #
Mathf
™™# (
.
™™( )

RoundToInt
™™) 3
(
™™3 4
	hpPercent
™™4 =
*
™™> ?
$num
™™@ C
)
™™C D
}
™™D E
$str
™™E F
"
™™F G
;
™™G H
if
¨¨ 
(
¨¨ 
	hpPercent
¨¨ 
<
¨¨ 
$num
¨¨  $
)
¨¨$ %
{
≠≠ 
GUI
ÆÆ 
.
ÆÆ 
color
ÆÆ 
=
ÆÆ 
Color
ÆÆ  %
.
ÆÆ% &
yellow
ÆÆ& ,
;
ÆÆ, -
}
ØØ 
if
∞∞ 
(
∞∞ 
	hpPercent
∞∞ 
<
∞∞ 
$num
∞∞  %
)
∞∞% &
{
±± 
GUI
≤≤ 
.
≤≤ 
color
≤≤ 
=
≤≤ 
Color
≤≤  %
.
≤≤% &
red
≤≤& )
;
≤≤) *
}
≥≥ 
Widgets
µµ 
.
µµ 
Label
µµ 
(
µµ 
hpRect
µµ $
,
µµ$ %
hpText
µµ& ,
)
µµ, -
;
µµ- .
GUI
∂∂ 
.
∂∂ 
color
∂∂ 
=
∂∂ 
Color
∂∂ !
.
∂∂! "
white
∂∂" '
;
∂∂' (
}
∑∑ 
Text
ππ 
.
ππ 
Anchor
ππ 
=
ππ 

TextAnchor
ππ $
.
ππ$ %
	UpperLeft
ππ% .
;
ππ. / 
DrawExtractButtons
ªª 
(
ªª 
rect
ªª #
,
ªª# $
item
ªª% )
)
ªª) *
;
ªª* +
}
ºº 	
private
ææ 
void
ææ  
DrawExtractButtons
ææ '
(
ææ' (
Rect
ææ( ,
rect
ææ- 1
,
ææ1 2
StoredItemData
ææ3 A
item
ææB F
)
ææF G
{
øø 	
float
¿¿ 
buttonX
¿¿ 
=
¿¿ 
rect
¿¿  
.
¿¿  !
xMax
¿¿! %
-
¿¿& '
ButtonWidth
¿¿( 3
*
¿¿4 5
$num
¿¿6 7
-
¿¿8 9
$num
¿¿: =
;
¿¿= >
Rect
¬¬ 
extract1Rect
¬¬ 
=
¬¬ 
new
¬¬  #
Rect
¬¬$ (
(
¬¬( )
buttonX
¬¬) 0
,
¬¬0 1
rect
¬¬2 6
.
¬¬6 7
y
¬¬7 8
+
¬¬9 :
$num
¬¬; =
,
¬¬= >
ButtonWidth
¬¬? J
-
¬¬K L
$num
¬¬M O
,
¬¬O P
rect
¬¬Q U
.
¬¬U V
height
¬¬V \
-
¬¬] ^
$num
¬¬_ b
)
¬¬b c
;
¬¬c d
if
√√ 
(
√√ 
Widgets
√√ 
.
√√ 

ButtonText
√√ "
(
√√" #
extract1Rect
√√# /
,
√√/ 0
$str
√√1 8
)
√√8 9
)
√√9 :
{
ƒƒ 
ExtractItem
≈≈ 
(
≈≈ 
item
≈≈  
,
≈≈  !
$num
≈≈" #
)
≈≈# $
;
≈≈$ %
}
∆∆ 
buttonX
»» 
+=
»» 
ButtonWidth
»» "
;
»»" #
Rect
…… 
extractStackRect
…… !
=
……" #
new
……$ '
Rect
……( ,
(
……, -
buttonX
……- 4
,
……4 5
rect
……6 :
.
……: ;
y
……; <
+
……= >
$num
……? A
,
……A B
ButtonWidth
……C N
-
……O P
$num
……Q S
,
……S T
rect
……U Y
.
……Y Z
height
……Z `
-
……a b
$num
……c f
)
……f g
;
……g h
int
   

stackLimit
   
=
   
item
   !
.
  ! "
def
  " %
?
  % &
.
  & '

stackLimit
  ' 1
??
  2 4
$num
  5 6
;
  6 7
string
ÀÀ 

stackLabel
ÀÀ 
=
ÀÀ 
$"
ÀÀ  "
$str
ÀÀ" &
"
ÀÀ& '
;
ÀÀ' (
if
ÕÕ 
(
ÕÕ 
item
ÕÕ 
.
ÕÕ 

stackCount
ÕÕ 
>=
ÕÕ  "

stackLimit
ÕÕ# -
)
ÕÕ- .
{
ŒŒ 
if
œœ 
(
œœ 
Widgets
œœ 
.
œœ 

ButtonText
œœ &
(
œœ& '
extractStackRect
œœ' 7
,
œœ7 8

stackLabel
œœ9 C
)
œœC D
)
œœD E
{
–– 
ExtractItem
—— 
(
——  
item
——  $
,
——$ %

stackLimit
——& 0
)
——0 1
;
——1 2
}
““ 
}
”” 
else
‘‘ 
{
’’ 
GUI
÷÷ 
.
÷÷ 
color
÷÷ 
=
÷÷ 
Color
÷÷ !
.
÷÷! "
gray
÷÷" &
;
÷÷& '
Widgets
◊◊ 
.
◊◊ 

ButtonText
◊◊ "
(
◊◊" #
extractStackRect
◊◊# 3
,
◊◊3 4

stackLabel
◊◊5 ?
)
◊◊? @
;
◊◊@ A
GUI
ÿÿ 
.
ÿÿ 
color
ÿÿ 
=
ÿÿ 
Color
ÿÿ !
.
ÿÿ! "
white
ÿÿ" '
;
ÿÿ' (
}
ŸŸ 
buttonX
€€ 
+=
€€ 
ButtonWidth
€€ "
;
€€" #
Rect
‹‹ 
extractCustomRect
‹‹ "
=
‹‹# $
new
‹‹% (
Rect
‹‹) -
(
‹‹- .
buttonX
‹‹. 5
,
‹‹5 6
rect
‹‹7 ;
.
‹‹; <
y
‹‹< =
+
‹‹> ?
$num
‹‹@ B
,
‹‹B C
ButtonWidth
‹‹D O
-
‹‹P Q
$num
‹‹R T
,
‹‹T U
rect
‹‹V Z
.
‹‹Z [
height
‹‹[ a
-
‹‹b c
$num
‹‹d g
)
‹‹g h
;
‹‹h i
if
›› 
(
›› 
Widgets
›› 
.
›› 

ButtonText
›› "
(
››" #
extractCustomRect
››# 4
,
››4 5
$str
››6 ;
)
››; <
)
››< =
{
ﬁﬁ 
Find
ﬂﬂ 
.
ﬂﬂ 
WindowStack
ﬂﬂ  
.
ﬂﬂ  !
Add
ﬂﬂ! $
(
ﬂﬂ$ %
new
ﬂﬂ% ("
Dialog_ExtractAmount
ﬂﬂ) =
(
ﬂﬂ= >
item
ﬂﬂ> B
,
ﬂﬂB C
this
ﬂﬂD H
)
ﬂﬂH I
)
ﬂﬂI J
;
ﬂﬂJ K
}
‡‡ 
}
·· 	
public
„„ 
void
„„ 
ExtractItemPublic
„„ %
(
„„% &
StoredItemData
„„& 4
item
„„5 9
,
„„9 :
int
„„; >
count
„„? D
)
„„D E
{
‰‰ 	
ExtractItem
ÂÂ 
(
ÂÂ 
item
ÂÂ 
,
ÂÂ 
count
ÂÂ #
)
ÂÂ# $
;
ÂÂ$ %
}
ÊÊ 	
private
ËË 
void
ËË 
ExtractItem
ËË  
(
ËË  !
StoredItemData
ËË! /
item
ËË0 4
,
ËË4 5
int
ËË6 9
count
ËË: ?
)
ËË? @
{
ÈÈ 	
if
ÍÍ 
(
ÍÍ 
core
ÍÍ 
==
ÍÍ 
null
ÍÍ 
||
ÍÍ 
!
ÍÍ  !
core
ÍÍ! %
.
ÍÍ% &
Spawned
ÍÍ& -
||
ÍÍ. 0
item
ÍÍ1 5
==
ÍÍ6 8
null
ÍÍ9 =
)
ÍÍ= >
{
ÎÎ 
Messages
ÏÏ 
.
ÏÏ 
Message
ÏÏ  
(
ÏÏ  !
$str
ÏÏ! (
,
ÏÏ( )
MessageTypeDefOf
ÏÏ* :
.
ÏÏ: ;
RejectInput
ÏÏ; F
)
ÏÏF G
;
ÏÏG H
return
ÌÌ 
;
ÌÌ 
}
ÓÓ 
int
 
actualCount
 
=
 
Mathf
 #
.
# $
Min
$ '
(
' (
count
( -
,
- .
item
/ 3
.
3 4

stackCount
4 >
)
> ?
;
? @
int
ÒÒ 

stackLimit
ÒÒ 
=
ÒÒ 
item
ÒÒ !
.
ÒÒ! "
def
ÒÒ" %
.
ÒÒ% &

stackLimit
ÒÒ& 0
;
ÒÒ0 1
int
ÚÚ 
totalExtracted
ÚÚ 
=
ÚÚ  
$num
ÚÚ! "
;
ÚÚ" #
while
ÙÙ 
(
ÙÙ 
actualCount
ÙÙ 
>
ÙÙ  
$num
ÙÙ! "
)
ÙÙ" #
{
ıı 
int
ˆˆ 

batchCount
ˆˆ 
=
ˆˆ  
Mathf
ˆˆ! &
.
ˆˆ& '
Min
ˆˆ' *
(
ˆˆ* +
actualCount
ˆˆ+ 6
,
ˆˆ6 7

stackLimit
ˆˆ8 B
)
ˆˆB C
;
ˆˆC D
Thing
˜˜ 
extractedThing
˜˜ $
=
˜˜% &
core
˜˜' +
.
˜˜+ ,
ExtractItem
˜˜, 7
(
˜˜7 8
item
˜˜8 <
.
˜˜< =
def
˜˜= @
,
˜˜@ A

batchCount
˜˜B L
,
˜˜L M
item
˜˜N R
.
˜˜R S
stuffDef
˜˜S [
)
˜˜[ \
;
˜˜\ ]
if
˘˘ 
(
˘˘ 
extractedThing
˘˘ "
==
˘˘# %
null
˘˘& *
)
˘˘* +
{
˙˙ 
break
˚˚ 
;
˚˚ 
}
¸¸ 
IntVec3
ˇˇ 
spawnPos
ˇˇ  
=
ˇˇ! "#
FindSpawnPositionNear
ˇˇ# 8
(
ˇˇ8 9
core
ˇˇ9 =
.
ˇˇ= >
Position
ˇˇ> F
,
ˇˇF G
core
ˇˇH L
.
ˇˇL M
Map
ˇˇM P
,
ˇˇP Q
$num
ˇˇR S
)
ˇˇS T
;
ˇˇT U
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 
spawnPos
ÄÄ 
.
ÄÄ 
IsValid
ÄÄ %
)
ÄÄ% &
{
ÅÅ 
core
ÇÇ 
.
ÇÇ 
	StoreItem
ÇÇ "
(
ÇÇ" #
extractedThing
ÇÇ# 1
)
ÇÇ1 2
;
ÇÇ2 3
Messages
ÉÉ 
.
ÉÉ 
Message
ÉÉ $
(
ÉÉ$ %
$str
ÉÉ% /
,
ÉÉ/ 0
MessageTypeDefOf
ÉÉ1 A
.
ÉÉA B
RejectInput
ÉÉB M
)
ÉÉM N
;
ÉÉN O
break
ÑÑ 
;
ÑÑ 
}
ÖÖ 
Thing
áá 
spawnedThing
áá "
=
áá# $
GenSpawn
áá% -
.
áá- .
Spawn
áá. 3
(
áá3 4
extractedThing
áá4 B
,
ááB C
spawnPos
ááD L
,
ááL M
core
ááN R
.
ááR S
Map
ááS V
)
ááV W
;
ááW X

FleckMaker
àà 
.
àà  
ThrowLightningGlow
àà -
(
àà- .
spawnedThing
àà. :
.
àà: ;
DrawPos
àà; B
,
ààB C
core
ààD H
.
ààH I
Map
ààI L
,
ààL M
$num
ààN R
)
ààR S
;
ààS T
totalExtracted
ää 
+=
ää !

batchCount
ää" ,
;
ää, -
actualCount
ãã 
-=
ãã 

batchCount
ãã )
;
ãã) *
}
åå 
if
éé 
(
éé 
totalExtracted
éé 
>
éé  
$num
éé! "
)
éé" #
{
èè 
Messages
êê 
.
êê 
Message
êê  
(
êê  !
$"
êê! #
$str
êê# '
{
êê' (
GetItemLabel
êê( 4
(
êê4 5
item
êê5 9
)
êê9 :
}
êê: ;
$str
êê; =
{
êê= >
totalExtracted
êê> L
}
êêL M
"
êêM N
,
êêN O
MessageTypeDefOf
êêP `
.
êê` a
TaskCompletion
êêa o
)
êêo p
;
êêp q!
UpdateFilteredItems
ëë #
(
ëë# $
)
ëë$ %
;
ëë% &
}
íí 
else
ìì 
{
îî 
Messages
ïï 
.
ïï 
Message
ïï  
(
ïï  !
$str
ïï! '
,
ïï' (
MessageTypeDefOf
ïï) 9
.
ïï9 :
RejectInput
ïï: E
)
ïïE F
;
ïïF G
}
ññ 
}
óó 	
private
ôô 
IntVec3
ôô #
FindSpawnPositionNear
ôô -
(
ôô- .
IntVec3
ôô. 5
center
ôô6 <
,
ôô< =
Map
ôô> A
map
ôôB E
,
ôôE F
int
ôôG J
radius
ôôK Q
)
ôôQ R
{
öö 	
for
õõ 
(
õõ 
int
õõ 
r
õõ 
=
õõ 
$num
õõ 
;
õõ 
r
õõ 
<=
õõ  
radius
õõ! '
;
õõ' (
r
õõ) *
++
õõ* ,
)
õõ, -
{
úú 
foreach
ùù 
(
ùù 
IntVec3
ùù  
cell
ùù! %
in
ùù& (
	GenRadial
ùù) 2
.
ùù2 3
RadialCellsAround
ùù3 D
(
ùùD E
center
ùùE K
,
ùùK L
r
ùùM N
,
ùùN O
true
ùùP T
)
ùùT U
)
ùùU V
{
ûû 
if
üü 
(
üü 
cell
üü 
.
üü 
InBounds
üü %
(
üü% &
map
üü& )
)
üü) *
&&
üü+ -
cell
üü. 2
.
üü2 3
	Standable
üü3 <
(
üü< =
map
üü= @
)
üü@ A
&&
üüB D
map
üüE H
.
üüH I
	thingGrid
üüI R
.
üüR S
ThingsListAt
üüS _
(
üü_ `
cell
üü` d
)
üüd e
.
üüe f
Count
üüf k
==
üül n
$num
üüo p
)
üüp q
{
†† 
return
°° 
cell
°° #
;
°°# $
}
¢¢ 
}
££ 
}
§§ 
return
•• 
IntVec3
•• 
.
•• 
Invalid
•• "
;
••" #
}
¶¶ 	
private
®® 
string
®® 
GetItemLabel
®® #
(
®®# $
StoredItemData
®®$ 2
item
®®3 7
)
®®7 8
{
©© 	
if
™™ 
(
™™ 
item
™™ 
.
™™ 
def
™™ 
==
™™ 
null
™™  
)
™™  !
{
´´ 
return
¨¨ 
$str
¨¨ 
;
¨¨ 
}
≠≠ 
string
ØØ 
label
ØØ 
=
ØØ 
item
ØØ 
.
ØØ  
def
ØØ  #
.
ØØ# $
label
ØØ$ )
;
ØØ) *
if
∞∞ 
(
∞∞ 
item
∞∞ 
.
∞∞ 
stuffDef
∞∞ 
!=
∞∞  
null
∞∞! %
)
∞∞% &
{
±± 
label
≤≤ 
=
≤≤ 
item
≤≤ 
.
≤≤ 
stuffDef
≤≤ %
.
≤≤% &
label
≤≤& +
+
≤≤, -
label
≤≤. 3
;
≤≤3 4
}
≥≥ 
return
µµ 
label
µµ 
.
µµ 
CapitalizeFirst
µµ (
(
µµ( )
)
µµ) *
;
µµ* +
}
∂∂ 	
private
∏∏ 
string
∏∏ 
GetItemTooltip
∏∏ %
(
∏∏% &
StoredItemData
∏∏& 4
item
∏∏5 9
)
∏∏9 :
{
ππ 	
if
∫∫ 
(
∫∫ 
item
∫∫ 
.
∫∫ 
def
∫∫ 
==
∫∫ 
null
∫∫  
)
∫∫  !
{
ªª 
return
ºº 
$str
ºº 
;
ºº 
}
ΩΩ 
string
øø 
tooltip
øø 
=
øø 
GetItemLabel
øø )
(
øø) *
item
øø* .
)
øø. /
;
øø/ 0
tooltip
¿¿ 
+=
¿¿ 
$"
¿¿ 
$str
¿¿ 
{
¿¿  
item
¿¿  $
.
¿¿$ %

stackCount
¿¿% /
}
¿¿/ 0
"
¿¿0 1
;
¿¿1 2
if
¬¬ 
(
¬¬ 
item
¬¬ 
.
¬¬ 
quality
¬¬ 
!=
¬¬ 
QualityCategory
¬¬  /
.
¬¬/ 0
Normal
¬¬0 6
)
¬¬6 7
{
√√ 
tooltip
ƒƒ 
+=
ƒƒ 
$"
ƒƒ 
$str
ƒƒ #
{
ƒƒ# $
item
ƒƒ$ (
.
ƒƒ( )
quality
ƒƒ) 0
.
ƒƒ0 1
GetLabel
ƒƒ1 9
(
ƒƒ9 :
)
ƒƒ: ;
}
ƒƒ; <
"
ƒƒ< =
;
ƒƒ= >
}
≈≈ 
if
«« 
(
«« 
item
«« 
.
«« 
	hitPoints
«« 
>
««  
$num
««! "
&&
««# %
item
««& *
.
««* +
def
««+ .
.
««. /
useHitPoints
««/ ;
)
««; <
{
»» 
float
…… 
	hpPercent
…… 
=
……  !
(
……" #
float
……# (
)
……( )
item
……) -
.
……- .
	hitPoints
……. 7
/
……8 9
item
……: >
.
……> ?
def
……? B
.
……B C
BaseMaxHitPoints
……C S
;
……S T
tooltip
   
+=
   
$"
   
$str
   #
{
  # $
item
  $ (
.
  ( )
	hitPoints
  ) 2
}
  2 3
$str
  3 6
{
  6 7
item
  7 ;
.
  ; <
def
  < ?
.
  ? @
BaseMaxHitPoints
  @ P
}
  P Q
$str
  Q S
{
  S T
Mathf
  T Y
.
  Y Z

RoundToInt
  Z d
(
  d e
	hpPercent
  e n
*
  o p
$num
  q t
)
  t u
}
  u v
$str
  v x
"
  x y
;
  y z
}
ÀÀ 
if
ÕÕ 
(
ÕÕ 
!
ÕÕ 
string
ÕÕ 
.
ÕÕ 
IsNullOrEmpty
ÕÕ %
(
ÕÕ% &
item
ÕÕ& *
.
ÕÕ* +
def
ÕÕ+ .
.
ÕÕ. /
description
ÕÕ/ :
)
ÕÕ: ;
)
ÕÕ; <
{
ŒŒ 
tooltip
œœ 
+=
œœ 
$"
œœ 
$str
œœ !
{
œœ! "
item
œœ" &
.
œœ& '
def
œœ' *
.
œœ* +
description
œœ+ 6
}
œœ6 7
"
œœ7 8
;
œœ8 9
}
–– 
return
““ 
tooltip
““ 
;
““ 
}
”” 	
private
’’ 
Color
’’ 
GetQualityColor
’’ %
(
’’% &
QualityCategory
’’& 5
quality
’’6 =
)
’’= >
{
÷÷ 	
switch
◊◊ 
(
◊◊ 
quality
◊◊ 
)
◊◊ 
{
ÿÿ 
case
ŸŸ 
QualityCategory
ŸŸ $
.
ŸŸ$ %
Awful
ŸŸ% *
:
ŸŸ* +
return
⁄⁄ 
new
⁄⁄ 
Color
⁄⁄ $
(
⁄⁄$ %
$num
⁄⁄% )
,
⁄⁄) *
$num
⁄⁄+ /
,
⁄⁄/ 0
$num
⁄⁄1 5
)
⁄⁄5 6
;
⁄⁄6 7
case
€€ 
QualityCategory
€€ $
.
€€$ %
Poor
€€% )
:
€€) *
return
‹‹ 
new
‹‹ 
Color
‹‹ $
(
‹‹$ %
$num
‹‹% )
,
‹‹) *
$num
‹‹+ /
,
‹‹/ 0
$num
‹‹1 5
)
‹‹5 6
;
‹‹6 7
case
›› 
QualityCategory
›› $
.
››$ %
Normal
››% +
:
››+ ,
return
ﬁﬁ 
Color
ﬁﬁ  
.
ﬁﬁ  !
white
ﬁﬁ! &
;
ﬁﬁ& '
case
ﬂﬂ 
QualityCategory
ﬂﬂ $
.
ﬂﬂ$ %
Good
ﬂﬂ% )
:
ﬂﬂ) *
return
‡‡ 
new
‡‡ 
Color
‡‡ $
(
‡‡$ %
$num
‡‡% )
,
‡‡) *
$num
‡‡+ /
,
‡‡/ 0
$num
‡‡1 5
)
‡‡5 6
;
‡‡6 7
case
·· 
QualityCategory
·· $
.
··$ %
	Excellent
··% .
:
··. /
return
‚‚ 
new
‚‚ 
Color
‚‚ $
(
‚‚$ %
$num
‚‚% )
,
‚‚) *
$num
‚‚+ /
,
‚‚/ 0
$num
‚‚1 3
)
‚‚3 4
;
‚‚4 5
case
„„ 
QualityCategory
„„ $
.
„„$ %

Masterwork
„„% /
:
„„/ 0
return
‰‰ 
new
‰‰ 
Color
‰‰ $
(
‰‰$ %
$num
‰‰% '
,
‰‰' (
$num
‰‰) -
,
‰‰- .
$num
‰‰/ 3
)
‰‰3 4
;
‰‰4 5
case
ÂÂ 
QualityCategory
ÂÂ $
.
ÂÂ$ %
	Legendary
ÂÂ% .
:
ÂÂ. /
return
ÊÊ 
new
ÊÊ 
Color
ÊÊ $
(
ÊÊ$ %
$num
ÊÊ% '
,
ÊÊ' (
$num
ÊÊ) -
,
ÊÊ- .
$num
ÊÊ/ 3
)
ÊÊ3 4
;
ÊÊ4 5
default
ÁÁ 
:
ÁÁ 
return
ËË 
Color
ËË  
.
ËË  !
white
ËË! &
;
ËË& '
}
ÈÈ 
}
ÍÍ 	
private
ÏÏ 
void
ÏÏ !
UpdateFilteredItems
ÏÏ (
(
ÏÏ( )
)
ÏÏ) *
{
ÌÌ 	
if
ÓÓ 
(
ÓÓ 
core
ÓÓ 
==
ÓÓ 
null
ÓÓ 
)
ÓÓ 
{
ÔÔ 
filteredItems
 
.
 
Clear
 #
(
# $
)
$ %
;
% &
return
ÒÒ 
;
ÒÒ 
}
ÚÚ 
IEnumerable
ÙÙ 
<
ÙÙ 
StoredItemData
ÙÙ &
>
ÙÙ& '
allItems
ÙÙ( 0
=
ÙÙ1 2
core
ÙÙ3 7
.
ÙÙ7 8
GetAllStoredItems
ÙÙ8 I
(
ÙÙI J
)
ÙÙJ K
;
ÙÙK L
if
ˆˆ 
(
ˆˆ 
string
ˆˆ 
.
ˆˆ 
IsNullOrEmpty
ˆˆ $
(
ˆˆ$ %

searchText
ˆˆ% /
)
ˆˆ/ 0
)
ˆˆ0 1
{
˜˜ 
filteredItems
¯¯ 
=
¯¯ 
allItems
¯¯  (
.
¯¯( )
ToList
¯¯) /
(
¯¯/ 0
)
¯¯0 1
;
¯¯1 2
}
˘˘ 
else
˙˙ 
{
˚˚ 
string
¸¸ 
searchLower
¸¸ "
=
¸¸# $

searchText
¸¸% /
.
¸¸/ 0
ToLower
¸¸0 7
(
¸¸7 8
)
¸¸8 9
;
¸¸9 :
filteredItems
˝˝ 
=
˝˝ 
allItems
˝˝  (
.
˝˝( )
Where
˝˝) .
(
˝˝. /
item
˝˝/ 3
=>
˝˝4 6
{
˛˛ 
if
ˇˇ 
(
ˇˇ 
item
ˇˇ 
.
ˇˇ 
def
ˇˇ  
==
ˇˇ! #
null
ˇˇ$ (
)
ˇˇ( )
{
ÄÄ 
return
ÅÅ 
false
ÅÅ $
;
ÅÅ$ %
}
ÇÇ 
string
ÑÑ 
label
ÑÑ  
=
ÑÑ! "
GetItemLabel
ÑÑ# /
(
ÑÑ/ 0
item
ÑÑ0 4
)
ÑÑ4 5
.
ÑÑ5 6
ToLower
ÑÑ6 =
(
ÑÑ= >
)
ÑÑ> ?
;
ÑÑ? @
return
ÖÖ 
label
ÖÖ  
.
ÖÖ  !
Contains
ÖÖ! )
(
ÖÖ) *
searchLower
ÖÖ* 5
)
ÖÖ5 6
;
ÖÖ6 7
}
ÜÜ 
)
ÜÜ 
.
ÜÜ 
ToList
ÜÜ 
(
ÜÜ 
)
ÜÜ 
;
ÜÜ 
}
áá 
filteredItems
ââ 
=
ââ 
filteredItems
ââ )
.
ââ) *
OrderBy
ââ* 1
(
ââ1 2
item
ââ2 6
=>
ââ7 9
GetItemLabel
ââ: F
(
ââF G
item
ââG K
)
ââK L
)
ââL M
.
ââM N
ToList
ââN T
(
ââT U
)
ââU V
;
ââV W
}
ää 	
}
ãã 
}åå …7
^B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Settings\DigitalStorageSettings.cs
	namespace 	
DigitalStorage
 
. 
Settings !
{ 
public 

class "
DigitalStorageSettings '
:( )
ModSettings* 5
{ 
public 
static 
float 
costMultiplier *
=+ ,
$num- 1
;1 2
public		 
static		 
bool		 
enableDebugLog		 )
=		* +
false		, 1
;		1 2
public

 
static

 
bool

 
enableConversionLog

 .
=

/ 0
false

1 6
;

6 7
public 
static 
int  
reservedCountPerItem .
=/ 0
$num1 4
;4 5
public 
override 
void 

ExposeData '
(' (
)( )
{ 	
Scribe_Values 
. 
Look 
( 
ref "
costMultiplier# 1
,1 2
$str3 C
,C D
$numE I
)I J
;J K
Scribe_Values 
. 
Look 
( 
ref "
enableDebugLog# 1
,1 2
$str3 C
,C D
falseE J
)J K
;K L
Scribe_Values 
. 
Look 
( 
ref "
enableConversionLog# 6
,6 7
$str8 M
,M N
falseO T
)T U
;U V
Scribe_Values 
. 
Look 
( 
ref " 
reservedCountPerItem# 7
,7 8
$str9 O
,O P
$numQ T
)T U
;U V
base 
. 

ExposeData 
( 
) 
; 
} 	
public 
static 
void $
DoSettingsWindowContents 3
(3 4
Rect4 8
inRect9 ?
)? @
{ 	
Listing_Standard 
listingStandard ,
=- .
new/ 2
Listing_Standard3 C
(C D
)D E
;E F
listingStandard 
. 
Begin !
(! "
inRect" (
)( )
;) *
Text 
. 
Font 
= 
GameFont  
.  !
Medium! '
;' (
listingStandard 
. 
Label !
(! "
$str" (
)( )
;) *
Text 
. 
Font 
= 
GameFont  
.  !
Small! &
;& '
listingStandard 
. 
Gap 
(  
$num  #
)# $
;$ %
listingStandard!! 
.!! 
Label!! !
(!!! "
string!!" (
.!!( )
Format!!) /
(!!/ 0
$str!!0 ?
,!!? @
costMultiplier!!A O
)!!O P
)!!P Q
;!!Q R
costMultiplier"" 
="" 
listingStandard"" ,
."", -
Slider""- 3
(""3 4
costMultiplier""4 B
,""B C
$num""D H
,""H I
$num""J M
)""M N
;""N O
listingStandard## 
.## 
Gap## 
(##  
$num##  "
)##" #
;### $
listingStandard%% 
.%% 
Label%% !
(%%! "
$str%%" 2
)%%2 3
;%%3 4
listingStandard&& 
.&& 
Gap&& 
(&&  
$num&&  #
)&&# $
;&&$ %
Text)) 
.)) 
Font)) 
=)) 
GameFont))  
.))  !
Medium))! '
;))' (
listingStandard** 
.** 
Label** !
(**! "
$str**" *
)*** +
;**+ ,
Text++ 
.++ 
Font++ 
=++ 
GameFont++  
.++  !
Small++! &
;++& '
listingStandard,, 
.,, 
Gap,, 
(,,  
$num,,  #
),,# $
;,,$ %
listingStandard.. 
... 
Label.. !
(..! "
string.." (
...( )
Format..) /
(../ 0
$str..0 ?
,..? @ 
reservedCountPerItem..A U
)..U V
)..V W
;..W X 
reservedCountPerItem//  
=//! "
(//# $
int//$ '
)//' (
listingStandard//( 7
.//7 8
Slider//8 >
(//> ? 
reservedCountPerItem//? S
,//S T
$num//U W
,//W X
$num//Y \
)//\ ]
;//] ^
listingStandard00 
.00 
Gap00 
(00  
$num00  "
)00" #
;00# $
listingStandard22 
.22 
Label22 !
(22! "
$str22" ?
)22? @
;22@ A
listingStandard33 
.33 
Gap33 
(33  
$num33  #
)33# $
;33$ %
Text66 
.66 
Font66 
=66 
GameFont66  
.66  !
Medium66! '
;66' (
listingStandard77 
.77 
Label77 !
(77! "
$str77" (
)77( )
;77) *
Text88 
.88 
Font88 
=88 
GameFont88  
.88  !
Small88! &
;88& '
listingStandard99 
.99 
Gap99 
(99  
$num99  #
)99# $
;99$ %
listingStandard;; 
.;; 
CheckboxLabeled;; +
(;;+ ,
$str;;, 4
,;;4 5
ref;;6 9
enableDebugLog;;: H
,;;H I
$str<< ,
)<<, -
;<<- .
listingStandard== 
.== 
Gap== 
(==  
$num==  "
)==" #
;==# $
listingStandard?? 
.?? 
CheckboxLabeled?? +
(??+ ,
$str??, 4
,??4 5
ref??6 9
enableConversionLog??: M
,??M N
$str@@ 2
)@@2 3
;@@3 4
listingStandardAA 
.AA 
GapAA 
(AA  
$numAA  "
)AA" #
;AA# $
GUIDD 
.DD 
colorDD 
=DD 
ColorDD 
.DD 
yellowDD $
;DD$ %
listingStandardEE 
.EE 
LabelEE !
(EE! "
$strEE" 9
)EE9 :
;EE: ;
GUIFF 
.FF 
colorFF 
=FF 
ColorFF 
.FF 
whiteFF #
;FF# $
listingStandardHH 
.HH 
EndHH 
(HH  
)HH  !
;HH! "
}II 	
}JJ 
}KK ¢
YB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Settings\DigitalStorageMod.cs
	namespace 	
DigitalStorage
 
. 
Settings !
{ 
public 

class 
DigitalStorageMod "
:# $
Mod% (
{ 
private "
DigitalStorageSettings &
settings' /
;/ 0
public

 
DigitalStorageMod

  
(

  !
ModContentPack

! /
content

0 7
)

7 8
:

9 :
base

; ?
(

? @
content

@ G
)

G H
{ 	
this 
. 
settings 
= 
GetSettings '
<' ("
DigitalStorageSettings( >
>> ?
(? @
)@ A
;A B
} 	
public 
override 
void $
DoSettingsWindowContents 5
(5 6
Rect6 :
inRect; A
)A B
{ 	"
DigitalStorageSettings "
." #$
DoSettingsWindowContents# ;
(; <
inRect< B
)B C
;C D
base 
. $
DoSettingsWindowContents )
() *
inRect* 0
)0 1
;1 2
} 	
public 
override 
string 
SettingsCategory /
(/ 0
)0 1
{ 	
return 
$str -
;- .
} 	
} 
} òπ
ZB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Services\AsyncItemConverter.cs
	namespace

 	
DigitalStorage


 
.

 
Services

 !
{ 
public 

static 
class 
AsyncItemConverter *
{ 
private 
static 

Dictionary !
<! " 
Building_StorageCore" 6
,6 7
ConversionState8 G
>G H
activeConversionsI Z
=[ \
new] `

Dictionarya k
<k l!
Building_StorageCore	l Ä
,
Ä Å
ConversionState
Ç ë
>
ë í
(
í ì
)
ì î
;
î ï
private 
class 
ConversionState %
{ 	
public 
List 
< 
Thing 
> 
	toConvert (
=) *
new+ .
List/ 3
<3 4
Thing4 9
>9 :
(: ;
); <
;< =
public 
List 
< 
ItemData  
>  !
preparedData" .
=/ 0
new1 4
List5 9
<9 :
ItemData: B
>B C
(C D
)D E
;E F
public 
int 
dataPreparedIndex (
=) *
$num+ ,
;, -
public 
int 
despawnIndex #
=$ %
$num& '
;' (
public 
int 
itemsPerFrame $
=% &
$num' )
;) *
} 	
private 
class 
ItemData 
{ 	
public   
Thing   
thing   
;   
public!! 
StoredItemData!! !
data!!" &
;!!& '
}"" 	
public'' 
static'' 
void''  
StartAsyncConversion'' /
(''/ 0 
Building_StorageCore''0 D
core''E I
)''I J
{(( 	
if)) 
()) "
DigitalStorageSettings)) &
.))& '
enableConversionLog))' :
))): ;
{** 
Log++ 
.++ 
Message++ 
(++ 
$"++ 
$str++ W
{++W X
(++X Y
core++Y ]
!=++^ `
null++a e
?++f g
$str++h l
:++m n
$str++o u
)++u v
}++v w
$str	++w Å
{
++Å Ç
(
++Ç É
core
++É á
!=
++à ä
null
++ã è
?
++ê ë
core
++í ñ
.
++ñ ó
Powered
++ó û
.
++û ü
ToString
++ü ß
(
++ß ®
)
++® ©
:
++™ ´
$str
++¨ ±
)
++± ≤
}
++≤ ≥
"
++≥ ¥
)
++¥ µ
;
++µ ∂
},, 
if.. 
(.. 
core.. 
==.. 
null.. 
||.. 
!..  !
core..! %
...% &
Powered..& -
)..- .
{// 
if00 
(00 "
DigitalStorageSettings00 *
.00* +
enableConversionLog00+ >
)00> ?
{11 
Log22 
.22 
Message22 
(22  
$"22  "
$str22" e
"22e f
)22f g
;22g h
}33 
return44 
;44 
}55 
	SlotGroup77 
	slotGroup77 
=77  !
core77" &
.77& '
GetSlotGroup77' 3
(773 4
)774 5
;775 6
if88 
(88 
	slotGroup88 
==88 
null88 !
)88! "
{99 
if:: 
(:: "
DigitalStorageSettings:: *
.::* +
enableConversionLog::+ >
)::> ?
{;; 
Log<< 
.<< 
Message<< 
(<<  
$"<<  "
$str<<" `
"<<` a
)<<a b
;<<b c
}== 
return>> 
;>> 
}?? 
intAA 
reservedCountAA 
=AA "
DigitalStorageSettingsAA  6
.AA6 7 
reservedCountPerItemAA7 K
;AAK L
ifBB 
(BB "
DigitalStorageSettingsBB &
.BB& '
enableConversionLogBB' :
)BB: ;
{CC 
LogDD 
.DD 
MessageDD 
(DD 
$"DD 
$strDD S
{DDS T
reservedCountDDT a
}DDa b
"DDb c
)DDc d
;DDd e
}EE 

DictionaryHH 
<HH 
stringHH 
,HH 
ListHH #
<HH# $
ThingHH$ )
>HH) *
>HH* +

itemsByKeyHH, 6
=HH7 8
newHH9 <

DictionaryHH= G
<HHG H
stringHHH N
,HHN O
ListHHP T
<HHT U
ThingHHU Z
>HHZ [
>HH[ \
(HH\ ]
)HH] ^
;HH^ _
foreachII 
(II 
ThingII 
thingII  
inII! #
	slotGroupII$ -
.II- .

HeldThingsII. 8
)II8 9
{JJ 
ifKK 
(KK 
thingKK 
!=KK 
nullKK !
&&KK" $
thingKK% *
.KK* +
SpawnedKK+ 2
)KK2 3
{LL 
stringMM 
keyMM 
=MM  

GetItemKeyMM! +
(MM+ ,
thingMM, 1
)MM1 2
;MM2 3
ifNN 
(NN 
!NN 

itemsByKeyNN #
.NN# $
ContainsKeyNN$ /
(NN/ 0
keyNN0 3
)NN3 4
)NN4 5
{OO 

itemsByKeyPP "
[PP" #
keyPP# &
]PP& '
=PP( )
newPP* -
ListPP. 2
<PP2 3
ThingPP3 8
>PP8 9
(PP9 :
)PP: ;
;PP; <
}QQ 

itemsByKeyRR 
[RR 
keyRR "
]RR" #
.RR# $
AddRR$ '
(RR' (
thingRR( -
)RR- .
;RR. /
}SS 
}TT 
ifVV 
(VV "
DigitalStorageSettingsVV &
.VV& '
enableConversionLogVV' :
)VV: ;
{WW 
LogXX 
.XX 
MessageXX 
(XX 
$"XX 
$strXX Z
{XXZ [

itemsByKeyXX[ e
.XXe f
CountXXf k
}XXk l
"XXl m
)XXm n
;XXn o
}YY 
List\\ 
<\\ 
Thing\\ 
>\\ 
	toConvert\\ !
=\\" #
new\\$ '
List\\( ,
<\\, -
Thing\\- 2
>\\2 3
(\\3 4
)\\4 5
;\\5 6
foreach]] 
(]] 
var]] 
kvp]] 
in]] 

itemsByKey]]  *
)]]* +
{^^ 
List__ 
<__ 
Thing__ 
>__ 
things__ "
=__# $
kvp__% (
.__( )
Value__) .
;__. /
intbb 

totalCountbb 
=bb  
thingsbb! '
.bb' (
Sumbb( +
(bb+ ,
tbb, -
=>bb. 0
tbb1 2
.bb2 3

stackCountbb3 =
)bb= >
;bb> ?
ifdd 
(dd "
DigitalStorageSettingsdd *
.dd* +
enableConversionLogdd+ >
)dd> ?
{ee 
Logff 
.ff 
Messageff 
(ff  
$"ff  "
$strff" A
{ffA B
kvpffB E
.ffE F
KeyffF I
}ffI J
$strffJ P
{ffP Q

totalCountffQ [
}ff[ \
$strff\ a
{ffa b
reservedCountffb o
}ffo p
"ffp q
)ffq r
;ffr s
}gg 
ifjj 
(jj 

totalCountjj 
>jj  
reservedCountjj! .
)jj. /
{kk 
intll 
toConvertCountll &
=ll' (

totalCountll) 3
-ll4 5
reservedCountll6 C
;llC D
intmm 
	convertedmm !
=mm" #
$nummm$ %
;mm% &
ifoo 
(oo "
DigitalStorageSettingsoo .
.oo. /
enableConversionLogoo/ B
)ooB C
{pp 
Logqq 
.qq 
Messageqq #
(qq# $
$"qq$ &
$strqq& K
{qqK L
toConvertCountqqL Z
}qqZ [
"qq[ \
)qq\ ]
;qq] ^
}rr 
foreachtt 
(tt 
Thingtt "
thingtt# (
intt) +
thingstt, 2
.tt2 3
OrderBytt3 :
(tt: ;
ttt; <
=>tt= ?
ttt@ A
.ttA B

stackCountttB L
)ttL M
)ttM N
{uu 
ifvv 
(vv 
	convertedvv %
>=vv& (
toConvertCountvv) 7
)vv7 8
{ww 
breakxx !
;xx! "
}yy 
int{{ 
	remaining{{ %
={{& '
toConvertCount{{( 6
-{{7 8
	converted{{9 B
;{{B C
if|| 
(|| 
thing|| !
.||! "

stackCount||" ,
<=||- /
	remaining||0 9
)||9 :
{}} 
	toConvert %
.% &
Add& )
() *
thing* /
)/ 0
;0 1
	converted
ÄÄ %
+=
ÄÄ& (
thing
ÄÄ) .
.
ÄÄ. /

stackCount
ÄÄ/ 9
;
ÄÄ9 :
}
ÅÅ 
else
ÇÇ 
{
ÉÉ 
Thing
ÜÜ !
split
ÜÜ" '
=
ÜÜ( )
thing
ÜÜ* /
.
ÜÜ/ 0
SplitOff
ÜÜ0 8
(
ÜÜ8 9
	remaining
ÜÜ9 B
)
ÜÜB C
;
ÜÜC D
if
áá 
(
áá  
split
áá  %
!=
áá& (
null
áá) -
&&
áá. 0
split
áá1 6
.
áá6 7

stackCount
áá7 A
>
ááB C
$num
ááD E
)
ááE F
{
àà 
if
ää  "
(
ää# $
!
ää$ %
split
ää% *
.
ää* +
Spawned
ää+ 2
&&
ää3 5
thing
ää6 ;
.
ää; <
Map
ää< ?
!=
ää@ B
null
ääC G
)
ääG H
{
ãã  !
GenSpawn
åå$ ,
.
åå, -
Spawn
åå- 2
(
åå2 3
split
åå3 8
,
åå8 9
thing
åå: ?
.
åå? @
Position
åå@ H
,
ååH I
thing
ååJ O
.
ååO P
Map
ååP S
)
ååS T
;
ååT U
if
çç$ &
(
çç' ($
DigitalStorageSettings
çç( >
.
çç> ?!
enableConversionLog
çç? R
)
ççR S
{
éé$ %
Log
èè( +
.
èè+ ,
Message
èè, 3
(
èè3 4
$"
èè4 6
$str
èè6 c
{
èèc d
split
èèd i
.
èèi j
Label
èèj o
}
èèo p
$str
èèp r
{
èèr s
split
èès x
.
èèx y

stackCountèèy É
}èèÉ Ñ
$strèèÑ ä
{èèä ã
thingèèã ê
.èèê ë
Positionèèë ô
}èèô ö
"èèö õ
)èèõ ú
;èèú ù
}
êê$ %
}
ëë  !
	toConvert
íí  )
.
íí) *
Add
íí* -
(
íí- .
split
íí. 3
)
íí3 4
;
íí4 5
	converted
ìì  )
+=
ìì* ,
split
ìì- 2
.
ìì2 3

stackCount
ìì3 =
;
ìì= >
}
îî 
else
ïï  
{
ññ 
if
óó  "
(
óó# $$
DigitalStorageSettings
óó$ :
.
óó: ;!
enableConversionLog
óó; N
)
óóN O
{
òò  !
Log
ôô$ '
.
ôô' (
Message
ôô( /
(
ôô/ 0
$"
ôô0 2
$str
ôô2 b
{
ôôb c
(
ôôc d
split
ôôd i
!=
ôôj l
null
ôôm q
?
ôôr s
split
ôôt y
.
ôôy z

stackCountôôz Ñ
.ôôÑ Ö
ToStringôôÖ ç
(ôôç é
)ôôé è
:ôôê ë
$strôôí ò
)ôôò ô
}ôôô ö
"ôôö õ
)ôôõ ú
;ôôú ù
}
öö  !
}
õõ 
}
úú 
}
ùù 
if
üü 
(
üü $
DigitalStorageSettings
üü .
.
üü. /!
enableConversionLog
üü/ B
)
üüB C
{
†† 
Log
°° 
.
°° 
Message
°° #
(
°°# $
$"
°°$ &
$str
°°& N
{
°°N O
toConvertCount
°°O ]
}
°°] ^
$str
°°^ d
{
°°d e
	converted
°°e n
}
°°n o
"
°°o p
)
°°p q
;
°°q r
}
¢¢ 
}
££ 
}
§§ 
if
¶¶ 
(
¶¶ 
	toConvert
¶¶ 
.
¶¶ 
Count
¶¶ 
==
¶¶  "
$num
¶¶# $
)
¶¶$ %
{
ßß 
if
®® 
(
®® $
DigitalStorageSettings
®® *
.
®®* +!
enableConversionLog
®®+ >
)
®®> ?
{
©© 
Log
™™ 
.
™™ 
Message
™™ 
(
™™  
$"
™™  "
$str
™™" i
"
™™i j
)
™™j k
;
™™k l
}
´´ 
return
¨¨ 
;
¨¨ 
}
≠≠ 
if
ØØ 
(
ØØ $
DigitalStorageSettings
ØØ &
.
ØØ& '!
enableConversionLog
ØØ' :
)
ØØ: ;
{
∞∞ 
Log
±± 
.
±± 
Message
±± 
(
±± 
$"
±± 
$str
±± S
{
±±S T
	toConvert
±±T ]
.
±±] ^
Count
±±^ c
}
±±c d
$str
±±d h
"
±±h i
)
±±i j
;
±±j k
}
≤≤ 
if
µµ 
(
µµ 
activeConversions
µµ !
.
µµ! "
TryGetValue
µµ" -
(
µµ- .
core
µµ. 2
,
µµ2 3
out
µµ4 7
ConversionState
µµ8 G
existingState
µµH U
)
µµU V
)
µµV W
{
∂∂ 
foreach
∏∏ 
(
∏∏ 
Thing
∏∏ 
thing
∏∏ $
in
∏∏% '
	toConvert
∏∏( 1
)
∏∏1 2
{
ππ 
if
∫∫ 
(
∫∫ 
!
∫∫ 
existingState
∫∫ &
.
∫∫& '
	toConvert
∫∫' 0
.
∫∫0 1
Contains
∫∫1 9
(
∫∫9 :
thing
∫∫: ?
)
∫∫? @
)
∫∫@ A
{
ªª 
existingState
ºº %
.
ºº% &
	toConvert
ºº& /
.
ºº/ 0
Add
ºº0 3
(
ºº3 4
thing
ºº4 9
)
ºº9 :
;
ºº: ;
}
ΩΩ 
}
ææ 
}
øø 
else
¿¿ 
{
¡¡ 
activeConversions
√√ !
[
√√! "
core
√√" &
]
√√& '
=
√√( )
new
√√* -
ConversionState
√√. =
{
ƒƒ 
	toConvert
≈≈ 
=
≈≈ 
	toConvert
≈≈  )
}
∆∆ 
;
∆∆ 
}
«« 
}
»» 	
public
ÕÕ 
static
ÕÕ 
void
ÕÕ 
Update
ÕÕ !
(
ÕÕ! "
)
ÕÕ" #
{
ŒŒ 	
if
œœ 
(
œœ 
activeConversions
œœ !
.
œœ! "
Count
œœ" '
==
œœ( *
$num
œœ+ ,
)
œœ, -
{
–– 
return
—— 
;
—— 
}
““ 
List
‘‘ 
<
‘‘ "
Building_StorageCore
‘‘ %
>
‘‘% &
toRemove
‘‘' /
=
‘‘0 1
new
‘‘2 5
List
‘‘6 :
<
‘‘: ;"
Building_StorageCore
‘‘; O
>
‘‘O P
(
‘‘P Q
)
‘‘Q R
;
‘‘R S
foreach
÷÷ 
(
÷÷ 
var
÷÷ 
kvp
÷÷ 
in
÷÷ 
activeConversions
÷÷  1
)
÷÷1 2
{
◊◊ "
Building_StorageCore
ÿÿ $
core
ÿÿ% )
=
ÿÿ* +
kvp
ÿÿ, /
.
ÿÿ/ 0
Key
ÿÿ0 3
;
ÿÿ3 4
ConversionState
ŸŸ 
state
ŸŸ  %
=
ŸŸ& '
kvp
ŸŸ( +
.
ŸŸ+ ,
Value
ŸŸ, 1
;
ŸŸ1 2
if
€€ 
(
€€ 
core
€€ 
==
€€ 
null
€€  
||
€€! #
!
€€$ %
core
€€% )
.
€€) *
Spawned
€€* 1
||
€€2 4
!
€€5 6
core
€€6 :
.
€€: ;
Powered
€€; B
)
€€B C
{
‹‹ 
toRemove
›› 
.
›› 
Add
››  
(
››  !
core
››! %
)
››% &
;
››& '
continue
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
int
„„ 
prepared
„„ 
=
„„ 
$num
„„  
;
„„  !
while
‰‰ 
(
‰‰ 
state
‰‰ 
.
‰‰ 
dataPreparedIndex
‰‰ .
<
‰‰/ 0
state
‰‰1 6
.
‰‰6 7
	toConvert
‰‰7 @
.
‰‰@ A
Count
‰‰A F
&&
‰‰G I
prepared
‰‰J R
<
‰‰S T
state
‰‰U Z
.
‰‰Z [
itemsPerFrame
‰‰[ h
)
‰‰h i
{
ÂÂ 
Thing
ÊÊ 
thing
ÊÊ 
=
ÊÊ  !
state
ÊÊ" '
.
ÊÊ' (
	toConvert
ÊÊ( 1
[
ÊÊ1 2
state
ÊÊ2 7
.
ÊÊ7 8
dataPreparedIndex
ÊÊ8 I
]
ÊÊI J
;
ÊÊJ K
if
ËË 
(
ËË 
thing
ËË 
!=
ËË  
null
ËË! %
&&
ËË& (
thing
ËË) .
.
ËË. /
Spawned
ËË/ 6
&&
ËË7 9
!
ËË: ;
thing
ËË; @
.
ËË@ A
	Destroyed
ËËA J
)
ËËJ K
{
ÈÈ 
StoredItemData
ÎÎ &
data
ÎÎ' +
=
ÎÎ, -
new
ÎÎ. 1
StoredItemData
ÎÎ2 @
(
ÎÎ@ A
thing
ÎÎA F
)
ÎÎF G
;
ÎÎG H
state
ÏÏ 
.
ÏÏ 
preparedData
ÏÏ *
.
ÏÏ* +
Add
ÏÏ+ .
(
ÏÏ. /
new
ÏÏ/ 2
ItemData
ÏÏ3 ;
{
ÏÏ< =
thing
ÏÏ> C
=
ÏÏD E
thing
ÏÏF K
,
ÏÏK L
data
ÏÏM Q
=
ÏÏR S
data
ÏÏT X
}
ÏÏY Z
)
ÏÏZ [
;
ÏÏ[ \
}
ÌÌ 
state
ÔÔ 
.
ÔÔ 
dataPreparedIndex
ÔÔ +
++
ÔÔ+ -
;
ÔÔ- .
prepared
 
++
 
;
 
}
ÒÒ 
int
ıı 
	processed
ıı 
=
ıı 
$num
ıı  !
;
ıı! "
while
ˆˆ 
(
ˆˆ 
state
ˆˆ 
.
ˆˆ 
despawnIndex
ˆˆ )
<
ˆˆ* +
state
ˆˆ, 1
.
ˆˆ1 2
preparedData
ˆˆ2 >
.
ˆˆ> ?
Count
ˆˆ? D
&&
ˆˆE G
	processed
ˆˆH Q
<
ˆˆR S
state
ˆˆT Y
.
ˆˆY Z
itemsPerFrame
ˆˆZ g
)
ˆˆg h
{
˜˜ 
ItemData
¯¯ 
itemData
¯¯ %
=
¯¯& '
state
¯¯( -
.
¯¯- .
preparedData
¯¯. :
[
¯¯: ;
state
¯¯; @
.
¯¯@ A
despawnIndex
¯¯A M
]
¯¯M N
;
¯¯N O
Thing
˘˘ 
thing
˘˘ 
=
˘˘  !
itemData
˘˘" *
.
˘˘* +
thing
˘˘+ 0
;
˘˘0 1
StoredItemData
˙˙ "
data
˙˙# '
=
˙˙( )
itemData
˙˙* 2
.
˙˙2 3
data
˙˙3 7
;
˙˙7 8
if
¸¸ 
(
¸¸ 
thing
¸¸ 
!=
¸¸  
null
¸¸! %
&&
¸¸& (
thing
¸¸) .
.
¸¸. /
Spawned
¸¸/ 6
&&
¸¸7 9
data
¸¸: >
!=
¸¸? A
null
¸¸B F
)
¸¸F G
{
˝˝ 
core
ˇˇ 
.
ˇˇ 
StoreItemData
ˇˇ *
(
ˇˇ* +
data
ˇˇ+ /
)
ˇˇ/ 0
;
ˇˇ0 1
thing
ÇÇ 
.
ÇÇ 
DeSpawn
ÇÇ %
(
ÇÇ% &
DestroyMode
ÇÇ& 1
.
ÇÇ1 2
Vanish
ÇÇ2 8
)
ÇÇ8 9
;
ÇÇ9 :
}
ÉÉ 
state
ÖÖ 
.
ÖÖ 
despawnIndex
ÖÖ &
++
ÖÖ& (
;
ÖÖ( )
	processed
ÜÜ 
++
ÜÜ 
;
ÜÜ  
}
áá 
if
ãã 
(
ãã 
state
ãã 
.
ãã 
dataPreparedIndex
ãã +
>=
ãã, .
state
ãã/ 4
.
ãã4 5
	toConvert
ãã5 >
.
ãã> ?
Count
ãã? D
&&
ããE G
state
åå 
.
åå 
despawnIndex
åå &
>=
åå' )
state
åå* /
.
åå/ 0
preparedData
åå0 <
.
åå< =
Count
åå= B
)
ååB C
{
çç 
state
éé 
.
éé 
	toConvert
éé #
.
éé# $
Clear
éé$ )
(
éé) *
)
éé* +
;
éé+ ,
state
èè 
.
èè 
preparedData
èè &
.
èè& '
Clear
èè' ,
(
èè, -
)
èè- .
;
èè. /
toRemove
êê 
.
êê 
Add
êê  
(
êê  !
core
êê! %
)
êê% &
;
êê& '
}
ëë 
}
íí 
foreach
ïï 
(
ïï "
Building_StorageCore
ïï )
core
ïï* .
in
ïï/ 1
toRemove
ïï2 :
)
ïï: ;
{
ññ 
activeConversions
óó !
.
óó! "
Remove
óó" (
(
óó( )
core
óó) -
)
óó- .
;
óó. /
}
òò 
}
ôô 	
private
ûû 
static
ûû 
string
ûû 

GetItemKey
ûû (
(
ûû( )
Thing
ûû) .
thing
ûû/ 4
)
ûû4 5
{
üü 	
QualityCategory
†† 
quality
†† #
=
††$ %
thing
††& +
.
††+ ,

TryGetComp
††, 6
<
††6 7
CompQuality
††7 B
>
††B C
(
††C D
)
††D E
?
††E F
.
††F G
Quality
††G N
??
††O Q
QualityCategory
††R a
.
††a b
Normal
††b h
;
††h i
string
°° 
	stuffName
°° 
=
°° 
thing
°° $
.
°°$ %
Stuff
°°% *
?
°°* +
.
°°+ ,
defName
°°, 3
??
°°4 6
$str
°°7 =
;
°°= >
return
¢¢ 
$"
¢¢ 
{
¢¢ 
thing
¢¢ 
.
¢¢ 
def
¢¢ 
.
¢¢  
defName
¢¢  '
}
¢¢' (
$str
¢¢( )
{
¢¢) *
	stuffName
¢¢* 3
}
¢¢3 4
$str
¢¢4 5
{
¢¢5 6
quality
¢¢6 =
}
¢¢= >
"
¢¢> ?
;
¢¢? @
}
££ 	
public
®® 
static
®® 
bool
®® 
IsConverting
®® '
(
®®' ("
Building_StorageCore
®®( <
core
®®= A
)
®®A B
{
©© 	
return
™™ 
core
™™ 
!=
™™ 
null
™™ 
&&
™™  "
activeConversions
™™# 4
.
™™4 5
ContainsKey
™™5 @
(
™™@ A
core
™™A E
)
™™E F
;
™™F G
}
´´ 	
public
∞∞ 
static
∞∞ 
void
∞∞ 
ClearAll
∞∞ #
(
∞∞# $
)
∞∞$ %
{
±± 	
activeConversions
≤≤ 
.
≤≤ 
Clear
≤≤ #
(
≤≤# $
)
≤≤$ %
;
≤≤% &
}
≥≥ 	
}
¥¥ 
}µµ ¢
YB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Services\PawnStorageAccess.cs
	namespace 	
DigitalStorage
 
. 
Services !
{ 
public 

static 
class 
PawnStorageAccess )
{		 
public

 
static

 
bool

 
HasTerminalImplant

 -
(

- .
Pawn

. 2
pawn

3 7
)

7 8
{ 	
if 
( 
pawn 
== 
null 
|| 
pawn  $
.$ %
health% +
==, .
null/ 3
||4 6
pawn7 ;
.; <
health< B
.B C
	hediffSetC L
==M O
nullP T
)T U
{ 
return 
false 
; 
} 
if 
( 
pawn 
. 
health 
. 
	hediffSet %
.% &
	HasHediff& /
(/ 0
DefDatabase0 ;
<; <
	HediffDef< E
>E F
.F G
GetNamedG O
(O P
$strP p
,p q
falser w
)w x
,x y
falsez 
)	 Ä
)
Ä Å
{ 
return 
true 
; 
} 
if 
( 
pawn 
. 
IsColonyMech !
)! "
{ 
Pawn 
overseer 
= 
pawn  $
.$ %
GetOverseer% 0
(0 1
)1 2
;2 3
if 
( 
overseer 
!= 
null  $
&&% '
overseer( 0
.0 1
health1 7
!=8 :
null; ?
&&@ B
overseerC K
.K L
healthL R
.R S
	hediffSetS \
!=] _
null` d
)d e
{ 
if 
( 
overseer  
.  !
health! '
.' (
	hediffSet( 1
.1 2
	HasHediff2 ;
(; <
DefDatabase< G
<G H
	HediffDefH Q
>Q R
.R S
GetNamedS [
([ \
$str\ |
,| }
false	~ É
)
É Ñ
,
Ñ Ö
false
Ü ã
)
ã å
)
å ç
{ 
return 
true #
;# $
}   
}!! 
}"" 
return$$ 
false$$ 
;$$ 
}%% 	
}&& 
}'' “€
cB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Services\DigitalStorageGameComponent.cs
	namespace 	
DigitalStorage
 
. 
Services !
{ 
public 

class '
DigitalStorageGameComponent ,
:- .
GameComponent/ <
{ 
public '
DigitalStorageGameComponent *
(* +
Game+ /
game0 4
)4 5
{ 	
} 	
public 
override 
void 
GameComponentTick .
(. /
)/ 0
{ 	
base 
. 
GameComponentTick "
(" #
)# $
;$ %
} 	
public 
override 
void 
GameComponentUpdate 0
(0 1
)1 2
{ 	
base 
. 
GameComponentUpdate $
($ %
)% &
;& '
AsyncItemConverter!! 
.!! 
Update!! %
(!!% &
)!!& '
;!!' (
}"" 	
public$$ 
override$$ 
void$$ 

ExposeData$$ '
($$' (
)$$( )
{%% 	
base&& 
.&& 

ExposeData&& 
(&& 
)&& 
;&& 
Scribe_Collections'' 
.'' 
Look'' #
<''# $ 
Building_StorageCore''$ 8
>''8 9
(''9 :
ref'': =
this''> B
.''B C
globalCores''C N
,''N O
$str''P ]
,''] ^
LookMode''_ g
.''g h
	Reference''h q
)''q r
;''r s
if(( 
((( 
Scribe(( 
.(( 
mode(( 
==(( 
LoadSaveMode(( +
.((+ ,
LoadingVars((, 7
)((7 8
{)) 
if** 
(** 
this** 
.** 
globalCores** $
==**% '
null**( ,
)**, -
{++ 
this,, 
.,, 
globalCores,, $
=,,% &
new,,' *
List,,+ /
<,,/ 0 
Building_StorageCore,,0 D
>,,D E
(,,E F
),,F G
;,,G H
}-- 
this.. 
... 
RebuildCache.. !
(..! "
).." #
;..# $
}// 
}00 	
public22 
void22 
RegisterCore22  
(22  ! 
Building_StorageCore22! 5
core226 :
)22: ;
{33 	
Log44 
.44 
Message44 
(44 
$"44 
$str44 4
{444 5
core445 9
}449 :
$str44: E
{44E F
core44F J
?44J K
.44K L
Map44L O
}44O P
$str44P d
{44d e
core44e i
?44i j
.44j k
Map44k n
?44n o
.44o p
uniqueID44p x
}44x y
"44y z
)44z {
;44{ |
if66 
(66 
core66 
==66 
null66 
||66 
this66  $
.66$ %
globalCores66% 0
.660 1
Contains661 9
(669 :
core66: >
)66> ?
)66? @
{77 
return88 
;88 
}99 
this;; 
.;; 
globalCores;; 
.;; 
Add;;  
(;;  !
core;;! %
);;% &
;;;& '
Log<< 
.<< 
Message<< 
(<< 
$"<< 
$str<< T
{<<T U
this<<U Y
.<<Y Z
globalCores<<Z e
.<<e f
Count<<f k
}<<k l
"<<l m
)<<m n
;<<n o
if>> 
(>> 
core>> 
.>> 
Map>> 
!=>> 
null>>  
)>>  !
{?? 
if@@ 
(@@ 
!@@ 
this@@ 
.@@ 

coresByMap@@ $
.@@$ %
TryGetValue@@% 0
(@@0 1
core@@1 5
.@@5 6
Map@@6 9
,@@9 :
out@@; >
List@@? C
<@@C D 
Building_StorageCore@@D X
>@@X Y
list@@Z ^
)@@^ _
)@@_ `
{AA 
listBB 
=BB 
newBB 
ListBB #
<BB# $ 
Building_StorageCoreBB$ 8
>BB8 9
(BB9 :
)BB: ;
;BB; <
thisCC 
.CC 

coresByMapCC #
[CC# $
coreCC$ (
.CC( )
MapCC) ,
]CC, -
=CC. /
listCC0 4
;CC4 5
LogDD 
.DD 
MessageDD 
(DD  
$"DD  "
$strDD" ;
{DD; <
coreDD< @
.DD@ A
MapDDA D
.DDD E
uniqueIDDDE M
}DDM N
$strDDN T
"DDT U
)DDU V
;DDV W
}EE 
ifGG 
(GG 
!GG 
listGG 
.GG 
ContainsGG "
(GG" #
coreGG# '
)GG' (
)GG( )
{HH 
listII 
.II 
AddII 
(II 
coreII !
)II! "
;II" #
LogJJ 
.JJ 
MessageJJ 
(JJ  
$"JJ  "
$strJJ" Z
{JJZ [
thisJJ[ _
.JJ_ `

coresByMapJJ` j
.JJj k
CountJJk p
}JJp q
"JJq r
)JJr s
;JJs t
}KK 
}LL 
elseMM 
{NN 
LogOO 
.OO 
MessageOO 
(OO 
$"OO 
$strOO R
"OOR S
)OOS T
;OOT U
}PP 
}QQ 	
publicSS 
voidSS 
DeregisterCoreSS "
(SS" # 
Building_StorageCoreSS# 7
coreSS8 <
)SS< =
{TT 	
ifUU 
(UU 
coreUU 
==UU 
nullUU 
)UU 
{VV 
returnWW 
;WW 
}XX 
thisZZ 
.ZZ 
globalCoresZZ 
.ZZ 
RemoveZZ #
(ZZ# $
coreZZ$ (
)ZZ( )
;ZZ) *
if\\ 
(\\ 
core\\ 
.\\ 
Map\\ 
!=\\ 
null\\  
&&\\! #
this\\$ (
.\\( )

coresByMap\\) 3
.\\3 4
TryGetValue\\4 ?
(\\? @
core\\@ D
.\\D E
Map\\E H
,\\H I
out\\J M
List\\N R
<\\R S 
Building_StorageCore\\S g
>\\g h
list\\i m
)\\m n
)\\n o
{]] 
list^^ 
.^^ 
Remove^^ 
(^^ 
core^^  
)^^  !
;^^! "
}__ 
}`` 	
publicee 
Listee 
<ee  
Building_StorageCoreee (
>ee( )
GetAllCoresee* 5
(ee5 6
)ee6 7
{ff 	
thisgg 
.gg 
globalCoresgg 
.gg 
	RemoveAllgg &
(gg& '
(gg' ( 
Building_StorageCoregg( <
cgg= >
)gg> ?
=>gg@ B
cggC D
==ggE G
nullggH L
||ggM O
cggP Q
.ggQ R
	DestroyedggR [
)gg[ \
;gg\ ]
returnhh 
thishh 
.hh 
globalCoreshh #
;hh# $
}ii 	
publicnn 
Listnn 
<nn  
Building_StorageCorenn (
>nn( )
GetCoresOnMapnn* 7
(nn7 8
Mapnn8 ;
mapnn< ?
)nn? @
{oo 	
Logpp 
.pp 
Messagepp 
(pp 
$"pp 
$strpp 4
{pp4 5
mappp5 8
}pp8 9
$strpp9 H
{ppH I
mapppI L
?ppL M
.ppM N
uniqueIDppN V
}ppV W
"ppW X
)ppX Y
;ppY Z
Logqq 
.qq 
Messageqq 
(qq 
$"qq 
$strqq A
{qqA B
thisqqB F
.qqF G

coresByMapqqG Q
.qqQ R
CountqqR W
}qqW X
"qqX Y
)qqY Z
;qqZ [
foreachss 
(ss 
varss 
kvpss 
inss 
thisss  $
.ss$ %

coresByMapss% /
)ss/ 0
{tt 
Loguu 
.uu 
Messageuu 
(uu 
$"uu 
$struu C
{uuC D
kvpuuD G
.uuG H
KeyuuH K
}uuK L
$struuL [
{uu[ \
kvpuu\ _
.uu_ `
Keyuu` c
?uuc d
.uud e
uniqueIDuue m
}uum n
$struun |
{uu| }
kvp	uu} Ä
.
uuÄ Å
Value
uuÅ Ü
?
uuÜ á
.
uuá à
Count
uuà ç
}
uuç é
"
uué è
)
uuè ê
;
uuê ë
}vv 
ifxx 
(xx 
mapxx 
==xx 
nullxx 
)xx 
{yy 
Logzz 
.zz 
Messagezz 
(zz 
$"zz 
$strzz @
"zz@ A
)zzA B
;zzB C
return{{ 
new{{ 
List{{ 
<{{   
Building_StorageCore{{  4
>{{4 5
({{5 6
){{6 7
;{{7 8
}|| 
if~~ 
(~~ 
this~~ 
.~~ 

coresByMap~~ 
.~~  
TryGetValue~~  +
(~~+ ,
map~~, /
,~~/ 0
out~~1 4
List~~5 9
<~~9 : 
Building_StorageCore~~: N
>~~N O
list~~P T
)~~T U
)~~U V
{ 
Log
ÄÄ 
.
ÄÄ 
Message
ÄÄ 
(
ÄÄ 
$"
ÄÄ 
$str
ÄÄ <
{
ÄÄ< =
list
ÄÄ= A
.
ÄÄA B
Count
ÄÄB G
}
ÄÄG H
$str
ÄÄH L
"
ÄÄL M
)
ÄÄM N
;
ÄÄN O
list
ÅÅ 
.
ÅÅ 
	RemoveAll
ÅÅ 
(
ÅÅ 
(
ÅÅ  "
Building_StorageCore
ÅÅ  4
c
ÅÅ5 6
)
ÅÅ6 7
=>
ÅÅ8 :
c
ÅÅ; <
==
ÅÅ= ?
null
ÅÅ@ D
||
ÅÅE G
c
ÅÅH I
.
ÅÅI J
	Destroyed
ÅÅJ S
)
ÅÅS T
;
ÅÅT U
return
ÇÇ 
list
ÇÇ 
;
ÇÇ 
}
ÉÉ 
Log
ÖÖ 
.
ÖÖ 
Message
ÖÖ 
(
ÖÖ 
$"
ÖÖ 
$str
ÖÖ <
"
ÖÖ< =
)
ÖÖ= >
;
ÖÖ> ?
return
ÜÜ 
new
ÜÜ 
List
ÜÜ 
<
ÜÜ "
Building_StorageCore
ÜÜ 0
>
ÜÜ0 1
(
ÜÜ1 2
)
ÜÜ2 3
;
ÜÜ3 4
}
áá 	
private
åå 
void
åå 
RebuildCache
åå !
(
åå! "
)
åå" #
{
çç 	
Log
éé 
.
éé 
Message
éé 
(
éé 
$"
éé 
$str
éé H
{
ééH I
this
ééI M
.
ééM N
globalCores
ééN Y
.
ééY Z
Count
ééZ _
}
éé_ `
"
éé` a
)
ééa b
;
ééb c
this
êê 
.
êê 

coresByMap
êê 
.
êê 
Clear
êê !
(
êê! "
)
êê" #
;
êê# $
this
ëë 
.
ëë 
globalCores
ëë 
.
ëë 
	RemoveAll
ëë &
(
ëë& '
(
ëë' ("
Building_StorageCore
ëë( <
c
ëë= >
)
ëë> ?
=>
ëë@ B
c
ëëC D
==
ëëE G
null
ëëH L
||
ëëM O
c
ëëP Q
.
ëëQ R
	Destroyed
ëëR [
)
ëë[ \
;
ëë\ ]
foreach
ìì 
(
ìì "
Building_StorageCore
ìì )
core
ìì* .
in
ìì/ 1
this
ìì2 6
.
ìì6 7
globalCores
ìì7 B
)
ììB C
{
îî 
if
ïï 
(
ïï 
core
ïï 
.
ïï 
Map
ïï 
!=
ïï 
null
ïï  $
)
ïï$ %
{
ññ 
if
óó 
(
óó 
!
óó 
this
óó 
.
óó 

coresByMap
óó (
.
óó( )
TryGetValue
óó) 4
(
óó4 5
core
óó5 9
.
óó9 :
Map
óó: =
,
óó= >
out
óó? B
List
óóC G
<
óóG H"
Building_StorageCore
óóH \
>
óó\ ]
list
óó^ b
)
óób c
)
óóc d
{
òò 
list
ôô 
=
ôô 
new
ôô "
List
ôô# '
<
ôô' ("
Building_StorageCore
ôô( <
>
ôô< =
(
ôô= >
)
ôô> ?
;
ôô? @
this
öö 
.
öö 

coresByMap
öö '
[
öö' (
core
öö( ,
.
öö, -
Map
öö- 0
]
öö0 1
=
öö2 3
list
öö4 8
;
öö8 9
}
õõ 
list
úú 
.
úú 
Add
úú 
(
úú 
core
úú !
)
úú! "
;
úú" #
Log
ùù 
.
ùù 
Message
ùù 
(
ùù  
$"
ùù  "
$str
ùù" :
{
ùù: ;
core
ùù; ?
}
ùù? @
$str
ùù@ G
{
ùùG H
core
ùùH L
.
ùùL M
Map
ùùM P
.
ùùP Q
uniqueID
ùùQ Y
}
ùùY Z
"
ùùZ [
)
ùù[ \
;
ùù\ ]
}
ûû 
else
üü 
{
†† 
Log
°° 
.
°° 
Message
°° 
(
°°  
$"
°°  "
$str
°°" :
{
°°: ;
core
°°; ?
}
°°? @
$str
°°@ P
"
°°P Q
)
°°Q R
;
°°R S
}
¢¢ 
}
££ 
Log
•• 
.
•• 
Message
•• 
(
•• 
$"
•• 
$str
•• E
{
••E F
this
••F J
.
••J K

coresByMap
••K U
.
••U V
Count
••V [
}
••[ \
"
••\ ]
)
••] ^
;
••^ _
}
¶¶ 	
public
´´ "
Building_StorageCore
´´ #"
FindCoreWithItemType
´´$ 8
(
´´8 9
ThingDef
´´9 A
def
´´B E
,
´´E F
ThingDef
´´G O
stuff
´´P U
=
´´V W
null
´´X \
,
´´\ ]
Map
´´^ a
preferredMap
´´b n
=
´´o p
null
´´q u
)
´´u v
{
¨¨ 	
if
ÆÆ 
(
ÆÆ 
preferredMap
ÆÆ 
!=
ÆÆ 
null
ÆÆ  $
)
ÆÆ$ %
{
ØØ 
List
∞∞ 
<
∞∞ "
Building_StorageCore
∞∞ )
>
∞∞) *
mapCores
∞∞+ 3
=
∞∞4 5
this
∞∞6 :
.
∞∞: ;
GetCoresOnMap
∞∞; H
(
∞∞H I
preferredMap
∞∞I U
)
∞∞U V
;
∞∞V W
foreach
±± 
(
±± "
Building_StorageCore
±± -
core
±±. 2
in
±±3 5
mapCores
±±6 >
)
±±> ?
{
≤≤ 
if
≥≥ 
(
≥≥ 
core
≥≥ 
!=
≥≥ 
null
≥≥  $
&&
≥≥% '
core
≥≥( ,
.
≥≥, -
Spawned
≥≥- 4
&&
≥≥5 7
core
≥≥8 <
.
≥≥< =
Powered
≥≥= D
)
≥≥D E
{
¥¥ 
if
µµ 
(
µµ 
core
µµ  
.
µµ  !
HasItem
µµ! (
(
µµ( )
def
µµ) ,
,
µµ, -
stuff
µµ. 3
)
µµ3 4
)
µµ4 5
{
∂∂ 
return
∑∑ "
core
∑∑# '
;
∑∑' (
}
∏∏ 
}
ππ 
}
∫∫ 
}
ªª 
Map
ææ 
preferredBaseMap
ææ  
=
ææ! "

GetBaseMap
ææ# -
(
ææ- .
preferredMap
ææ. :
)
ææ: ;
;
ææ; <
HashSet
øø 
<
øø 
Map
øø 
>
øø 
searchedMaps
øø %
=
øø& '
new
øø( +
HashSet
øø, 3
<
øø3 4
Map
øø4 7
>
øø7 8
(
øø8 9
)
øø9 :
;
øø: ;
if
¿¿ 
(
¿¿ 
preferredMap
¿¿ 
!=
¿¿ 
null
¿¿  $
)
¿¿$ %
{
¡¡ 
searchedMaps
¬¬ 
.
¬¬ 
Add
¬¬  
(
¬¬  !
preferredMap
¬¬! -
)
¬¬- .
;
¬¬. /
}
√√ 
foreach
≈≈ 
(
≈≈ "
Building_StorageCore
≈≈ )
core
≈≈* .
in
≈≈/ 1
this
≈≈2 6
.
≈≈6 7
GetAllCores
≈≈7 B
(
≈≈B C
)
≈≈C D
)
≈≈D E
{
∆∆ 
if
«« 
(
«« 
core
«« 
==
«« 
null
««  
||
««! #
!
««$ %
core
««% )
.
««) *
Spawned
««* 1
||
««2 4
!
««5 6
core
««6 :
.
««: ;
Powered
««; B
||
««C E
core
««F J
.
««J K
Map
««K N
==
««O Q
null
««R V
)
««V W
{
»» 
continue
…… 
;
…… 
}
   
Map
ÕÕ 
coreBaseMap
ÕÕ 
=
ÕÕ  !

GetBaseMap
ÕÕ" ,
(
ÕÕ, -
core
ÕÕ- 1
.
ÕÕ1 2
Map
ÕÕ2 5
)
ÕÕ5 6
;
ÕÕ6 7
if
ŒŒ 
(
ŒŒ 
preferredBaseMap
ŒŒ $
!=
ŒŒ% '
null
ŒŒ( ,
&&
ŒŒ- /
coreBaseMap
ŒŒ0 ;
==
ŒŒ< >
preferredBaseMap
ŒŒ? O
)
ŒŒO P
{
œœ 
continue
–– 
;
–– 
}
—— 
if
‘‘ 
(
‘‘ 
searchedMaps
‘‘  
.
‘‘  !
Contains
‘‘! )
(
‘‘) *
core
‘‘* .
.
‘‘. /
Map
‘‘/ 2
)
‘‘2 3
)
‘‘3 4
{
’’ 
continue
÷÷ 
;
÷÷ 
}
◊◊ 
if
ŸŸ 
(
ŸŸ 
core
ŸŸ 
.
ŸŸ 
HasItem
ŸŸ  
(
ŸŸ  !
def
ŸŸ! $
,
ŸŸ$ %
stuff
ŸŸ& +
)
ŸŸ+ ,
)
ŸŸ, -
{
⁄⁄ 
return
€€ 
core
€€ 
;
€€  
}
‹‹ 
searchedMaps
ﬂﬂ 
.
ﬂﬂ 
Add
ﬂﬂ  
(
ﬂﬂ  !
core
ﬂﬂ! %
.
ﬂﬂ% &
Map
ﬂﬂ& )
)
ﬂﬂ) *
;
ﬂﬂ* +
}
‡‡ 
return
‚‚ 
null
‚‚ 
;
‚‚ 
}
„„ 	
private
ËË 
Map
ËË 

GetBaseMap
ËË 
(
ËË 
Map
ËË "
map
ËË# &
)
ËË& '
{
ÈÈ 	
if
ÍÍ 
(
ÍÍ 
map
ÍÍ 
==
ÍÍ 
null
ÍÍ 
)
ÍÍ 
{
ÎÎ 
return
ÏÏ 
null
ÏÏ 
;
ÏÏ 
}
ÌÌ 
try
 
{
ÒÒ 
var
ÚÚ 
baseMapMethod
ÚÚ !
=
ÚÚ" #
typeof
ÚÚ$ *
(
ÚÚ* +
Map
ÚÚ+ .
)
ÚÚ. /
.
ÚÚ/ 0
	GetMethod
ÚÚ0 9
(
ÚÚ9 :
$str
ÚÚ: C
,
ÚÚC D
System
ÚÚE K
.
ÚÚK L

Reflection
ÚÚL V
.
ÚÚV W
BindingFlags
ÚÚW c
.
ÚÚc d
Public
ÚÚd j
|
ÚÚk l
System
ÚÚm s
.
ÚÚs t

Reflection
ÚÚt ~
.
ÚÚ~ 
BindingFlagsÚÚ ã
.ÚÚã å
InstanceÚÚå î
)ÚÚî ï
;ÚÚï ñ
if
ÛÛ 
(
ÛÛ 
baseMapMethod
ÛÛ !
!=
ÛÛ" $
null
ÛÛ% )
)
ÛÛ) *
{
ÙÙ 
return
ıı 
baseMapMethod
ıı (
.
ıı( )
Invoke
ıı) /
(
ıı/ 0
map
ıı0 3
,
ıı3 4
null
ıı5 9
)
ıı9 :
as
ıı; =
Map
ıı> A
??
ııB D
map
ııE H
;
ııH I
}
ˆˆ 
}
˜˜ 
catch
¯¯ 
{
˘˘ 
}
˚˚ 
return
˝˝ 
map
˝˝ 
;
˝˝ 
}
˛˛ 	
public
ÉÉ "
Building_StorageCore
ÉÉ #
FindCoreWithItem
ÉÉ$ 4
(
ÉÉ4 5
Thing
ÉÉ5 :
item
ÉÉ; ?
)
ÉÉ? @
{
ÑÑ 	
if
ÖÖ 
(
ÖÖ 
item
ÖÖ 
==
ÖÖ 
null
ÖÖ 
)
ÖÖ 
{
ÜÜ 
return
áá 
null
áá 
;
áá 
}
àà 
if
ãã 
(
ãã 
item
ãã 
.
ãã 
Spawned
ãã 
&&
ãã 
item
ãã  $
.
ãã$ %
Map
ãã% (
!=
ãã) +
null
ãã, 0
)
ãã0 1
{
åå (
DigitalStorageMapComponent
çç *
mapComp
çç+ 2
=
çç3 4
item
çç5 9
.
çç9 :
Map
çç: =
.
çç= >
GetComponent
çç> J
<
ççJ K(
DigitalStorageMapComponent
ççK e
>
ççe f
(
ççf g
)
ççg h
;
ççh i"
Building_StorageCore
éé $
core
éé% )
=
éé* +
mapComp
éé, 3
?
éé3 4
.
éé4 5
FindCoreWithItem
éé5 E
(
ééE F
item
ééF J
)
ééJ K
;
ééK L
if
èè 
(
èè 
core
èè 
!=
èè 
null
èè  
)
èè  !
{
êê 
return
ëë 
core
ëë 
;
ëë  
}
íí 
}
ìì 
return
ññ 
this
ññ 
.
ññ "
FindCoreWithItemType
ññ ,
(
ññ, -
item
ññ- 1
.
ññ1 2
def
ññ2 5
,
ññ5 6
item
ññ7 ;
.
ññ; <
Stuff
ññ< A
,
ññA B
item
ññC G
.
ññG H
Map
ññH K
)
ññK L
;
ññL M
}
óó 	
public
úú 
Thing
úú -
TryExtractItemFromAnyCoreGlobal
úú 4
(
úú4 5
ThingDef
úú5 =
def
úú> A
,
úúA B
int
úúC F
count
úúG L
,
úúL M
ThingDef
úúN V
stuff
úúW \
=
úú] ^
null
úú_ c
,
úúc d
Map
úúe h
preferredMap
úúi u
=
úúv w
null
úúx |
)
úú| }
{
ùù 	
if
üü 
(
üü 
preferredMap
üü 
!=
üü 
null
üü  $
)
üü$ %
{
†† 
List
°° 
<
°° "
Building_StorageCore
°° )
>
°°) *
mapCores
°°+ 3
=
°°4 5
this
°°6 :
.
°°: ;
GetCoresOnMap
°°; H
(
°°H I
preferredMap
°°I U
)
°°U V
;
°°V W
foreach
¢¢ 
(
¢¢ "
Building_StorageCore
¢¢ -
core
¢¢. 2
in
¢¢3 5
mapCores
¢¢6 >
)
¢¢> ?
{
££ 
if
§§ 
(
§§ 
core
§§ 
!=
§§ 
null
§§  $
&&
§§% '
core
§§( ,
.
§§, -
Spawned
§§- 4
&&
§§5 7
core
§§8 <
.
§§< =
Powered
§§= D
)
§§D E
{
•• 
if
¶¶ 
(
¶¶ 
core
¶¶  
.
¶¶  !
HasItem
¶¶! (
(
¶¶( )
def
¶¶) ,
,
¶¶, -
stuff
¶¶. 3
)
¶¶3 4
)
¶¶4 5
{
ßß 
Thing
®® !
	extracted
®®" +
=
®®, -
core
®®. 2
.
®®2 3
ExtractItem
®®3 >
(
®®> ?
def
®®? B
,
®®B C
count
®®D I
,
®®I J
stuff
®®K P
)
®®P Q
;
®®Q R
if
©© 
(
©©  
	extracted
©©  )
!=
©©* ,
null
©©- 1
)
©©1 2
{
™™ 
return
´´  &
	extracted
´´' 0
;
´´0 1
}
¨¨ 
}
≠≠ 
}
ÆÆ 
}
ØØ 
}
∞∞ 
Map
≥≥ 
preferredBaseMap
≥≥  
=
≥≥! "

GetBaseMap
≥≥# -
(
≥≥- .
preferredMap
≥≥. :
)
≥≥: ;
;
≥≥; <
HashSet
¥¥ 
<
¥¥ 
Map
¥¥ 
>
¥¥ 
searchedMaps
¥¥ %
=
¥¥& '
new
¥¥( +
HashSet
¥¥, 3
<
¥¥3 4
Map
¥¥4 7
>
¥¥7 8
(
¥¥8 9
)
¥¥9 :
;
¥¥: ;
if
µµ 
(
µµ 
preferredMap
µµ 
!=
µµ 
null
µµ  $
)
µµ$ %
{
∂∂ 
searchedMaps
∑∑ 
.
∑∑ 
Add
∑∑  
(
∑∑  !
preferredMap
∑∑! -
)
∑∑- .
;
∑∑. /
}
∏∏ 
foreach
∫∫ 
(
∫∫ "
Building_StorageCore
∫∫ )
core
∫∫* .
in
∫∫/ 1
this
∫∫2 6
.
∫∫6 7
GetAllCores
∫∫7 B
(
∫∫B C
)
∫∫C D
)
∫∫D E
{
ªª 
if
ºº 
(
ºº 
core
ºº 
==
ºº 
null
ºº  
||
ºº! #
!
ºº$ %
core
ºº% )
.
ºº) *
Spawned
ºº* 1
||
ºº2 4
!
ºº5 6
core
ºº6 :
.
ºº: ;
Powered
ºº; B
||
ººC E
core
ººF J
.
ººJ K
Map
ººK N
==
ººO Q
null
ººR V
)
ººV W
{
ΩΩ 
continue
ææ 
;
ææ 
}
øø 
Map
¬¬ 
coreBaseMap
¬¬ 
=
¬¬  !

GetBaseMap
¬¬" ,
(
¬¬, -
core
¬¬- 1
.
¬¬1 2
Map
¬¬2 5
)
¬¬5 6
;
¬¬6 7
if
√√ 
(
√√ 
preferredBaseMap
√√ $
!=
√√% '
null
√√( ,
&&
√√- /
coreBaseMap
√√0 ;
==
√√< >
preferredBaseMap
√√? O
)
√√O P
{
ƒƒ 
continue
≈≈ 
;
≈≈ 
}
∆∆ 
if
…… 
(
…… 
searchedMaps
……  
.
……  !
Contains
……! )
(
……) *
core
……* .
.
……. /
Map
……/ 2
)
……2 3
)
……3 4
{
   
continue
ÀÀ 
;
ÀÀ 
}
ÃÃ 
if
ŒŒ 
(
ŒŒ 
core
ŒŒ 
.
ŒŒ 
HasItem
ŒŒ  
(
ŒŒ  !
def
ŒŒ! $
,
ŒŒ$ %
stuff
ŒŒ& +
)
ŒŒ+ ,
)
ŒŒ, -
{
œœ 
Thing
–– 
	extracted
–– #
=
––$ %
core
––& *
.
––* +
ExtractItem
––+ 6
(
––6 7
def
––7 :
,
––: ;
count
––< A
,
––A B
stuff
––C H
)
––H I
;
––I J
if
—— 
(
—— 
	extracted
—— !
!=
——" $
null
——% )
)
——) *
{
““ 
return
”” 
	extracted
”” (
;
””( )
}
‘‘ 
}
’’ 
searchedMaps
ÿÿ 
.
ÿÿ 
Add
ÿÿ  
(
ÿÿ  !
core
ÿÿ! %
.
ÿÿ% &
Map
ÿÿ& )
)
ÿÿ) *
;
ÿÿ* +
}
ŸŸ 
return
€€ 
null
€€ 
;
€€ 
}
‹‹ 	
private
ﬁﬁ 
List
ﬁﬁ 
<
ﬁﬁ "
Building_StorageCore
ﬁﬁ )
>
ﬁﬁ) *
globalCores
ﬁﬁ+ 6
=
ﬁﬁ7 8
new
ﬁﬁ9 <
List
ﬁﬁ= A
<
ﬁﬁA B"
Building_StorageCore
ﬁﬁB V
>
ﬁﬁV W
(
ﬁﬁW X
)
ﬁﬁX Y
;
ﬁﬁY Z
private
ﬂﬂ 

Dictionary
ﬂﬂ 
<
ﬂﬂ 
Map
ﬂﬂ 
,
ﬂﬂ 
List
ﬂﬂ  $
<
ﬂﬂ$ %"
Building_StorageCore
ﬂﬂ% 9
>
ﬂﬂ9 :
>
ﬂﬂ: ;

coresByMap
ﬂﬂ< F
=
ﬂﬂG H
new
ﬂﬂI L

Dictionary
ﬂﬂM W
<
ﬂﬂW X
Map
ﬂﬂX [
,
ﬂﬂ[ \
List
ﬂﬂ] a
<
ﬂﬂa b"
Building_StorageCore
ﬂﬂb v
>
ﬂﬂv w
>
ﬂﬂw x
(
ﬂﬂx y
)
ﬂﬂy z
;
ﬂﬂz {
}
‡‡ 
}·· ÿ#
iB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Achtung_Compatibility.cs
	namespace		 	
DigitalStorage		
 
.		 
HarmonyPatches		 '
{

 
[ 
HarmonyPatch 
( 
typeof 
( 
ReservationManager +
)+ ,
,, -
$str. :
): ;
]; <
public 

static 
class 7
+Patch_ReservationManager_CanReserve_Achtung C
{ 
public 
static 
void 
Postfix "
(" #
ref 
bool 
__result 
, 
ReservationManager 

__instance )
,) *
Pawn 
claimant 
, 
LocalTargetInfo 
target "
," #
int 
maxPawns 
, 
int 

stackCount 
, 
ReservationLayerDef 
layer  %
,% &
bool #
ignoreOtherReservations (
)( )
{ 	
if 
( 
__result 
) 
{ 
return 
; 
} 
if"" 
("" 
!"" 
target"" 
."" 
HasThing""  
)""  !
{## 
return$$ 
;$$ 
}%% 
Thing'' 
thing'' 
='' 
target''  
.''  !
Thing''! &
;''& '
if(( 
((( 
thing(( 
==(( 
null(( 
||((  
claimant((! )
==((* ,
null((- 1
)((1 2
{)) 
return** 
;** 
}++ 
if.. 
(.. 
!.. 
PawnStorageAccess.. "
..." #
HasTerminalImplant..# 5
(..5 6
claimant..6 >
)..> ?
)..? @
{// 
return00 
;00 
}11 
if44 
(44 
thing44 
.44 
Map44 
==44 
claimant44 %
.44% &
Map44& )
)44) *
{55 
return66 
;66 
}77 
Game:: 
game:: 
=:: 
Current:: 
.::  
Game::  $
;::$ %'
DigitalStorageGameComponent;; '
gameComp;;( 0
=;;1 2
(;;3 4
game;;4 8
!=;;9 ;
null;;< @
);;@ A
?;;B C
game;;D H
.;;H I
GetComponent;;I U
<;;U V'
DigitalStorageGameComponent;;V q
>;;q r
(;;r s
);;s t
:;;u v
null;;w {
;;;{ |
if<< 
(<< 
gameComp<< 
==<< 
null<<  
)<<  !
{== 
return>> 
;>> 
}??  
Building_StorageCoreBB  
coreBB! %
=BB& '
gameCompBB( 0
.BB0 1
FindCoreWithItemBB1 A
(BBA B
thingBBB G
)BBG H
;BBH I
ifCC 
(CC 
coreCC 
==CC 
nullCC 
||CC 
!CC  !
coreCC! %
.CC% &
PoweredCC& -
)CC- .
{DD 
returnEE 
;EE 
}FF 
	SlotGroupII 
	slotGroupII 
=II  !
coreII" &
.II& '
GetSlotGroupII' 3
(II3 4
)II4 5
;II5 6
ifJJ 
(JJ 
	slotGroupJJ 
==JJ 
nullJJ !
)JJ! "
{KK 
returnLL 
;LL 
}MM 
boolOO 

itemInCoreOO 
=OO 
falseOO #
;OO# $
foreachPP 
(PP 
ThingPP 
	heldThingPP $
inPP% '
	slotGroupPP( 1
.PP1 2

HeldThingsPP2 <
)PP< =
{QQ 
ifRR 
(RR 
	heldThingRR 
==RR  
thingRR! &
)RR& '
{SS 

itemInCoreTT 
=TT  
trueTT! %
;TT% &
breakUU 
;UU 
}VV 
}WW 
ifYY 
(YY 
!YY 

itemInCoreYY 
)YY 
{ZZ 
return[[ 
;[[ 
}\\ 
__result__ 
=__ 
true__ 
;__ 
}`` 	
}aa 
}bb Œ'
oB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_PickUpAndHaul_Compatibility.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[

 
HarmonyPatch

 
(

 
typeof

 
(

 
Pawn_JobTracker

 (
)

( )
,

) *
$str

+ 5
)

5 6
]

6 7
public 

static 
class +
Patch_PickUpAndHaul_FixJobCount 7
{ 
public 
static 
void 
Prefix !
(! "
Job" %
newJob& ,
,, -
Pawn. 2
___pawn3 :
): ;
{ 	
if 
( 
newJob 
== 
null 
|| !
___pawn" )
==* ,
null- 1
)1 2
{ 
return 
; 
} 
if 
( 
newJob 
. 
def 
. 
defName "
!=# %
$str& 7
)7 8
{ 
return 
; 
} 
if 
( 
newJob 
. 
targetQueueA #
!=$ &
null' +
&&, .
newJob/ 5
.5 6

countQueue6 @
!=A C
nullD H
)H I
{ 
for 
( 
int 
i 
= 
$num 
; 
i  !
<" #
newJob$ *
.* +

countQueue+ 5
.5 6
Count6 ;
;; <
i= >
++> @
)@ A
{ 
if 
( 
newJob 
. 

countQueue )
[) *
i* +
]+ ,
<=- /
$num0 1
)1 2
{   
if"" 
("" 
i"" 
<"" 
newJob""  &
.""& '
targetQueueA""' 3
.""3 4
Count""4 9
&&"": <
newJob""= C
.""C D
targetQueueA""D P
[""P Q
i""Q R
]""R S
.""S T
HasThing""T \
)""\ ]
{## 
Thing$$ !
thing$$" '
=$$( )
newJob$$* 0
.$$0 1
targetQueueA$$1 =
[$$= >
i$$> ?
]$$? @
.$$@ A
Thing$$A F
;$$F G
newJob%% "
.%%" #

countQueue%%# -
[%%- .
i%%. /
]%%/ 0
=%%1 2
thing%%3 8
.%%8 9

stackCount%%9 C
;%%C D
}&& 
else'' 
{(( 
newJob)) "
.))" #

countQueue))# -
[))- .
i)). /
]))/ 0
=))1 2
$num))3 4
;))4 5
}** 
}++ 
},, 
}-- 
if00 
(00 
newJob00 
.00 
count00 
<=00 
$num00  !
&&00" $
newJob00% +
.00+ ,
targetA00, 3
.003 4
HasThing004 <
)00< =
{11 
newJob22 
.22 
count22 
=22 
newJob22 %
.22% &
targetA22& -
.22- .
Thing22. 3
.223 4

stackCount224 >
;22> ?
}33 
}44 	
}55 
[:: 
HarmonyPatch:: 
(:: 
typeof:: 
(:: 

Toils_Haul:: #
)::# $
,::$ %
$str::& :
)::: ;
]::; <
public;; 

static;; 
class;; 2
&Patch_PickUpAndHaul_ErrorCheckForCarry;; >
{<< 
public== 
static== 
void== 
Prefix== !
(==! "
Pawn==" &
pawn==' +
,==+ ,
Thing==- 2
	haulThing==3 <
)==< =
{>> 	
if?? 
(?? 
pawn?? 
==?? 
null?? 
||?? 
	haulThing??  )
==??* ,
null??- 1
)??1 2
{@@ 
returnAA 
;AA 
}BB 
JobDD 
curJobDD 
=DD 
pawnDD 
.DD 
CurJobDD $
;DD$ %
ifEE 
(EE 
curJobEE 
==EE 
nullEE 
)EE 
{FF 
returnGG 
;GG 
}HH 
ifKK 
(KK 
curJobKK 
.KK 
countKK 
<=KK 
$numKK  !
||KK" $
curJobKK% +
.KK+ ,
countKK, 1
>KK2 3
	haulThingKK4 =
.KK= >

stackCountKK> H
)KKH I
{LL 
curJobMM 
.MM 
countMM 
=MM 
	haulThingMM (
.MM( )

stackCountMM) 3
;MM3 4
}NN 
}OO 	
}PP 
}QQ §)
nB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_StaticConstructorOnStartup.cs
	namespace		 	
DigitalStorage		
 
.		 
HarmonyPatches		 '
{

 
[ 
HarmonyPatch 
( 
typeof 
( -
!StaticConstructorOnStartupUtility :
): ;
,; <
$str= F
)F G
]G H
public 

static 
class ,
 Patch_StaticConstructorOnStartup 8
{ 
public 
static 
void 
Postfix "
(" #
)# $
{ 	
ApplyCostMultiplier 
(  
)  !
;! "
} 	
private 
static 
void 
ApplyCostMultiplier /
(/ 0
)0 1
{ 	
float 

multiplier 
= "
DigitalStorageSettings 5
.5 6
costMultiplier6 D
;D E
if 
( 
Mathf 
. 
Approximately #
(# $

multiplier$ .
,. /
$num0 4
)4 5
)5 6
{ 
return 
; 
} 
List 
< 
string 
> 
defNames !
=" #
new$ '
List( ,
<, -
string- 3
>3 4
{ 
$str!! ,
,!!, -
$str"" ,
,"", -
$str## *
,##* +
$str$$ /
,$$/ 0
$str&& *
,&&* +
$str'' +
,''+ ,
$str(( *
,((* +
$str** -
}++ 
;++ 
foreach-- 
(-- 
string-- 
defName-- #
in--$ &
defNames--' /
)--/ 0
{.. 
ThingDef// 
thingDef// !
=//" #
DefDatabase//$ /
</// 0
ThingDef//0 8
>//8 9
.//9 :
GetNamedSilentFail//: L
(//L M
defName//M T
)//T U
;//U V
if00 
(00 
thingDef00 
!=00 
null00  $
&&00% '
thingDef00( 0
.000 1
costList001 9
!=00: <
null00= A
)00A B
{11 
List22 
<22 
ThingDefCountClass22 +
>22+ ,
newCostList22- 8
=229 :
new22; >
List22? C
<22C D
ThingDefCountClass22D V
>22V W
(22W X
)22X Y
;22Y Z
foreach33 
(33 
ThingDefCountClass33 /
cost330 4
in335 7
thingDef338 @
.33@ A
costList33A I
)33I J
{44 
int55 
newCount55 $
=55% &
Mathf55' ,
.55, -

RoundToInt55- 7
(557 8
cost558 <
.55< =
count55= B
*55C D

multiplier55E O
)55O P
;55P Q
if77 
(77 
newCount77 $
<77% &
$num77' (
)77( )
{88 
newCount99 $
=99% &
$num99' (
;99( )
}:: 
newCostList;; #
.;;# $
Add;;$ '
(;;' (
new;;( +
ThingDefCountClass;;, >
(;;> ?
cost;;? C
.;;C D
thingDef;;D L
,;;L M
newCount;;N V
);;V W
);;W X
;;;X Y
}<< 
thingDef== 
.== 
costList== %
===& '
newCostList==( 3
;==3 4
}>> 
}?? 
ListBB 
<BB 
stringBB 
>BB 
recipeDefNamesBB '
=BB( )
newBB* -
ListBB. 2
<BB2 3
stringBB3 9
>BB9 :
{CC 
$strDD /
,DD/ 0
$strEE 0
,EE0 1
$strFF /
,FF/ 0
$strGG 2
}HH 
;HH 
foreachJJ 
(JJ 
stringJJ 

recipeNameJJ &
inJJ' )
recipeDefNamesJJ* 8
)JJ8 9
{KK 
	RecipeDefLL 
	recipeDefLL #
=LL$ %
DefDatabaseLL& 1
<LL1 2
	RecipeDefLL2 ;
>LL; <
.LL< =
GetNamedSilentFailLL= O
(LLO P

recipeNameLLP Z
)LLZ [
;LL[ \
ifMM 
(MM 
	recipeDefMM 
!=MM  
nullMM! %
&&MM& (
	recipeDefMM) 2
.MM2 3
ingredientsMM3 >
!=MM? A
nullMMB F
)MMF G
{NN 
foreachOO 
(OO 
IngredientCountOO ,

ingredientOO- 7
inOO8 :
	recipeDefOO; D
.OOD E
ingredientsOOE P
)OOP Q
{PP 

ingredientQQ "
.QQ" #
SetBaseCountQQ# /
(QQ/ 0

ingredientQQ0 :
.QQ: ;
GetBaseCountQQ; G
(QQG H
)QQH I
*QQJ K

multiplierQQL V
)QQV W
;QQW X
}RR 
}SS 
}TT 
}UU 	
}VV 
}WW Ù
tB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_CompRottable_TicksUntilRotAtTemp.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
CompRottable %
)% &
,& '
$str( =
)= >
]> ?
public 

static 
class 2
&Patch_CompRottable_TicksUntilRotAtTemp >
{		 
public

 
static

 
bool

 
Prefix

 !
(

! "
CompRottable

" .

__instance

/ 9
,

9 :
ref

; >
int

? B
__result

C K
)

K L
{ 	
return 
true 
; 
} 	
} 
} •
gB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_CompRottable_Active.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
CompRottable %
)% &
,& '
$str( 0
,0 1

MethodType2 <
.< =
Getter= C
)C D
]D E
public 

static 
class %
Patch_CompRottable_Active 1
{		 
public

 
static

 
bool

 
Prefix

 !
(

! "
CompRottable

" .

__instance

/ 9
,

9 :
ref

; >
bool

? C
__result

D L
)

L M
{ 	
return 
true 
; 
} 	
} 
} ï#
hB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Thing_DrawGUIOverlay.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[		 
HarmonyPatch		 
(		 
typeof		 
(		 
Thing		 
)		 
,		  
$str		! 1
)		1 2
]		2 3
public

 

static

 
class

 &
Patch_Thing_DrawGUIOverlay

 2
{ 
public 
static 
bool 
Prefix !
(! "
Thing" '

__instance( 2
)2 3
{ 	
bool 
flag 
= 

__instance "
." #
def# &
.& '
category' /
!=0 2
ThingCategory3 @
.@ A
ItemA E
;E F
bool 
flag2 
; 
if 
( 
flag 
) 
{ 
flag2 
= 
true 
; 
} 
else 
{ 
bool 
flag3 
= 

__instance '
.' (
Map( +
==, .
null/ 3
;3 4
if 
( 
flag3 
) 
{ 
flag2 
= 
true  
;  !
} 
else 
{  
Building_StorageCore (
core) -
=. /
GridsUtility0 <
.< =
GetFirstThing= J
<J K 
Building_StorageCoreK _
>_ `
(` a

__instancea k
.k l
Positionl t
,t u

__instance	v Ä
.
Ä Å
Map
Å Ñ
)
Ñ Ö
;
Ö Ü
bool 
flag4 
=  
core! %
!=& (
null) -
&&. 0
core1 5
.5 6
Spawned6 =
&&> @
coreA E
.E F
PoweredF M
;M N
if 
( 
flag4 
) 
{   
	SlotGroup!! !
	slotGroup!!" +
=!!, -
StoreUtility!!. :
.!!: ;
GetSlotGroup!!; G
(!!G H

__instance!!H R
.!!R S
Position!!S [
,!![ \

__instance!!] g
.!!g h
Map!!h k
)!!k l
;!!l m
bool"" 
flag5"" "
=""# $
	slotGroup""% .
!=""/ 1
null""2 6
&&""7 9
	slotGroup"": C
.""C D
parent""D J
==""K M
core""N R
;""R S
if## 
(## 
flag5## !
)##! "
{$$ 
return%% "
false%%# (
;%%( )
}&& 
}''  
Building_DiskCabinet(( (
cabinet(() 0
=((1 2
GridsUtility((3 ?
.((? @
GetFirstThing((@ M
<((M N 
Building_DiskCabinet((N b
>((b c
(((c d

__instance((d n
.((n o
Position((o w
,((w x

__instance	((y É
.
((É Ñ
Map
((Ñ á
)
((á à
;
((à â
bool)) 
flag6)) 
=))  
cabinet))! (
!=))) +
null)), 0
&&))1 3
cabinet))4 ;
.)); <
Spawned))< C
;))C D
if** 
(** 
flag6** 
)** 
{++ 
	SlotGroup,, !

slotGroup2,," ,
=,,- .
StoreUtility,,/ ;
.,,; <
GetSlotGroup,,< H
(,,H I

__instance,,I S
.,,S T
Position,,T \
,,,\ ]

__instance,,^ h
.,,h i
Map,,i l
),,l m
;,,m n
bool-- 
flag7-- "
=--# $

slotGroup2--% /
!=--0 2
null--3 7
&&--8 :

slotGroup2--; E
.--E F
parent--F L
==--M O
cabinet--P W
;--W X
if.. 
(.. 
flag7.. !
)..! "
{// 
return00 "
false00# (
;00( )
}11 
}22 
flag233 
=33 
true33  
;33  !
}44 
}55 
return66 
flag266 
;66 
}77 	
}88 
}99 ‰
_B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Thing_Print.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[		 
HarmonyPatch		 
(		 
typeof		 
(		 
Thing		 
)		 
,		  
$str		! (
)		( )
]		) *
public

 

static

 
class

 
Patch_Thing_Print

 )
{ 
public 
static 
bool 
Prefix !
(! "
Thing" '

__instance( 2
,2 3
SectionLayer4 @
layerA F
)F G
{ 	
if 
( 

__instance 
. 
def 
. 
category '
!=( *
ThingCategory+ 8
.8 9
Item9 =
)= >
{ 
return 
true 
; 
} 
if 
( 

__instance 
. 
Map 
== !
null" &
)& '
{ 
return 
true 
; 
} 
	SlotGroup 
	slotGroup 
=  !
StoreUtility" .
.. /
GetSlotGroup/ ;
(; <

__instance< F
.F G
PositionG O
,O P

__instanceQ [
.[ \
Map\ _
)_ `
;` a
if 
( 
	slotGroup 
== 
null !
)! "
{ 
return 
true 
; 
}  
Building_StorageCore""  
core""! %
=""& '
	slotGroup""( 1
.""1 2
parent""2 8
as""9 ; 
Building_StorageCore""< P
;""P Q
if## 
(## 
core## 
!=## 
null## 
&&## 
core##  $
.##$ %
Spawned##% ,
&&##- /
core##0 4
.##4 5
Powered##5 <
)##< =
{$$ 
return%% 
false%% 
;%% 
}&&  
Building_DiskCabinet))  
cabinet))! (
=))) *
	slotGroup))+ 4
.))4 5
parent))5 ;
as))< > 
Building_DiskCabinet))? S
;))S T
if** 
(** 
cabinet** 
!=** 
null** 
&&**  "
cabinet**# *
.*** +
Spawned**+ 2
)**2 3
{++ 
return,, 
false,, 
;,, 
}-- 
return// 
true// 
;// 
}00 	
}11 
}22 Ï
hB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Thing_TryAbsorbStack.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
Thing 
) 
,  
$str! 1
)1 2
]2 3
public 

static 
class &
Patch_Thing_TryAbsorbStack 2
{		 
public

 
static

 
bool

 
Prefix

 !
(

! "
Thing

" '

__instance

( 2
,

2 3
Thing

4 9
other

: ?
,

? @
ref

A D
bool

E I
__result

J R
)

R S
{ 	
bool 
flag 
= !
Patch_StackProtection -
.- .
IsProtectedDisk. =
(= >

__instance> H
)H I
||J L!
Patch_StackProtectionM b
.b c
IsProtectedDiskc r
(r s
others x
)x y
;y z
bool 
flag2 
; 
if 
( 
flag 
) 
{ 
__result 
= 
false  
;  !
flag2 
= 
false 
; 
} 
else 
{ 
flag2 
= 
true 
; 
} 
return 
flag2 
; 
} 	
} 
} Ë
fB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Thing_CanStackWith.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
Thing 
) 
,  
$str! /
)/ 0
]0 1
public 

static 
class $
Patch_Thing_CanStackWith 0
{		 
public

 
static

 
bool

 
Prefix

 !
(

! "
Thing

" '

__instance

( 2
,

2 3
Thing

4 9
other

: ?
,

? @
ref

A D
bool

E I
__result

J R
)

R S
{ 	
bool 
flag 
= !
Patch_StackProtection -
.- .
IsProtectedDisk. =
(= >

__instance> H
)H I
||J L!
Patch_StackProtectionM b
.b c
IsProtectedDiskc r
(r s
others x
)x y
;y z
bool 
flag2 
; 
if 
( 
flag 
) 
{ 
__result 
= 
false  
;  !
flag2 
= 
false 
; 
} 
else 
{ 
flag2 
= 
true 
; 
} 
return 
flag2 
; 
} 	
} 
} ≥)
^B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\Dialog_RenameNetwork.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
public 

class  
Dialog_RenameNetwork %
:& '
Window( .
{ 
public		  
Dialog_RenameNetwork		 #
(		# $ 
Building_StorageCore		$ 8
core		9 =
)		= >
:

 
base

 
(

 
null

 
)

 
{ 	
this 
. 
core 
= 
core 
; 
this 
. 
curName 
= 
core 
.  
NetworkName  +
;+ ,
this 
. 

forcePause 
= 
true "
;" #
this 
. 
doCloseX 
= 
true  
;  !
this 
. #
absorbInputAroundWindow (
=) *
true+ /
;/ 0
this 
. !
closeOnClickedOutside &
=' (
true) -
;- .
} 	
public 
override 
Vector2 
InitialSize  +
{ 	
get 
{ 
return 
new 
Vector2 "
(" #
$num# '
,' (
$num) -
)- .
;. /
} 
} 	
public 
override 
void 
DoWindowContents -
(- .
Rect. 2
inRect3 9
)9 :
{ 	
Text 
. 
Font 
= 
GameFont  
.  !
Small! &
;& '
Widgets 
. 
Label 
( 
new 
Rect "
(" #
$num# %
,% &
$num' )
,) *
inRect+ 1
.1 2
width2 7
,7 8
$num9 <
)< =
,= >
$str? H
)H I
;I J
this   
.   
curName   
=   
Widgets   "
.  " #
	TextField  # ,
(  , -
new  - 0
Rect  1 5
(  5 6
$num  6 8
,  8 9
$num  : =
,  = >
inRect  ? E
.  E F
width  F K
,  K L
$num  M P
)  P Q
,  Q R
this  S W
.  W X
curName  X _
)  _ `
;  ` a
bool!! 
flag!! 
=!! 
Widgets!! 
.!!  

ButtonText!!  *
(!!* +
new!!+ .
Rect!!/ 3
(!!3 4
$num!!4 6
,!!6 7
inRect!!8 >
.!!> ?
height!!? E
-!!F G
$num!!H K
,!!K L
inRect!!M S
.!!S T
width!!T Y
/!!Z [
$num!!\ ^
-!!_ `
$num!!a c
,!!c d
$num!!e h
)!!h i
,!!i j
$str!!k o
,!!o p
true!!q u
,!!u v
true!!w {
,!!{ |
true	!!} Å
,
!!Å Ç
null
!!É á
)
!!á à
;
!!à â
if"" 
("" 
flag"" 
)"" 
{## 
bool$$ 
flag2$$ 
=$$ 
!$$ 
string$$ $
.$$$ %
IsNullOrEmpty$$% 2
($$2 3
this$$3 7
.$$7 8
curName$$8 ?
)$$? @
;$$@ A
if%% 
(%% 
flag2%% 
)%% 
{&& 
this'' 
.'' 
core'' 
.'' 
NetworkName'' )
=''* +
this'', 0
.''0 1
curName''1 8
;''8 9
}(( 
this)) 
.)) 
Close)) 
()) 
true)) 
)))  
;))  !
}** 
bool++ 
flag3++ 
=++ 
Widgets++  
.++  !

ButtonText++! +
(+++ ,
new++, /
Rect++0 4
(++4 5
inRect++5 ;
.++; <
width++< A
/++B C
$num++D F
+++G H
$num++I K
,++K L
inRect++M S
.++S T
height++T Z
-++[ \
$num++] `
,++` a
inRect++b h
.++h i
width++i n
/++o p
$num++q s
-++t u
$num++v x
,++x y
$num++z }
)++} ~
,++~ 
$str
++Ä Ñ
,
++Ñ Ö
true
++Ü ä
,
++ä ã
true
++å ê
,
++ê ë
true
++í ñ
,
++ñ ó
null
++ò ú
)
++ú ù
;
++ù û
if,, 
(,, 
flag3,, 
),, 
{-- 
this.. 
... 
Close.. 
(.. 
true.. 
)..  
;..  !
}// 
}00 	
private22  
Building_StorageCore22 $
core22% )
;22) *
private44 
string44 
curName44 
;44 
}55 
}66 œ?
_B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_TradeAction.cs
	namespace		 	
DigitalStorage		
 
.		 
HarmonyPatches		 '
{

 
[ 
HarmonyPatch 
( 
typeof 
( 
Pawn_TraderTracker +
)+ ,
,, -
$str. E
)E F
]F G
public 

static 
class 3
'Patch_TradeAction_GiveSoldThingToTrader ?
{ 
public 
static 
bool 
Prefix !
(! "
Thing" '
toGive( .
,. /
int0 3
countToGive4 ?
,? @
PawnA E
playerNegotiatorF V
)V W
{ 	
if 
( 
toGive 
== 
null 
) 
{ 
return 
true 
; 
} 
var 
	tradeInfo 
= 
TradeItemTracker ,
., -
GetTradeItemInfo- =
(= >
toGive> D
)D E
;E F
if 
( 
	tradeInfo 
== 
null !
)! "
{ 
return 
true 
; 
} 
if!! 
(!! 
	tradeInfo!! 
.!! 

sourceCore!! $
!=!!% '
null!!( ,
&&!!- /
	tradeInfo!!0 9
.!!9 :

sourceCore!!: D
.!!D E
Spawned!!E L
&&!!M O
	tradeInfo!!P Y
.!!Y Z

sourceCore!!Z d
.!!d e
Powered!!e l
)!!l m
{"" 
Thing$$ 
	extracted$$ 
=$$  !
	tradeInfo$$" +
.$$+ ,

sourceCore$$, 6
.$$6 7
ExtractItem$$7 B
($$B C
	tradeInfo$$C L
.$$L M
def$$M P
,$$P Q
countToGive$$R ]
,$$] ^
	tradeInfo$$_ h
.$$h i
stuffDef$$i q
)$$q r
;$$r s
if&& 
(&& 
	extracted&& 
!=&&  
null&&! %
)&&% &
{'' 
	extracted)) 
.)) 
Destroy)) %
())% &
DestroyMode))& 1
.))1 2
Vanish))2 8
)))8 9
;))9 :
if++ 
(++ "
DigitalStorageSettings++ .
.++. /
enableDebugLog++/ =
)++= >
{,, 
Log-- 
.-- 
Message-- #
(--# $
$"--$ &
$str--& 3
{--3 4
	tradeInfo--4 =
.--= >
def--> A
.--A B
label--B G
}--G H
$str--H J
{--J K
countToGive--K V
}--V W
"--W X
)--X Y
;--Y Z
}.. 
}// 
}00 
TradeItemTracker33 
.33 
UnregisterTradeItem33 0
(330 1
toGive331 7
)337 8
;338 9
return66 
false66 
;66 
}77 	
}88 
[== 
HarmonyPatch== 
(== 
typeof== 
(== 
TradeUtility== %
)==% &
,==& '
$str==( <
)==< =
]=== >
public>> 

static>> 
class>> 1
%Patch_TradeUtility_LaunchThingsOfType>> =
{?? 
public@@ 
static@@ 
bool@@ 
Prefix@@ !
(@@! "
ThingDef@@" *
resDef@@+ 1
,@@1 2
int@@3 6
debt@@7 ;
,@@; <
Map@@= @
map@@A D
,@@D E
	TradeShip@@F O
trader@@P V
)@@V W
{AA 	
ifBB 
(BB 
debtBB 
<=BB 
$numBB 
||BB 
mapBB  
==BB! #
nullBB$ (
)BB( )
{CC 
returnDD 
trueDD 
;DD 
}EE '
DigitalStorageGameComponentHH '
gameCompHH( 0
=HH1 2
CurrentHH3 :
.HH: ;
GameHH; ?
?HH? @
.HH@ A
GetComponentHHA M
<HHM N'
DigitalStorageGameComponentHHN i
>HHi j
(HHj k
)HHk l
;HHl m
ifII 
(II 
gameCompII 
==II 
nullII  
)II  !
{JJ 
returnKK 
trueKK 
;KK 
}LL 
intNN 
	remainingNN 
=NN 
debtNN  
;NN  !
foreachQQ 
(QQ  
Building_StorageCoreQQ )
coreQQ* .
inQQ/ 1
gameCompQQ2 :
.QQ: ;
GetAllCoresQQ; F
(QQF G
)QQG H
)QQH I
{RR 
ifSS 
(SS 
coreSS 
==SS 
nullSS  
||SS! #
!SS$ %
coreSS% )
.SS) *
SpawnedSS* 1
||SS2 4
!SS5 6
coreSS6 :
.SS: ;
PoweredSS; B
||SSC E
coreSSF J
.SSJ K
MapSSK N
!=SSO Q
mapSSR U
)SSU V
{TT 
continueUU 
;UU 
}VV 
ifXX 
(XX 
	remainingXX 
<=XX  
$numXX! "
)XX" #
{YY 
breakZZ 
;ZZ 
}[[ 
int^^ 
	available^^ 
=^^ 
core^^  $
.^^$ %
GetItemCount^^% 1
(^^1 2
resDef^^2 8
,^^8 9
null^^: >
)^^> ?
;^^? @
if__ 
(__ 
	available__ 
>__ 
$num__  !
)__! "
{`` 
intaa 
	toExtractaa !
=aa" #
Systemaa$ *
.aa* +
Mathaa+ /
.aa/ 0
Minaa0 3
(aa3 4
	availableaa4 =
,aa= >
	remainingaa? H
)aaH I
;aaI J
Thingbb 
	extractedbb #
=bb$ %
corebb& *
.bb* +
ExtractItembb+ 6
(bb6 7
resDefbb7 =
,bb= >
	toExtractbb? H
,bbH I
nullbbJ N
)bbN O
;bbO P
ifdd 
(dd 
	extracteddd !
!=dd" $
nulldd% )
)dd) *
{ee 
	remainingff !
-=ff" $
	extractedff% .
.ff. /

stackCountff/ 9
;ff9 :
	extractedgg !
.gg! "
Destroygg" )
(gg) *
DestroyModegg* 5
.gg5 6
Vanishgg6 <
)gg< =
;gg= >
ifii 
(ii "
DigitalStorageSettingsii 2
.ii2 3
enableDebugLogii3 A
)iiA B
{jj 
Logkk 
.kk  
Messagekk  '
(kk' (
$"kk( *
$strkk* 9
{kk9 :
resDefkk: @
.kk@ A
labelkkA F
}kkF G
$strkkG I
{kkI J
	extractedkkJ S
.kkS T

stackCountkkT ^
}kk^ _
"kk_ `
)kk` a
;kka b
}ll 
}mm 
}nn 
}oo 
ifrr 
(rr 
	remainingrr 
>rr 
$numrr 
)rr 
{ss 
returnvv 
truevv 
;vv 
}ww 
returnzz 
falsezz 
;zz 
}{{ 	
}|| 
[
ÅÅ 
HarmonyPatch
ÅÅ 
(
ÅÅ 
typeof
ÅÅ 
(
ÅÅ 
Dialog_Trade
ÅÅ %
)
ÅÅ% &
,
ÅÅ& '
$str
ÅÅ( /
)
ÅÅ/ 0
]
ÅÅ0 1
public
ÇÇ 

static
ÇÇ 
class
ÇÇ &
Patch_Dialog_Trade_Close
ÇÇ 0
{
ÉÉ 
public
ÑÑ 
static
ÑÑ 
void
ÑÑ 
Postfix
ÑÑ "
(
ÑÑ" #
)
ÑÑ# $
{
ÖÖ 	
TradeItemTracker
áá 
.
áá 
Clear
áá "
(
áá" #
)
áá# $
;
áá$ %
}
àà 	
}
ââ 
}ää §ë
`B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_TradeUtility.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( '
Building_OrbitalTradeBeacon 4
)4 5
,5 6
$str7 C
)C D
]D E
public 

static 
class /
#Patch_OrbitalTradeBeacon_AllPowered ;
{ 
public 
static 
void 
Postfix "
(" #
Map# &
map' *
,* +
ref, /
IEnumerable0 ;
<; <'
Building_OrbitalTradeBeacon< W
>W X
__resultY a
)a b
{ 	
if 
( 
map 
== 
null 
) 
{ 
return 
; 
} '
DigitalStorageGameComponent   '
gameComp  ( 0
=  1 2
Current  3 :
.  : ;
Game  ; ?
?  ? @
.  @ A
GetComponent  A M
<  M N'
DigitalStorageGameComponent  N i
>  i j
(  j k
)  k l
;  l m
if!! 
(!! 
gameComp!! 
==!! 
null!!  
)!!  !
{"" 
return## 
;## 
}$$ 
bool&& 
hasActiveCore&& 
=&&  
false&&! &
;&&& '
foreach'' 
(''  
Building_StorageCore'' )
core''* .
in''/ 1
gameComp''2 :
.'': ;
GetAllCores''; F
(''F G
)''G H
)''H I
{(( 
if)) 
()) 
core)) 
!=)) 
null))  
&&))! #
core))$ (
.))( )
Spawned))) 0
&&))1 3
core))4 8
.))8 9
Powered))9 @
&&))A C
core))D H
.))H I
Map))I L
==))M O
map))P S
)))S T
{** 
hasActiveCore++ !
=++" #
true++$ (
;++( )
break,, 
;,, 
}-- 
}.. 
if00 
(00 
!00 
hasActiveCore00 
)00 
{11 
return22 
;22 
}33 
if66 
(66 
__result66 
!=66 
null66  
&&66! #
__result66$ ,
.66, -
Any66- 0
(660 1
)661 2
)662 3
{77 
return88 
;88 
}99 
ListAA 
<AA '
Building_OrbitalTradeBeaconAA ,
>AA, -

allBeaconsAA. 8
=AA9 :
newAA; >
ListAA? C
<AAC D'
Building_OrbitalTradeBeaconAAD _
>AA_ `
(AA` a
)AAa b
;AAb c
foreachBB 
(BB 
BuildingBB 
buildingBB &
inBB' )
mapBB* -
.BB- .
listerBuildingsBB. =
.BB= > 
allBuildingsColonistBB> R
)BBR S
{CC 
ifDD 
(DD 
buildingDD 
isDD '
Building_OrbitalTradeBeaconDD  ;
beaconDD< B
)DDB C
{EE 

allBeaconsFF 
.FF 
AddFF "
(FF" #
beaconFF# )
)FF) *
;FF* +
}GG 
}HH 
ifJJ 
(JJ 

allBeaconsJJ 
.JJ 
CountJJ  
>JJ! "
$numJJ# $
)JJ$ %
{KK 
__resultMM 
=MM 

allBeaconsMM %
;MM% &
}NN 
}PP 	
}QQ 
[VV 
HarmonyPatchVV 
(VV 
typeofVV 
(VV 
TradeUtilityVV %
)VV% &
,VV& '
$strVV( E
)VVE F
]VVF G
publicWW 

staticWW 
classWW :
.Patch_TradeUtility_AllLaunchableThingsForTradeWW F
{XX 
publicYY 
staticYY 
voidYY 
PostfixYY "
(YY" #
MapYY# &
mapYY' *
,YY* +
refYY, /
IEnumerableYY0 ;
<YY; <
ThingYY< A
>YYA B
__resultYYC K
)YYK L
{ZZ 	
if[[ 
([[ 
map[[ 
==[[ 
null[[ 
)[[ 
{\\ 
return]] 
;]] 
}^^ '
DigitalStorageGameComponent`` '
gameComp``( 0
=``1 2
Current``3 :
.``: ;
Game``; ?
?``? @
.``@ A
GetComponent``A M
<``M N'
DigitalStorageGameComponent``N i
>``i j
(``j k
)``k l
;``l m
ifaa 
(aa 
gameCompaa 
==aa 
nullaa  
)aa  !
{bb 
returncc 
;cc 
}dd 
Listgg 
<gg 
Thinggg 
>gg 
tradableThingsgg &
=gg' (
newgg) ,
Listgg- 1
<gg1 2
Thinggg2 7
>gg7 8
(gg8 9
__resultgg9 A
)ggA B
;ggB C
TradeUtilityHelperjj 
.jj "
AddVirtualStorageItemsjj 5
(jj5 6
gameCompjj6 >
,jj> ?
mapjj@ C
,jjC D
tradableThingsjjE S
)jjS T
;jjT U
__resultll 
=ll 
tradableThingsll %
;ll% &
ifnn 
(nn "
DigitalStorageSettingsnn &
.nn& '
enableDebugLognn' 5
)nn5 6
{oo 
Logpp 
.pp 
Messagepp 
(pp 
$"pp 
$strpp M
{ppM N
tradableThingsppN \
.pp\ ]
Countpp] b
}ppb c
$strppc e
"ppe f
)ppf g
;ppg h
}qq 
}rr 	
}ss 
[xx 
HarmonyPatchxx 
(xx 
typeofxx 
(xx 
Pawn_TraderTrackerxx +
)xx+ ,
,xx, -
$strxx. H
)xxH I
]xxI J
publicyy 

staticyy 
classyy =
1Patch_Pawn_TraderTracker_ColonyThingsWillingToBuyyy I
{zz 
public{{ 
static{{ 
void{{ 
Postfix{{ "
({{" #
Pawn{{# '
playerNegotiator{{( 8
,{{8 9
Pawn{{: >
___pawn{{? F
,{{F G
ref{{H K
IEnumerable{{L W
<{{W X
Thing{{X ]
>{{] ^
__result{{_ g
){{g h
{|| 	
if}} 
(}} 
___pawn}} 
==}} 
null}} 
||}}  "
___pawn}}# *
.}}* +
Map}}+ .
==}}/ 1
null}}2 6
)}}6 7
{~~ 
return 
; 
}
ÄÄ )
DigitalStorageGameComponent
ÇÇ '
gameComp
ÇÇ( 0
=
ÇÇ1 2
Current
ÇÇ3 :
.
ÇÇ: ;
Game
ÇÇ; ?
?
ÇÇ? @
.
ÇÇ@ A
GetComponent
ÇÇA M
<
ÇÇM N)
DigitalStorageGameComponent
ÇÇN i
>
ÇÇi j
(
ÇÇj k
)
ÇÇk l
;
ÇÇl m
if
ÉÉ 
(
ÉÉ 
gameComp
ÉÉ 
==
ÉÉ 
null
ÉÉ  
)
ÉÉ  !
{
ÑÑ 
return
ÖÖ 
;
ÖÖ 
}
ÜÜ 
List
ââ 
<
ââ 
Thing
ââ 
>
ââ 
tradableThings
ââ &
=
ââ' (
new
ââ) ,
List
ââ- 1
<
ââ1 2
Thing
ââ2 7
>
ââ7 8
(
ââ8 9
__result
ââ9 A
)
ââA B
;
ââB C 
TradeUtilityHelper
åå 
.
åå $
AddVirtualStorageItems
åå 5
(
åå5 6
gameComp
åå6 >
,
åå> ?
___pawn
åå@ G
.
ååG H
Map
ååH K
,
ååK L
tradableThings
ååM [
)
åå[ \
;
åå\ ]
__result
éé 
=
éé 
tradableThings
éé %
;
éé% &
if
êê 
(
êê $
DigitalStorageSettings
êê &
.
êê& '
enableDebugLog
êê' 5
)
êê5 6
{
ëë 
Log
íí 
.
íí 
Message
íí 
(
íí 
$"
íí 
$str
íí J
{
ííJ K
tradableThings
ííK Y
.
ííY Z
Count
ííZ _
}
íí_ `
$str
íí` b
"
ííb c
)
ííc d
;
ííd e
}
ìì 
}
îî 	
}
ïï 
[
öö 
HarmonyPatch
öö 
(
öö 
typeof
öö 
(
öö 
	TradeDeal
öö "
)
öö" #
,
öö# $
$str
öö% 9
)
öö9 :
]
öö: ;
public
õõ 

static
õõ 
class
õõ 0
"Patch_TradeDeal_InSellablePosition
õõ :
{
úú 
public
ùù 
static
ùù 
bool
ùù 
Prefix
ùù !
(
ùù! "
Thing
ùù" '
t
ùù( )
,
ùù) *
ref
ùù+ .
string
ùù/ 5
reason
ùù6 <
,
ùù< =
ref
ùù> A
bool
ùùB F
__result
ùùG O
)
ùùO P
{
ûû 	
if
üü 
(
üü 
t
üü 
==
üü 
null
üü 
)
üü 
{
†† 
return
°° 
true
°° 
;
°° 
}
¢¢ 
if
•• 
(
•• 
TradeItemTracker
••  
.
••  !
GetTradeItemInfo
••! 1
(
••1 2
t
••2 3
)
••3 4
!=
••5 7
null
••8 <
)
••< =
{
¶¶ 
reason
ßß 
=
ßß 
null
ßß 
;
ßß 
__result
®® 
=
®® 
true
®® 
;
®®  
return
©© 
false
©© 
;
©© 
}
™™ 
return
¨¨ 
true
¨¨ 
;
¨¨ 
}
≠≠ 	
}
ÆÆ 
public
≥≥ 

static
≥≥ 
class
≥≥  
TradeUtilityHelper
≥≥ *
{
¥¥ 
public
µµ 
static
µµ 
void
µµ $
AddVirtualStorageItems
µµ 1
(
µµ1 2)
DigitalStorageGameComponent
µµ2 M
gameComp
µµN V
,
µµV W
Map
µµX [
map
µµ\ _
,
µµ_ `
List
µµa e
<
µµe f
Thing
µµf k
>
µµk l
tradableThings
µµm {
)
µµ{ |
{
∂∂ 	
if
∑∑ 
(
∑∑ 
gameComp
∑∑ 
==
∑∑ 
null
∑∑  
||
∑∑! #
map
∑∑$ '
==
∑∑( *
null
∑∑+ /
)
∑∑/ 0
{
∏∏ 
return
ππ 
;
ππ 
}
∫∫ 
foreach
ΩΩ 
(
ΩΩ "
Building_StorageCore
ΩΩ )
core
ΩΩ* .
in
ΩΩ/ 1
gameComp
ΩΩ2 :
.
ΩΩ: ;
GetAllCores
ΩΩ; F
(
ΩΩF G
)
ΩΩG H
)
ΩΩH I
{
ææ 
if
øø 
(
øø 
core
øø 
==
øø 
null
øø  
||
øø! #
!
øø$ %
core
øø% )
.
øø) *
Spawned
øø* 1
||
øø2 4
!
øø5 6
core
øø6 :
.
øø: ;
Powered
øø; B
||
øøC E
core
øøF J
.
øøJ K
Map
øøK N
!=
øøO Q
map
øøR U
)
øøU V
{
¿¿ 
continue
¡¡ 
;
¡¡ 
}
¬¬ 
foreach
≈≈ 
(
≈≈ 
StoredItemData
≈≈ '
itemData
≈≈( 0
in
≈≈1 3
core
≈≈4 8
.
≈≈8 9
GetAllStoredItems
≈≈9 J
(
≈≈J K
)
≈≈K L
)
≈≈L M
{
∆∆ 
if
«« 
(
«« 
itemData
««  
==
««! #
null
««$ (
||
««) +
itemData
««, 4
.
««4 5
def
««5 8
==
««9 ;
null
««< @
||
««A C
itemData
««D L
.
««L M

stackCount
««M W
<=
««X Z
$num
««[ \
)
««\ ]
{
»» 
continue
……  
;
……  !
}
   
Thing
ÕÕ 

tradeThing
ÕÕ $
=
ÕÕ% &

ThingMaker
ÕÕ' 1
.
ÕÕ1 2
	MakeThing
ÕÕ2 ;
(
ÕÕ; <
itemData
ÕÕ< D
.
ÕÕD E
def
ÕÕE H
,
ÕÕH I
itemData
ÕÕJ R
.
ÕÕR S
stuffDef
ÕÕS [
)
ÕÕ[ \
;
ÕÕ\ ]

tradeThing
ŒŒ 
.
ŒŒ 

stackCount
ŒŒ )
=
ŒŒ* +
itemData
ŒŒ, 4
.
ŒŒ4 5

stackCount
ŒŒ5 ?
;
ŒŒ? @
CompQuality
—— 
qualityComp
——  +
=
——, -

tradeThing
——. 8
.
——8 9

TryGetComp
——9 C
<
——C D
CompQuality
——D O
>
——O P
(
——P Q
)
——Q R
;
——R S
if
““ 
(
““ 
itemData
““  
.
““  !
quality
““! (
!=
““) +
QualityCategory
““, ;
.
““; <
Awful
““< A
&&
““B D
qualityComp
““E P
!=
““Q S
null
““T X
)
““X Y
{
”” 
qualityComp
‘‘ #
.
‘‘# $

SetQuality
‘‘$ .
(
‘‘. /
itemData
‘‘/ 7
.
‘‘7 8
quality
‘‘8 ?
,
‘‘? @"
ArtGenerationContext
‘‘A U
.
‘‘U V
Colony
‘‘V \
)
‘‘\ ]
;
‘‘] ^
}
’’ 
if
ÿÿ 
(
ÿÿ 
itemData
ÿÿ  
.
ÿÿ  !
	hitPoints
ÿÿ! *
>
ÿÿ+ ,
$num
ÿÿ- .
&&
ÿÿ/ 1

tradeThing
ÿÿ2 <
.
ÿÿ< =
def
ÿÿ= @
.
ÿÿ@ A
useHitPoints
ÿÿA M
)
ÿÿM N
{
ŸŸ 

tradeThing
⁄⁄ "
.
⁄⁄" #
	HitPoints
⁄⁄# ,
=
⁄⁄- .
itemData
⁄⁄/ 7
.
⁄⁄7 8
	hitPoints
⁄⁄8 A
;
⁄⁄A B
}
€€ 
TradeItemTracker
ﬁﬁ $
.
ﬁﬁ$ %
RegisterTradeItem
ﬁﬁ% 6
(
ﬁﬁ6 7

tradeThing
ﬁﬁ7 A
,
ﬁﬁA B
core
ﬁﬁC G
,
ﬁﬁG H
itemData
ﬁﬁI Q
)
ﬁﬁQ R
;
ﬁﬁR S
tradableThings
‡‡ "
.
‡‡" #
Add
‡‡# &
(
‡‡& '

tradeThing
‡‡' 1
)
‡‡1 2
;
‡‡2 3
}
·· 
}
‚‚ 
}
„„ 	
}
‰‰ 
public
ÈÈ 

static
ÈÈ 
class
ÈÈ 
TradeItemTracker
ÈÈ (
{
ÍÍ 
private
ÎÎ 
static
ÎÎ 
readonly
ÎÎ 

Dictionary
ÎÎ  *
<
ÎÎ* +
Thing
ÎÎ+ 0
,
ÎÎ0 1
TradeItemInfo
ÎÎ2 ?
>
ÎÎ? @
_tradeItems
ÎÎA L
=
ÎÎM N
new
ÎÎO R

Dictionary
ÎÎS ]
<
ÎÎ] ^
Thing
ÎÎ^ c
,
ÎÎc d
TradeItemInfo
ÎÎe r
>
ÎÎr s
(
ÎÎs t
)
ÎÎt u
;
ÎÎu v
public
ÌÌ 
class
ÌÌ 
TradeItemInfo
ÌÌ "
{
ÓÓ 	
public
ÔÔ "
Building_StorageCore
ÔÔ '

sourceCore
ÔÔ( 2
;
ÔÔ2 3
public
 
ThingDef
 
def
 
;
  
public
ÒÒ 
ThingDef
ÒÒ 
stuffDef
ÒÒ $
;
ÒÒ$ %
public
ÚÚ 
int
ÚÚ 

stackCount
ÚÚ !
;
ÚÚ! "
public
ÛÛ 
QualityCategory
ÛÛ "
quality
ÛÛ# *
;
ÛÛ* +
public
ÙÙ 
int
ÙÙ 
	hitPoints
ÙÙ  
;
ÙÙ  !
}
ıı 	
public
˜˜ 
static
˜˜ 
void
˜˜ 
RegisterTradeItem
˜˜ ,
(
˜˜, -
Thing
˜˜- 2

tradeThing
˜˜3 =
,
˜˜= >"
Building_StorageCore
˜˜? S
core
˜˜T X
,
˜˜X Y
StoredItemData
˜˜Z h
itemData
˜˜i q
)
˜˜q r
{
¯¯ 	
_tradeItems
˘˘ 
[
˘˘ 

tradeThing
˘˘ "
]
˘˘" #
=
˘˘$ %
new
˘˘& )
TradeItemInfo
˘˘* 7
{
˙˙ 

sourceCore
˚˚ 
=
˚˚ 
core
˚˚ !
,
˚˚! "
def
¸¸ 
=
¸¸ 
itemData
¸¸ 
.
¸¸ 
def
¸¸ "
,
¸¸" #
stuffDef
˝˝ 
=
˝˝ 
itemData
˝˝ #
.
˝˝# $
stuffDef
˝˝$ ,
,
˝˝, -

stackCount
˛˛ 
=
˛˛ 
itemData
˛˛ %
.
˛˛% &

stackCount
˛˛& 0
,
˛˛0 1
quality
ˇˇ 
=
ˇˇ 
itemData
ˇˇ "
.
ˇˇ" #
quality
ˇˇ# *
,
ˇˇ* +
	hitPoints
ÄÄ 
=
ÄÄ 
itemData
ÄÄ $
.
ÄÄ$ %
	hitPoints
ÄÄ% .
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
public
ÑÑ 
static
ÑÑ 
TradeItemInfo
ÑÑ #
GetTradeItemInfo
ÑÑ$ 4
(
ÑÑ4 5
Thing
ÑÑ5 :

tradeThing
ÑÑ; E
)
ÑÑE F
{
ÖÖ 	
if
ÜÜ 
(
ÜÜ 

tradeThing
ÜÜ 
==
ÜÜ 
null
ÜÜ "
)
ÜÜ" #
{
áá 
return
àà 
null
àà 
;
àà 
}
ââ 
TradeItemInfo
ää 
info
ää 
;
ää 
_tradeItems
ãã 
.
ãã 
TryGetValue
ãã #
(
ãã# $

tradeThing
ãã$ .
,
ãã. /
out
ãã0 3
info
ãã4 8
)
ãã8 9
;
ãã9 :
return
åå 
info
åå 
;
åå 
}
çç 	
public
èè 
static
èè 
void
èè !
UnregisterTradeItem
èè .
(
èè. /
Thing
èè/ 4

tradeThing
èè5 ?
)
èè? @
{
êê 	
if
ëë 
(
ëë 

tradeThing
ëë 
!=
ëë 
null
ëë "
)
ëë" #
{
íí 
_tradeItems
ìì 
.
ìì 
Remove
ìì "
(
ìì" #

tradeThing
ìì# -
)
ìì- .
;
ìì. /
}
îî 
}
ïï 	
public
óó 
static
óó 
void
óó 
Clear
óó  
(
óó  !
)
óó! "
{
òò 	
_tradeItems
ôô 
.
ôô 
Clear
ôô 
(
ôô 
)
ôô 
;
ôô  
}
öö 	
}
õõ 
}úú ˛2
uB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_RecipeWorkerCounter_CountProducts.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{		 
[ 
HarmonyPatch 
( 
typeof 
( 
RecipeWorkerCounter ,
), -
,- .
$str/ >
)> ?
]? @
public 

static 
class 3
'Patch_RecipeWorkerCounter_CountProducts ?
{ 
public 
static 
void 
Postfix "
(" #
ref# &
int' *
__result+ 3
,3 4
Bill_Production5 D
billE I
)I J
{ 	
if 
( 
bill 
== 
null 
|| 
bill  $
.$ %
recipe% +
==, .
null/ 3
||4 6
bill7 ;
.; <
recipe< B
.B C
productsC K
==L N
nullO S
||T V
billW [
.[ \
recipe\ b
.b c
productsc k
.k l
Countl q
==r t
$numu v
)v w
{ 
return 
; 
} '
DigitalStorageGameComponent '
gameComp( 0
=1 2
Current3 :
.: ;
Game; ?
?? @
.@ A
GetComponentA M
<M N'
DigitalStorageGameComponentN i
>i j
(j k
)k l
;l m
if 
( 
gameComp 
== 
null  
)  !
{ 
return 
; 
} 
ThingDefCountClass 
product &
=' (
bill) -
.- .
recipe. 4
.4 5
products5 =
[= >
$num> ?
]? @
;@ A
ThingDef   
	targetDef   
=    
product  ! (
.  ( )
thingDef  ) 1
;  1 2
if"" 
("" 
	targetDef"" 
=="" 
null"" !
)""! "
{## 
return$$ 
;$$ 
}%% 
int(( 
virtualCount(( 
=(( 
$num((  
;((  !
foreach** 
(**  
Building_StorageCore** )
core*** .
in**/ 1
gameComp**2 :
.**: ;
GetAllCores**; F
(**F G
)**G H
)**H I
{++ 
if,, 
(,, 
core,, 
==,, 
null,,  
||,,! #
!,,$ %
core,,% )
.,,) *
Spawned,,* 1
||,,2 4
!,,5 6
core,,6 :
.,,: ;
Powered,,; B
),,B C
{-- 
continue.. 
;.. 
}// 
foreach22 
(22 
var22 
itemData22 %
in22& (
core22) -
.22- .
GetAllStoredItems22. ?
(22? @
)22@ A
)22A B
{33 
if44 
(44 
itemData44  
.44  !
def44! $
!=44% '
	targetDef44( 1
)441 2
{55 
continue66  
;66  !
}77 
if:: 
(:: 
!:: 
IsValidForBill:: '
(::' (
itemData::( 0
,::0 1
bill::2 6
,::6 7
	targetDef::8 A
)::A B
)::B C
{;; 
continue<<  
;<<  !
}== 
virtualCount??  
+=??! #
itemData??$ ,
.??, -

stackCount??- 7
;??7 8
}@@ 
}AA 
__resultDD 
+=DD 
virtualCountDD $
;DD$ %
}EE 	
privateJJ 
staticJJ 
boolJJ 
IsValidForBillJJ *
(JJ* +
StoredItemDataJJ+ 9
itemDataJJ: B
,JJB C
Bill_ProductionJJD S
billJJT X
,JJX Y
ThingDefJJZ b
	targetDefJJc l
)JJl m
{KK 	
ifMM 
(MM 
!MM 
billMM 
.MM 
includeTaintedMM $
&&MM% '
	targetDefMM( 1
.MM1 2
	IsApparelMM2 ;
)MM; <
{NN 
}PP 
ifSS 
(SS 
	targetDefSS 
.SS 
useHitPointsSS &
&&SS' )
itemDataSS* 2
.SS2 3
	hitPointsSS3 <
>SS= >
$numSS? @
)SS@ A
{TT 
floatUU 
	hpPercentUU 
=UU  !
(UU" #
floatUU# (
)UU( )
itemDataUU) 1
.UU1 2
	hitPointsUU2 ;
/UU< =
	targetDefUU> G
.UUG H
BaseMaxHitPointsUUH X
;UUX Y
ifVV 
(VV 
!VV 
billVV 
.VV 
hpRangeVV !
.VV! "
IncludesEpsilonVV" 1
(VV1 2
	hpPercentVV2 ;
)VV; <
)VV< =
{WW 
returnXX 
falseXX  
;XX  !
}YY 
}ZZ 
if]] 
(]] 
itemData]] 
.]] 
quality]]  
!=]]! #
QualityCategory]]$ 3
.]]3 4
Normal]]4 :
)]]: ;
{^^ 
if__ 
(__ 
!__ 
bill__ 
.__ 
qualityRange__ &
.__& '
Includes__' /
(__/ 0
itemData__0 8
.__8 9
quality__9 @
)__@ A
)__A B
{`` 
returnaa 
falseaa  
;aa  !
}bb 
}cc 
ifff 
(ff 
billff 
.ff 
limitToAllowedStuffff (
&&ff) +
itemDataff, 4
.ff4 5
stuffDefff5 =
!=ff> @
nullffA E
)ffE F
{gg 
ifhh 
(hh 
!hh 
billhh 
.hh 
ingredientFilterhh *
.hh* +
Allowshh+ 1
(hh1 2
itemDatahh2 :
.hh: ;
stuffDefhh; C
)hhC D
)hhD E
{ii 
returnjj 
falsejj  
;jj  !
}kk 
}ll 
returnnn 
truenn 
;nn 
}oo 	
}pp 
}qq Ú>
cB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_ResourceCounter.cs
	namespace		 	
DigitalStorage		
 
.		 
HarmonyPatches		 '
{

 
[ 
HarmonyPatch 
( 
typeof 
( 
ResourceCounter (
)( )
,) *
$str+ 5
)5 6
]6 7
public 

static 
class *
Patch_ResourceCounter_GetCount 6
{ 
public 
static 
void 
Postfix "
(" #
ref# &
int' *
__result+ 3
,3 4
ThingDef5 =
rDef> B
,B C
ResourceCounterD S

__instanceT ^
)^ _
{ 	
if 
( 
rDef 
. #
resourceReadoutPriority ,
==- /!
ResourceCountPriority0 E
.E F
	UncountedF O
)O P
{ 
return 
; 
} 
Game 
game 
= 
Current 
.  
Game  $
;$ %'
DigitalStorageGameComponent '
gameComp( 0
=1 2
(3 4
game4 8
!=9 ;
null< @
)@ A
?B C
gameD H
.H I
GetComponentI U
<U V'
DigitalStorageGameComponentV q
>q r
(r s
)s t
:u v
nullw {
;{ |
if 
( 
gameComp 
== 
null  
)  !
{ 
return 
; 
} 
int"" 
totalInCores"" 
="" 
$num""  
;""  !
foreach$$ 
($$  
Building_StorageCore$$ )
core$$* .
in$$/ 1
gameComp$$2 :
.$$: ;
GetAllCores$$; F
($$F G
)$$G H
)$$H I
{%% 
if&& 
(&& 
core&& 
==&& 
null&&  
||&&! #
!&&$ %
core&&% )
.&&) *
Spawned&&* 1
||&&2 4
!&&5 6
core&&6 :
.&&: ;
Powered&&; B
)&&B C
{'' 
continue(( 
;(( 
})) 
totalInCores++ 
+=++ 
core++  $
.++$ %
GetItemCount++% 1
(++1 2
rDef++2 6
,++6 7
null++8 <
)++< =
;++= >
},, 
if// 
(// 
totalInCores// 
>// 
$num//  
)//  !
{00 
__result11 
+=11 
totalInCores11 (
;11( )
}22 
}33 	
}44 
[99 
HarmonyPatch99 
(99 
typeof99 
(99 
ResourceCounter99 (
)99( )
,99) *
$str99+ >
,99> ?

MethodType99@ J
.99J K
Getter99K Q
)99Q R
]99R S
public:: 

static:: 
class:: 3
'Patch_ResourceCounter_AllCountedAmounts:: ?
{;; 
public<< 
static<< 
void<< 
Postfix<< "
(<<" #
ref<<# &

Dictionary<<' 1
<<<1 2
ThingDef<<2 :
,<<: ;
int<<< ?
><<? @
__result<<A I
,<<I J
ResourceCounter<<K Z

__instance<<[ e
)<<e f
{== 	
Game?? 
game?? 
=?? 
Current?? 
.??  
Game??  $
;??$ %'
DigitalStorageGameComponent@@ '
gameComp@@( 0
=@@1 2
(@@3 4
game@@4 8
!=@@9 ;
null@@< @
)@@@ A
?@@B C
game@@D H
.@@H I
GetComponent@@I U
<@@U V'
DigitalStorageGameComponent@@V q
>@@q r
(@@r s
)@@s t
:@@u v
null@@w {
;@@{ |
ifAA 
(AA 
gameCompAA 
==AA 
nullAA  
)AA  !
{BB 
returnCC 
;CC 
}DD 

DictionaryGG 
<GG 
ThingDefGG 
,GG  
intGG! $
>GG$ %
	newResultGG& /
=GG0 1
newGG2 5

DictionaryGG6 @
<GG@ A
ThingDefGGA I
,GGI J
intGGK N
>GGN O
(GGO P
__resultGGP X
)GGX Y
;GGY Z
foreachJJ 
(JJ  
Building_StorageCoreJJ )
coreJJ* .
inJJ/ 1
gameCompJJ2 :
.JJ: ;
GetAllCoresJJ; F
(JJF G
)JJG H
)JJH I
{KK 
ifLL 
(LL 
coreLL 
==LL 
nullLL  
||LL! #
!LL$ %
coreLL% )
.LL) *
SpawnedLL* 1
||LL2 4
!LL5 6
coreLL6 :
.LL: ;
PoweredLL; B
)LLB C
{MM 
continueNN 
;NN 
}OO 
foreachRR 
(RR 
varRR 
itemRR !
inRR" $
coreRR% )
.RR) *
GetAllStoredItemsRR* ;
(RR; <
)RR< =
)RR= >
{SS 
ifTT 
(TT 
itemTT 
.TT 
defTT  
.TT  !#
resourceReadoutPriorityTT! 8
==TT9 ;!
ResourceCountPriorityTT< Q
.TTQ R
	UncountedTTR [
)TT[ \
{UU 
continueVV  
;VV  !
}WW 
ifYY 
(YY 
	newResultYY !
.YY! "
ContainsKeyYY" -
(YY- .
itemYY. 2
.YY2 3
defYY3 6
)YY6 7
)YY7 8
{ZZ 
	newResult[[ !
[[[! "
item[[" &
.[[& '
def[[' *
][[* +
+=[[, .
item[[/ 3
.[[3 4

stackCount[[4 >
;[[> ?
}\\ 
else]] 
{^^ 
	newResult__ !
[__! "
item__" &
.__& '
def__' *
]__* +
=__, -
item__. 2
.__2 3

stackCount__3 =
;__= >
}`` 
}aa 
	SlotGroupdd 
	slotGroupdd #
=dd$ %
coredd& *
.dd* +
GetSlotGroupdd+ 7
(dd7 8
)dd8 9
;dd9 :
ifee 
(ee 
	slotGroupee 
!=ee  
nullee! %
)ee% &
{ff 
foreachgg 
(gg 
Thinggg "
thinggg# (
ingg) +
	slotGroupgg, 5
.gg5 6

HeldThingsgg6 @
)gg@ A
{hh 
ifii 
(ii 
thingii !
!=ii" $
nullii% )
&&ii* ,
thingii- 2
.ii2 3
Spawnedii3 :
&&ii; =
thingii> C
.iiC D
defiiD G
.iiG H#
resourceReadoutPriorityiiH _
!=ii` b!
ResourceCountPriorityiic x
.iix y
	Uncounted	iiy Ç
)
iiÇ É
{jj 
ifkk 
(kk  
	newResultkk  )
.kk) *
ContainsKeykk* 5
(kk5 6
thingkk6 ;
.kk; <
defkk< ?
)kk? @
)kk@ A
{ll 
	newResultmm  )
[mm) *
thingmm* /
.mm/ 0
defmm0 3
]mm3 4
+=mm5 7
thingmm8 =
.mm= >

stackCountmm> H
;mmH I
}nn 
elseoo  
{pp 
	newResultqq  )
[qq) *
thingqq* /
.qq/ 0
defqq0 3
]qq3 4
=qq5 6
thingqq7 <
.qq< =

stackCountqq= G
;qqG H
}rr 
}ss 
}tt 
}uu 
}vv 
__resultxx 
=xx 
	newResultxx  
;xx  !
}yy 	
}zz 
}{{ ëW
dB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Designator_Build.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
Designator_Build )
)) *
,* +
$str, :
): ;
]; <
public 

static 
class /
#Patch_Designator_Build_ProcessInput ;
{ 
public 
static 
bool 
Prefix !
(! "
Designator_Build" 2

__instance3 =
,= >
Event? D
evE G
)G H
{ 	
if 
( 
Prefs 
. 
DevMode 
) 
{ 
bool 
originalGodMode $
=% &
DebugSettings' 4
.4 5
godMode5 <
;< =
try 
{ 
DebugSettings !
.! "
godMode" )
=* +
true, 0
;0 1
return 
true 
;  
}   
finally!! 
{"" 
DebugSettings## !
.##! "
godMode##" )
=##* +
originalGodMode##, ;
;##; <
}$$ 
}%% 
bool(( 
canInteract(( 
=(( 
(((  
bool((  $
)(($ %
AccessTools((% 0
.((0 1
Method((1 7
(((7 8
typeof((8 >
(((> ?

Designator((? I
)((I J
,((J K
$str((L ^
)((^ _
.((_ `
Invoke((` f
(((f g

__instance((g q
,((q r
null((s w
)((w x
;((x y
if)) 
()) 
!)) 
canInteract)) 
))) 
{** 
return++ 
false++ 
;++ 
},, 
ThingDef.. 
thingDef.. 
=.. 

__instance..  *
...* +

PlacingDef..+ 5
as..6 8
ThingDef..9 A
;..A B
if// 
(// 
thingDef// 
==// 
null//  
||//! #
!//$ %
thingDef//% -
.//- .
MadeFromStuff//. ;
)//; <
{00 
return22 
true22 
;22 
}33 
Game66 
game66 
=66 
Current66 
.66  
Game66  $
;66$ %'
DigitalStorageGameComponent77 '
gameComp77( 0
=771 2
(773 4
game774 8
!=779 ;
null77< @
)77@ A
?77B C
game77D H
.77H I
GetComponent77I U
<77U V'
DigitalStorageGameComponent77V q
>77q r
(77r s
)77s t
:77u v
null77w {
;77{ |
if88 
(88 
gameComp88 
==88 
null88  
||88! #
gameComp88$ ,
.88, -
GetAllCores88- 8
(888 9
)889 :
.88: ;
Count88; @
==88A C
$num88D E
)88E F
{99 
return;; 
true;; 
;;; 
}<< 
bool?? 
originalGodMode2?? !
=??" #
DebugSettings??$ 1
.??1 2
godMode??2 9
;??9 :
tryAA 
{BB 
DebugSettingsDD 
.DD 
godModeDD %
=DD& '
trueDD( ,
;DD, -
ListGG 
<GG 
FloatMenuOptionGG $
>GG$ %
listGG& *
=GG+ ,
newGG- 0
ListGG1 5
<GG5 6
FloatMenuOptionGG6 E
>GGE F
(GGF G
)GGG H
;GGH I
foreachII 
(II 
ThingDefII !
	thingDef2II" +
inII, .

__instanceII/ 9
.II9 :
MapII: =
.II= >
resourceCounterII> M
.IIM N
AllCountedAmountsIIN _
.II_ `
KeysII` d
.IId e
OrderByDescendingIIe v
(IIv w
delegateIIw 
(	II Ä
ThingDef
IIÄ à
d
IIâ ä
)
IIä ã
{JJ 
StuffPropertiesKK #

stuffPropsKK$ .
=KK/ 0
dKK1 2
.KK2 3

stuffPropsKK3 =
;KK= >
ifLL 
(LL 

stuffPropsLL "
==LL# %
nullLL& *
)LL* +
{MM 
returnNN 
floatNN $
.NN$ %
PositiveInfinityNN% 5
;NN5 6
}OO 
returnPP 

stuffPropsPP %
.PP% &
commonalityPP& 1
;PP1 2
}QQ 
)QQ 
.QQ 
ThenByQQ 
(QQ 
(QQ 
ThingDefQQ #
dQQ$ %
)QQ% &
=>QQ' )
dQQ* +
.QQ+ ,
BaseMarketValueQQ, ;
)QQ; <
)QQ< =
{RR 
ifTT 
(TT 
	thingDef2TT !
.TT! "
IsStuffTT" )
&&TT* ,
	thingDef2TT- 6
.TT6 7

stuffPropsTT7 A
.TTA B
CanMakeTTB I
(TTI J
thingDefTTJ R
)TTR S
&&TTT V
(UU 
DebugSettingsUU &
.UU& '
godModeUU' .
||UU/ 1

__instanceUU2 <
.UU< =
MapUU= @
.UU@ A
listerThingsUUA M
.UUM N
ThingsOfDefUUN Y
(UUY Z
	thingDef2UUZ c
)UUc d
.UUd e
CountUUe j
>UUk l
$numUUm n
)UUn o
)UUo p
{VV 
ThingDefWW  
localStuffDefWW! .
=WW/ 0
	thingDef2WW1 :
;WW: ;
stringXX 
textXX #
;XX# $
Precept_ThingStyleZZ *
sourcePreceptZZ+ 8
=ZZ9 :
TraverseZZ; C
.ZZC D
CreateZZD J
(ZZJ K

__instanceZZK U
)ZZU V
.ZZV W
FieldZZW \
(ZZ\ ]
$strZZ] l
)ZZl m
.ZZm n
GetValueZZn v
<ZZv w
Precept_ThingStyle	ZZw â
>
ZZâ ä
(
ZZä ã
)
ZZã å
;
ZZå ç
if[[ 
([[ 
sourcePrecept[[ )
!=[[* ,
null[[- 1
)[[1 2
{\\ 
text]]  
=]]! "
$str]]# :
.]]: ;
	Translate]]; D
(]]D E
localStuffDef]]E R
.]]R S
LabelAsStuff]]S _
,]]_ `
sourcePrecept]]a n
.]]n o
Label]]o t
)]]t u
;]]u v
}^^ 
else__ 
{`` 
textaa  
=aa! "
GenLabelaa# +
.aa+ ,

ThingLabelaa, 6
(aa6 7

__instanceaa7 A
.aaA B

PlacingDefaaB L
,aaL M
localStuffDefaaN [
,aa[ \
$numaa] ^
)aa^ _
;aa_ `
}bb 
textcc 
=cc 
textcc #
.cc# $
CapitalizeFirstcc$ 3
(cc3 4
)cc4 5
;cc5 6
listee 
.ee 
Addee  
(ee  !
newee! $
FloatMenuOptionee% 4
(ee4 5
textee5 9
,ee9 :
delegateee; C
{ff 
AccessToolshh '
.hh' (
Methodhh( .
(hh. /
typeofhh/ 5
(hh5 6

Designatorhh6 @
)hh@ A
,hhA B
$strhhC Q
)hhQ R
.hhR S
InvokehhS Y
(hhY Z

__instancehhZ d
,hhd e
newhhf i
objecthhj p
[hhp q
]hhq r
{hhs t
evhhu w
}hhx y
)hhy z
;hhz {
Findii  
.ii  !
DesignatorManagerii! 2
.ii2 3
Selectii3 9
(ii9 :

__instanceii: D
)iiD E
;iiE F
Traversejj $
.jj$ %
Createjj% +
(jj+ ,

__instancejj, 6
)jj6 7
.jj7 8
Fieldjj8 =
(jj= >
$strjj> H
)jjH I
.jjI J
SetValuejjJ R
(jjR S
localStuffDefjjS `
)jj` a
;jja b
Traversekk $
.kk$ %
Createkk% +
(kk+ ,

__instancekk, 6
)kk6 7
.kk7 8
Fieldkk8 =
(kk= >
$strkk> J
)kkJ K
.kkK L
SetValuekkL T
(kkT U
truekkU Y
)kkY Z
;kkZ [
}ll 
,ll 
	thingDef2ll $
,ll$ %
nullll& *
,ll* +
falsell, 1
,ll1 2
MenuOptionPriorityll3 E
.llE F
DefaultllF M
,llM N
nullllO S
,llS T
nullllU Y
,llY Z
$numll[ ]
,ll] ^
nullll_ c
,llc d
nulllle i
,lli j
truellk o
,llo p
$numllq r
,llr s
nullllt x
)llx y
{mm 
tutorTagnn $
=nn% &
$strnn' 5
+nn6 7
thingDefnn8 @
.nn@ A
defNamennA H
+nnI J
$strnnK N
+nnO P
localStuffDefnnQ ^
.nn^ _
defNamenn_ f
}oo 
)oo 
;oo 
}pp 
}qq 
ifss 
(ss 
listss 
.ss 
Countss 
==ss !
$numss" #
)ss# $
{tt 
Messagesuu 
.uu 
Messageuu $
(uu$ %
$struu% :
.uu: ;
	Translateuu; D
(uuD E
)uuE F
,uuF G
MessageTypeDefOfuuH X
.uuX Y
RejectInputuuY d
,uud e
falseuuf k
)uuk l
;uul m
returnvv 
falsevv  
;vv  !
}ww 
	FloatMenuyy 
	floatMenuyy #
=yy$ %
newyy& )
	FloatMenuyy* 3
(yy3 4
listyy4 8
)yy8 9
;yy9 :
	floatMenuzz 
.zz 
onCloseCallbackzz )
=zz* +
delegatezz, 4
{{{ 
Traverse|| 
.|| 
Create|| #
(||# $

__instance||$ .
)||. /
.||/ 0
Field||0 5
(||5 6
$str||6 B
)||B C
.||C D
SetValue||D L
(||L M
true||M Q
)||Q R
;||R S
}}} 
;}} 
Find~~ 
.~~ 
WindowStack~~  
.~~  !
Add~~! $
(~~$ %
	floatMenu~~% .
)~~. /
;~~/ 0
Find 
. 
DesignatorManager &
.& '
Select' -
(- .

__instance. 8
)8 9
;9 :
return
ÅÅ 
false
ÅÅ 
;
ÅÅ 
}
ÇÇ 
finally
ÉÉ 
{
ÑÑ 
DebugSettings
ÜÜ 
.
ÜÜ 
godMode
ÜÜ %
=
ÜÜ& '
originalGodMode2
ÜÜ( 8
;
ÜÜ8 9
}
áá 
}
àà 	
}
ââ 
}ää ≥‘
zB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_WorkGiver_ConstructDeliverResources_V2.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( /
#WorkGiver_ConstructDeliverResources <
)< =
,= >
$str? V
)V W
]W X
public 

static 
class 8
,Patch_WorkGiver_ConstructDeliverResources_V2 D
{ 
private 
static 
bool 
LOG 
=>  ""
DigitalStorageSettings# 9
.9 :
enableDebugLog: H
;H I
public 
static 
void 
Postfix "
(" #
ref 
Job 
__result 
, /
#WorkGiver_ConstructDeliverResources /

__instance0 :
,: ;
Pawn 
pawn 
, 
IConstructible 
c 
, 
bool 4
(canRemoveExistingFloorUnderNearbyNeeders 9
,9 :
bool   
forced   
)   
{!! 	'
DigitalStorageGameComponent"" '
gameComp""( 0
=""1 2
Current""3 :
."": ;
Game""; ?
?""? @
.""@ A
GetComponent""A M
<""M N'
DigitalStorageGameComponent""N i
>""i j
(""j k
)""k l
;""l m
if## 
(## 
gameComp## 
==## 
null##  
)##  !
{$$ 
return%% 
;%% 
}&& 
bool(( 
hasChip(( 
=(( 
PawnStorageAccess(( ,
.((, -
HasTerminalImplant((- ?
(((? @
pawn((@ D
)((D E
;((E F
if** 
(** 
LOG** 
)** 
Log** 
.** 
Message**  
(**  !
$"**! #
$str**# 8
{**8 9
pawn**9 =
.**= >
Name**> B
}**B C
$str**C M
{**M N
hasChip**N U
}**U V
$str**V a
{**a b
__result**b j
!=**k m
null**n r
}**r s
"**s t
)**t u
;**u v
if.. 
(.. 
__result.. 
!=.. 
null..  
&&..! #
__result..$ ,
..., -
def..- 0
==..1 3
JobDefOf..4 <
...< =
HaulToContainer..= L
)..L M
{// 
if00 
(00 
LOG00 
)00 
Log00 
.00 
Message00 $
(00$ %
$"00% '
$str00' :
"00: ;
)00; <
;00< =
return11 
;11 
}22 
if55 
(55 
__result55 
!=55 
null55  
)55  !
{66 
if77 
(77 
LOG77 
)77 
Log77 
.77 
Message77 $
(77$ %
$"77% '
$str77' 9
"779 :
)77: ;
;77; <
return88 
;88 
}99 
if;; 
(;; 
LOG;; 
);; 
Log;; 
.;; 
Message;;  
(;;  !
$";;! #
$str;;# <
";;< =
);;= >
;;;> ?
foreach>> 
(>> 
ThingDefCountClass>> '
need>>( ,
in>>- /
c>>0 1
.>>1 2
TotalMaterialCost>>2 C
(>>C D
)>>D E
)>>E F
{?? 
int@@ 
countNeeded@@ 
=@@  !
GetCountNeeded@@" 0
(@@0 1
c@@1 2
,@@2 3
need@@4 8
.@@8 9
thingDef@@9 A
,@@A B
pawn@@C G
,@@G H
forced@@I O
)@@O P
;@@P Q
ifAA 
(AA 
LOGAA 
)AA 
LogAA 
.AA 
MessageAA $
(AA$ %
$"AA% '
$strAA' 6
{AA6 7
needAA7 ;
.AA; <
thingDefAA< D
.AAD E
defNameAAE L
}AAL M
$strAAM [
{AA[ \
countNeededAA\ g
}AAg h
"AAh i
)AAi j
;AAj k
ifBB 
(BB 
countNeededBB 
<=BB  "
$numBB# $
)BB$ %
{CC 
continueDD 
;DD 
}EE 
intHH 
maxCanCarryHH 
=HH  !
pawnHH" &
.HH& '
carryTrackerHH' 3
.HH3 4
MaxStackSpaceEverHH4 E
(HHE F
needHHF J
.HHJ K
thingDefHHK S
)HHS T
;HHT U
intII 
actualNeededII  
=II! "
MathII# '
.II' (
MinII( +
(II+ ,
countNeededII, 7
,II7 8
maxCanCarryII9 D
)IID E
;IIE F
ifJJ 
(JJ 
LOGJJ 
)JJ 
LogJJ 
.JJ 
MessageJJ $
(JJ$ %
$"JJ% '
$strJJ' =
{JJ= >
maxCanCarryJJ> I
}JJI J
$strJJJ Y
{JJY Z
actualNeededJJZ f
}JJf g
"JJg h
)JJh i
;JJi j
ThingMM 

finalThingMM  
=MM! ""
GetOrReplenishMaterialMM# 9
(MM9 :
gameCompMM: B
,MMB C
needMMD H
.MMH I
thingDefMMI Q
,MMQ R
actualNeededMMS _
,MM_ `
pawnMMa e
.MMe f
MapMMf i
)MMi j
;MMj k
ifOO 
(OO 

finalThingOO 
==OO !
nullOO" &
||OO' )
!OO* +

finalThingOO+ 5
.OO5 6
SpawnedOO6 =
)OO= >
{PP 
ifQQ 
(QQ 
LOGQQ 
)QQ 
LogQQ  
.QQ  !
MessageQQ! (
(QQ( )
$"QQ) +
$strQQ+ S
"QQS T
)QQT U
;QQU V
continueRR 
;RR 
}SS 
ifUU 
(UU 
LOGUU 
)UU 
LogUU 
.UU 
MessageUU $
(UU$ %
$"UU% '
$strUU' 7
{UU7 8

finalThingUU8 B
.UUB C
LabelUUC H
}UUH I
$strUUI K
{UUK L

finalThingUUL V
.UUV W

stackCountUUW a
}UUa b
$strUUb f
{UUf g

finalThingUUg q
.UUq r
PositionUUr z
}UUz {
"UU{ |
)UU| }
;UU} ~
__resultXX 
=XX 
CreateHaulJobXX (
(XX( )
pawnXX) -
,XX- .
cXX/ 0
,XX0 1

finalThingXX2 <
,XX< =
actualNeededXX> J
)XXJ K
;XXK L
ifYY 
(YY 
LOGYY 
)YY 
LogYY 
.YY 
MessageYY $
(YY$ %
$"YY% '
$strYY' A
{YYA B
__resultYYB J
!=YYK M
nullYYN R
}YYR S
"YYS T
)YYT U
;YYU V
returnZZ 
;ZZ 
}[[ 
}\\ 	
privateaa 
staticaa 
Thingaa "
GetOrReplenishMaterialaa 3
(aa3 4'
DigitalStorageGameComponentaa4 O
gameCompaaP X
,aaX Y
ThingDefaaZ b
defaac f
,aaf g
intaah k
neededaal r
,aar s
Mapaat w
mapaax {
)aa{ |
{bb 	
ifcc 
(cc 
LOGcc 
)cc 
Logcc 
.cc 
Messagecc  
(cc  !
$"cc! #
$strcc# D
{ccD E
defccE H
.ccH I
defNameccI P
}ccP Q
$strccQ Z
{ccZ [
neededcc[ a
}cca b
"ccb c
)ccc d
;ccd e
foreachee 
(ee  
Building_StorageCoreee )
coreee* .
inee/ 1
gameCompee2 :
.ee: ;
GetAllCoresee; F
(eeF G
)eeG H
)eeH I
{ff 
ifgg 
(gg 
coregg 
==gg 
nullgg  
||gg! #
!gg$ %
coregg% )
.gg) *
Spawnedgg* 1
||gg2 4
!gg5 6
coregg6 :
.gg: ;
Poweredgg; B
||ggC E
coreggF J
.ggJ K
MapggK N
!=ggO Q
mapggR U
)ggU V
{hh 
continueii 
;ii 
}jj 
Thingmm 
reservedThingmm #
=mm$ %
coremm& *
.mm* +
FindReservedItemmm+ ;
(mm; <
defmm< ?
,mm? @
nullmmA E
)mmE F
;mmF G
intnn 
reservedCountnn !
=nn" #
reservedThingnn$ 1
?nn1 2
.nn2 3

stackCountnn3 =
??nn> @
$numnnA B
;nnB C
intoo 
virtualCountoo  
=oo! "
coreoo# '
.oo' (
GetItemCountoo( 4
(oo4 5
defoo5 8
,oo8 9
nulloo: >
)oo> ?
;oo? @
intpp 
totalAvailablepp "
=pp# $
reservedCountpp% 2
+pp3 4
virtualCountpp5 A
;ppA B
ifrr 
(rr 
LOGrr 
)rr 
Logrr 
.rr 
Messagerr $
(rr$ %
$"rr% '
$strrr' G
{rrG H
corerrH L
.rrL M
NetworkNamerrM X
}rrX Y
$strrrY i
{rri j
reservedCountrrj w
}rrw x
$str	rrx á
{
rrá à
virtualCount
rrà î
}
rrî ï
$str
rrï ¶
{
rr¶ ß
totalAvailable
rrß µ
}
rrµ ∂
"
rr∂ ∑
)
rr∑ ∏
;
rr∏ π
iftt 
(tt 
totalAvailablett "
<tt# $
neededtt% +
)tt+ ,
{uu 
ifvv 
(vv 
LOGvv 
)vv 
Logvv  
.vv  !
Messagevv! (
(vv( )
$"vv) +
$strvv+ Q
"vvQ R
)vvR S
;vvS T
continueww 
;ww 
}xx 
Thingzz 

finalThingzz  
;zz  !
if|| 
(|| 
reservedCount|| !
>=||" $
needed||% +
)||+ ,
{}} 
if~~ 
(~~ 
LOG~~ 
)~~ 
Log~~  
.~~  !
Message~~! (
(~~( )
$"~~) +
$str~~+ S
{~~S T
needed~~T Z
}~~Z [
$str~~[ ]
"~~] ^
)~~^ _
;~~_ `
if
ÄÄ 
(
ÄÄ 
reservedCount
ÄÄ %
==
ÄÄ& (
needed
ÄÄ) /
)
ÄÄ/ 0
{
ÅÅ 

finalThing
ÇÇ "
=
ÇÇ# $
reservedThing
ÇÇ% 2
;
ÇÇ2 3
}
ÉÉ 
else
ÑÑ 
{
ÖÖ 

finalThing
ÜÜ "
=
ÜÜ# $
reservedThing
ÜÜ% 2
.
ÜÜ2 3
SplitOff
ÜÜ3 ;
(
ÜÜ; <
needed
ÜÜ< B
)
ÜÜB C
;
ÜÜC D
GenSpawn
áá  
.
áá  !
Spawn
áá! &
(
áá& '

finalThing
áá' 1
,
áá1 2
reservedThing
áá3 @
.
áá@ A
Position
ááA I
,
ááI J
map
ááK N
,
ááN O
WipeMode
ááP X
.
ááX Y
Vanish
ááY _
)
áá_ `
;
áá` a
}
àà 
}
ââ 
else
ää 
{
ãã 
if
åå 
(
åå 
LOG
åå 
)
åå 
Log
åå  
.
åå  !
Message
åå! (
(
åå( )
$"
åå) +
$str
åå+ R
{
ååR S
needed
ååS Y
-
ååZ [
reservedCount
åå\ i
}
ååi j
$str
ååj l
"
åål m
)
ååm n
;
åån o
int
éé 
needMore
éé  
=
éé! "
needed
éé# )
-
éé* +
reservedCount
éé, 9
;
éé9 :
Thing
èè 
	extracted
èè #
=
èè$ %
core
èè& *
.
èè* +
ExtractItem
èè+ 6
(
èè6 7
def
èè7 :
,
èè: ;
needMore
èè< D
,
èèD E
null
èèF J
)
èèJ K
;
èèK L
if
ëë 
(
ëë 
	extracted
ëë !
==
ëë" $
null
ëë% )
)
ëë) *
{
íí 
if
ìì 
(
ìì 
LOG
ìì 
)
ìì  
Log
ìì! $
.
ìì$ %
Message
ìì% ,
(
ìì, -
$"
ìì- /
$str
ìì/ _
"
ìì_ `
)
ìì` a
;
ììa b
continue
îî  
;
îî  !
}
ïï 
if
óó 
(
óó 
LOG
óó 
)
óó 
Log
óó  
.
óó  !
Message
óó! (
(
óó( )
$"
óó) +
$str
óó+ L
{
óóL M
	extracted
óóM V
.
óóV W
Label
óóW \
}
óó\ ]
$str
óó] _
{
óó_ `
	extracted
óó` i
.
óói j

stackCount
óój t
}
óót u
"
óóu v
)
óóv w
;
óów x
if
ôô 
(
ôô 
reservedThing
ôô %
!=
ôô& (
null
ôô) -
&&
ôô. 0
reservedThing
ôô1 >
.
ôô> ?
Spawned
ôô? F
)
ôôF G
{
öö 
if
úú 
(
úú 
LOG
úú 
)
úú  
Log
úú! $
.
úú$ %
Message
úú% ,
(
úú, -
$"
úú- /
$str
úú/ S
"
úúS T
)
úúT U
;
úúU V
reservedThing
ùù %
.
ùù% &
TryAbsorbStack
ùù& 4
(
ùù4 5
	extracted
ùù5 >
,
ùù> ?
false
ùù@ E
)
ùùE F
;
ùùF G
if
ûû 
(
ûû 
	extracted
ûû %
.
ûû% &

stackCount
ûû& 0
>
ûû1 2
$num
ûû3 4
)
ûû4 5
{
üü 
if
†† 
(
††  
LOG
††  #
)
††# $
Log
††% (
.
††( )
Message
††) 0
(
††0 1
$"
††1 3
$str
††3 V
{
††V W
	extracted
††W `
.
††` a

stackCount
††a k
}
††k l
$str
††l t
"
††t u
)
††u v
;
††v w
GenSpawn
°° $
.
°°$ %
Spawn
°°% *
(
°°* +
	extracted
°°+ 4
,
°°4 5
reservedThing
°°6 C
.
°°C D
Position
°°D L
,
°°L M
map
°°N Q
,
°°Q R
WipeMode
°°S [
.
°°[ \
Vanish
°°\ b
)
°°b c
;
°°c d
}
¢¢ 

finalThing
££ "
=
££# $
reservedThing
££% 2
;
££2 3
}
§§ 
else
•• 
{
¶¶ 
if
®® 
(
®® 
LOG
®® 
)
®®  
Log
®®! $
.
®®$ %
Message
®®% ,
(
®®, -
$"
®®- /
$str
®®/ U
"
®®U V
)
®®V W
;
®®W X
GenSpawn
©©  
.
©©  !
Spawn
©©! &
(
©©& '
	extracted
©©' 0
,
©©0 1
core
©©2 6
.
©©6 7
Position
©©7 ?
,
©©? @
map
©©A D
,
©©D E
WipeMode
©©F N
.
©©N O
Vanish
©©O U
)
©©U V
;
©©V W

finalThing
™™ "
=
™™# $
	extracted
™™% .
;
™™. /
}
´´ 
}
¨¨ 
if
ÆÆ 
(
ÆÆ 
LOG
ÆÆ 
)
ÆÆ 
Log
ÆÆ 
.
ÆÆ 
Message
ÆÆ $
(
ÆÆ$ %
$"
ÆÆ% '
$str
ÆÆ' O
{
ÆÆO P

finalThing
ÆÆP Z
.
ÆÆZ [
Label
ÆÆ[ `
}
ÆÆ` a
$str
ÆÆa c
{
ÆÆc d

finalThing
ÆÆd n
.
ÆÆn o

stackCount
ÆÆo y
}
ÆÆy z
$str
ÆÆz ~
{
ÆÆ~ 

finalThingÆÆ â
.ÆÆâ ä
PositionÆÆä í
}ÆÆí ì
"ÆÆì î
)ÆÆî ï
;ÆÆï ñ
return
≤≤ 

finalThing
≤≤ !
;
≤≤! "
}
≥≥ 
if
µµ 
(
µµ 
LOG
µµ 
)
µµ 
Log
µµ 
.
µµ 
Message
µµ  
(
µµ  !
$"
µµ! #
$str
µµ# I
"
µµI J
)
µµJ K
;
µµK L
return
∂∂ 
null
∂∂ 
;
∂∂ 
}
∑∑ 	
private
ºº 
static
ºº 
Thing
ºº 
SplitAndTeleport
ºº -
(
ºº- .
Thing
ºº. 3
source
ºº4 :
,
ºº: ;
int
ºº< ?
count
ºº@ E
,
ººE F
IntVec3
ººG N
	targetPos
ººO X
,
ººX Y
Map
ººZ ]
map
ºº^ a
)
ººa b
{
ΩΩ 	
if
ææ 
(
ææ 
source
ææ 
==
ææ 
null
ææ 
||
ææ !
!
ææ" #
source
ææ# )
.
ææ) *
Spawned
ææ* 1
)
ææ1 2
{
øø 
return
¿¿ 
null
¿¿ 
;
¿¿ 
}
¡¡ 
Thing
√√ 
thingToTeleport
√√ !
;
√√! "
if
ƒƒ 
(
ƒƒ 
source
ƒƒ 
.
ƒƒ 

stackCount
ƒƒ !
<=
ƒƒ" $
count
ƒƒ% *
)
ƒƒ* +
{
≈≈ 
source
∆∆ 
.
∆∆ 
DeSpawn
∆∆ 
(
∆∆ 
$num
∆∆  
)
∆∆  !
;
∆∆! "
thingToTeleport
«« 
=
««  !
source
««" (
;
««( )
}
»» 
else
…… 
{
   
thingToTeleport
ÀÀ 
=
ÀÀ  !
source
ÀÀ" (
.
ÀÀ( )
SplitOff
ÀÀ) 1
(
ÀÀ1 2
count
ÀÀ2 7
)
ÀÀ7 8
;
ÀÀ8 9
}
ÃÃ 
Thing
ŒŒ 
spawned
ŒŒ 
=
ŒŒ 
GenSpawn
ŒŒ $
.
ŒŒ$ %
Spawn
ŒŒ% *
(
ŒŒ* +
thingToTeleport
ŒŒ+ :
,
ŒŒ: ;
	targetPos
ŒŒ< E
,
ŒŒE F
map
ŒŒG J
,
ŒŒJ K
WipeMode
ŒŒL T
.
ŒŒT U
Vanish
ŒŒU [
)
ŒŒ[ \
;
ŒŒ\ ]

FleckMaker
œœ 
.
œœ  
ThrowLightningGlow
œœ )
(
œœ) *
spawned
œœ* 1
.
œœ1 2
DrawPos
œœ2 9
,
œœ9 :
map
œœ; >
,
œœ> ?
$num
œœ@ D
)
œœD E
;
œœE F
if
—— 
(
—— $
DigitalStorageSettings
—— &
.
——& '
enableDebugLog
——' 5
)
——5 6
{
““ 
Log
”” 
.
”” 
Message
”” 
(
”” 
$"
”” 
$str
”” +
{
””+ ,
spawned
””, 3
.
””3 4
Label
””4 9
}
””9 :
$str
””: <
{
””< =
spawned
””= D
.
””D E

stackCount
””E O
}
””O P
$str
””P S
{
””S T
	targetPos
””T ]
}
””] ^
"
””^ _
)
””_ `
;
””` a
}
‘‘ 
return
÷÷ 
spawned
÷÷ 
;
÷÷ 
}
◊◊ 	
private
ŸŸ 
static
ŸŸ "
Building_StorageCore
ŸŸ +
FindCoreWithItem
ŸŸ, <
(
ŸŸ< =)
DigitalStorageGameComponent
ŸŸ= X
gameComp
ŸŸY a
,
ŸŸa b
Thing
ŸŸc h
item
ŸŸi m
)
ŸŸm n
{
⁄⁄ 	
foreach
€€ 
(
€€ "
Building_StorageCore
€€ )
core
€€* .
in
€€/ 1
gameComp
€€2 :
.
€€: ;
GetAllCores
€€; F
(
€€F G
)
€€G H
)
€€H I
{
‹‹ 
if
›› 
(
›› 
core
›› 
==
›› 
null
››  
||
››! #
!
››$ %
core
››% )
.
››) *
Spawned
››* 1
||
››2 4
!
››5 6
core
››6 :
.
››: ;
Powered
››; B
)
››B C
{
ﬁﬁ 
continue
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 
	SlotGroup
‚‚ 
	slotGroup
‚‚ #
=
‚‚$ %
core
‚‚& *
.
‚‚* +
GetSlotGroup
‚‚+ 7
(
‚‚7 8
)
‚‚8 9
;
‚‚9 :
if
„„ 
(
„„ 
	slotGroup
„„ 
!=
„„  
null
„„! %
)
„„% &
{
‰‰ 
foreach
ÂÂ 
(
ÂÂ 
Thing
ÂÂ "
thing
ÂÂ# (
in
ÂÂ) +
	slotGroup
ÂÂ, 5
.
ÂÂ5 6

HeldThings
ÂÂ6 @
)
ÂÂ@ A
{
ÊÊ 
if
ÁÁ 
(
ÁÁ 
thing
ÁÁ !
==
ÁÁ" $
item
ÁÁ% )
)
ÁÁ) *
{
ËË 
return
ÈÈ "
core
ÈÈ# '
;
ÈÈ' (
}
ÍÍ 
}
ÎÎ 
}
ÏÏ 
}
ÌÌ 
return
ÓÓ 
null
ÓÓ 
;
ÓÓ 
}
ÔÔ 	
private
ÒÒ 
static
ÒÒ 
int
ÒÒ 
GetCountNeeded
ÒÒ )
(
ÒÒ) *
IConstructible
ÒÒ* 8
c
ÒÒ9 :
,
ÒÒ: ;
ThingDef
ÒÒ< D
def
ÒÒE H
,
ÒÒH I
Pawn
ÒÒJ N
pawn
ÒÒO S
,
ÒÒS T
bool
ÒÒU Y
forced
ÒÒZ `
)
ÒÒ` a
{
ÚÚ 	
if
ÛÛ 
(
ÛÛ 
forced
ÛÛ 
)
ÛÛ 
{
ÙÙ 
return
ıı 
c
ıı 
.
ıı 
ThingCountNeeded
ıı )
(
ıı) *
def
ıı* -
)
ıı- .
;
ıı. /
}
ˆˆ 
IHaulEnroute
¯¯ 
haulEnroute
¯¯ $
=
¯¯% &
c
¯¯' (
as
¯¯) +
IHaulEnroute
¯¯, 8
;
¯¯8 9
if
˘˘ 
(
˘˘ 
haulEnroute
˘˘ 
==
˘˘ 
null
˘˘ #
)
˘˘# $
{
˙˙ 
return
˚˚ 
c
˚˚ 
.
˚˚ 
ThingCountNeeded
˚˚ )
(
˚˚) *
def
˚˚* -
)
˚˚- .
;
˚˚. /
}
¸¸ 
return
˛˛ 
haulEnroute
˛˛ 
.
˛˛ *
GetSpaceRemainingWithEnroute
˛˛ ;
(
˛˛; <
def
˛˛< ?
,
˛˛? @
pawn
˛˛A E
)
˛˛E F
;
˛˛F G
}
ˇˇ 	
private
ÅÅ 
static
ÅÅ 
Thing
ÅÅ 
TeleportItem
ÅÅ )
(
ÅÅ) *
Thing
ÅÅ* /
item
ÅÅ0 4
,
ÅÅ4 5
IntVec3
ÅÅ6 =
	targetPos
ÅÅ> G
,
ÅÅG H
Map
ÅÅI L
map
ÅÅM P
)
ÅÅP Q
{
ÇÇ 	
if
ÉÉ 
(
ÉÉ 
item
ÉÉ 
==
ÉÉ 
null
ÉÉ 
||
ÉÉ 
!
ÉÉ  !
item
ÉÉ! %
.
ÉÉ% &
Spawned
ÉÉ& -
||
ÉÉ. 0
map
ÉÉ1 4
==
ÉÉ5 7
null
ÉÉ8 <
)
ÉÉ< =
{
ÑÑ 
return
ÖÖ 
null
ÖÖ 
;
ÖÖ 
}
ÜÜ 
item
àà 
.
àà 
DeSpawn
àà 
(
àà 
$num
àà 
)
àà 
;
àà 
Thing
ââ 
spawned
ââ 
=
ââ 
GenSpawn
ââ $
.
ââ$ %
Spawn
ââ% *
(
ââ* +
item
ââ+ /
,
ââ/ 0
	targetPos
ââ1 :
,
ââ: ;
map
ââ< ?
,
ââ? @
$num
ââA B
)
ââB C
;
ââC D

FleckMaker
ää 
.
ää  
ThrowLightningGlow
ää )
(
ää) *
spawned
ää* 1
.
ää1 2
DrawPos
ää2 9
,
ää9 :
map
ää; >
,
ää> ?
$num
ää@ D
)
ääD E
;
ääE F
if
åå 
(
åå $
DigitalStorageSettings
åå &
.
åå& '
enableDebugLog
åå' 5
)
åå5 6
{
çç 
Log
éé 
.
éé 
Message
éé 
(
éé 
$"
éé 
$str
éé +
{
éé+ ,
spawned
éé, 3
.
éé3 4
Label
éé4 9
}
éé9 :
$str
éé: <
{
éé< =
spawned
éé= D
.
ééD E

stackCount
ééE O
}
ééO P
$str
ééP S
{
ééS T
	targetPos
ééT ]
}
éé] ^
"
éé^ _
)
éé_ `
;
éé` a
}
èè 
return
ëë 
spawned
ëë 
;
ëë 
}
íí 	
private
îî 
static
îî 
Job
îî 
CreateHaulJob
îî (
(
îî( )
Pawn
îî) -
pawn
îî. 2
,
îî2 3
IConstructible
îî4 B
c
îîC D
,
îîD E
Thing
îîF K
	realThing
îîL U
,
îîU V
int
îîW Z
countNeeded
îî[ f
)
îîf g
{
ïï 	
if
ññ 
(
ññ 
	realThing
ññ 
==
ññ 
null
ññ !
||
ññ" $
!
ññ% &
	realThing
ññ& /
.
ññ/ 0
Spawned
ññ0 7
)
ññ7 8
{
óó 
return
òò 
null
òò 
;
òò 
}
ôô 
int
õõ 
countToTake
õõ 
=
õõ 
Math
õõ "
.
õõ" #
Min
õõ# &
(
õõ& '
countNeeded
õõ' 2
,
õõ2 3
pawn
õõ4 8
.
õõ8 9
carryTracker
õõ9 E
.
õõE F
MaxStackSpaceEver
õõF W
(
õõW X
	realThing
õõX a
.
õõa b
def
õõb e
)
õõe f
)
õõf g
;
õõg h
Job
úú 
job
úú 
=
úú 
JobMaker
úú 
.
úú 
MakeJob
úú &
(
úú& '
JobDefOf
úú' /
.
úú/ 0
HaulToContainer
úú0 ?
)
úú? @
;
úú@ A
job
ùù 
.
ùù 
targetA
ùù 
=
ùù 
	realThing
ùù #
;
ùù# $
job
ûû 
.
ûû 
targetB
ûû 
=
ûû 
(
ûû 
Thing
ûû  
)
ûû  !
c
ûû! "
;
ûû" #
job
üü 
.
üü 
count
üü 
=
üü 
countToTake
üü #
;
üü# $
if
°° 
(
°° 
!
°° 
pawn
°° 
.
°° 
Map
°° 
.
°°  
reservationManager
°° ,
.
°°, -
Reserve
°°- 4
(
°°4 5
pawn
°°5 9
,
°°9 :
job
°°; >
,
°°> ?
	realThing
°°@ I
,
°°I J
$num
°°K L
,
°°L M
-
°°N O
$num
°°O P
,
°°P Q
null
°°R V
,
°°V W
false
°°X ]
,
°°] ^
false
°°_ d
)
°°d e
)
°°e f
{
¢¢ 
return
££ 
null
££ 
;
££ 
}
§§ 
return
¶¶ 
job
¶¶ 
;
¶¶ 
}
ßß 	
}
®® 
}©© Ê⁄
B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_WorkGiver_DoBill_TryFindBestBillIngredients.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
WorkGiver_DoBill )
)) *
,* +
$str, H
)H I
]I J
public 

static 
class =
1Patch_WorkGiver_DoBill_TryFindBestBillIngredients I
{ 
public 
static 
void 
Postfix "
(" #
ref# &
bool' +
__result, 4
,4 5
Bill6 :
bill; ?
,? @
PawnA E
pawnF J
,J K
ThingL Q
	billGiverR [
,[ \
ref] `
Lista e
<e f

ThingCountf p
>p q
chosenr x
)x y
{ 	
if 
( 
__result 
) 
{ 
return 
; 
} '
DigitalStorageGameComponent '
gameComp( 0
=1 2
Current3 :
.: ;
Game; ?
?? @
.@ A
GetComponentA M
<M N'
DigitalStorageGameComponentN i
>i j
(j k
)k l
;l m
if   
(   
gameComp   
==   
null    
)    !
{!! 
return"" 
;"" 
}## 
Bill_Production%% 
billProd%% $
=%%% &
bill%%' +
as%%, .
Bill_Production%%/ >
;%%> ?
if&& 
(&& 
billProd&& 
==&& 
null&&  
)&&  !
{'' 
return(( 
;(( 
})) 
if++ 
(++ "
DigitalStorageSettings++ &
.++& '
enableDebugLog++' 5
)++5 6
Log,, 
.,, 
Message,, 
(,, 
$",, 
$str,, 2
{,,2 3
billProd,,3 ;
.,,; <
recipe,,< B
.,,B C
defName,,C J
},,J K
$str,,K R
{,,R S
pawn,,S W
.,,W X
Name,,X \
},,\ ]
",,] ^
),,^ _
;,,_ `
List// 
<// 
(// 
IngredientCount// !

ingredient//" ,
,//, -
int//. 1
needed//2 8
,//8 9 
Building_StorageCore//: N
core//O S
,//S T
ThingDef//U ]
def//^ a
,//a b
ThingDef//c k
stuff//l q
,//q r
Thing//s x
reservedThing	//y Ü
,
//Ü á
Thing
//à ç
mapThing
//é ñ
)
//ñ ó
>
//ó ò
materialSources
//ô ®
=
//© ™
new00 
List00 
<00 
(00 
IngredientCount00 )
,00) *
int00+ .
,00. / 
Building_StorageCore000 D
,00D E
ThingDef00F N
,00N O
ThingDef00P X
,00X Y
Thing00Z _
,00_ `
Thing00a f
)00f g
>00g h
(00h i
)00i j
;00j k
foreach22 
(22 
IngredientCount22 $

ingredient22% /
in220 2
billProd223 ;
.22; <
recipe22< B
.22B C
ingredients22C N
)22N O
{33 
ThingDef44 
anyDef44 
=44  !

ingredient44" ,
.44, -
filter44- 3
.443 4
AnyAllowedDef444 A
;44A B
if55 
(55 
anyDef55 
==55 
null55 "
)55" #
{66 
return77 
;77 
}88 
int:: 
neededCount:: 
=::  !

ingredient::" ,
.::, -
CountRequiredOfFor::- ?
(::? @
anyDef::@ F
,::F G
billProd::H P
.::P Q
recipe::Q W
,::W X
billProd::Y a
)::a b
;::b c
var== 

coreResult== 
===  
FindMaterialInCores==! 4
(==4 5
gameComp==5 =
,=== >

ingredient==? I
,==I J
billProd==K S
,==S T
neededCount==U `
,==` a
pawn==b f
.==f g
Map==g j
)==j k
;==k l
if>> 
(>> 

coreResult>> 
.>> 
core>> #
!=>>$ &
null>>' +
&&>>, .

coreResult>>/ 9
.>>9 :
def>>: =
!=>>> @
null>>A E
)>>E F
{?? 
if@@ 
(@@ "
DigitalStorageSettings@@ .
.@@. /
enableDebugLog@@/ =
)@@= >
LogAA 
.AA 
MessageAA #
(AA# $
$"AA$ &
$strAA& /
{AA/ 0
anyDefAA0 6
.AA6 7
defNameAA7 >
}AA> ?
$strAA? F
"AAF G
)AAG H
;AAH I
materialSourcesBB #
.BB# $
AddBB$ '
(BB' (
(BB( )

ingredientBB) 3
,BB3 4
neededCountBB5 @
,BB@ A

coreResultBBB L
.BBL M
coreBBM Q
,BBQ R

coreResultBBS ]
.BB] ^
defBB^ a
,BBa b

coreResultBBc m
.BBm n
stuffBBn s
,BBs t

coreResultBBu 
.	BB Ä
reservedThing
BBÄ ç
,
BBç é
null
BBè ì
)
BBì î
)
BBî ï
;
BBï ñ
continueCC 
;CC 
}DD 
ThingGG 
mapThingGG 
=GG  
FindMaterialOnMapGG! 2
(GG2 3
pawnGG3 7
,GG7 8

ingredientGG9 C
,GGC D
billProdGGE M
,GGM N
neededCountGGO Z
)GGZ [
;GG[ \
ifHH 
(HH 
mapThingHH 
!=HH 
nullHH  $
)HH$ %
{II 
ifJJ 
(JJ "
DigitalStorageSettingsJJ .
.JJ. /
enableDebugLogJJ/ =
)JJ= >
LogKK 
.KK 
MessageKK #
(KK# $
$"KK$ &
$strKK& /
{KK/ 0
anyDefKK0 6
.KK6 7
defNameKK7 >
}KK> ?
$strKK? G
{KKG H
mapThingKKH P
.KKP Q
LabelKKQ V
}KKV W
$strKKW [
{KK[ \
mapThingKK\ d
.KKd e
PositionKKe m
}KKm n
"KKn o
)KKo p
;KKp q
materialSourcesLL #
.LL# $
AddLL$ '
(LL' (
(LL( )

ingredientLL) 3
,LL3 4
neededCountLL5 @
,LL@ A
nullLLB F
,LLF G
mapThingLLH P
.LLP Q
defLLQ T
,LLT U
mapThingLLV ^
.LL^ _
StuffLL_ d
,LLd e
nullLLf j
,LLj k
mapThingLLl t
)LLt u
)LLu v
;LLv w
continueMM 
;MM 
}NN 
ifQQ 
(QQ "
DigitalStorageSettingsQQ *
.QQ* +
enableDebugLogQQ+ 9
)QQ9 :
LogRR 
.RR 
MessageRR 
(RR  
$"RR  "
$strRR" +
{RR+ ,
anyDefRR, 2
.RR2 3
defNameRR3 :
}RR: ;
$strRR; H
"RRH I
)RRI J
;RRJ K
returnSS 
;SS 
}TT 
ListWW 
<WW 

ThingCountWW 
>WW 
virtualIngredientsWW /
=WW0 1
newWW2 5
ListWW6 :
<WW: ;

ThingCountWW; E
>WWE F
(WWF G
)WWG H
;WWH I
foreachYY 
(YY 
varYY 
sourceYY 
inYY  "
materialSourcesYY# 2
)YY2 3
{ZZ 
Thing[[ 

finalThing[[  
;[[  !
if]] 
(]] 
source]] 
.]] 
core]] 
!=]]  "
null]]# '
)]]' (
{^^ 
IntVec3`` 
replenishPos`` (
=``) *
source``+ 1
.``1 2
reservedThing``2 ?
?``? @
.``@ A
Position``A I
??``J L
source``M S
.``S T
core``T X
.``X Y
Position``Y a
;``a b
intaa 
maxCanCarryaa #
=aa$ %
pawnaa& *
.aa* +
carryTrackeraa+ 7
.aa7 8
MaxStackSpaceEveraa8 I
(aaI J
sourceaaJ P
.aaP Q
defaaQ T
)aaT U
;aaU V
intbb 
actualCountbb #
=bb$ %
Mathbb& *
.bb* +
Minbb+ .
(bb. /
sourcebb/ 5
.bb5 6
neededbb6 <
,bb< =
maxCanCarrybb> I
)bbI J
;bbJ K

finalThingdd 
=dd  "
ReplenishToNeededCountdd! 7
(dd7 8
sourcedd8 >
.dd> ?
coredd? C
,ddC D
sourceddE K
.ddK L
defddL O
,ddO P
sourceddQ W
.ddW X
stuffddX ]
,dd] ^
actualCountdd_ j
,ddj k
replenishPosddl x
,ddx y
pawnddz ~
.dd~ 
Map	dd Ç
,
ddÇ É
source
ddÑ ä
.
ddä ã
reservedThing
ddã ò
)
ddò ô
;
ddô ö
ifff 
(ff 

finalThingff "
==ff# %
nullff& *
||ff+ -
!ff. /

finalThingff/ 9
.ff9 :
Spawnedff: A
)ffA B
{gg 
ifhh 
(hh "
DigitalStorageSettingshh 2
.hh2 3
enableDebugLoghh3 A
)hhA B
Logii 
.ii  
Messageii  '
(ii' (
$"ii( *
$strii* 9
{ii9 :
sourceii: @
.ii@ A
defiiA D
.iiD E
defNameiiE L
}iiL M
"iiM N
)iiN O
;iiO P
returnjj 
;jj 
}kk 
ifmm 
(mm "
DigitalStorageSettingsmm .
.mm. /
enableDebugLogmm/ =
)mm= >
Lognn 
.nn 
Messagenn #
(nn# $
$"nn$ &
$strnn& 5
{nn5 6

finalThingnn6 @
.nn@ A
LabelnnA F
}nnF G
$strnnG I
{nnI J

finalThingnnJ T
.nnT U

stackCountnnU _
}nn_ `
"nn` a
)nna b
;nnb c
}oo 
elsepp 
{qq 

finalThingss 
=ss  
sourcess! '
.ss' (
mapThingss( 0
;ss0 1
}tt 
ifww 
(ww 
!ww 
pawnww 
.ww 

CanReserveww $
(ww$ %

finalThingww% /
,ww/ 0
$numww1 2
,ww2 3
-ww4 5
$numww5 6
,ww6 7
nullww8 <
,ww< =
falseww> C
)wwC D
||wwE G
!wwH I
pawnwwI M
.wwM N
CanReachwwN V
(wwV W

finalThingwwW a
,wwa b
PathEndModewwc n
.wwn o
OnCellwwo u
,wwu v
Dangerwww }
.ww} ~
Deadly	ww~ Ñ
)
wwÑ Ö
)
wwÖ Ü
{xx 
ifyy 
(yy "
DigitalStorageSettingsyy .
.yy. /
enableDebugLogyy/ =
)yy= >
Logzz 
.zz 
Messagezz #
(zz# $
$"zz$ &
$strzz& 9
{zz9 :

finalThingzz: D
.zzD E
LabelzzE J
}zzJ K
"zzK L
)zzL M
;zzM N
return{{ 
;{{ 
}|| 
int~~ 

countToUse~~ 
=~~  
Math~~! %
.~~% &
Min~~& )
(~~) *
source~~* 0
.~~0 1
needed~~1 7
,~~7 8

finalThing~~9 C
.~~C D

stackCount~~D N
)~~N O
;~~O P
virtualIngredients "
." #
Add# &
(& '
new' *

ThingCount+ 5
(5 6

finalThing6 @
,@ A

countToUseB L
)L M
)M N
;N O
}
ÄÄ 
if
ÉÉ 
(
ÉÉ  
virtualIngredients
ÉÉ "
.
ÉÉ" #
Count
ÉÉ# (
==
ÉÉ) +
billProd
ÉÉ, 4
.
ÉÉ4 5
recipe
ÉÉ5 ;
.
ÉÉ; <
ingredients
ÉÉ< G
.
ÉÉG H
Count
ÉÉH M
)
ÉÉM N
{
ÑÑ 
if
ÖÖ 
(
ÖÖ 
chosen
ÖÖ 
==
ÖÖ 
null
ÖÖ "
)
ÖÖ" #
{
ÜÜ 
chosen
áá 
=
áá 
new
áá  
List
áá! %
<
áá% &

ThingCount
áá& 0
>
áá0 1
(
áá1 2
)
áá2 3
;
áá3 4
}
àà 
chosen
ââ 
.
ââ 
AddRange
ââ 
(
ââ   
virtualIngredients
ââ  2
)
ââ2 3
;
ââ3 4
__result
ää 
=
ää 
true
ää 
;
ää  
if
åå 
(
åå $
DigitalStorageSettings
åå *
.
åå* +
enableDebugLog
åå+ 9
)
åå9 :
Log
çç 
.
çç 
Message
çç 
(
çç  
$"
çç  "
$str
çç" 0
{
çç0 1 
virtualIngredients
çç1 C
.
ççC D
Count
ççD I
}
ççI J
$str
ççJ N
"
ççN O
)
ççO P
;
ççP Q
}
éé 
}
èè 	
private
ëë 
static
ëë 
Thing
ëë 
FindMaterialOnMap
ëë .
(
ëë. /
Pawn
ëë/ 3
pawn
ëë4 8
,
ëë8 9
IngredientCount
ëë: I

ingredient
ëëJ T
,
ëëT U
Bill_Production
ëëV e
billProd
ëëf n
,
ëën o
int
ëëp s
neededCount
ëët 
)ëë Ä
{
íí 	
return
ìì 

GenClosest
ìì 
.
ìì #
ClosestThingReachable
ìì 3
(
ìì3 4
pawn
îî 
.
îî 
Position
îî 
,
îî 
pawn
ïï 
.
ïï 
Map
ïï 
,
ïï 
ThingRequest
ññ 
.
ññ 
ForGroup
ññ %
(
ññ% &
ThingRequestGroup
ññ& 7
.
ññ7 8
HaulableEver
ññ8 D
)
ññD E
,
ññE F
PathEndMode
óó 
.
óó 
ClosestTouch
óó (
,
óó( )
TraverseParms
òò 
.
òò 
For
òò !
(
òò! "
pawn
òò" &
,
òò& '
Danger
òò( .
.
òò. /
Deadly
òò/ 5
,
òò5 6
TraverseMode
òò7 C
.
òòC D
ByPawn
òòD J
,
òòJ K
false
òòL Q
,
òòQ R
false
òòS X
,
òòX Y
false
òòZ _
,
òò_ `
true
òòa e
)
òòe f
,
òòf g
$num
ôô 
,
ôô 
t
öö 
=>
öö 
t
öö 
.
öö 
Spawned
öö 
&&
öö !

ingredient
õõ 
.
õõ  
filter
õõ  &
.
õõ& '
Allows
õõ' -
(
õõ- .
t
õõ. /
)
õõ/ 0
&&
õõ1 3
(
úú 
billProd
úú 
.
úú 
ingredientFilter
úú /
==
úú0 2
null
úú3 7
||
úú8 :
billProd
úú; C
.
úúC D
ingredientFilter
úúD T
.
úúT U
Allows
úúU [
(
úú[ \
t
úú\ ]
)
úú] ^
||
úú_ a

ingredient
úúb l
.
úúl m
IsFixedIngredient
úúm ~
)
úú~ 
&&úúÄ Ç
!
ùù 
t
ùù 
.
ùù 
IsForbidden
ùù #
(
ùù# $
pawn
ùù$ (
)
ùù( )
&&
ùù* ,
pawn
ûû 
.
ûû 

CanReserve
ûû $
(
ûû$ %
t
ûû% &
,
ûû& '
$num
ûû( )
,
ûû) *
-
ûû+ ,
$num
ûû, -
,
ûû- .
null
ûû/ 3
,
ûû3 4
false
ûû5 :
)
ûû: ;
&&
ûû< >
t
üü 
.
üü 

stackCount
üü !
>=
üü" $
neededCount
üü% 0
,
üü0 1
null
†† 
,
†† 
$num
†† 
,
†† 
-
†† 
$num
†† 
,
†† 
false
†† "
,
††" #

RegionType
††$ .
.
††. /
Set_Passable
††/ ;
,
††; <
false
††= B
,
††B C
false
††D I
)
††I J
;
††J K
}
°° 	
private
££ 
static
££ 
(
££ "
Building_StorageCore
££ ,
core
££- 1
,
££1 2
ThingDef
££3 ;
def
££< ?
,
££? @
ThingDef
££A I
stuff
££J O
,
££O P
Thing
££Q V
reservedThing
££W d
)
££d e!
FindMaterialInCores
££f y
(
££y z)
DigitalStorageGameComponent
§§ '
gameComp
§§( 0
,
§§0 1
IngredientCount
§§2 A

ingredient
§§B L
,
§§L M
Bill_Production
§§N ]
billProd
§§^ f
,
§§f g
int
§§h k
neededCount
§§l w
,
§§w x
Map
§§y |
map§§} Ä
)§§Ä Å
{
•• 	
foreach
¶¶ 
(
¶¶ "
Building_StorageCore
¶¶ )
core
¶¶* .
in
¶¶/ 1
gameComp
¶¶2 :
.
¶¶: ;
GetAllCores
¶¶; F
(
¶¶F G
)
¶¶G H
)
¶¶H I
{
ßß 
if
®® 
(
®® 
core
®® 
==
®® 
null
®®  
||
®®! #
!
®®$ %
core
®®% )
.
®®) *
Spawned
®®* 1
||
®®2 4
!
®®5 6
core
®®6 :
.
®®: ;
Powered
®®; B
||
®®C E
core
®®F J
.
®®J K
Map
®®K N
!=
®®O Q
map
®®R U
)
®®U V
{
©© 
continue
™™ 
;
™™ 
}
´´ 
ThingDef
ÆÆ 
anyDef
ÆÆ 
=
ÆÆ  !

ingredient
ÆÆ" ,
.
ÆÆ, -
filter
ÆÆ- 3
.
ÆÆ3 4
AnyAllowedDef
ÆÆ4 A
;
ÆÆA B
Thing
ØØ 
reservedThing
ØØ #
=
ØØ$ %
core
ØØ& *
.
ØØ* +
FindReservedItem
ØØ+ ;
(
ØØ; <
anyDef
ØØ< B
,
ØØB C
null
ØØD H
)
ØØH I
;
ØØI J
if
±± 
(
±± 
reservedThing
±± !
!=
±±" $
null
±±% )
&&
±±* ,
reservedThing
±±- :
.
±±: ;
Spawned
±±; B
)
±±B C
{
≤≤ 
if
≥≥ 
(
≥≥ 
!
≥≥ 

ingredient
≥≥ #
.
≥≥# $
filter
≥≥$ *
.
≥≥* +
Allows
≥≥+ 1
(
≥≥1 2
reservedThing
≥≥2 ?
.
≥≥? @
def
≥≥@ C
)
≥≥C D
)
≥≥D E
{
¥¥ 
continue
µµ  
;
µµ  !
}
∂∂ 
bool
∏∏ 
billFilterAllows
∏∏ )
=
∏∏* +
billProd
∏∏, 4
.
∏∏4 5
ingredientFilter
∏∏5 E
==
∏∏F H
null
∏∏I M
||
∏∏N P
billProd
ππ+ 3
.
ππ3 4
ingredientFilter
ππ4 D
.
ππD E
Allows
ππE K
(
ππK L
reservedThing
ππL Y
.
ππY Z
def
ππZ ]
)
ππ] ^
||
ππ_ a

ingredient
∫∫+ 5
.
∫∫5 6
filter
∫∫6 <
.
∫∫< =
AllowedDefCount
∫∫= L
==
∫∫M O
$num
∫∫P Q
;
∫∫Q R
if
ºº 
(
ºº 
billFilterAllows
ºº (
)
ºº( )
{
ΩΩ 
int
ææ 
reservedCount
ææ )
=
ææ* +
reservedThing
ææ, 9
.
ææ9 :

stackCount
ææ: D
;
ææD E
int
øø 
virtualCount
øø (
=
øø) *
core
øø+ /
.
øø/ 0
GetItemCount
øø0 <
(
øø< =
reservedThing
øø= J
.
øøJ K
def
øøK N
,
øøN O
reservedThing
øøP ]
.
øø] ^
Stuff
øø^ c
)
øøc d
;
øød e
if
¡¡ 
(
¡¡ 
reservedCount
¡¡ )
+
¡¡* +
virtualCount
¡¡, 8
>=
¡¡9 ;
neededCount
¡¡< G
)
¡¡G H
{
¬¬ 
return
√√ "
(
√√# $
core
√√$ (
,
√√( )
reservedThing
√√* 7
.
√√7 8
def
√√8 ;
,
√√; <
reservedThing
√√= J
.
√√J K
Stuff
√√K P
,
√√P Q
reservedThing
√√R _
)
√√_ `
;
√√` a
}
ƒƒ 
}
≈≈ 
}
∆∆ 
foreach
…… 
(
…… 
StoredItemData
…… '
itemData
……( 0
in
……1 3
core
……4 8
.
……8 9
GetAllStoredItems
……9 J
(
……J K
)
……K L
)
……L M
{
   
if
ÀÀ 
(
ÀÀ 
itemData
ÀÀ  
.
ÀÀ  !
def
ÀÀ! $
==
ÀÀ% '
null
ÀÀ( ,
||
ÀÀ- /
itemData
ÀÀ0 8
.
ÀÀ8 9

stackCount
ÀÀ9 C
<=
ÀÀD F
$num
ÀÀG H
)
ÀÀH I
{
ÃÃ 
continue
ÕÕ  
;
ÕÕ  !
}
ŒŒ 
if
–– 
(
–– 
!
–– 

ingredient
–– #
.
––# $
filter
––$ *
.
––* +
Allows
––+ 1
(
––1 2
itemData
––2 :
.
––: ;
def
––; >
)
––> ?
)
––? @
{
—— 
continue
““  
;
““  !
}
”” 
bool
’’ 
billFilterAllows
’’ )
=
’’* +
billProd
’’, 4
.
’’4 5
ingredientFilter
’’5 E
==
’’F H
null
’’I M
||
’’N P
billProd
÷÷+ 3
.
÷÷3 4
ingredientFilter
÷÷4 D
.
÷÷D E
Allows
÷÷E K
(
÷÷K L
itemData
÷÷L T
.
÷÷T U
def
÷÷U X
)
÷÷X Y
||
÷÷Z \

ingredient
◊◊+ 5
.
◊◊5 6
filter
◊◊6 <
.
◊◊< =
AllowedDefCount
◊◊= L
==
◊◊M O
$num
◊◊P Q
;
◊◊Q R
if
ŸŸ 
(
ŸŸ 
billFilterAllows
ŸŸ (
&&
ŸŸ) +
itemData
ŸŸ, 4
.
ŸŸ4 5

stackCount
ŸŸ5 ?
>=
ŸŸ@ B
neededCount
ŸŸC N
)
ŸŸN O
{
⁄⁄ 
return
€€ 
(
€€  
core
€€  $
,
€€$ %
itemData
€€& .
.
€€. /
def
€€/ 2
,
€€2 3
itemData
€€4 <
.
€€< =
stuffDef
€€= E
,
€€E F
null
€€G K
)
€€K L
;
€€L M
}
‹‹ 
}
›› 
}
ﬁﬁ 
return
‡‡ 
(
‡‡ 
null
‡‡ 
,
‡‡ 
null
‡‡ 
,
‡‡ 
null
‡‡  $
,
‡‡$ %
null
‡‡& *
)
‡‡* +
;
‡‡+ ,
}
·· 	
private
„„ 
static
„„ 
Thing
„„ $
ReplenishToNeededCount
„„ 3
(
„„3 4"
Building_StorageCore
„„4 H
core
„„I M
,
„„M N
ThingDef
„„O W
def
„„X [
,
„„[ \
ThingDef
„„] e
stuff
„„f k
,
„„k l
int
„„m p
needed
„„q w
,
„„w x
IntVec3„„y Ä
position„„Å â
,„„â ä
Map„„ã é
map„„è í
,„„í ì
Thing„„î ô 
existingReserved„„ö ™
)„„™ ´
{
‰‰ 	
if
ÂÂ 
(
ÂÂ 
core
ÂÂ 
==
ÂÂ 
null
ÂÂ 
||
ÂÂ 
def
ÂÂ  #
==
ÂÂ$ &
null
ÂÂ' +
||
ÂÂ, .
needed
ÂÂ/ 5
<=
ÂÂ6 8
$num
ÂÂ9 :
||
ÂÂ; =
map
ÂÂ> A
==
ÂÂB D
null
ÂÂE I
)
ÂÂI J
{
ÊÊ 
return
ÁÁ 
null
ÁÁ 
;
ÁÁ 
}
ËË 
int
ÍÍ 
currentCount
ÍÍ 
=
ÍÍ 
existingReserved
ÍÍ /
?
ÍÍ/ 0
.
ÍÍ0 1

stackCount
ÍÍ1 ;
??
ÍÍ< >
$num
ÍÍ? @
;
ÍÍ@ A
int
ÎÎ 
needMore
ÎÎ 
=
ÎÎ 
needed
ÎÎ !
-
ÎÎ" #
currentCount
ÎÎ$ 0
;
ÎÎ0 1
if
ÌÌ 
(
ÌÌ 
needMore
ÌÌ 
<=
ÌÌ 
$num
ÌÌ 
)
ÌÌ 
{
ÓÓ 
return
ÔÔ 
existingReserved
ÔÔ '
;
ÔÔ' (
}
 
Thing
ÚÚ 
	extracted
ÚÚ 
=
ÚÚ 
core
ÚÚ "
.
ÚÚ" #
ExtractItem
ÚÚ# .
(
ÚÚ. /
def
ÚÚ/ 2
,
ÚÚ2 3
needMore
ÚÚ4 <
,
ÚÚ< =
stuff
ÚÚ> C
)
ÚÚC D
;
ÚÚD E
if
ÛÛ 
(
ÛÛ 
	extracted
ÛÛ 
==
ÛÛ 
null
ÛÛ !
)
ÛÛ! "
{
ÙÙ 
return
ıı 
existingReserved
ıı '
;
ıı' (
}
ˆˆ 
if
¯¯ 
(
¯¯ 
existingReserved
¯¯  
!=
¯¯! #
null
¯¯$ (
&&
¯¯) +
existingReserved
¯¯, <
.
¯¯< =
Spawned
¯¯= D
)
¯¯D E
{
˘˘ 
bool
˙˙ 
absorbed
˙˙ 
=
˙˙ 
existingReserved
˙˙  0
.
˙˙0 1
TryAbsorbStack
˙˙1 ?
(
˙˙? @
	extracted
˙˙@ I
,
˙˙I J
false
˙˙K P
)
˙˙P Q
;
˙˙Q R
if
˚˚ 
(
˚˚ 
absorbed
˚˚ 
)
˚˚ 
{
¸¸ 
try
˝˝ 
{
˛˛ 
if
ˇˇ 
(
ˇˇ 
	extracted
ˇˇ %
!=
ˇˇ& (
null
ˇˇ) -
&&
ˇˇ. 0
!
ˇˇ1 2
	extracted
ˇˇ2 ;
.
ˇˇ; <
	Destroyed
ˇˇ< E
&&
ˇˇF H
	extracted
ˇˇI R
.
ˇˇR S

stackCount
ˇˇS ]
>
ˇˇ^ _
$num
ˇˇ` a
)
ˇˇa b
{
ÄÄ 
GenSpawn
ÅÅ $
.
ÅÅ$ %
Spawn
ÅÅ% *
(
ÅÅ* +
	extracted
ÅÅ+ 4
,
ÅÅ4 5
existingReserved
ÅÅ6 F
.
ÅÅF G
Position
ÅÅG O
,
ÅÅO P
map
ÅÅQ T
,
ÅÅT U
WipeMode
ÅÅV ^
.
ÅÅ^ _
Vanish
ÅÅ_ e
)
ÅÅe f
;
ÅÅf g
}
ÇÇ 
}
ÉÉ 
catch
ÑÑ 
{
ÑÑ 
}
ÑÑ 
return
ÖÖ 
existingReserved
ÖÖ +
;
ÖÖ+ ,
}
ÜÜ 
else
áá 
{
àà 
GenSpawn
ââ 
.
ââ 
Spawn
ââ "
(
ââ" #
	extracted
ââ# ,
,
ââ, -
existingReserved
ââ. >
.
ââ> ?
Position
ââ? G
,
ââG H
map
ââI L
,
ââL M
WipeMode
ââN V
.
ââV W
Vanish
ââW ]
)
ââ] ^
;
ââ^ _
return
ää 
existingReserved
ää +
;
ää+ ,
}
ãã 
}
åå 
else
çç 
{
éé 
GenSpawn
èè 
.
èè 
Spawn
èè 
(
èè 
	extracted
èè (
,
èè( )
position
èè* 2
,
èè2 3
map
èè4 7
,
èè7 8
WipeMode
èè9 A
.
èèA B
Vanish
èèB H
)
èèH I
;
èèI J
return
êê 
	extracted
êê  
;
êê  !
}
ëë 
}
íí 	
}
ìì 
}îî ¥ã
uB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Pawn_JobTracker_StartJob_Teleport.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
Pawn_JobTracker (
)( )
,) *
$str+ 5
)5 6
]6 7
public 

static 
class 3
'Patch_Pawn_JobTracker_StartJob_Teleport ?
{ 
public 
static 
bool 
Prefix !
(! "
Job" %
newJob& ,
,, -
Pawn. 2
___pawn3 :
): ;
{ 	
if 
( 
newJob 
== 
null 
|| !
___pawn" )
==* ,
null- 1
||2 4
___pawn5 <
.< =
Map= @
==A C
nullD H
||I K
newJobL R
.R S
defS V
==W Y
nullZ ^
)^ _
{ 
return 
true 
; 
} 
if 
( 
newJob 
. 
def 
== 
JobDefOf &
.& '
DoBill' -
&&. 0
newJob1 7
.7 8

countQueue8 B
!=C E
nullF J
&&K M
newJobN T
.T U
targetQueueBU a
!=b d
nulle i
)i j
{ 
HandleDoBill   
(   
newJob   #
,  # $
___pawn  % ,
)  , -
;  - .
}!! 
else## 
if## 
(## 
newJob## 
.## 
def## 
==##  "
JobDefOf### +
.##+ ,
HaulToContainer##, ;
)##; <
{$$ !
HandleHaulToContainer%% %
(%%% &
newJob%%& ,
,%%, -
___pawn%%. 5
)%%5 6
;%%6 7
}&& 
return(( 
true(( 
;(( 
})) 	
private++ 
static++ 
void++ 
HandleDoBill++ (
(++( )
Job++) ,
job++- 0
,++0 1
Pawn++2 6
pawn++7 ;
)++; <
{,, 	
Thing-- 
	billGiver-- 
=-- 
job-- !
.--! "
targetA--" )
.--) *
Thing--* /
;--/ 0
if.. 
(.. 
	billGiver.. 
==.. 
null.. !
||.." $
	billGiver..% .
.... /
Map../ 2
==..3 5
null..6 :
)..: ;
{// 
return00 
;00 
}11 
if33 
(33 
job33 
.33 
targetQueueB33  
==33! #
null33$ (
||33) +
job33, /
.33/ 0

countQueue330 :
==33; =
null33> B
)33B C
{44 
return55 
;55 
}66 
bool88 
hasChip88 
=88 
PawnStorageAccess88 ,
.88, -
HasTerminalImplant88- ?
(88? @
pawn88@ D
)88D E
;88E F
if99 
(99 
!99 
hasChip99 
)99 
{:: 
return;; 
;;; 
}<< 
IntVec3?? 
workbenchPos??  
=??! " 
GetBillGiverRootCell??# 7
(??7 8
	billGiver??8 A
,??A B
pawn??C G
)??G H
;??H I
bool@@ 
hasVirtualMaterial@@ #
=@@$ %
false@@& +
;@@+ ,
forBB 
(BB 
intBB 
iBB 
=BB 
$numBB 
;BB 
iBB 
<BB 
jobBB  #
.BB# $
targetQueueBBB$ 0
.BB0 1
CountBB1 6
;BB6 7
iBB8 9
++BB9 ;
)BB; <
{CC 
ifDD 
(DD 
iDD 
>=DD 
jobDD 
.DD 

countQueueDD '
.DD' (
CountDD( -
)DD- .
{EE 
continueFF 
;FF 
}GG 
LocalTargetInfoII 

targetInfoII  *
=II+ ,
jobII- 0
.II0 1
targetQueueBII1 =
[II= >
iII> ?
]II? @
;II@ A
ifJJ 
(JJ 
!JJ 

targetInfoJJ 
.JJ  
IsValidJJ  '
||JJ( *
!JJ+ ,

targetInfoJJ, 6
.JJ6 7
HasThingJJ7 ?
)JJ? @
{KK 
continueLL 
;LL 
}MM 
ThingOO 
materialOO 
=OO  

targetInfoOO! +
.OO+ ,
ThingOO, 1
;OO1 2
ifPP 
(PP 
materialPP 
==PP 
nullPP  $
||PP% '
materialPP( 0
.PP0 1
	DestroyedPP1 :
)PP: ;
{QQ 
continueRR 
;RR 
}SS 
intUU 
countNeededUU 
=UU  !
jobUU" %
.UU% &

countQueueUU& 0
[UU0 1
iUU1 2
]UU2 3
;UU3 4 
Building_StorageCoreXX $
materialCoreXX% 1
=XX2 3
FindCoreWithItemXX4 D
(XXD E
materialXXE M
,XXM N
pawnXXO S
.XXS T
MapXXT W
)XXW X
;XXX Y
ifYY 
(YY 
materialCoreYY  
!=YY! #
nullYY$ (
)YY( )
{ZZ 
hasVirtualMaterial[[ &
=[[' (
true[[) -
;[[- .
Thing]] 
thingToTeleport]] )
;]]) *
if^^ 
(^^ 
material^^  
.^^  !

stackCount^^! +
<=^^, .
countNeeded^^/ :
)^^: ;
{__ 
materialaa  
.aa  !
DeSpawnaa! (
(aa( )
$numaa) *
)aa* +
;aa+ ,
GenSpawnbb  
.bb  !
Spawnbb! &
(bb& '
materialbb' /
,bb/ 0
workbenchPosbb1 =
,bb= >
pawnbb? C
.bbC D
MapbbD G
,bbG H
WipeModebbI Q
.bbQ R
VanishbbR X
)bbX Y
;bbY Z
thingToTeleportcc '
=cc( )
materialcc* 2
;cc2 3
}dd 
elseee 
{ff 
thingToTeleporthh '
=hh( )
materialhh* 2
.hh2 3
SplitOffhh3 ;
(hh; <
countNeededhh< G
)hhG H
;hhH I
GenSpawnii  
.ii  !
Spawnii! &
(ii& '
thingToTeleportii' 6
,ii6 7
workbenchPosii8 D
,iiD E
pawniiF J
.iiJ K
MapiiK N
,iiN O
WipeModeiiP X
.iiX Y
VanishiiY _
)ii_ `
;ii` a
}jj 

FleckMakerll 
.ll 
ThrowLightningGlowll 1
(ll1 2
thingToTeleportll2 A
.llA B
DrawPosllB I
,llI J
thingToTeleportllK Z
.llZ [
Mapll[ ^
,ll^ _
$numll` d
)lld e
;lle f
jobmm 
.mm 
targetQueueBmm $
[mm$ %
imm% &
]mm& '
=mm( )
thingToTeleportmm* 9
;mm9 :
ifoo 
(oo "
DigitalStorageSettingsoo .
.oo. /
enableDebugLogoo/ =
)oo= >
{pp 
Logqq 
.qq 
Messageqq #
(qq# $
$"qq$ &
$strqq& 9
{qq9 :
thingToTeleportqq: I
.qqI J
LabelqqJ O
}qqO P
$strqqP R
{qqR S
thingToTeleportqqS b
.qqb c

stackCountqqc m
}qqm n
$strqqn t
{qqt u
workbenchPos	qqu Å
}
qqÅ Ç
"
qqÇ É
)
qqÉ Ñ
;
qqÑ Ö
}rr 
}ss 
}tt 
ifvv 
(vv 
hasVirtualMaterialvv "
)vv" #
{ww 
pawnxx 
.xx #
ClearReservationsForJobxx ,
(xx, -
jobxx- 0
)xx0 1
;xx1 2
}yy 
}zz 	
private|| 
static|| 
IntVec3||  
GetBillGiverRootCell|| 3
(||3 4
Thing||4 9
	billGiver||: C
,||C D
Pawn||E I
pawn||J N
)||N O
{}} 	
Building~~ 
building~~ 
=~~ 
	billGiver~~  )
as~~* ,
Building~~- 5
;~~5 6
if 
( 
building 
== 
null  
)  !
{
ÄÄ 
return
ÅÅ 
	billGiver
ÅÅ  
.
ÅÅ  !
Position
ÅÅ! )
;
ÅÅ) *
}
ÇÇ 
if
ÉÉ 
(
ÉÉ 
building
ÉÉ 
.
ÉÉ 
def
ÉÉ 
.
ÉÉ  
hasInteractionCell
ÉÉ /
)
ÉÉ/ 0
{
ÑÑ 
return
ÖÖ 
building
ÖÖ 
.
ÖÖ  
InteractionCell
ÖÖ  /
;
ÖÖ/ 0
}
ÜÜ 
return
áá 
pawn
áá 
.
áá 
Position
áá  
;
áá  !
}
àà 	
private
ää 
static
ää 
void
ää #
HandleHaulToContainer
ää 1
(
ää1 2
Job
ää2 5
job
ää6 9
,
ää9 :
Pawn
ää; ?
pawn
ää@ D
)
ääD E
{
ãã 	
if
åå 
(
åå $
DigitalStorageSettings
åå &
.
åå& '
enableDebugLog
åå' 5
)
åå5 6
Log
çç 
.
çç 
Message
çç 
(
çç 
$"
çç 
$str
çç A
{
ççA B
pawn
ççB F
.
ççF G
Name
ççG K
}
ççK L
$str
ççL Z
{
ççZ [
job
çç[ ^
.
çç^ _
targetA
çç_ f
}
ççf g
$str
ççg s
{
ççs t
job
ççt w
.
ççw x
count
ççx }
}
çç} ~
"
çç~ 
)çç Ä
;ççÄ Å
if
èè 
(
èè 
job
èè 
.
èè 
targetA
èè 
.
èè 
Thing
èè !
==
èè" $
null
èè% )
||
èè* ,
job
èè- 0
.
èè0 1
targetA
èè1 8
.
èè8 9
Thing
èè9 >
.
èè> ?
Map
èè? B
==
èèC E
null
èèF J
)
èèJ K
{
êê 
return
ëë 
;
ëë 
}
íí 
bool
îî 
hasChip
îî 
=
îî 
PawnStorageAccess
îî ,
.
îî, - 
HasTerminalImplant
îî- ?
(
îî? @
pawn
îî@ D
)
îîD E
;
îîE F
if
ïï 
(
ïï 
!
ïï 
hasChip
ïï 
)
ïï 
{
ññ 
return
óó 
;
óó 
}
òò 
Thing
öö 
material
öö 
=
öö 
job
öö  
.
öö  !
targetA
öö! (
.
öö( )
Thing
öö) .
;
öö. /
if
õõ 
(
õõ 
material
õõ 
==
õõ 
null
õõ  
||
õõ! #
material
õõ$ ,
.
õõ, -
	Destroyed
õõ- 6
)
õõ6 7
{
úú 
return
ùù 
;
ùù 
}
ûû "
Building_StorageCore
°°  
materialCore
°°! -
=
°°. /
FindCoreWithItem
°°0 @
(
°°@ A
material
°°A I
,
°°I J
pawn
°°K O
.
°°O P
Map
°°P S
)
°°S T
;
°°T U
if
££ 
(
££ 
materialCore
££ 
!=
££ 
null
££  $
)
££$ %
{
§§ 
int
¶¶ 
countNeeded
¶¶ 
=
¶¶  !
job
¶¶" %
.
¶¶% &
count
¶¶& +
>
¶¶, -
$num
¶¶. /
?
¶¶0 1
job
¶¶2 5
.
¶¶5 6
count
¶¶6 ;
:
¶¶< =
material
¶¶> F
.
¶¶F G

stackCount
¶¶G Q
;
¶¶Q R
Thing
®® 
thingToTeleport
®® %
;
®®% &
if
©© 
(
©© 
material
©© 
.
©© 

stackCount
©© '
>
©©( )
countNeeded
©©* 5
)
©©5 6
{
™™ 
thingToTeleport
¨¨ #
=
¨¨$ %
material
¨¨& .
.
¨¨. /
SplitOff
¨¨/ 7
(
¨¨7 8
countNeeded
¨¨8 C
)
¨¨C D
;
¨¨D E
GenSpawn
≠≠ 
.
≠≠ 
Spawn
≠≠ "
(
≠≠" #
thingToTeleport
≠≠# 2
,
≠≠2 3
material
≠≠4 <
.
≠≠< =
Position
≠≠= E
,
≠≠E F
pawn
≠≠G K
.
≠≠K L
Map
≠≠L O
,
≠≠O P
WipeMode
≠≠Q Y
.
≠≠Y Z
Vanish
≠≠Z `
)
≠≠` a
;
≠≠a b
}
ÆÆ 
else
ØØ 
{
∞∞ 
thingToTeleport
≤≤ #
=
≤≤$ %
material
≤≤& .
;
≤≤. /
}
≥≥ 
thingToTeleport
∂∂ 
.
∂∂  
DeSpawn
∂∂  '
(
∂∂' (
$num
∂∂( )
)
∂∂) *
;
∂∂* +
GenSpawn
∑∑ 
.
∑∑ 
Spawn
∑∑ 
(
∑∑ 
thingToTeleport
∑∑ .
,
∑∑. /
pawn
∑∑0 4
.
∑∑4 5
Position
∑∑5 =
,
∑∑= >
pawn
∑∑? C
.
∑∑C D
Map
∑∑D G
,
∑∑G H
WipeMode
∑∑I Q
.
∑∑Q R
Vanish
∑∑R X
)
∑∑X Y
;
∑∑Y Z

FleckMaker
∏∏ 
.
∏∏  
ThrowLightningGlow
∏∏ -
(
∏∏- .
thingToTeleport
∏∏. =
.
∏∏= >
DrawPos
∏∏> E
,
∏∏E F
thingToTeleport
∏∏G V
.
∏∏V W
Map
∏∏W Z
,
∏∏Z [
$num
∏∏\ `
)
∏∏` a
;
∏∏a b
job
ªª 
.
ªª 
targetA
ªª 
=
ªª 
thingToTeleport
ªª -
;
ªª- .
pawn
ææ 
.
ææ %
ClearReservationsForJob
ææ ,
(
ææ, -
job
ææ- 0
)
ææ0 1
;
ææ1 2
if
¿¿ 
(
¿¿ $
DigitalStorageSettings
¿¿ *
.
¿¿* +
enableDebugLog
¿¿+ 9
)
¿¿9 :
Log
¡¡ 
.
¡¡ 
Message
¡¡ 
(
¡¡  
$"
¡¡  "
$str
¡¡" =
{
¡¡= >
thingToTeleport
¡¡> M
.
¡¡M N
Label
¡¡N S
}
¡¡S T
$str
¡¡T V
{
¡¡V W
thingToTeleport
¡¡W f
.
¡¡f g

stackCount
¡¡g q
}
¡¡q r
$str
¡¡r u
{
¡¡u v
pawn
¡¡v z
.
¡¡z {
Position¡¡{ É
}¡¡É Ñ
"¡¡Ñ Ö
)¡¡Ö Ü
;¡¡Ü á
}
¬¬ 
}
√√ 	
private
≈≈ 
static
≈≈ "
Building_StorageCore
≈≈ +
FindCoreWithItem
≈≈, <
(
≈≈< =
Thing
≈≈= B
item
≈≈C G
,
≈≈G H
Map
≈≈I L
map
≈≈M P
)
≈≈P Q
{
∆∆ 	)
DigitalStorageGameComponent
«« '
gameComp
««( 0
=
««1 2
Current
««3 :
.
««: ;
Game
««; ?
?
««? @
.
««@ A
GetComponent
««A M
<
««M N)
DigitalStorageGameComponent
««N i
>
««i j
(
««j k
)
««k l
;
««l m
if
»» 
(
»» 
gameComp
»» 
==
»» 
null
»»  
)
»»  !
{
…… 
return
   
null
   
;
   
}
ÀÀ 
foreach
ÕÕ 
(
ÕÕ "
Building_StorageCore
ÕÕ )
core
ÕÕ* .
in
ÕÕ/ 1
gameComp
ÕÕ2 :
.
ÕÕ: ;
GetAllCores
ÕÕ; F
(
ÕÕF G
)
ÕÕG H
)
ÕÕH I
{
ŒŒ 
if
œœ 
(
œœ 
core
œœ 
==
œœ 
null
œœ  
||
œœ! #
!
œœ$ %
core
œœ% )
.
œœ) *
Spawned
œœ* 1
||
œœ2 4
!
œœ5 6
core
œœ6 :
.
œœ: ;
Powered
œœ; B
||
œœC E
core
œœF J
.
œœJ K
Map
œœK N
!=
œœO Q
map
œœR U
)
œœU V
{
–– 
continue
—— 
;
—— 
}
““ 
	SlotGroup
‘‘ 
	slotGroup
‘‘ #
=
‘‘$ %
core
‘‘& *
.
‘‘* +
GetSlotGroup
‘‘+ 7
(
‘‘7 8
)
‘‘8 9
;
‘‘9 :
if
’’ 
(
’’ 
	slotGroup
’’ 
!=
’’  
null
’’! %
)
’’% &
{
÷÷ 
foreach
ÿÿ 
(
ÿÿ 
Thing
ÿÿ "
thing
ÿÿ# (
in
ÿÿ) +
	slotGroup
ÿÿ, 5
.
ÿÿ5 6

HeldThings
ÿÿ6 @
)
ÿÿ@ A
{
ŸŸ 
if
⁄⁄ 
(
⁄⁄ 
thing
⁄⁄ !
==
⁄⁄" $
item
⁄⁄% )
)
⁄⁄) *
{
€€ 
return
‹‹ "
core
‹‹# '
;
‹‹' (
}
›› 
}
ﬁﬁ 
if
·· 
(
·· 
	slotGroup
·· !
.
··! "
	CellsList
··" +
.
··+ ,
Contains
··, 4
(
··4 5
item
··5 9
.
··9 :
Position
··: B
)
··B C
)
··C D
{
‚‚ 
return
„„ 
core
„„ #
;
„„# $
}
‰‰ 
}
ÂÂ 
}
ÊÊ 
return
ËË 
null
ËË 
;
ËË 
}
ÈÈ 	
}
ÍÍ 
}ÎÎ Î
YB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\HarmonyInit.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ &
StaticConstructorOnStartup 
]  
public 

static 
class 
HarmonyInit #
{ 
static		 
HarmonyInit		 
(		 
)		 
{

 	
Harmony 
harmony 
= 
new !
Harmony" )
() *
$str* I
)I J
;J K
harmony 
. 
PatchAll 
( 
) 
; 
Log 
. 
Message 
( 
$str G
)G H
;H I
} 	
} 
} Å?
RB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Data\StoredItemData.cs
	namespace 	
DigitalStorage
 
. 
Data 
{ 
public

 

class

 
StoredItemData

 
:

  !

IExposable

" ,
{ 
public 
ThingDef 
def 
; 
public 
ThingDef 
stuffDef  
;  !
public 
QualityCategory 
quality &
=' (
QualityCategory) 8
.8 9
Normal9 ?
;? @
public 
int 
	hitPoints 
= 
-  
$num  !
;! "
public 
int 

stackCount 
= 
$num  !
;! "
public 
string 
uniqueId 
; 
public 
StoredItemData 
( 
) 
{ 	
this 
. 
uniqueId 
= 
Guid  
.  !
NewGuid! (
(( )
)) *
.* +
ToString+ 3
(3 4
)4 5
;5 6
} 	
public 
StoredItemData 
( 
Thing #
thing$ )
)) *
{ 	
this 
. 
def 
= 
thing 
. 
def  
;  !
this 
. 
stuffDef 
= 
thing !
.! "
Stuff" '
;' (
this 
. 

stackCount 
= 
thing #
.# $

stackCount$ .
;. /
this 
. 
	hitPoints 
= 
thing "
." #
	HitPoints# ,
;, -
this   
.   
uniqueId   
=   
Guid    
.    !
NewGuid  ! (
(  ( )
)  ) *
.  * +
ToString  + 3
(  3 4
)  4 5
;  5 6
CompQuality## 
compQuality## #
=##$ %
thing##& +
.##+ ,

TryGetComp##, 6
<##6 7
CompQuality##7 B
>##B C
(##C D
)##D E
;##E F
if$$ 
($$ 
compQuality$$ 
!=$$ 
null$$ #
)$$# $
{%% 
this&& 
.&& 
quality&& 
=&& 
compQuality&& *
.&&* +
Quality&&+ 2
;&&2 3
}'' 
}(( 	
public** 
void** 

ExposeData** 
(** 
)**  
{++ 	
Scribe_Defs,, 
.,, 
Look,, 
(,, 
ref,,  
this,,! %
.,,% &
def,,& )
,,,) *
$str,,+ 0
),,0 1
;,,1 2
Scribe_Defs-- 
.-- 
Look-- 
(-- 
ref--  
this--! %
.--% &
stuffDef--& .
,--. /
$str--0 :
)--: ;
;--; <
Scribe_Values.. 
... 
Look.. 
(.. 
ref.. "
this..# '
...' (
quality..( /
,../ 0
$str..1 :
,..: ;
QualityCategory..< K
...K L
Normal..L R
)..R S
;..S T
Scribe_Values// 
.// 
Look// 
(// 
ref// "
this//# '
.//' (
	hitPoints//( 1
,//1 2
$str//3 >
,//> ?
-//@ A
$num//A B
)//B C
;//C D
Scribe_Values00 
.00 
Look00 
(00 
ref00 "
this00# '
.00' (

stackCount00( 2
,002 3
$str004 @
,00@ A
$num00B C
)00C D
;00D E
Scribe_Values11 
.11 
Look11 
(11 
ref11 "
this11# '
.11' (
uniqueId11( 0
,110 1
$str112 <
,11< =
null11> B
)11B C
;11C D
if33 
(33 
Scribe33 
.33 
mode33 
==33 
LoadSaveMode33 +
.33+ ,
PostLoadInit33, 8
&&339 ;
string33< B
.33B C
IsNullOrEmpty33C P
(33P Q
this33Q U
.33U V
uniqueId33V ^
)33^ _
)33_ `
{44 
this55 
.55 
uniqueId55 
=55 
Guid55  $
.55$ %
NewGuid55% ,
(55, -
)55- .
.55. /
ToString55/ 7
(557 8
)558 9
;559 :
}66 
}77 	
public<< 
Thing<< 
CreateThing<<  
(<<  !
)<<! "
{== 	
if>> 
(>> 
this>> 
.>> 
def>> 
==>> 
null>>  
)>>  !
{?? 
return@@ 
null@@ 
;@@ 
}AA 
ThingCC 
thingCC 
=CC 

ThingMakerCC $
.CC$ %
	MakeThingCC% .
(CC. /
thisCC/ 3
.CC3 4
defCC4 7
,CC7 8
thisCC9 =
.CC= >
stuffDefCC> F
)CCF G
;CCG H
thingDD 
.DD 

stackCountDD 
=DD 
thisDD #
.DD# $

stackCountDD$ .
;DD. /
ifFF 
(FF 
thisFF 
.FF 
	hitPointsFF 
>FF  
$numFF! "
)FF" #
{GG 
thingHH 
.HH 
	HitPointsHH 
=HH  !
thisHH" &
.HH& '
	hitPointsHH' 0
;HH0 1
}II 
CompQualityKK 
compQualityKK #
=KK$ %
thingKK& +
.KK+ ,

TryGetCompKK, 6
<KK6 7
CompQualityKK7 B
>KKB C
(KKC D
)KKD E
;KKE F
ifLL 
(LL 
compQualityLL 
!=LL 
nullLL #
)LL# $
{MM 
compQualityNN 
.NN 

SetQualityNN &
(NN& '
thisNN' +
.NN+ ,
qualityNN, 3
,NN3 4 
ArtGenerationContextNN5 I
.NNI J
ColonyNNJ P
)NNP Q
;NNQ R
}OO 
returnQQ 
thingQQ 
;QQ 
}RR 	
publicWW 
boolWW 
MatchesWW 
(WW 
ThingDefWW $
thingDefWW% -
,WW- .
ThingDefWW/ 7
stuffWW8 =
=WW> ?
nullWW@ D
)WWD E
{XX 	
returnYY 
thisYY 
.YY 
defYY 
==YY 
thingDefYY '
&&YY( *
thisYY+ /
.YY/ 0
stuffDefYY0 8
==YY9 ;
stuffYY< A
;YYA B
}ZZ 	
public\\ 
override\\ 
string\\ 
ToString\\ '
(\\' (
)\\( )
{]] 	
string^^ 
label^^ 
=^^ 
this^^ 
.^^  
def^^  #
?^^# $
.^^$ %
label^^% *
??^^+ -
$str^^. 7
;^^7 8
if__ 
(__ 
this__ 
.__ 
stuffDef__ 
!=__  
null__! %
)__% &
{`` 
labelaa 
=aa 
thisaa 
.aa 
stuffDefaa %
.aa% &
labelaa& +
+aa, -
$straa. 1
+aa2 3
labelaa4 9
;aa9 :
}bb 
returncc 
$"cc 
{cc 
labelcc 
}cc 
$strcc 
{cc 
thiscc #
.cc# $

stackCountcc$ .
}cc. /
"cc/ 0
;cc0 1
}dd 	
}ee 
}ff ⁄
gB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\CompUseEffect_TerminalImplant.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
public		 

class		 )
CompUseEffect_TerminalImplant		 .
:		/ 0
CompUseEffect		1 >
{

 
public 
override 
void 
DoEffect %
(% &
Pawn& *
user+ /
)/ 0
{ 	
base 
. 
DoEffect 
( 
user 
) 
;  "
Hediff_TerminalImplant "
." #
AddTerminalImplant# 5
(5 6
user6 :
): ;
;; <
Messages 
. 
Message 
( 
$" 
{  
user  $
.$ %

LabelShort% /
}/ 0
$str0 G
"G H
,H I
userJ N
,N O
MessageTypeDefOfP `
.` a
PositiveEventa n
)n o
;o p
} 	
public 
override 
AcceptanceReport (
CanBeUsedBy) 4
(4 5
Pawn5 9
p: ;
); <
{ 	
if 
( 
p 
== 
null 
|| 
! 
p 
.  
	RaceProps  )
.) *
	Humanlike* 3
)3 4
return 
$str !
;! "
if 
( "
Hediff_TerminalImplant &
.& '
HasTerminalImplant' 9
(9 :
p: ;
); <
)< =
return 
$str  
;  !
return 
true 
; 
} 	
public 
override 
TaggedString $
ConfirmMessage% 3
(3 4
Pawn4 8
p9 :
): ;
{ 	
return 
$" 
$str 
{ 
p 
. 

LabelShort '
}' (
$str( P
"P Q
;Q R
}   	
}!! 
public## 

class## 4
(CompProperties_UseEffect_TerminalImplant## 9
:##: ;$
CompProperties_UseEffect##< T
{$$ 
public%% 4
(CompProperties_UseEffect_TerminalImplant%% 7
(%%7 8
)%%8 9
{&& 	
this'' 
.'' 
	compClass'' 
='' 
typeof'' #
(''# $)
CompUseEffect_TerminalImplant''$ A
)''A B
;''B C
}(( 	
})) 
}** ¨*
_B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\CompVirtualIngredient.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
public		 

class		 ,
 CompProperties_VirtualIngredient		 1
:		2 3
CompProperties		4 B
{

 
public ,
 CompProperties_VirtualIngredient /
(/ 0
)0 1
{ 	
this 
. 
	compClass 
= 
typeof #
(# $!
CompVirtualIngredient$ 9
)9 :
;: ;
} 	
} 
public 

class !
CompVirtualIngredient &
:' (
	ThingComp) 2
{ 
private 
bool 
	isVirtual 
=  
false! &
;& '
private  
Building_StorageCore $

sourceCore% /
;/ 0
private 
Map 
	sourceMap 
; 
private 
bool 
isFromReserved #
=$ %
false& +
;+ ,
private 
bool %
reservedThingPositionOnly .
=/ 0
false1 6
;6 7
private 
Thing 
reservedThing #
=$ %
null& *
;* +
public   
bool   
	IsVirtual   
=>    
	isVirtual  ! *
;  * +
public""  
Building_StorageCore"" #

SourceCore""$ .
=>""/ 1

sourceCore""2 <
;""< =
public$$ 
Map$$ 
	SourceMap$$ 
=>$$ 
	sourceMap$$  )
;$$) *
public&& 
bool&& 
IsFromReserved&& "
=>&&# %
isFromReserved&&& 4
;&&4 5
public(( 
bool(( %
ReservedThingPositionOnly(( -
=>((. 0%
reservedThingPositionOnly((1 J
;((J K
public** 
Thing** 
ReservedThing** "
=>**# %
reservedThing**& 3
;**3 4
public,, 
void,, 

SetVirtual,, 
(,, 
bool,, #
value,,$ )
),,) *
{-- 	
	isVirtual.. 
=.. 
value.. 
;.. 
}// 	
public11 
void11 
SetSourceCore11 !
(11! " 
Building_StorageCore11" 6
core117 ;
)11; <
{22 	

sourceCore33 
=33 
core33 
;33 
}44 	
public66 
void66 
SetSourceMap66  
(66  !
Map66! $
map66% (
)66( )
{77 	
	sourceMap88 
=88 
map88 
;88 
}99 	
public;; 
void;; 
SetFromReserved;; #
(;;# $
bool;;$ (
value;;) .
,;;. /
Thing;;0 5
reservedThing;;6 C
=;;D E
null;;F J
);;J K
{<< 	
isFromReserved== 
=== 
value== "
;==" #
this>> 
.>> 
reservedThing>> 
=>>  
reservedThing>>! .
;>>. /
this?? 
.?? %
reservedThingPositionOnly?? *
=??+ ,
false??- 2
;??2 3
}@@ 	
publicBB 
voidBB (
SetReservedThingPositionOnlyBB 0
(BB0 1
boolBB1 5
valueBB6 ;
,BB; <
ThingBB= B
reservedThingBBC P
=BBQ R
nullBBS W
)BBW X
{CC 	
isFromReservedDD 
=DD 
falseDD "
;DD" #
thisEE 
.EE %
reservedThingPositionOnlyEE *
=EE+ ,
valueEE- 2
;EE2 3
thisFF 
.FF 
reservedThingFF 
=FF  
reservedThingFF! .
;FF. /
}GG 	
publicII 
overrideII 
voidII 
PostExposeDataII +
(II+ ,
)II, -
{JJ 	
baseKK 
.KK 
PostExposeDataKK 
(KK  
)KK  !
;KK! "
Scribe_ValuesLL 
.LL 
LookLL 
(LL 
refLL "
	isVirtualLL# ,
,LL, -
$strLL. 9
,LL9 :
falseLL; @
)LL@ A
;LLA B
Scribe_ReferencesMM 
.MM 
LookMM "
(MM" #
refMM# &

sourceCoreMM' 1
,MM1 2
$strMM3 ?
,MM? @
falseMMA F
)MMF G
;MMG H
Scribe_ValuesNN 
.NN 
LookNN 
(NN 
refNN "
isFromReservedNN# 1
,NN1 2
$strNN3 C
,NNC D
falseNNE J
)NNJ K
;NNK L
Scribe_ValuesOO 
.OO 
LookOO 
(OO 
refOO "%
reservedThingPositionOnlyOO# <
,OO< =
$strOO> Y
,OOY Z
falseOO[ `
)OO` a
;OOa b
Scribe_ReferencesPP 
.PP 
LookPP "
(PP" #
refPP# &
reservedThingPP' 4
,PP4 5
$strPP6 E
,PPE F
falsePPG L
)PPL M
;PPM N
}RR 	
}SS 
}TT ˚$
`B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\Hediff_TerminalImplant.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
public 

class "
Hediff_TerminalImplant '
:( )
Hediff* 0
{ 
public 
static 
bool 
HasTerminalImplant -
(- .
Pawn. 2
pawn3 7
)7 8
{		 	
bool

 
flag

 
=

 
pawn

 
==

 
null

  $
||

% '
pawn

( ,
.

, -
health

- 3
==

4 6
null

7 ;
;

; <
return 
! 
flag 
&& 
pawn  
.  !
health! '
.' (
	hediffSet( 1
.1 2
	HasHediff2 ;
(; <
DefDatabase< G
<G H
	HediffDefH Q
>Q R
.R S
GetNamedS [
([ \
$str\ |
,| }
true	~ Ç
)
Ç É
,
É Ñ
false
Ö ä
)
ä ã
;
ã å
} 	
public 
static 
void 
AddTerminalImplant -
(- .
Pawn. 2
pawn3 7
)7 8
{ 	
bool 
flag 
= 
pawn 
== 
null  $
||% '
pawn( ,
., -
health- 3
==4 6
null7 ;
;; <
if 
( 
! 
flag 
) 
{ 
bool 
flag2 
= "
Hediff_TerminalImplant 3
.3 4
HasTerminalImplant4 F
(F G
pawnG K
)K L
;L M
if 
( 
! 
flag2 
) 
{ 
	HediffDef 
	hediffDef '
=( )
DefDatabase* 5
<5 6
	HediffDef6 ?
>? @
.@ A
GetNamedA I
(I J
$strJ j
,j k
truel p
)p q
;q r
Hediff 
hediff !
=" #
HediffMaker$ /
./ 0

MakeHediff0 :
(: ;
	hediffDef; D
,D E
pawnF J
,J K
nullL P
)P Q
;Q R
pawn 
. 
health 
.  
	AddHediff  )
() *
hediff* 0
,0 1
null2 6
,6 7
null8 <
,< =
null> B
)B C
;C D
} 
} 
} 	
public 
static 
void !
RemoveTerminalImplant 0
(0 1
Pawn1 5
pawn6 :
): ;
{ 	
bool 
flag 
= 
pawn 
== 
null  $
||% '
pawn( ,
., -
health- 3
==4 6
null7 ;
;; <
if   
(   
!   
flag   
)   
{!! 
Hediff"" 
hediff"" 
="" 
pawn""  $
.""$ %
health""% +
.""+ ,
	hediffSet"", 5
.""5 6
GetFirstHediffOfDef""6 I
(""I J
DefDatabase""J U
<""U V
	HediffDef""V _
>""_ `
.""` a
GetNamed""a i
(""i j
$str	""j ä
,
""ä ã
true
""å ê
)
""ê ë
,
""ë í
false
""ì ò
)
""ò ô
;
""ô ö
bool## 
flag2## 
=## 
hediff## #
!=##$ &
null##' +
;##+ ,
if$$ 
($$ 
flag2$$ 
)$$ 
{%% 
pawn&& 
.&& 
health&& 
.&&  
RemoveHediff&&  ,
(&&, -
hediff&&- 3
)&&3 4
;&&4 5
}'' 
}(( 
})) 	
public++ 
override++ 
void++ 
Notify_PawnKilled++ .
(++. /
)++/ 0
{,, 	
base-- 
.-- 
Notify_PawnKilled-- "
(--" #
)--# $
;--$ %
}.. 	
public00 
override00 
void00 

ExposeData00 '
(00' (
)00( )
{11 	
base22 
.22 

ExposeData22 
(22 
)22 
;22 
}33 	
}44 
}55 åG
dB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\DigitalStorageMapComponent.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
public 

class &
DigitalStorageMapComponent +
:, -
MapComponent. :
{		 
private

 
List

 
<

  
Building_StorageCore

 )
>

) *
cores

+ 0
=

1 2
new

3 6
List

7 ;
<

; < 
Building_StorageCore

< P
>

P Q
(

Q R
)

R S
;

S T
private 
HashSet 
< 
IntVec3 
>  
cabinetPositions! 1
=2 3
new4 7
HashSet8 ?
<? @
IntVec3@ G
>G H
(H I
)I J
;J K
public &
DigitalStorageMapComponent )
() *
Map* -
map. 1
)1 2
: 
base 
( 
map 
) 
{ 	
} 	
public 
void 
RegisterCore  
(  ! 
Building_StorageCore! 5
core6 :
): ;
{ 	
if 
( 
core 
!= 
null 
&& 
!  !
this! %
.% &
cores& +
.+ ,
Contains, 4
(4 5
core5 9
)9 :
): ;
{ 
this 
. 
cores 
. 
Add 
( 
core #
)# $
;$ %
} 
} 	
public 
void 
DeregisterCore "
(" # 
Building_StorageCore# 7
core8 <
)< =
{ 	
if 
( 
core 
!= 
null 
) 
{ 
this 
. 
cores 
. 
Remove !
(! "
core" &
)& '
;' (
} 
}   	
public"" 
List"" 
<""  
Building_StorageCore"" (
>""( )
GetAllCores""* 5
(""5 6
)""6 7
{## 	
return$$ 
this$$ 
.$$ 
cores$$ 
;$$ 
}%% 	
public'' 
void'' 
RegisterCabinet'' #
(''# $ 
Building_DiskCabinet''$ 8
cabinet''9 @
)''@ A
{(( 	
if)) 
()) 
cabinet)) 
!=)) 
null)) 
)))  
{** 
this++ 
.++ 
cabinetPositions++ %
.++% &
Add++& )
(++) *
cabinet++* 1
.++1 2
Position++2 :
)++: ;
;++; <
},, 
}-- 	
public// 
void// 
DeregisterCabinet// %
(//% & 
Building_DiskCabinet//& :
cabinet//; B
)//B C
{00 	
if11 
(11 
cabinet11 
!=11 
null11 
)11  
{22 
this33 
.33 
cabinetPositions33 %
.33% &
Remove33& ,
(33, -
cabinet33- 4
.334 5
Position335 =
)33= >
;33> ?
}44 
}55 	
public77 
bool77 
IsCabinetPosition77 %
(77% &
IntVec377& -
pos77. 1
)771 2
{88 	
return99 
this99 
.99 
cabinetPositions99 (
.99( )
Contains99) 1
(991 2
pos992 5
)995 6
;996 7
}:: 	
public??  
Building_StorageCore?? #
FindCoreWithItem??$ 4
(??4 5
Thing??5 :
thing??; @
)??@ A
{@@ 	
ifAA 
(AA 
thingAA 
==AA 
nullAA 
||AA  
!AA! "
thingAA" '
.AA' (
SpawnedAA( /
)AA/ 0
{BB 
returnCC 
nullCC 
;CC 
}DD 
forFF 
(FF 
intFF 
iFF 
=FF 
$numFF 
;FF 
iFF 
<FF 
thisFF  $
.FF$ %
coresFF% *
.FF* +
CountFF+ 0
;FF0 1
iFF2 3
++FF3 5
)FF5 6
{GG  
Building_StorageCoreHH $
coreHH% )
=HH* +
thisHH, 0
.HH0 1
coresHH1 6
[HH6 7
iHH7 8
]HH8 9
;HH9 :
ifII 
(II 
coreII 
==II 
nullII  
||II! #
!II$ %
coreII% )
.II) *
SpawnedII* 1
||II2 4
!II5 6
coreII6 :
.II: ;
PoweredII; B
)IIB C
{JJ 
continueKK 
;KK 
}LL 
	SlotGroupNN 
	slotGroupNN #
=NN$ %
coreNN& *
.NN* +
GetSlotGroupNN+ 7
(NN7 8
)NN8 9
;NN9 :
ifOO 
(OO 
	slotGroupOO 
!=OO  
nullOO! %
)OO% &
{PP 
foreachRR 
(RR 
ThingRR "
tRR# $
inRR% '
	slotGroupRR( 1
.RR1 2

HeldThingsRR2 <
)RR< =
{SS 
ifTT 
(TT 
tTT 
==TT  
thingTT! &
)TT& '
{UU 
returnVV "
coreVV# '
;VV' (
}WW 
}XX 
}YY 
if\\ 
(\\ 
	slotGroup\\ 
!=\\  
null\\! %
&&\\& (
	slotGroup\\) 2
.\\2 3
	CellsList\\3 <
!=\\= ?
null\\@ D
)\\D E
{]] 
foreach^^ 
(^^ 
IntVec3^^ $
cell^^% )
in^^* ,
	slotGroup^^- 6
.^^6 7
	CellsList^^7 @
)^^@ A
{__ 
if`` 
(`` 
cell``  
==``! #
thing``$ )
.``) *
Position``* 2
)``2 3
{aa 
Listbb  
<bb  !
Thingbb! &
>bb& '
thingsAtCellbb( 4
=bb5 6
thingbb7 <
.bb< =
Mapbb= @
.bb@ A
	thingGridbbA J
.bbJ K
ThingsListAtbbK W
(bbW X
cellbbX \
)bb\ ]
;bb] ^
forcc 
(cc  !
intcc! $
jcc% &
=cc' (
$numcc) *
;cc* +
jcc, -
<cc. /
thingsAtCellcc0 <
.cc< =
Countcc= B
;ccB C
jccD E
++ccE G
)ccG H
{dd 
Thingee  %
t2ee& (
=ee) *
thingsAtCellee+ 7
[ee7 8
jee8 9
]ee9 :
;ee: ;
ifff  "
(ff# $
t2ff$ &
==ff' )
thingff* /
||ff0 2
(ff3 4
t2ff4 6
.ff6 7
defff7 :
==ff; =
thingff> C
.ffC D
defffD G
&&ffH J
t2ffK M
.ffM N
StuffffN S
==ffT V
thingffW \
.ff\ ]
Stuffff] b
)ffb c
)ffc d
{gg  !
returnhh$ *
corehh+ /
;hh/ 0
}ii  !
}jj 
}kk 
}ll 
}mm 
ifpp 
(pp 
corepp 
.pp 
HasItempp  
(pp  !
thingpp! &
.pp& '
defpp' *
,pp* +
thingpp, 1
.pp1 2
Stuffpp2 7
)pp7 8
)pp8 9
{qq 
returnrr 
corerr 
;rr  
}ss 
}tt 
returnvv 
nullvv 
;vv 
}ww 	
publicyy 
boolyy 
IsCorePositionyy "
(yy" #
IntVec3yy# *
posyy+ .
)yy. /
{zz 	
for{{ 
({{ 
int{{ 
i{{ 
={{ 
$num{{ 
;{{ 
i{{ 
<{{ 
this{{  $
.{{$ %
cores{{% *
.{{* +
Count{{+ 0
;{{0 1
i{{2 3
++{{3 5
){{5 6
{||  
Building_StorageCore}} $ 
building_StorageCore}}% 9
=}}: ;
this}}< @
.}}@ A
cores}}A F
[}}F G
i}}G H
]}}H I
;}}I J
if~~ 
(~~  
building_StorageCore~~ (
!=~~) +
null~~, 0
&&~~1 3 
building_StorageCore~~4 H
.~~H I
Position~~I Q
==~~R T
pos~~U X
)~~X Y
{ 
return
ÄÄ 
true
ÄÄ 
;
ÄÄ  
}
ÅÅ 
}
ÇÇ 
return
ÉÉ 
false
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
}
ÖÖ 
}ÜÜ å
cB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_StackProtection.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ &
StaticConstructorOnStartup 
]  
public 

static 
class !
Patch_StackProtection -
{		 
static

 !
Patch_StackProtection

 $
(

$ %
)

% &
{ 	
LongEventHandler 
. 
QueueLongEvent +
(+ ,
new, /
Action0 6
(6 7!
Patch_StackProtection7 L
.L M
EnforceStackLimitsM _
)_ `
,` a
$str	b Ö
,
Ö Ü
false
á å
,
å ç
null
é í
,
í ì
true
î ò
,
ò ô
false
ö ü
,
ü †
null
° •
)
• ¶
;
¶ ß
} 	
private 
static 
void 
EnforceStackLimits .
(. /
)/ 0
{ 	
foreach 
( 
string 
defName #
in$ &!
Patch_StackProtection' <
.< =
ProtectedDiskDefs= N
)N O
{ 
ThingDef 
def 
= 
DefDatabase *
<* +
ThingDef+ 3
>3 4
.4 5
GetNamedSilentFail5 G
(G H
defNameH O
)O P
;P Q
bool 
flag 
= 
def 
!=  "
null# '
&&( *
def+ .
.. /

stackLimit/ 9
!=: <
$num= >
;> ?
if 
( 
flag 
) 
{ 
Log 
. 
Message 
(  
string  &
.& '
Format' -
(- .
$str. Q
,Q R
defNameS Z
,Z [
def\ _
._ `

stackLimit` j
)j k
)k l
;l m
def 
. 

stackLimit "
=# $
$num% &
;& '
} 
} 
} 	
public 
static 
bool 
IsProtectedDisk *
(* +
ThingDef+ 3
def4 7
)7 8
{ 	
return 
def 
!= 
null 
&& !!
Patch_StackProtection" 7
.7 8
ProtectedDiskDefs8 I
.I J
ContainsJ R
(R S
defS V
.V W
defNameW ^
)^ _
;_ `
}   	
public"" 
static"" 
bool"" 
IsProtectedDisk"" *
(""* +
Thing""+ 0
thing""1 6
)""6 7
{## 	
return$$ 
($$ 
($$ 
thing$$ 
!=$$ 
null$$ "
)$$" #
?$$$ %
thing$$& +
.$$+ ,
def$$, /
:$$0 1
null$$2 6
)$$6 7
!=$$8 :
null$$; ?
&&$$@ B!
Patch_StackProtection$$C X
.$$X Y
ProtectedDiskDefs$$Y j
.$$j k
Contains$$k s
($$s t
thing$$t y
.$$y z
def$$z }
.$$} ~
defName	$$~ Ö
)
$$Ö Ü
;
$$Ü á
}%% 	
private'' 
static'' 
readonly'' 
HashSet''  '
<''' (
string''( .
>''. /
ProtectedDiskDefs''0 A
=''B C
new''D G
HashSet''H O
<''O P
string''P V
>''V W
{''X Y
$str''Z t
,''t u
$str	''v ë
,
''ë í
$str
''ì ≠
}
''Æ Ø
;
''Ø ∞
}(( 
})) ¸ä
aB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\Building_InputInterface.cs
	namespace		 	
DigitalStorage		
 
.		 

Components		 #
{

 
public 

class #
Building_InputInterface (
:) *
Building_Storage+ ;
{ 
private  
Building_StorageCore $
	boundCore% .
;. /
private 
CompPowerTrader 
	powerComp  )
;) *
public  
Building_StorageCore #
	BoundCore$ -
=>. 0
	boundCore1 :
;: ;
public 
bool 
Powered 
=> 
	powerComp (
!=) +
null, 0
&&1 3
	powerComp4 =
.= >
PowerOn> E
;E F
public 
bool 
IsActive 
=> 
Powered  '
&&( *
	boundCore+ 4
!=5 7
null8 <
&&= ?
	boundCore@ I
.I J
PoweredJ Q
;Q R
public 
override 
void 

SpawnSetup '
(' (
Map( +
map, /
,/ 0
bool1 5
respawningAfterLoad6 I
)I J
{ 	
Log 
. 
Message 
( 
$" 
$str >
{> ?
map? B
}B C
$strC Y
{Y Z
respawningAfterLoadZ m
}m n
"n o
)o p
;p q
try 
{ 
base 
. 

SpawnSetup 
(  
map  #
,# $
respawningAfterLoad% 8
)8 9
;9 :
	powerComp 
= 
GetComp #
<# $
CompPowerTrader$ 3
>3 4
(4 5
)5 6
;6 7
if"" 
("" 
!"" 
respawningAfterLoad"" (
&&"") +
	boundCore"", 5
==""6 8
null""9 =
&&""> @
Map""A D
!=""E G
null""H L
)""L M
{## 
TryAutoConnect$$ "
($$" #
)$$# $
;$$$ %
}%%  
RefreshStoreSettings&& $
(&&$ %
)&&% &
;&&& '
Log'' 
.'' 
Message'' 
('' 
$"'' 
$str'' <
"''< =
)''= >
;''> ?
}(( 
catch)) 
()) 
System)) 
.)) 
	Exception)) #
ex))$ &
)))& '
{** 
Log++ 
.++ 
Error++ 
(++ 
$"++ 
$str++ <
{++< =
ex++= ?
}++? @
"++@ A
)++A B
;++B C
},, 
}-- 	
public// 
override// 
void// 
DeSpawn// $
(//$ %
DestroyMode//% 0
mode//1 5
=//6 7
DestroyMode//8 C
.//C D
Vanish//D J
)//J K
{00 	
Log11 
.11 
Message11 
(11 
$"11 
$str11 5
"115 6
)116 7
;117 8
try22 
{33 
SetBoundCore44 
(44 
null44 !
)44! "
;44" #
base55 
.55 
DeSpawn55 
(55 
mode55 !
)55! "
;55" #
Log66 
.66 
Message66 
(66 
$"66 
$str66 9
"669 :
)66: ;
;66; <
}77 
catch88 
(88 
System88 
.88 
	Exception88 #
ex88$ &
)88& '
{99 
Log:: 
.:: 
Error:: 
(:: 
$":: 
$str:: 9
{::9 :
ex::: <
}::< =
"::= >
)::> ?
;::? @
};; 
}<< 	
public>> 
override>> 
void>> 

ExposeData>> '
(>>' (
)>>( )
{?? 	
Log@@ 
.@@ 
Message@@ 
(@@ 
$"@@ 
$str@@ ?
{@@? @
Scribe@@@ F
.@@F G
mode@@G K
}@@K L
"@@L M
)@@M N
;@@N O
tryAA 
{BB 
baseCC 
.CC 

ExposeDataCC 
(CC  
)CC  !
;CC! "
Scribe_ReferencesDD !
.DD! "
LookDD" &
(DD& '
refDD' *
	boundCoreDD+ 4
,DD4 5
$strDD6 A
)DDA B
;DDB C
LogEE 
.EE 
MessageEE 
(EE 
$"EE 
$strEE H
{EEH I
	boundCoreEEI R
}EER S
"EES T
)EET U
;EEU V
}FF 
catchGG 
(GG 
SystemGG 
.GG 
	ExceptionGG #
exGG$ &
)GG& '
{HH 
LogII 
.II 
ErrorII 
(II 
$"II 
$strII <
{II< =
exII= ?
}II? @
"II@ A
)IIA B
;IIB C
}JJ 
}KK 	
publicMM 
overrideMM 
stringMM 
GetInspectStringMM /
(MM/ 0
)MM0 1
{NN 	
StringBuilderOO 
sbOO 
=OO 
newOO "
StringBuilderOO# 0
(OO0 1
)OO1 2
;OO2 3
stringPP 
baseStrPP 
=PP 
basePP !
.PP! "
GetInspectStringPP" 2
(PP2 3
)PP3 4
;PP4 5
ifQQ 
(QQ 
!QQ 
stringQQ 
.QQ 
IsNullOrEmptyQQ %
(QQ% &
baseStrQQ& -
)QQ- .
)QQ. /
{RR 
sbSS 
.SS 

AppendLineSS 
(SS 
baseStrSS %
)SS% &
;SS& '
}TT 
ifVV 
(VV 
	boundCoreVV 
!=VV 
nullVV !
)VV! "
{WW 
sbXX 
.XX 

AppendLineXX 
(XX 
$strXX %
+XX& '
	boundCoreXX( 1
.XX1 2
NetworkNameXX2 =
)XX= >
;XX> ?
sbYY 
.YY 

AppendLineYY 
(YY 
$"YY  
$strYY  $
{YY$ %
	boundCoreYY% .
.YY. /
GetUsedCapacityYY/ >
(YY> ?
)YY? @
}YY@ A
$strYYA B
{YYB C
	boundCoreYYC L
.YYL M
GetCapacityYYM X
(YYX Y
)YYY Z
}YYZ [
"YY[ \
)YY\ ]
;YY] ^
}ZZ 
else[[ 
{\\ 
sb]] 
.]] 

AppendLine]] 
(]] 
$str]] #
)]]# $
;]]$ %
}^^ 
if`` 
(`` 
!`` 
Powered`` 
)`` 
{aa 
sbbb 
.bb 

AppendLinebb 
(bb 
$strbb #
)bb# $
;bb$ %
}cc 
returndd 
sbdd 
.dd 
ToStringdd 
(dd 
)dd  
.dd  !
TrimEnddd! (
(dd( )
)dd) *
;dd* +
}ee 	
publicgg 
overridegg 
IEnumerablegg #
<gg# $
Gizmogg$ )
>gg) *
	GetGizmosgg+ 4
(gg4 5
)gg5 6
{hh 	
foreachii 
(ii 
Gizmoii 
gizmoii  
inii! #
baseii$ (
.ii( )
	GetGizmosii) 2
(ii2 3
)ii3 4
)ii4 5
{jj 
yieldkk 
returnkk 
gizmokk "
;kk" #
}ll 
yieldnn 
returnnn 
newnn 
Command_Actionnn +
{oo 
defaultLabelpp 
=pp 
$strpp &
,pp& '
defaultDescqq 
=qq 
$strqq *
,qq* +
iconrr 
=rr 
ContentFinderrr $
<rr$ %
	Texture2Drr% .
>rr. /
.rr/ 0
Getrr0 3
(rr3 4
$strrr4 N
,rrN O
truerrP T
)rrT U
,rrU V
actionss 
=ss 
delegatess !
{tt 
Listuu 
<uu 
FloatMenuOptionuu (
>uu( )
optionsuu* 1
=uu2 3
newuu4 7
Listuu8 <
<uu< =
FloatMenuOptionuu= L
>uuL M
(uuM N
)uuN O
;uuO P'
DigitalStorageGameComponentvv /
gameCompvv0 8
=vv9 :
Currentvv; B
.vvB C
GamevvC G
?vvG H
.vvH I
GetComponentvvI U
<vvU V'
DigitalStorageGameComponentvvV q
>vvq r
(vvr s
)vvs t
;vvt u
ifxx 
(xx 
gameCompxx  
!=xx! #
nullxx$ (
)xx( )
{yy 
foreachzz 
(zz  ! 
Building_StorageCorezz! 5
corezz6 :
inzz; =
gameCompzz> F
.zzF G
GetAllCoreszzG R
(zzR S
)zzS T
)zzT U
{{{ 
if|| 
(||  
core||  $
!=||% '
null||( ,
&&||- /
core||0 4
.||4 5
Spawned||5 <
&&||= ?
core||@ D
.||D E
Map||E H
==||I K
Map||L O
)||O P
{}} 
options~~  '
.~~' (
Add~~( +
(~~+ ,
new~~, /
FloatMenuOption~~0 ?
(~~? @
core~~@ D
.~~D E
NetworkName~~E P
,~~P Q
(~~R S
)~~S T
=>~~U W
SetBoundCore~~X d
(~~d e
core~~e i
)~~i j
)~~j k
)~~k l
;~~l m
} 
}
ÄÄ 
}
ÅÅ 
if
ÉÉ 
(
ÉÉ 
options
ÉÉ 
.
ÉÉ  
Count
ÉÉ  %
==
ÉÉ& (
$num
ÉÉ) *
)
ÉÉ* +
{
ÑÑ 
options
ÖÖ 
.
ÖÖ  
Add
ÖÖ  #
(
ÖÖ# $
new
ÖÖ$ '
FloatMenuOption
ÖÖ( 7
(
ÖÖ7 8
$str
ÖÖ8 ?
,
ÖÖ? @
null
ÖÖA E
)
ÖÖE F
)
ÖÖF G
;
ÖÖG H
}
ÜÜ 
Find
áá 
.
áá 
WindowStack
áá $
.
áá$ %
Add
áá% (
(
áá( )
new
áá) ,
	FloatMenu
áá- 6
(
áá6 7
options
áá7 >
)
áá> ?
)
áá? @
;
áá@ A
}
àà 
}
ââ 
;
ââ 
}
ää 	
public
åå 
void
åå 
SetBoundCore
åå  
(
åå  !"
Building_StorageCore
åå! 5
core
åå6 :
)
åå: ;
{
çç 	
	boundCore
éé 
=
éé 
core
éé 
;
éé "
RefreshStoreSettings
èè  
(
èè  !
)
èè! "
;
èè" #
}
êê 	
private
íí 
void
íí 
TryAutoConnect
íí #
(
íí# $
)
íí$ %
{
ìì 	
if
îî 
(
îî 
Map
îî 
==
îî 
null
îî 
)
îî 
return
îî #
;
îî# $
foreach
ññ 
(
ññ 
IntVec3
ññ 
cell
ññ !
in
ññ" $
GenAdj
ññ% +
.
ññ+ ,
CellsAdjacent8Way
ññ, =
(
ññ= >
this
ññ> B
)
ññB C
)
ññC D
{
óó 
if
òò 
(
òò 
!
òò 
cell
òò 
.
òò 
InBounds
òò "
(
òò" #
Map
òò# &
)
òò& '
)
òò' (
continue
ôô 
;
ôô "
Building_StorageCore
õõ $
core
õõ% )
=
õõ* +
cell
õõ, 0
.
õõ0 1
GetFirstBuilding
õõ1 A
(
õõA B
Map
õõB E
)
õõE F
as
õõG I"
Building_StorageCore
õõJ ^
;
õõ^ _
if
úú 
(
úú 
core
úú 
!=
úú 
null
úú  
)
úú  !
{
ùù 
SetBoundCore
ûû  
(
ûû  !
core
ûû! %
)
ûû% &
;
ûû& '
break
üü 
;
üü 
}
†† 
}
°° 
}
¢¢ 	
private
§§ 
void
§§ "
RefreshStoreSettings
§§ )
(
§§) *
)
§§* +
{
•• 	
if
¶¶ 
(
¶¶ 
	boundCore
¶¶ 
!=
¶¶ 
null
¶¶ !
)
¶¶! "
{
ßß 
settings
®® 
=
®® 
	boundCore
®® $
.
®®$ %
GetStoreSettings
®®% 5
(
®®5 6
)
®®6 7
;
®®7 8
}
©© 
}
™™ 	
public
ØØ 
override
ØØ 
void
ØØ "
Notify_ReceivedThing
ØØ 1
(
ØØ1 2
Thing
ØØ2 7
newItem
ØØ8 ?
)
ØØ? @
{
∞∞ 	
base
±± 
.
±± "
Notify_ReceivedThing
±± %
(
±±% &
newItem
±±& -
)
±±- .
;
±±. /
if
≥≥ 
(
≥≥ 
!
≥≥ 
IsActive
≥≥ 
||
≥≥ 
	boundCore
≥≥ &
==
≥≥' )
null
≥≥* .
||
≥≥/ 1
	boundCore
≥≥2 ;
.
≥≥; <
Map
≥≥< ?
==
≥≥@ B
null
≥≥C G
)
≥≥G H
{
¥¥ 
return
µµ 
;
µµ 
}
∂∂ 
if
∏∏ 
(
∏∏ 
!
∏∏ 
	boundCore
∏∏ 
.
∏∏ 
CanReceiveThing
∏∏ *
(
∏∏* +
newItem
∏∏+ 2
)
∏∏2 3
)
∏∏3 4
{
ππ 
return
∫∫ 
;
∫∫ 
}
ªª 
if
ææ 
(
ææ 
newItem
ææ 
.
ææ 
Spawned
ææ 
)
ææ  
{
øø 
newItem
¿¿ 
.
¿¿ 
DeSpawn
¿¿ 
(
¿¿  
DestroyMode
¿¿  +
.
¿¿+ ,
Vanish
¿¿, 2
)
¿¿2 3
;
¿¿3 4
}
¡¡ 
GenPlace
√√ 
.
√√ 
TryPlaceThing
√√ "
(
√√" #
newItem
√√# *
,
√√* +
	boundCore
√√, 5
.
√√5 6
Position
√√6 >
,
√√> ?
	boundCore
√√@ I
.
√√I J
Map
√√J M
,
√√M N
ThingPlaceMode
√√O ]
.
√√] ^
Near
√√^ b
)
√√b c
;
√√c d

FleckMaker
ƒƒ 
.
ƒƒ  
ThrowLightningGlow
ƒƒ )
(
ƒƒ) *
	boundCore
ƒƒ* 3
.
ƒƒ3 4
DrawPos
ƒƒ4 ;
,
ƒƒ; <
	boundCore
ƒƒ= F
.
ƒƒF G
Map
ƒƒG J
,
ƒƒJ K
$num
ƒƒL P
)
ƒƒP Q
;
ƒƒQ R
if
∆∆ 
(
∆∆ $
DigitalStorageSettings
∆∆ &
.
∆∆& '
enableDebugLog
∆∆' 5
)
∆∆5 6
{
«« 
Log
»» 
.
»» 
Message
»» 
(
»» 
$"
»» 
$str
»» -
{
»»- .
newItem
»». 5
.
»»5 6
Label
»»6 ;
}
»»; <
$str
»»< >
{
»»> ?
newItem
»»? F
.
»»F G

stackCount
»»G Q
}
»»Q R
$str
»»R U
{
»»U V
	boundCore
»»V _
.
»»_ `
NetworkName
»»` k
}
»»k l
"
»»l m
)
»»m n
;
»»n o
}
…… 
}
   	
public
ÃÃ 
new
ÃÃ 
bool
ÃÃ 
Accepts
ÃÃ 
(
ÃÃ  
Thing
ÃÃ  %
t
ÃÃ& '
)
ÃÃ' (
{
ÕÕ 	
if
ŒŒ 
(
ŒŒ 
!
ŒŒ 
IsActive
ŒŒ 
||
ŒŒ 
	boundCore
ŒŒ &
==
ŒŒ' )
null
ŒŒ* .
)
ŒŒ. /
{
œœ 
return
–– 
false
–– 
;
–– 
}
—— 
if
”” 
(
”” 
!
”” 
	boundCore
”” 
.
”” 
CanReceiveThing
”” *
(
””* +
t
””+ ,
)
””, -
)
””- .
{
‘‘ 
return
’’ 
false
’’ 
;
’’ 
}
÷÷ 
return
ÿÿ 
base
ÿÿ 
.
ÿÿ 
Accepts
ÿÿ 
(
ÿÿ  
t
ÿÿ  !
)
ÿÿ! "
;
ÿÿ" #
}
ŸŸ 	
public
€€ 
new
€€ 
StorageSettings
€€ "
GetStoreSettings
€€# 3
(
€€3 4
)
€€4 5
{
‹‹ 	
return
›› 
	boundCore
›› 
?
›› 
.
›› 
GetStoreSettings
›› .
(
››. /
)
››/ 0
??
››1 3
settings
››4 <
;
››< =
}
ﬁﬁ 	
public
‡‡ 
new
‡‡ 
StorageSettings
‡‡ "$
GetParentStoreSettings
‡‡# 9
(
‡‡9 :
)
‡‡: ;
{
·· 	
if
‚‚ 
(
‚‚ 
	boundCore
‚‚ 
!=
‚‚ 
null
‚‚ !
)
‚‚! "
{
„„ 
return
‰‰ 
	boundCore
‰‰  
.
‰‰  !$
GetParentStoreSettings
‰‰! 7
(
‰‰7 8
)
‰‰8 9
;
‰‰9 :
}
ÂÂ 
return
ÊÊ 
def
ÊÊ 
.
ÊÊ 
building
ÊÊ 
?
ÊÊ  
.
ÊÊ  !"
fixedStorageSettings
ÊÊ! 5
??
ÊÊ6 8
StorageSettings
ÊÊ9 H
.
ÊÊH I'
EverStorableFixedSettings
ÊÊI b
(
ÊÊb c
)
ÊÊc d
;
ÊÊd e
}
ÁÁ 	
}
ËË 
}ÈÈ ®
^B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\Building_DiskCabinet.cs
	namespace

 	
DigitalStorage


 
.

 

Components

 #
{ 
[ &
StaticConstructorOnStartup 
]  
public 

class  
Building_DiskCabinet %
:& '
Building_Storage( 8
{ 
private 
static 
readonly 
	Texture2D  )
LinkTex* 1
=2 3
ContentFinder4 A
<A B
	Texture2DB K
>K L
.L M
GetM P
(P Q
$strQ k
,k l
truem q
)q r
;r s
public 
const 
int 
MaxDiskCount %
=& '
$num( )
;) *
private 
static 
readonly 

Dictionary  *
<* +
string+ 1
,1 2
int3 6
>6 7
DiskCapacities8 F
=G H
newI L

DictionaryM W
<W X
stringX ^
,^ _
int` c
>c d
{ 	
{ 
$str (
,( )
$num* ,
}- .
,. /
{ 
$str )
,) *
$num+ .
}/ 0
,0 1
{ 
$str (
,( )
$num* -
}. /
} 	
;	 

private  
Building_StorageCore $
	boundCore% .
;. /
public 
override 
void 

SpawnSetup '
(' (
Map( +
map, /
,/ 0
bool1 5
respawningAfterLoad6 I
)I J
{ 	
base 
. 

SpawnSetup 
( 
map 
,  
respawningAfterLoad! 4
)4 5
;5 6&
DigitalStorageMapComponent &
	component' 0
=1 2
map3 6
.6 7
GetComponent7 C
<C D&
DigitalStorageMapComponentD ^
>^ _
(_ `
)` a
;a b
if 
( 
	component 
!= 
null !
)! "
{ 
	component   
.   
RegisterCabinet   )
(  ) *
this  * .
)  . /
;  / 0
}!! 
if"" 
("" 
this"" 
."" 
	boundCore"" 
=="" !
null""" &
&&""' )
!""* +
respawningAfterLoad""+ >
)""> ?
{## 
this$$ 
.$$ 
TryAutoConnect$$ #
($$# $
)$$$ %
;$$% &
}%% 
}&& 	
public(( 
override(( 
void(( 
DeSpawn(( $
((($ %
DestroyMode((% 0
mode((1 5
=((6 7
DestroyMode((8 C
.((C D
Vanish((D J
)((J K
{)) 	
Map** 
map** 
=** 
base** 
.** 
Map** 
;** 
if++ 
(++ 
map++ 
!=++ 
null++ 
)++ 
{,, &
DigitalStorageMapComponent-- *
	component--+ 4
=--5 6
map--7 :
.--: ;
GetComponent--; G
<--G H&
DigitalStorageMapComponent--H b
>--b c
(--c d
)--d e
;--e f
if.. 
(.. 
	component.. 
!=..  
null..! %
)..% &
{// 
	component00 
.00 
DeregisterCabinet00 /
(00/ 0
this000 4
)004 5
;005 6
}11 
}22 
this33 
.33 
SetBoundCore33 
(33 
null33 "
)33" #
;33# $
this44 
.44 
DropAllDisks44 
(44 
)44 
;44  
base55 
.55 
DeSpawn55 
(55 
mode55 
)55 
;55 
}66 	
public88 
override88 
void88 
PostMake88 %
(88% &
)88& '
{99 	
base:: 
.:: 
PostMake:: 
(:: 
):: 
;:: 
this;; 
.;; 
	boundCore;; 
=;; 
null;; !
;;;! "
}<< 	
public>> 
override>> 
void>> 

ExposeData>> '
(>>' (
)>>( )
{?? 	
base@@ 
.@@ 

ExposeData@@ 
(@@ 
)@@ 
;@@ 
Scribe_ReferencesAA 
.AA 
LookAA "
<AA" # 
Building_StorageCoreAA# 7
>AA7 8
(AA8 9
refAA9 <
thisAA= A
.AAA B
	boundCoreAAB K
,AAK L
$strAAM X
,AAX Y
falseAAZ _
)AA_ `
;AA` a
}BB 	
publicDD 
overrideDD 
voidDD  
Notify_ReceivedThingDD 1
(DD1 2
ThingDD2 7
newItemDD8 ?
)DD? @
{EE 	
baseFF 
.FF  
Notify_ReceivedThingFF %
(FF% &
newItemFF& -
)FF- .
;FF. /
ifGG 
(GG 
thisGG 
.GG 
GetDiskCountGG !
(GG! "
)GG" #
>GG$ %
$numGG& '
)GG' (
{HH 
ListII 
<II 
ThingII 
>II 
disksII !
=II" #
thisII$ (
.II( )
GetDisksII) 1
(II1 2
)II2 3
.II3 4
ToListII4 :
(II: ;
)II; <
;II< =
whileJJ 
(JJ 
disksJJ 
.JJ 
CountJJ "
>JJ# $
$numJJ% &
)JJ& '
{KK 
ThingLL 
diskLL 
=LL  
disksLL! &
.LL& '
LastLL' +
(LL+ ,
)LL, -
;LL- .
disksMM 
.MM 
RemoveMM  
(MM  !
diskMM! %
)MM% &
;MM& '
diskNN 
.NN 
DeSpawnNN  
(NN  !
DestroyModeNN! ,
.NN, -
VanishNN- 3
)NN3 4
;NN4 5
GenPlaceOO 
.OO 
TryPlaceThingOO *
(OO* +
diskOO+ /
,OO/ 0
baseOO1 5
.OO5 6
PositionOO6 >
,OO> ?
baseOO@ D
.OOD E
MapOOE H
,OOH I
ThingPlaceModeOOJ X
.OOX Y
NearOOY ]
,OO] ^
nullOO_ c
,OOc d
nullOOe i
,OOi j
nullOOk o
,OOo p
$numOOq r
)OOr s
;OOs t
}PP 
}QQ 
}RR 	
publicTT 
overrideTT 
stringTT 
GetInspectStringTT /
(TT/ 0
)TT0 1
{UU 	
StringBuilderVV 
sbVV 
=VV 
newVV "
StringBuilderVV# 0
(VV0 1
)VV1 2
;VV2 3
stringWW 
baseStrWW 
=WW 
baseWW !
.WW! "
GetInspectStringWW" 2
(WW2 3
)WW3 4
;WW4 5
ifXX 
(XX 
!XX 
stringXX 
.XX 
IsNullOrEmptyXX %
(XX% &
baseStrXX& -
)XX- .
)XX. /
{YY 
sbZZ 
.ZZ 

AppendLineZZ 
(ZZ 
baseStrZZ %
)ZZ% &
;ZZ& '
}[[ 
sb\\ 
.\\ 

AppendLine\\ 
(\\ 
string\\  
.\\  !
Format\\! '
(\\' (
$str\\( 5
,\\5 6
this\\7 ;
.\\; <
GetDiskCount\\< H
(\\H I
)\\I J
,\\J K
$num\\L M
)\\M N
)\\N O
;\\O P
sb]] 
.]] 

AppendLine]] 
(]] 
string]]  
.]]  !
Format]]! '
(]]' (
$str]]( 4
,]]4 5
this]]6 :
.]]: ;
GetProvidedCapacity]]; N
(]]N O
)]]O P
)]]P Q
)]]Q R
;]]R S
if^^ 
(^^ 
this^^ 
.^^ 
	boundCore^^ 
!=^^ !
null^^" &
)^^& '
{__ 
sb`` 
.`` 

AppendLine`` 
(`` 
$str`` %
+``& '
this``( ,
.``, -
	boundCore``- 6
.``6 7
NetworkName``7 B
)``B C
;``C D
}aa 
elsebb 
{cc 
sbdd 
.dd 

AppendLinedd 
(dd 
$strdd #
)dd# $
;dd$ %
}ee 
returnff 
sbff 
.ff 
ToStringff 
(ff 
)ff  
.ff  !
TrimEndff! (
(ff( )
)ff) *
;ff* +
}gg 	
publicii 
overrideii 
IEnumerableii #
<ii# $
Gizmoii$ )
>ii) *
	GetGizmosii+ 4
(ii4 5
)ii5 6
{jj 	
foreachkk 
(kk 
Gizmokk 
gizmokk  
inkk! #
basekk$ (
.kk( )
	GetGizmoskk) 2
(kk2 3
)kk3 4
)kk4 5
{ll 
yieldmm 
returnmm 
gizmomm "
;mm" #
}nn 
yieldpp 
returnpp 
newpp 
Command_Actionpp +
{qq 
defaultLabelrr 
=rr 
$strrr &
,rr& '
defaultDescss 
=ss 
$strss 1
,ss1 2
icontt 
=tt 
LinkTextt 
,tt 
actionuu 
=uu 
delegateuu !
(uu! "
)uu" #
{vv 
Listww 
<ww 
FloatMenuOptionww (
>ww( )
optionsww* 1
=ww2 3
newww4 7
Listww8 <
<ww< =
FloatMenuOptionww= L
>wwL M
(wwM N
)wwN O
;wwO P
Gamezz 
gamezz 
=zz 
Currentzz  '
.zz' (
Gamezz( ,
;zz, -'
DigitalStorageGameComponent{{ /
gameComp{{0 8
={{9 :
({{; <
game{{< @
!={{A C
null{{D H
){{H I
?{{J K
game{{L P
.{{P Q
GetComponent{{Q ]
<{{] ^'
DigitalStorageGameComponent{{^ y
>{{y z
({{z {
){{{ |
:{{} ~
null	{{ É
;
{{É Ñ
if}} 
(}} 
gameComp}}  
!=}}! #
null}}$ (
)}}( )
{~~ 
foreach
ÄÄ 
(
ÄÄ  !"
Building_StorageCore
ÄÄ! 5
core
ÄÄ6 :
in
ÄÄ; =
gameComp
ÄÄ> F
.
ÄÄF G
GetAllCores
ÄÄG R
(
ÄÄR S
)
ÄÄS T
)
ÄÄT U
{
ÅÅ 
if
ÇÇ 
(
ÇÇ  
core
ÇÇ  $
!=
ÇÇ% '
null
ÇÇ( ,
&&
ÇÇ- /
core
ÇÇ0 4
.
ÇÇ4 5
Spawned
ÇÇ5 <
)
ÇÇ< =
{
ÉÉ 
string
ÑÑ  &
label
ÑÑ' ,
=
ÑÑ- .
core
ÑÑ/ 3
.
ÑÑ3 4
NetworkName
ÑÑ4 ?
;
ÑÑ? @
if
ÜÜ  "
(
ÜÜ# $
core
ÜÜ$ (
.
ÜÜ( )
Map
ÜÜ) ,
!=
ÜÜ- /
base
ÜÜ0 4
.
ÜÜ4 5
Map
ÜÜ5 8
)
ÜÜ8 9
{
áá  !
label
àà$ )
=
àà* +
string
àà, 2
.
àà2 3
Format
àà3 9
(
àà9 :
$str
àà: H
,
ààH I
core
ààJ N
.
ààN O
NetworkName
ààO Z
,
ààZ [
core
àà\ `
.
àà` a
Map
ààa d
?
ààd e
.
ààe f
Index
ààf k
??
ààl n
-
àào p
$num
ààp q
)
ààq r
;
ààr s
}
ââ  !
options
ãã  '
.
ãã' (
Add
ãã( +
(
ãã+ ,
new
ãã, /
FloatMenuOption
ãã0 ?
(
ãã? @
label
ãã@ E
,
ããE F
delegate
ããG O
(
ããO P
)
ããP Q
{
åå  !
this
çç$ (
.
çç( )
SetBoundCore
çç) 5
(
çç5 6
core
çç6 :
)
çç: ;
;
çç; <
}
éé  !
)
éé! "
)
éé" #
;
éé# $
}
èè 
}
êê 
}
ëë 
else
íí 
{
ìì 
foreach
ïï 
(
ïï  !"
Building_StorageCore
ïï! 5
core
ïï6 :
in
ïï; =
base
ïï> B
.
ïïB C
Map
ïïC F
.
ïïF G
listerBuildings
ïïG V
.
ïïV W)
AllBuildingsColonistOfClass
ïïW r
<
ïïr s#
Building_StorageCoreïïs á
>ïïá à
(ïïà â
)ïïâ ä
)ïïä ã
{
ññ 
options
óó #
.
óó# $
Add
óó$ '
(
óó' (
new
óó( +
FloatMenuOption
óó, ;
(
óó; <
core
óó< @
.
óó@ A
NetworkName
óóA L
,
óóL M
delegate
óóN V
(
óóV W
)
óóW X
{
òò 
this
ôô  $
.
ôô$ %
SetBoundCore
ôô% 1
(
ôô1 2
core
ôô2 6
)
ôô6 7
;
ôô7 8
}
öö 
)
öö 
)
öö 
;
öö  
}
õõ 
}
úú 
if
ûû 
(
ûû 
options
ûû 
.
ûû  
Count
ûû  %
==
ûû& (
$num
ûû) *
)
ûû* +
{
üü 
options
†† 
.
††  
Add
††  #
(
††# $
new
††$ '
FloatMenuOption
††( 7
(
††7 8
$str
††8 ?
,
††? @
null
††A E
)
††E F
)
††F G
;
††G H
}
°° 
Find
¢¢ 
.
¢¢ 
WindowStack
¢¢ $
.
¢¢$ %
Add
¢¢% (
(
¢¢( )
new
¢¢) ,
	FloatMenu
¢¢- 6
(
¢¢6 7
options
¢¢7 >
)
¢¢> ?
)
¢¢? @
;
¢¢@ A
}
££ 
}
§§ 
;
§§ 
yield
•• 
break
•• 
;
•• 
}
¶¶ 	
public
®® 
void
®® 
SetBoundCore
®®  
(
®®  !"
Building_StorageCore
®®! 5
core
®®6 :
)
®®: ;
{
©© 	
if
™™ 
(
™™ 
this
™™ 
.
™™ 
	boundCore
™™ 
!=
™™ !
null
™™" &
)
™™& '
{
´´ 
this
¨¨ 
.
¨¨ 
	boundCore
¨¨ 
.
¨¨ #
DeregisterDiskCabinet
¨¨ 4
(
¨¨4 5
this
¨¨5 9
)
¨¨9 :
;
¨¨: ;
}
≠≠ 
this
ÆÆ 
.
ÆÆ 
	boundCore
ÆÆ 
=
ÆÆ 
core
ÆÆ !
;
ÆÆ! "
if
ØØ 
(
ØØ 
this
ØØ 
.
ØØ 
	boundCore
ØØ 
!=
ØØ !
null
ØØ" &
)
ØØ& '
{
∞∞ 
this
±± 
.
±± 
	boundCore
±± 
.
±± !
RegisterDiskCabinet
±± 2
(
±±2 3
this
±±3 7
)
±±7 8
;
±±8 9
}
≤≤ 
}
≥≥ 	
public
µµ "
Building_StorageCore
µµ #
GetBoundCore
µµ$ 0
(
µµ0 1
)
µµ1 2
{
∂∂ 	
return
∑∑ 
this
∑∑ 
.
∑∑ 
	boundCore
∑∑ !
;
∑∑! "
}
∏∏ 	
public
∫∫ 
int
∫∫ 
GetDiskCount
∫∫ 
(
∫∫  
)
∫∫  !
{
ªª 	
return
ºº 
this
ºº 
.
ºº 
GetDisks
ºº  
(
ºº  !
)
ºº! "
.
ºº" #
Count
ºº# (
(
ºº( )
)
ºº) *
;
ºº* +
}
ΩΩ 	
public
øø 
IEnumerable
øø 
<
øø 
Thing
øø  
>
øø  !
GetDisks
øø" *
(
øø* +
)
øø+ ,
{
¿¿ 	
	SlotGroup
¡¡ 
	slotGroup
¡¡ 
=
¡¡  !
base
¡¡" &
.
¡¡& '
GetSlotGroup
¡¡' 3
(
¡¡3 4
)
¡¡4 5
;
¡¡5 6
if
¬¬ 
(
¬¬ 
	slotGroup
¬¬ 
!=
¬¬ 
null
¬¬ !
)
¬¬! "
{
√√ 
foreach
ƒƒ 
(
ƒƒ 
Thing
ƒƒ 
thing
ƒƒ $
in
ƒƒ% '
	slotGroup
ƒƒ( 1
.
ƒƒ1 2

HeldThings
ƒƒ2 <
)
ƒƒ< =
{
≈≈ 
if
∆∆ 
(
∆∆ 
this
∆∆ 
.
∆∆ 
IsDisk
∆∆ #
(
∆∆# $
thing
∆∆$ )
)
∆∆) *
)
∆∆* +
{
«« 
yield
»» 
return
»» $
thing
»»% *
;
»»* +
}
…… 
}
   
}
ÀÀ 
yield
ÃÃ 
break
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
public
œœ 
int
œœ !
GetProvidedCapacity
œœ &
(
œœ& '
)
œœ' (
{
–– 	
int
—— 
total
—— 
=
—— 
$num
—— 
;
—— 
foreach
““ 
(
““ 
Thing
““ 
disk
““ 
in
““  "
this
““# '
.
““' (
GetDisks
““( 0
(
““0 1
)
““1 2
)
““2 3
{
”” 
int
‘‘ 
capacity
‘‘ 
;
‘‘ 
if
’’ 
(
’’ 
DiskCapacities
’’ "
.
’’" #
TryGetValue
’’# .
(
’’. /
disk
’’/ 3
.
’’3 4
def
’’4 7
.
’’7 8
defName
’’8 ?
,
’’? @
out
’’A D
capacity
’’E M
)
’’M N
)
’’N O
{
÷÷ 
total
◊◊ 
+=
◊◊ 
capacity
◊◊ %
;
◊◊% &
}
ÿÿ 
}
ŸŸ 
return
⁄⁄ 
total
⁄⁄ 
;
⁄⁄ 
}
€€ 	
private
›› 
bool
›› 
IsDisk
›› 
(
›› 
Thing
›› !
thing
››" '
)
››' (
{
ﬁﬁ 	
return
ﬂﬂ 
thing
ﬂﬂ 
!=
ﬂﬂ 
null
ﬂﬂ  
&&
ﬂﬂ! #
DiskCapacities
ﬂﬂ$ 2
.
ﬂﬂ2 3
ContainsKey
ﬂﬂ3 >
(
ﬂﬂ> ?
thing
ﬂﬂ? D
.
ﬂﬂD E
def
ﬂﬂE H
.
ﬂﬂH I
defName
ﬂﬂI P
)
ﬂﬂP Q
;
ﬂﬂQ R
}
‡‡ 	
private
‚‚ 
void
‚‚ 
TryAutoConnect
‚‚ #
(
‚‚# $
)
‚‚$ %
{
„„ 	
foreach
‰‰ 
(
‰‰ 
IntVec3
‰‰ 
cell
‰‰ !
in
‰‰" $
GenAdj
‰‰% +
.
‰‰+ ,
CellsAdjacent8Way
‰‰, =
(
‰‰= >
this
‰‰> B
)
‰‰B C
)
‰‰C D
{
ÂÂ 
if
ÊÊ 
(
ÊÊ 
!
ÊÊ 
cell
ÊÊ 
.
ÊÊ 
InBounds
ÊÊ "
(
ÊÊ" #
base
ÊÊ# '
.
ÊÊ' (
Map
ÊÊ( +
)
ÊÊ+ ,
)
ÊÊ, -
continue
ÁÁ 
;
ÁÁ 
Building
ÈÈ 
building
ÈÈ !
=
ÈÈ" #
cell
ÈÈ$ (
.
ÈÈ( )
GetFirstBuilding
ÈÈ) 9
(
ÈÈ9 :
base
ÈÈ: >
.
ÈÈ> ?
Map
ÈÈ? B
)
ÈÈB C
;
ÈÈC D"
Building_StorageCore
ÍÍ $
core
ÍÍ% )
=
ÍÍ* +
building
ÍÍ, 4
as
ÍÍ5 7"
Building_StorageCore
ÍÍ8 L
;
ÍÍL M
if
ÎÎ 
(
ÎÎ 
core
ÎÎ 
!=
ÎÎ 
null
ÎÎ  
)
ÎÎ  !
{
ÏÏ 
this
ÌÌ 
.
ÌÌ 
SetBoundCore
ÌÌ %
(
ÌÌ% &
core
ÌÌ& *
)
ÌÌ* +
;
ÌÌ+ ,
break
ÓÓ 
;
ÓÓ 
}
ÔÔ 
}
 
}
ÒÒ 	
private
ÛÛ 
void
ÛÛ 
DropAllDisks
ÛÛ !
(
ÛÛ! "
)
ÛÛ" #
{
ÙÙ 	
foreach
ıı 
(
ıı 
Thing
ıı 
disk
ıı 
in
ıı  "
this
ıı# '
.
ıı' (
GetDisks
ıı( 0
(
ıı0 1
)
ıı1 2
.
ıı2 3
ToList
ıı3 9
(
ıı9 :
)
ıı: ;
)
ıı; <
{
ˆˆ 
if
˜˜ 
(
˜˜ 
disk
˜˜ 
!=
˜˜ 
null
˜˜  
&&
˜˜! #
!
˜˜$ %
disk
˜˜% )
.
˜˜) *
	Destroyed
˜˜* 3
)
˜˜3 4
{
¯¯ 
disk
˘˘ 
.
˘˘ 
DeSpawn
˘˘  
(
˘˘  !
DestroyMode
˘˘! ,
.
˘˘, -
Vanish
˘˘- 3
)
˘˘3 4
;
˘˘4 5
GenPlace
˙˙ 
.
˙˙ 
TryPlaceThing
˙˙ *
(
˙˙* +
disk
˙˙+ /
,
˙˙/ 0
base
˙˙1 5
.
˙˙5 6
Position
˙˙6 >
,
˙˙> ?
base
˙˙@ D
.
˙˙D E
Map
˙˙E H
,
˙˙H I
ThingPlaceMode
˙˙J X
.
˙˙X Y
Near
˙˙Y ]
,
˙˙] ^
null
˙˙_ c
,
˙˙c d
null
˙˙e i
,
˙˙i j
null
˙˙k o
,
˙˙o p
$num
˙˙q r
)
˙˙r s
;
˙˙s t
}
˚˚ 
}
¸¸ 
}
˝˝ 	
}
˛˛ 
}ˇˇ ¥≥
^B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\Building_StorageCore.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
[ &
StaticConstructorOnStartup 
]  
public 

class  
Building_StorageCore %
:& '
Building_Storage( 8
,8 9
IRenameable: E
{ 
private 
static 
readonly 
	Texture2D  )
	RenameTex* 3
=4 5
ContentFinder6 C
<C D
	Texture2DD M
>M N
.N O
GetO R
(R S
$strS f
,f g
trueh l
)l m
;m n
private 
static 
readonly 
Material  (
LightMat) 1
=2 3
MaterialPool4 @
.@ A
MatFromA H
(H I
$strI R
,R S
ShaderDatabaseT b
.b c
MoteGlowc k
)k l
;l m
private 
static 
readonly 
Material  (
OrbMat) /
=0 1
MaterialPool2 >
.> ?
MatFrom? F
(F G
$strG P
,P Q
ShaderDatabaseR `
.` a
Cutouta g
)g h
;h i
private 
const 
int 
BaseCapacity &
=' (
$num) ,
;, -
private   
string   
networkName   "
;  " #
private!! 
List!! 
<!!  
Building_DiskCabinet!! )
>!!) *
diskCabinets!!+ 7
=!!8 9
new!!: =
List!!> B
<!!B C 
Building_DiskCabinet!!C W
>!!W X
(!!X Y
)!!Y Z
;!!Z [
private"" 
CompPowerTrader"" 
	powerComp""  )
;"") *
private%% 
List%% 
<%% 
StoredItemData%% #
>%%# $
virtualStorage%%% 3
=%%4 5
new%%6 9
List%%: >
<%%> ?
StoredItemData%%? M
>%%M N
(%%N O
)%%O P
;%%P Q
private&& 

Dictionary&& 
<&& 
string&& !
,&&! "
StoredItemData&&# 1
>&&1 2

itemLookup&&3 =
=&&> ?
new&&@ C

Dictionary&&D N
<&&N O
string&&O U
,&&U V
StoredItemData&&W e
>&&e f
(&&f g
)&&g h
;&&h i
private** 

Dictionary** 
<** 
string** !
,**! "
int**# &
>**& '
reservedItemCounts**( :
=**; <
new**= @

Dictionary**A K
<**K L
string**L R
,**R S
int**T W
>**W X
(**X Y
)**Y Z
;**Z [
public,, 
string,, 
RenamableLabel,, $
{-- 	
get.. 
{.. 
return.. 
this.. 
... 
networkName.. )
??..* ,
this..- 1
...1 2
LabelCapNoCount..2 A
;..A B
}..C D
set// 
{// 
this// 
.// 
networkName// "
=//# $
value//% *
;//* +
}//, -
}00 	
public22 
string22 
	BaseLabel22 
{33 	
get44 
{44 
return44 
this44 
.44 
LabelCapNoCount44 -
;44- .
}44/ 0
}55 	
public77 
string77 
InspectLabel77 "
{88 	
get99 
{99 
return99 
this99 
.99 
LabelCap99 &
;99& '
}99( )
}:: 	
public<< 
string<< 
NetworkName<< !
{== 	
get>> 
{>> 
return>> 
this>> 
.>> 
networkName>> )
??>>* ,
$str>>- 4
;>>4 5
}>>6 7
set?? 
{?? 
this?? 
.?? 
networkName?? "
=??# $
value??% *
;??* +
}??, -
}@@ 	
publicBB 
boolBB 
PoweredBB 
{CC 	
getDD 
{EE 
CompPowerTraderFF 
compPowerTraderFF  /
=FF0 1
thisFF2 6
.FF6 7
	powerCompFF7 @
;FF@ A
returnGG 
compPowerTraderGG &
!=GG' )
nullGG* .
&&GG/ 1
compPowerTraderGG2 A
.GGA B
PowerOnGGB I
;GGI J
}HH 
}II 	
	protectedKK 
overrideKK 
voidKK 
DrawAtKK  &
(KK& '
Vector3KK' .
drawLocKK/ 6
,KK6 7
boolKK8 <
flipKK= A
=KKB C
falseKKD I
)KKI J
{LL 	
baseNN 
.NN 
DrawAtNN 
(NN 
drawLocNN 
,NN  
flipNN! %
)NN% &
;NN& '
Vector3QQ 
lightPosQQ 
=QQ 
drawLocQQ &
;QQ& '
lightPosRR 
.RR 
yRR 
=RR 
AltitudeLayerRR &
.RR& '
BuildingOnTopRR' 4
.RR4 5
AltitudeForRR5 @
(RR@ A
)RRA B
;RRB C
	Matrix4x4SS 
lightMatSS 
=SS  
	Matrix4x4SS! *
.SS* +
TRSSS+ .
(SS. /
lightPosSS/ 7
,SS7 8

QuaternionSS9 C
.SSC D
identitySSD L
,SSL M
newSSN Q
Vector3SSR Y
(SSY Z
$numSSZ \
,SS\ ]
$numSS^ a
,SSa b
$numSSc e
)SSe f
)SSf g
;SSg h
GraphicsTT 
.TT 
DrawMeshTT 
(TT 
MeshPoolTT &
.TT& '
plane10TT' .
,TT. /
lightMatTT0 8
,TT8 9
LightMatTT: B
,TTB C
$numTTD E
)TTE F
;TTF G
floatWW 
floatOffsetWW 
=WW 
MathfWW  %
.WW% &
SinWW& )
(WW) *
TimeWW* .
.WW. / 
realtimeSinceStartupWW/ C
*WWD E
$numWWF H
)WWH I
*WWJ K
$numWWL Q
;WWQ R
Vector3XX 
orbPosXX 
=XX 
drawLocXX $
;XX$ %
orbPosYY 
.YY 
yYY 
=YY 
AltitudeLayerYY $
.YY$ %
BuildingOnTopYY% 2
.YY2 3
AltitudeForYY3 >
(YY> ?
)YY? @
+YYA B
$numYYC H
;YYH I
orbPosZZ 
.ZZ 
zZZ 
+=ZZ 
floatOffsetZZ #
;ZZ# $
	Matrix4x4[[ 
orbMat[[ 
=[[ 
	Matrix4x4[[ (
.[[( )
TRS[[) ,
([[, -
orbPos[[- 3
,[[3 4

Quaternion[[5 ?
.[[? @
identity[[@ H
,[[H I
new[[J M
Vector3[[N U
([[U V
$num[[V X
,[[X Y
$num[[Z ]
,[[] ^
$num[[_ a
)[[a b
)[[b c
;[[c d
Graphics\\ 
.\\ 
DrawMesh\\ 
(\\ 
MeshPool\\ &
.\\& '
plane10\\' .
,\\. /
orbMat\\0 6
,\\6 7
OrbMat\\8 >
,\\> ?
$num\\@ A
)\\A B
;\\B C
}]] 	
public__ 
override__ 
void__ 

SpawnSetup__ '
(__' (
Map__( +
map__, /
,__/ 0
bool__1 5
respawningAfterLoad__6 I
)__I J
{`` 	
baseaa 
.aa 

SpawnSetupaa 
(aa 
mapaa 
,aa  
respawningAfterLoadaa! 4
)aa4 5
;aa5 6
thisbb 
.bb 
	powerCompbb 
=bb 
basebb !
.bb! "
GetCompbb" )
<bb) *
CompPowerTraderbb* 9
>bb9 :
(bb: ;
)bb; <
;bb< =&
DigitalStorageMapComponentcc &
	componentcc' 0
=cc1 2
mapcc3 6
.cc6 7
GetComponentcc7 C
<ccC D&
DigitalStorageMapComponentccD ^
>cc^ _
(cc_ `
)cc` a
;cca b
ifdd 
(dd 
	componentdd 
!=dd 
nulldd !
)dd! "
{ee 
	componentff 
.ff 
RegisterCoreff &
(ff& '
thisff' +
)ff+ ,
;ff, -
}gg 
Gamehh 
gamehh 
=hh 
Currenthh 
.hh  
Gamehh  $
;hh$ %
ifii 
(ii 
gameii 
!=ii 
nullii 
)ii 
{jj '
DigitalStorageGameComponentkk +

component2kk, 6
=kk7 8
gamekk9 =
.kk= >
GetComponentkk> J
<kkJ K'
DigitalStorageGameComponentkkK f
>kkf g
(kkg h
)kkh i
;kki j
ifll 
(ll 

component2ll 
!=ll !
nullll" &
)ll& '
{mm 

component2nn 
.nn 
RegisterCorenn +
(nn+ ,
thisnn, 0
)nn0 1
;nn1 2
}oo 
}pp 
}qq 	
publicss 
overridess 
voidss 
DeSpawnss $
(ss$ %
DestroyModess% 0
modess1 5
=ss6 7
DestroyModess8 C
.ssC D
VanishssD J
)ssJ K
{tt 	
Mapuu 
mapuu 
=uu 
baseuu 
.uu 
Mapuu 
;uu 
ifvv 
(vv 
mapvv 
!=vv 
nullvv 
)vv 
{ww &
DigitalStorageMapComponentxx *
	componentxx+ 4
=xx5 6
mapxx7 :
.xx: ;
GetComponentxx; G
<xxG H&
DigitalStorageMapComponentxxH b
>xxb c
(xxc d
)xxd e
;xxe f
ifyy 
(yy 
	componentyy 
!=yy  
nullyy! %
)yy% &
{zz 
	component{{ 
.{{ 
DeregisterCore{{ ,
({{, -
this{{- 1
){{1 2
;{{2 3
}|| 
}}} 
Game~~ 
game~~ 
=~~ 
Current~~ 
.~~  
Game~~  $
;~~$ %
if 
( 
game 
!= 
null 
) 
{
ÄÄ )
DigitalStorageGameComponent
ÅÅ +

component2
ÅÅ, 6
=
ÅÅ7 8
game
ÅÅ9 =
.
ÅÅ= >
GetComponent
ÅÅ> J
<
ÅÅJ K)
DigitalStorageGameComponent
ÅÅK f
>
ÅÅf g
(
ÅÅg h
)
ÅÅh i
;
ÅÅi j
if
ÇÇ 
(
ÇÇ 

component2
ÇÇ 
!=
ÇÇ !
null
ÇÇ" &
)
ÇÇ& '
{
ÉÉ 

component2
ÑÑ 
.
ÑÑ 
DeregisterCore
ÑÑ -
(
ÑÑ- .
this
ÑÑ. 2
)
ÑÑ2 3
;
ÑÑ3 4
}
ÖÖ 
}
ÜÜ 
foreach
áá 
(
áá "
Building_DiskCabinet
áá )
cabinet
áá* 1
in
áá2 4
this
áá5 9
.
áá9 :
diskCabinets
áá: F
.
ááF G
ToList
ááG M
(
ááM N
)
ááN O
)
ááO P
{
àà 
if
ââ 
(
ââ 
cabinet
ââ 
!=
ââ 
null
ââ #
)
ââ# $
{
ää 
cabinet
ãã 
.
ãã 
SetBoundCore
ãã (
(
ãã( )
null
ãã) -
)
ãã- .
;
ãã. /
}
åå 
}
çç 
this
éé 
.
éé 
diskCabinets
éé 
.
éé 
Clear
éé #
(
éé# $
)
éé$ %
;
éé% &
base
êê 
.
êê 
DeSpawn
êê 
(
êê 
mode
êê 
)
êê 
;
êê 
}
ëë 	
public
ìì 
override
ìì 
IEnumerable
ìì #
<
ìì# $
Gizmo
ìì$ )
>
ìì) *
	GetGizmos
ìì+ 4
(
ìì4 5
)
ìì5 6
{
îî 	
foreach
ïï 
(
ïï 
Gizmo
ïï 
gizmo
ïï  
in
ïï! #
base
ïï$ (
.
ïï( )
	GetGizmos
ïï) 2
(
ïï2 3
)
ïï3 4
)
ïï4 5
{
ññ 
yield
óó 
return
óó 
gizmo
óó "
;
óó" #
}
òò 
yield
öö 
return
öö 
new
öö 
Command_Action
öö +
{
õõ 
defaultLabel
úú 
=
úú 
$str
úú %
,
úú% &
defaultDesc
ùù 
=
ùù 
$str
ùù ,
,
ùù, -
icon
ûû 
=
ûû 
ContentFinder
ûû $
<
ûû$ %
	Texture2D
ûû% .
>
ûû. /
.
ûû/ 0
Get
ûû0 3
(
ûû3 4
$str
ûû4 N
,
ûûN O
true
ûûP T
)
ûûT U
,
ûûU V
action
üü 
=
üü 
delegate
üü !
(
üü! "
)
üü" #
{
†† 
Find
°° 
.
°° 
WindowStack
°° $
.
°°$ %
Add
°°% (
(
°°( )
new
°°) ,
DigitalStorage
°°- ;
.
°°; <
UI
°°< >
.
°°> ?#
Dialog_VirtualStorage
°°? T
(
°°T U
this
°°U Y
)
°°Y Z
)
°°Z [
;
°°[ \
}
¢¢ 
}
££ 
;
££ 
yield
•• 
return
•• 
new
•• 
Command_Action
•• +
{
¶¶ 
defaultLabel
ßß 
=
ßß 
$str
ßß &
,
ßß& '
defaultDesc
®® 
=
®® 
$str
®® ,
,
®®, -
icon
©© 
=
©© 
	RenameTex
©©  
,
©©  !
action
™™ 
=
™™ 
delegate
™™ !
(
™™! "
)
™™" #
{
´´ 
Find
¨¨ 
.
¨¨ 
WindowStack
¨¨ $
.
¨¨$ %
Add
¨¨% (
(
¨¨( )
new
¨¨) ,"
Dialog_RenameNetwork
¨¨- A
(
¨¨A B
this
¨¨B F
)
¨¨F G
)
¨¨G H
;
¨¨H I
}
≠≠ 
}
ÆÆ 
;
ÆÆ 
yield
ØØ 
break
ØØ 
;
ØØ 
}
∞∞ 	
public
≤≤ 
override
≤≤ 
void
≤≤ 
PostMake
≤≤ %
(
≤≤% &
)
≤≤& '
{
≥≥ 	
base
¥¥ 
.
¥¥ 
PostMake
¥¥ 
(
¥¥ 
)
¥¥ 
;
¥¥ 
this
µµ 
.
µµ 
diskCabinets
µµ 
=
µµ 
new
µµ  #
List
µµ$ (
<
µµ( )"
Building_DiskCabinet
µµ) =
>
µµ= >
(
µµ> ?
)
µµ? @
;
µµ@ A
this
∂∂ 
.
∂∂ 
virtualStorage
∂∂ 
=
∂∂  !
new
∂∂" %
List
∂∂& *
<
∂∂* +
StoredItemData
∂∂+ 9
>
∂∂9 :
(
∂∂: ;
)
∂∂; <
;
∂∂< =
this
∑∑ 
.
∑∑ 

itemLookup
∑∑ 
=
∑∑ 
new
∑∑ !

Dictionary
∑∑" ,
<
∑∑, -
string
∑∑- 3
,
∑∑3 4
StoredItemData
∑∑5 C
>
∑∑C D
(
∑∑D E
)
∑∑E F
;
∑∑F G
this
∏∏ 
.
∏∏  
reservedItemCounts
∏∏ #
=
∏∏$ %
new
∏∏& )

Dictionary
∏∏* 4
<
∏∏4 5
string
∏∏5 ;
,
∏∏; <
int
∏∏= @
>
∏∏@ A
(
∏∏A B
)
∏∏B C
;
∏∏C D
}
ππ 	
public
ªª 
override
ªª 
void
ªª 

ExposeData
ªª '
(
ªª' (
)
ªª( )
{
ºº 	
base
ΩΩ 
.
ΩΩ 

ExposeData
ΩΩ 
(
ΩΩ 
)
ΩΩ 
;
ΩΩ 
Scribe_Values
ææ 
.
ææ 
Look
ææ 
<
ææ 
string
ææ %
>
ææ% &
(
ææ& '
ref
ææ' *
this
ææ+ /
.
ææ/ 0
networkName
ææ0 ;
,
ææ; <
$str
ææ= J
,
ææJ K
null
ææL P
,
ææP Q
false
ææR W
)
ææW X
;
ææX Y 
Scribe_Collections
øø 
.
øø 
Look
øø #
<
øø# $"
Building_DiskCabinet
øø$ 8
>
øø8 9
(
øø9 :
ref
øø: =
this
øø> B
.
øøB C
diskCabinets
øøC O
,
øøO P
$str
øøQ _
,
øø_ `
LookMode
øøa i
.
øøi j
	Reference
øøj s
,
øøs t
Array
øøu z
.
øøz {
Emptyøø{ Ä
<øøÄ Å
objectøøÅ á
>øøá à
(øøà â
)øøâ ä
)øøä ã
;øøã å 
Scribe_Collections
¿¿ 
.
¿¿ 
Look
¿¿ #
<
¿¿# $
StoredItemData
¿¿$ 2
>
¿¿2 3
(
¿¿3 4
ref
¿¿4 7
this
¿¿8 <
.
¿¿< =
virtualStorage
¿¿= K
,
¿¿K L
$str
¿¿M ]
,
¿¿] ^
LookMode
¿¿_ g
.
¿¿g h
Deep
¿¿h l
)
¿¿l m
;
¿¿m n 
Scribe_Collections
¡¡ 
.
¡¡ 
Look
¡¡ #
<
¡¡# $
string
¡¡$ *
,
¡¡* +
int
¡¡, /
>
¡¡/ 0
(
¡¡0 1
ref
¡¡1 4
this
¡¡5 9
.
¡¡9 : 
reservedItemCounts
¡¡: L
,
¡¡L M
$str
¡¡N b
,
¡¡b c
LookMode
¡¡d l
.
¡¡l m
Value
¡¡m r
,
¡¡r s
LookMode
¡¡t |
.
¡¡| }
Value¡¡} Ç
)¡¡Ç É
;¡¡É Ñ
if
√√ 
(
√√ 
Scribe
√√ 
.
√√ 
mode
√√ 
==
√√ 
LoadSaveMode
√√ +
.
√√+ ,
PostLoadInit
√√, 8
)
√√8 9
{
ƒƒ 
if
≈≈ 
(
≈≈ 
this
≈≈ 
.
≈≈ 
diskCabinets
≈≈ %
==
≈≈& (
null
≈≈) -
)
≈≈- .
{
∆∆ 
this
«« 
.
«« 
diskCabinets
«« %
=
««& '
new
««( +
List
««, 0
<
««0 1"
Building_DiskCabinet
««1 E
>
««E F
(
««F G
)
««G H
;
««H I
}
»» 
if
…… 
(
…… 
this
…… 
.
…… 
virtualStorage
…… '
==
……( *
null
……+ /
)
……/ 0
{
   
this
ÀÀ 
.
ÀÀ 
virtualStorage
ÀÀ '
=
ÀÀ( )
new
ÀÀ* -
List
ÀÀ. 2
<
ÀÀ2 3
StoredItemData
ÀÀ3 A
>
ÀÀA B
(
ÀÀB C
)
ÀÀC D
;
ÀÀD E
}
ÃÃ 
if
ÕÕ 
(
ÕÕ 
this
ÕÕ 
.
ÕÕ  
reservedItemCounts
ÕÕ +
==
ÕÕ, .
null
ÕÕ/ 3
)
ÕÕ3 4
{
ŒŒ 
this
œœ 
.
œœ  
reservedItemCounts
œœ +
=
œœ, -
new
œœ. 1

Dictionary
œœ2 <
<
œœ< =
string
œœ= C
,
œœC D
int
œœE H
>
œœH I
(
œœI J
)
œœJ K
;
œœK L
}
–– 
RebuildLookup
”” 
(
”” 
)
”” 
;
””  
}
‘‘ 
}
’’ 	
public
◊◊ 
override
◊◊ 
string
◊◊ 
GetInspectString
◊◊ /
(
◊◊/ 0
)
◊◊0 1
{
ÿÿ 	
StringBuilder
ŸŸ 
sb
ŸŸ 
=
ŸŸ 
new
ŸŸ "
StringBuilder
ŸŸ# 0
(
ŸŸ0 1
)
ŸŸ1 2
;
ŸŸ2 3
string
⁄⁄ 
baseStr
⁄⁄ 
=
⁄⁄ 
base
⁄⁄ !
.
⁄⁄! "
GetInspectString
⁄⁄" 2
(
⁄⁄2 3
)
⁄⁄3 4
;
⁄⁄4 5
if
€€ 
(
€€ 
!
€€ 
string
€€ 
.
€€ 
IsNullOrEmpty
€€ %
(
€€% &
baseStr
€€& -
)
€€- .
)
€€. /
{
‹‹ 
sb
›› 
.
›› 

AppendLine
›› 
(
›› 
baseStr
›› %
)
››% &
;
››& '
}
ﬁﬁ 
sb
ﬂﬂ 
.
ﬂﬂ 

AppendLine
ﬂﬂ 
(
ﬂﬂ 
$str
ﬂﬂ  
+
ﬂﬂ! "
this
ﬂﬂ# '
.
ﬂﬂ' (
NetworkName
ﬂﬂ( 3
)
ﬂﬂ3 4
;
ﬂﬂ4 5
sb
‡‡ 
.
‡‡ 

AppendLine
‡‡ 
(
‡‡ 
string
‡‡  
.
‡‡  !
Format
‡‡! '
(
‡‡' (
$str
‡‡( 7
,
‡‡7 8
this
‡‡9 =
.
‡‡= >
GetUsedCapacity
‡‡> M
(
‡‡M N
)
‡‡N O
,
‡‡O P
this
‡‡Q U
.
‡‡U V
GetCapacity
‡‡V a
(
‡‡a b
)
‡‡b c
)
‡‡c d
)
‡‡d e
;
‡‡e f
sb
·· 
.
·· 

AppendLine
·· 
(
·· 
string
··  
.
··  !
Format
··! '
(
··' (
$str
··( 2
,
··2 3
this
··4 8
.
··8 9
diskCabinets
··9 E
.
··E F
Count
··F K
)
··K L
)
··L M
;
··M N
if
‚‚ 
(
‚‚ 
!
‚‚ 
this
‚‚ 
.
‚‚ 
Powered
‚‚ 
)
‚‚ 
{
„„ 
sb
‰‰ 
.
‰‰ 

AppendLine
‰‰ 
(
‰‰ 
$str
‰‰ #
)
‰‰# $
;
‰‰$ %
}
ÂÂ 
return
ÊÊ 
sb
ÊÊ 
.
ÊÊ 
ToString
ÊÊ 
(
ÊÊ 
)
ÊÊ  
.
ÊÊ  !
TrimEnd
ÊÊ! (
(
ÊÊ( )
)
ÊÊ) *
;
ÊÊ* +
}
ÁÁ 	
public
ÏÏ 
int
ÏÏ 
GetCapacity
ÏÏ 
(
ÏÏ 
)
ÏÏ  
{
ÌÌ 	
return
ÓÓ 
BaseCapacity
ÓÓ 
+
ÓÓ  !
this
ÓÓ" &
.
ÓÓ& '
GetDiskCapacity
ÓÓ' 6
(
ÓÓ6 7
)
ÓÓ7 8
;
ÓÓ8 9
}
ÔÔ 	
public
ÙÙ 
int
ÙÙ 
GetUsedCapacity
ÙÙ "
(
ÙÙ" #
)
ÙÙ# $
{
ıı 	
return
˜˜ 
this
˜˜ 
.
˜˜ 
virtualStorage
˜˜ &
.
˜˜& '
Count
˜˜' ,
;
˜˜, -
}
¯¯ 	
public
˙˙ 
int
˙˙ 
GetDiskCapacity
˙˙ "
(
˙˙" #
)
˙˙# $
{
˚˚ 	
int
¸¸ 
total
¸¸ 
=
¸¸ 
$num
¸¸ 
;
¸¸ 
foreach
˝˝ 
(
˝˝ "
Building_DiskCabinet
˝˝ )
cabinet
˝˝* 1
in
˝˝2 4
this
˝˝5 9
.
˝˝9 :
diskCabinets
˝˝: F
)
˝˝F G
{
˛˛ 
if
ˇˇ 
(
ˇˇ 
cabinet
ˇˇ 
!=
ˇˇ 
null
ˇˇ #
&&
ˇˇ$ &
cabinet
ˇˇ' .
.
ˇˇ. /
Spawned
ˇˇ/ 6
)
ˇˇ6 7
{
ÄÄ 
total
ÅÅ 
+=
ÅÅ 
cabinet
ÅÅ $
.
ÅÅ$ %!
GetProvidedCapacity
ÅÅ% 8
(
ÅÅ8 9
)
ÅÅ9 :
;
ÅÅ: ;
}
ÇÇ 
}
ÉÉ 
return
ÑÑ 
total
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
public
ãã 
new
ãã 
bool
ãã 
Accepts
ãã 
(
ãã  
Thing
ãã  %
t
ãã& '
)
ãã' (
{
åå 	
if
éé 
(
éé 
!
éé 
base
éé 
.
éé 
Accepts
éé 
(
éé 
t
éé 
)
éé  
)
éé  !
{
èè 
return
êê 
false
êê 
;
êê 
}
ëë 
if
îî 
(
îî 
!
îî 
this
îî 
.
îî 
Powered
îî 
)
îî 
{
ïï 
return
ññ 
false
ññ 
;
ññ 
}
óó 
bool
öö 
canMerge
öö 
=
öö 
false
öö !
;
öö! "
foreach
õõ 
(
õõ 
StoredItemData
õõ #
existing
õõ$ ,
in
õõ- /
this
õõ0 4
.
õõ4 5
virtualStorage
õõ5 C
)
õõC D
{
úú 
if
ùù 
(
ùù 
existing
ùù 
.
ùù 
Matches
ùù $
(
ùù$ %
t
ùù% &
.
ùù& '
def
ùù' *
,
ùù* +
t
ùù, -
.
ùù- .
Stuff
ùù. 3
)
ùù3 4
&&
ùù5 7
existing
ûû 
.
ûû 
quality
ûû $
==
ûû% '
(
ûû( )
t
ûû) *
.
ûû* +

TryGetComp
ûû+ 5
<
ûû5 6
CompQuality
ûû6 A
>
ûûA B
(
ûûB C
)
ûûC D
?
ûûD E
.
ûûE F
Quality
ûûF M
??
ûûN P
QualityCategory
ûûQ `
.
ûû` a
Normal
ûûa g
)
ûûg h
)
ûûh i
{
üü 
canMerge
°° 
=
°° 
true
°° #
;
°°# $
break
¢¢ 
;
¢¢ 
}
££ 
}
§§ 
if
ßß 
(
ßß 
canMerge
ßß 
)
ßß 
{
®® 
return
©© 
true
©© 
;
©© 
}
™™ 
else
´´ 
{
¨¨ 
return
ÆÆ 
this
ÆÆ 
.
ÆÆ 
GetUsedCapacity
ÆÆ +
(
ÆÆ+ ,
)
ÆÆ, -
<
ÆÆ. /
this
ÆÆ0 4
.
ÆÆ4 5
GetCapacity
ÆÆ5 @
(
ÆÆ@ A
)
ÆÆA B
;
ÆÆB C
}
ØØ 
}
∞∞ 	
public
≤≤ 
bool
≤≤ 
CanReceiveThing
≤≤ #
(
≤≤# $
Thing
≤≤$ )
item
≤≤* .
)
≤≤. /
{
≥≥ 	
return
¥¥ 
this
¥¥ 
.
¥¥ 
Accepts
¥¥ 
(
¥¥  
item
¥¥  $
)
¥¥$ %
;
¥¥% &
}
µµ 	
public
∑∑ 
void
∑∑ !
RegisterDiskCabinet
∑∑ '
(
∑∑' ("
Building_DiskCabinet
∑∑( <
cabinet
∑∑= D
)
∑∑D E
{
∏∏ 	
if
ππ 
(
ππ 
cabinet
ππ 
!=
ππ 
null
ππ 
&&
ππ  "
!
ππ# $
this
ππ$ (
.
ππ( )
diskCabinets
ππ) 5
.
ππ5 6
Contains
ππ6 >
(
ππ> ?
cabinet
ππ? F
)
ππF G
)
ππG H
{
∫∫ 
this
ªª 
.
ªª 
diskCabinets
ªª !
.
ªª! "
Add
ªª" %
(
ªª% &
cabinet
ªª& -
)
ªª- .
;
ªª. /
}
ºº 
}
ΩΩ 	
public
øø 
void
øø #
DeregisterDiskCabinet
øø )
(
øø) *"
Building_DiskCabinet
øø* >
cabinet
øø? F
)
øøF G
{
¿¿ 	
this
¡¡ 
.
¡¡ 
diskCabinets
¡¡ 
.
¡¡ 
Remove
¡¡ $
(
¡¡$ %
cabinet
¡¡% ,
)
¡¡, -
;
¡¡- .
}
¬¬ 	
private
≈≈ 
int
≈≈ #
lastPhysicalItemCount
≈≈ )
=
≈≈* +
$num
≈≈, -
;
≈≈- .
private
»» 

Dictionary
»» 
<
»» 
string
»» !
,
»»! "
int
»»# &
>
»»& '
_cachedItemCounts
»»( 9
=
»»: ;
new
»»< ?

Dictionary
»»@ J
<
»»J K
string
»»K Q
,
»»Q R
int
»»S V
>
»»V W
(
»»W X
)
»»X Y
;
»»Y Z
private
…… 

Dictionary
…… 
<
…… 
string
…… !
,
……! "
int
……# &
>
……& '#
_cachedPhysicalCounts
……( =
=
……> ?
new
……@ C

Dictionary
……D N
<
……N O
string
……O U
,
……U V
int
……W Z
>
……Z [
(
……[ \
)
……\ ]
;
……] ^
	protected
ÀÀ 
override
ÀÀ 
void
ÀÀ 
Tick
ÀÀ  $
(
ÀÀ$ %
)
ÀÀ% &
{
ÃÃ 	
base
ÕÕ 
.
ÕÕ 
Tick
ÕÕ 
(
ÕÕ 
)
ÕÕ 
;
ÕÕ 
if
œœ 
(
œœ 
!
œœ 
this
œœ 
.
œœ 
Powered
œœ 
)
œœ 
{
–– 
return
—— 
;
—— 
}
““ 
if
’’ 
(
’’ 
Find
’’ 
.
’’ 
TickManager
’’  
.
’’  !
	TicksGame
’’! *
%
’’+ ,
$num
’’- /
==
’’0 2
$num
’’3 4
)
’’4 5
{
÷÷ #
MaintainReservedItems
◊◊ %
(
◊◊% &
)
◊◊& '
;
◊◊' (
}
ÿÿ 
if
‹‹ 
(
‹‹ 
Find
‹‹ 
.
‹‹ 
TickManager
‹‹  
.
‹‹  !
	TicksGame
‹‹! *
%
‹‹+ ,
$num
‹‹- 0
==
‹‹1 3
$num
‹‹4 5
)
‹‹5 6
{
›› 
if
ﬁﬁ 
(
ﬁﬁ $
DigitalStorageSettings
ﬁﬁ *
.
ﬁﬁ* +!
enableConversionLog
ﬁﬁ+ >
)
ﬁﬁ> ?
{
ﬂﬂ 
Log
‡‡ 
.
‡‡ 
Message
‡‡ 
(
‡‡  
$"
‡‡  "
$str
‡‡" ;
{
‡‡; <
Find
‡‡< @
.
‡‡@ A
TickManager
‡‡A L
.
‡‡L M
	TicksGame
‡‡M V
}
‡‡V W
$str
‡‡W a
{
‡‡a b
this
‡‡b f
.
‡‡f g
Powered
‡‡g n
}
‡‡n o
"
‡‡o p
)
‡‡p q
;
‡‡q r
}
·· 
	SlotGroup
„„ 
	slotGroup
„„ #
=
„„$ %
base
„„& *
.
„„* +
GetSlotGroup
„„+ 7
(
„„7 8
)
„„8 9
;
„„9 :
if
‰‰ 
(
‰‰ 
	slotGroup
‰‰ 
!=
‰‰  
null
‰‰! %
)
‰‰% &
{
ÂÂ 
int
ÊÊ 
reservedCount
ÊÊ %
=
ÊÊ& '$
DigitalStorageSettings
ÊÊ( >
.
ÊÊ> ?"
reservedCountPerItem
ÊÊ? S
;
ÊÊS T
int
ÁÁ 

totalItems
ÁÁ "
=
ÁÁ# $
	slotGroup
ÁÁ% .
.
ÁÁ. /

HeldThings
ÁÁ/ 9
.
ÁÁ9 :
Count
ÁÁ: ?
(
ÁÁ? @
)
ÁÁ@ A
;
ÁÁA B
if
ÈÈ 
(
ÈÈ $
DigitalStorageSettings
ÈÈ .
.
ÈÈ. /!
enableConversionLog
ÈÈ/ B
)
ÈÈB C
{
ÍÍ 
Log
ÎÎ 
.
ÎÎ 
Message
ÎÎ #
(
ÎÎ# $
$"
ÎÎ$ &
$str
ÎÎ& G
{
ÎÎG H
reservedCount
ÎÎH U
}
ÎÎU V
$str
ÎÎV ^
{
ÎÎ^ _

totalItems
ÎÎ_ i
}
ÎÎi j
"
ÎÎj k
)
ÎÎk l
;
ÎÎl m
}
ÏÏ 
bool
ÔÔ 
needsConversion
ÔÔ (
=
ÔÔ) *
false
ÔÔ+ 0
;
ÔÔ0 1
_cachedItemCounts
 %
.
% &
Clear
& +
(
+ ,
)
, -
;
- .
List
ÛÛ 
<
ÛÛ 
Thing
ÛÛ 
>
ÛÛ 

heldThings
ÛÛ  *
=
ÛÛ+ ,
	slotGroup
ÛÛ- 6
.
ÛÛ6 7

HeldThings
ÛÛ7 A
.
ÛÛA B
ToList
ÛÛB H
(
ÛÛH I
)
ÛÛI J
;
ÛÛJ K
for
ÙÙ 
(
ÙÙ 
int
ÙÙ 
i
ÙÙ 
=
ÙÙ  
$num
ÙÙ! "
;
ÙÙ" #
i
ÙÙ$ %
<
ÙÙ& '

heldThings
ÙÙ( 2
.
ÙÙ2 3
Count
ÙÙ3 8
;
ÙÙ8 9
i
ÙÙ: ;
++
ÙÙ; =
)
ÙÙ= >
{
ıı 
Thing
ˆˆ 
thing
ˆˆ #
=
ˆˆ$ %

heldThings
ˆˆ& 0
[
ˆˆ0 1
i
ˆˆ1 2
]
ˆˆ2 3
;
ˆˆ3 4
if
˜˜ 
(
˜˜ 
thing
˜˜ !
==
˜˜" $
null
˜˜% )
||
˜˜* ,
!
˜˜- .
thing
˜˜. 3
.
˜˜3 4
Spawned
˜˜4 ;
)
˜˜; <
{
¯¯ 
continue
˘˘ $
;
˘˘$ %
}
˙˙ 
if
˛˛ 
(
˛˛ 
this
˛˛  
.
˛˛  !
Map
˛˛! $
!=
˛˛% '
null
˛˛( ,
)
˛˛, -
{
ˇˇ 
if
ÄÄ 
(
ÄÄ  
this
ÄÄ  $
.
ÄÄ$ %
Map
ÄÄ% (
.
ÄÄ( ) 
reservationManager
ÄÄ) ;
.
ÄÄ; <"
IsReservedByAnyoneOf
ÄÄ< P
(
ÄÄP Q
new
ÄÄQ T
LocalTargetInfo
ÄÄU d
(
ÄÄd e
thing
ÄÄe j
)
ÄÄj k
,
ÄÄk l
Faction
ÄÄm t
.
ÄÄt u
OfPlayer
ÄÄu }
)
ÄÄ} ~
)
ÄÄ~ 
{
ÅÅ 
if
ÑÑ  "
(
ÑÑ# $ 
IsValidReservation
ÑÑ$ 6
(
ÑÑ6 7
thing
ÑÑ7 <
,
ÑÑ< =
this
ÑÑ> B
.
ÑÑB C
Map
ÑÑC F
)
ÑÑF G
)
ÑÑG H
{
ÖÖ  !
if
ÜÜ$ &
(
ÜÜ' ($
DigitalStorageSettings
ÜÜ( >
.
ÜÜ> ?!
enableConversionLog
ÜÜ? R
)
ÜÜR S
{
áá$ %
Log
àà( +
.
àà+ ,
Message
àà, 3
(
àà3 4
$"
àà4 6
$str
àà6 Q
{
ààQ R
thing
ààR W
.
ààW X
Label
ààX ]
}
àà] ^
"
àà^ _
)
àà_ `
;
àà` a
}
ââ$ %
continue
ää$ ,
;
ää, -
}
ãã  !
if
çç  "
(
çç# $$
DigitalStorageSettings
çç$ :
.
çç: ;!
enableConversionLog
çç; N
)
ççN O
{
éé  !
Log
èè$ '
.
èè' (
Message
èè( /
(
èè/ 0
$"
èè0 2
$str
èè2 L
{
èèL M
thing
èèM R
.
èèR S
Label
èèS X
}
èèX Y
"
èèY Z
)
èèZ [
;
èè[ \
}
êê  !
}
ëë 
}
íí 
string
îî 
key
îî "
=
îî# $

GetItemKey
îî% /
(
îî/ 0
thing
îî0 5
)
îî5 6
;
îî6 7
if
ïï 
(
ïï 
!
ïï 
_cachedItemCounts
ïï .
.
ïï. /
ContainsKey
ïï/ :
(
ïï: ;
key
ïï; >
)
ïï> ?
)
ïï? @
{
ññ 
_cachedItemCounts
óó -
[
óó- .
key
óó. 1
]
óó1 2
=
óó3 4
$num
óó5 6
;
óó6 7
}
òò 
_cachedItemCounts
ôô )
[
ôô) *
key
ôô* -
]
ôô- .
+=
ôô/ 1
thing
ôô2 7
.
ôô7 8

stackCount
ôô8 B
;
ôôB C
if
úú 
(
úú 
_cachedItemCounts
úú -
[
úú- .
key
úú. 1
]
úú1 2
>
úú3 4
reservedCount
úú5 B
)
úúB C
{
ùù 
needsConversion
ûû +
=
ûû, -
true
ûû. 2
;
ûû2 3
if
üü 
(
üü  $
DigitalStorageSettings
üü  6
.
üü6 7!
enableConversionLog
üü7 J
)
üüJ K
{
†† 
Log
°°  #
.
°°# $
Message
°°$ +
(
°°+ ,
$"
°°, .
$str
°°. L
{
°°L M
key
°°M P
}
°°P Q
$str
°°Q V
{
°°V W
_cachedItemCounts
°°W h
[
°°h i
key
°°i l
]
°°l m
}
°°m n
$str
°°n s
{
°°s t
reservedCount°°t Å
}°°Å Ç
"°°Ç É
)°°É Ñ
;°°Ñ Ö
}
¢¢ 
break
££ !
;
££! "
}
§§ 
}
•• 
if
ßß 
(
ßß 
needsConversion
ßß '
)
ßß' (
{
®® 
if
©© 
(
©© $
DigitalStorageSettings
©© 2
.
©©2 3!
enableConversionLog
©©3 F
)
©©F G
{
™™ 
Log
´´ 
.
´´  
Message
´´  '
(
´´' (
$"
´´( *
$str
´´* b
"
´´b c
)
´´c d
;
´´d e
}
¨¨ 
Services
ØØ  
.
ØØ  ! 
AsyncItemConverter
ØØ! 3
.
ØØ3 4"
StartAsyncConversion
ØØ4 H
(
ØØH I
this
ØØI M
)
ØØM N
;
ØØN O
}
∞∞ 
else
±± 
{
≤≤ 
if
≥≥ 
(
≥≥ $
DigitalStorageSettings
≥≥ 2
.
≥≥2 3!
enableConversionLog
≥≥3 F
)
≥≥F G
{
¥¥ 
Log
µµ 
.
µµ  
Message
µµ  '
(
µµ' (
$"
µµ( *
$str
µµ* =
"
µµ= >
)
µµ> ?
;
µµ? @
}
∂∂ 
}
∑∑ #
lastPhysicalItemCount
∫∫ )
=
∫∫* +

heldThings
∫∫, 6
.
∫∫6 7
Count
∫∫7 <
;
∫∫< =
}
ªª 
else
ºº 
{
ΩΩ 
if
ææ 
(
ææ $
DigitalStorageSettings
ææ .
.
ææ. /!
enableConversionLog
ææ/ B
)
ææB C
{
øø 
Log
¿¿ 
.
¿¿ 
Message
¿¿ #
(
¿¿# $
$"
¿¿$ &
$str
¿¿& C
"
¿¿C D
)
¿¿D E
;
¿¿E F
}
¡¡ 
}
¬¬ 
}
√√ 
}
ƒƒ 	
private
…… 
void
…… #
MaintainReservedItems
…… *
(
……* +
)
……+ ,
{
   	
int
ÀÀ 
reservedCount
ÀÀ 
=
ÀÀ $
DigitalStorageSettings
ÀÀ  6
.
ÀÀ6 7"
reservedCountPerItem
ÀÀ7 K
;
ÀÀK L
	SlotGroup
ÃÃ 
	slotGroup
ÃÃ 
=
ÃÃ  !
base
ÃÃ" &
.
ÃÃ& '
GetSlotGroup
ÃÃ' 3
(
ÃÃ3 4
)
ÃÃ4 5
;
ÃÃ5 6
if
ÕÕ 
(
ÕÕ 
	slotGroup
ÕÕ 
==
ÕÕ 
null
ÕÕ !
)
ÕÕ! "
{
ŒŒ 
return
œœ 
;
œœ 
}
–– #
_cachedPhysicalCounts
”” !
.
””! "
Clear
””" '
(
””' (
)
””( )
;
””) *
List
÷÷ 
<
÷÷ 
Thing
÷÷ 
>
÷÷ 

heldThings
÷÷ "
=
÷÷# $
	slotGroup
÷÷% .
.
÷÷. /

HeldThings
÷÷/ 9
.
÷÷9 :
ToList
÷÷: @
(
÷÷@ A
)
÷÷A B
;
÷÷B C
for
◊◊ 
(
◊◊ 
int
◊◊ 
i
◊◊ 
=
◊◊ 
$num
◊◊ 
;
◊◊ 
i
◊◊ 
<
◊◊ 

heldThings
◊◊  *
.
◊◊* +
Count
◊◊+ 0
;
◊◊0 1
i
◊◊2 3
++
◊◊3 5
)
◊◊5 6
{
ÿÿ 
Thing
ŸŸ 
thing
ŸŸ 
=
ŸŸ 

heldThings
ŸŸ (
[
ŸŸ( )
i
ŸŸ) *
]
ŸŸ* +
;
ŸŸ+ ,
if
⁄⁄ 
(
⁄⁄ 
thing
⁄⁄ 
==
⁄⁄ 
null
⁄⁄ !
||
⁄⁄" $
!
⁄⁄% &
thing
⁄⁄& +
.
⁄⁄+ ,
Spawned
⁄⁄, 3
)
⁄⁄3 4
{
€€ 
continue
‹‹ 
;
‹‹ 
}
›› 
string
ﬂﬂ 
key
ﬂﬂ 
=
ﬂﬂ 

GetItemKey
ﬂﬂ '
(
ﬂﬂ' (
thing
ﬂﬂ( -
)
ﬂﬂ- .
;
ﬂﬂ. /
if
‡‡ 
(
‡‡ 
!
‡‡ #
_cachedPhysicalCounts
‡‡ *
.
‡‡* +
ContainsKey
‡‡+ 6
(
‡‡6 7
key
‡‡7 :
)
‡‡: ;
)
‡‡; <
{
·· #
_cachedPhysicalCounts
‚‚ )
[
‚‚) *
key
‚‚* -
]
‚‚- .
=
‚‚/ 0
$num
‚‚1 2
;
‚‚2 3
}
„„ #
_cachedPhysicalCounts
‰‰ %
[
‰‰% &
key
‰‰& )
]
‰‰) *
+=
‰‰+ -
thing
‰‰. 3
.
‰‰3 4

stackCount
‰‰4 >
;
‰‰> ?
}
ÂÂ 
foreach
ÍÍ 
(
ÍÍ 
StoredItemData
ÍÍ #
itemData
ÍÍ$ ,
in
ÍÍ- /
this
ÍÍ0 4
.
ÍÍ4 5
virtualStorage
ÍÍ5 C
.
ÍÍC D
ToList
ÍÍD J
(
ÍÍJ K
)
ÍÍK L
)
ÍÍL M
{
ÎÎ 
if
ÏÏ 
(
ÏÏ 
itemData
ÏÏ 
==
ÏÏ 
null
ÏÏ  $
||
ÏÏ% '
itemData
ÏÏ( 0
.
ÏÏ0 1
def
ÏÏ1 4
==
ÏÏ5 7
null
ÏÏ8 <
||
ÏÏ= ?
itemData
ÏÏ@ H
.
ÏÏH I

stackCount
ÏÏI S
<=
ÏÏT V
$num
ÏÏW X
)
ÏÏX Y
{
ÌÌ 
continue
ÓÓ 
;
ÓÓ 
}
ÔÔ 
string
ÒÒ 
key
ÒÒ 
=
ÒÒ 

GetItemKey
ÒÒ '
(
ÒÒ' (
itemData
ÒÒ( 0
.
ÒÒ0 1
def
ÒÒ1 4
,
ÒÒ4 5
itemData
ÒÒ6 >
.
ÒÒ> ?
stuffDef
ÒÒ? G
,
ÒÒG H
itemData
ÒÒI Q
.
ÒÒQ R
quality
ÒÒR Y
)
ÒÒY Z
;
ÒÒZ [
int
ÙÙ 
currentCount
ÙÙ  
=
ÙÙ! "#
_cachedPhysicalCounts
ÙÙ# 8
.
ÙÙ8 9
ContainsKey
ÙÙ9 D
(
ÙÙD E
key
ÙÙE H
)
ÙÙH I
?
ÙÙJ K#
_cachedPhysicalCounts
ÙÙL a
[
ÙÙa b
key
ÙÙb e
]
ÙÙe f
:
ÙÙg h
$num
ÙÙi j
;
ÙÙj k
if
¯¯ 
(
¯¯ 
currentCount
¯¯  
<
¯¯! "
reservedCount
¯¯# 0
)
¯¯0 1
{
˘˘ 
int
˙˙ 
needed
˙˙ 
=
˙˙  
reservedCount
˙˙! .
-
˙˙/ 0
currentCount
˙˙1 =
;
˙˙= >
ThingDef
˚˚ 
def
˚˚  
=
˚˚! "
itemData
˚˚# +
.
˚˚+ ,
def
˚˚, /
;
˚˚/ 0
ThingDef
¸¸ 
stuff
¸¸ "
=
¸¸# $
itemData
¸¸% -
.
¸¸- .
stuffDef
¸¸. 6
;
¸¸6 7
QualityCategory
˝˝ #
quality
˝˝$ +
=
˝˝, -
itemData
˝˝. 6
.
˝˝6 7
quality
˝˝7 >
;
˝˝> ?
int
ÄÄ 

stackLimit
ÄÄ "
=
ÄÄ# $
def
ÄÄ% (
.
ÄÄ( )

stackLimit
ÄÄ) 3
;
ÄÄ3 4
int
ÅÅ 
actualNeeded
ÅÅ $
=
ÅÅ% &
Math
ÅÅ' +
.
ÅÅ+ ,
Min
ÅÅ, /
(
ÅÅ/ 0
needed
ÅÅ0 6
,
ÅÅ6 7

stackLimit
ÅÅ8 B
)
ÅÅB C
;
ÅÅC D
Thing
ÑÑ 
	extracted
ÑÑ #
=
ÑÑ$ %$
ExtractItemForReserved
ÑÑ& <
(
ÑÑ< =
def
ÑÑ= @
,
ÑÑ@ A
actualNeeded
ÑÑB N
,
ÑÑN O
stuff
ÑÑP U
,
ÑÑU V
quality
ÑÑW ^
)
ÑÑ^ _
;
ÑÑ_ `
if
ÖÖ 
(
ÖÖ 
	extracted
ÖÖ !
!=
ÖÖ" $
null
ÖÖ% )
)
ÖÖ) *
{
ÜÜ 
GenSpawn
àà  
.
àà  !
Spawn
àà! &
(
àà& '
	extracted
àà' 0
,
àà0 1
this
àà2 6
.
àà6 7
Position
àà7 ?
,
àà? @
this
ààA E
.
ààE F
Map
ààF I
)
ààI J
;
ààJ K
if
ââ 
(
ââ $
DigitalStorageSettings
ââ 2
.
ââ2 3
enableDebugLog
ââ3 A
)
ââA B
{
ää 
Log
ãã 
.
ãã  
Message
ãã  '
(
ãã' (
$"
ãã( *
$str
ãã* 9
{
ãã9 :
	extracted
ãã: C
.
ããC D
Label
ããD I
}
ããI J
$str
ããJ L
{
ããL M
	extracted
ããM V
.
ããV W

stackCount
ããW a
}
ããa b
$str
ããb g
{
ããg h
currentCount
ããh t
}
ããt u
$str
ããu z
{
ããz {
actualNeededãã{ á
}ããá à
$strããà â
{ããâ ä
neededããä ê
}ããê ë
"ããë í
)ããí ì
;ããì î
}
åå 
}
çç 
}
éé 
}
èè 
foreach
íí 
(
íí 
var
íí 
kvp
íí 
in
íí #
_cachedPhysicalCounts
íí  5
)
íí5 6
{
ìì 
this
îî 
.
îî  
reservedItemCounts
îî '
[
îî' (
kvp
îî( +
.
îî+ ,
Key
îî, /
]
îî/ 0
=
îî1 2
kvp
îî3 6
.
îî6 7
Value
îî7 <
;
îî< =
}
ïï 
}
ññ 	
public
°° 
Thing
°° 
TryReplenishItem
°° %
(
°°% &
ThingDef
°°& .
def
°°/ 2
,
°°2 3
ThingDef
°°4 <
stuff
°°= B
,
°°B C
int
°°D G
needed
°°H N
,
°°N O
QualityCategory
°°P _
quality
°°` g
)
°°g h
{
¢¢ 	
if
££ 
(
££ 
def
££ 
==
££ 
null
££ 
||
££ 
needed
££ %
<=
££& (
$num
££) *
||
££+ -
!
££. /
this
££/ 3
.
££3 4
Powered
££4 ;
)
££; <
{
§§ 
return
•• 
null
•• 
;
•• 
}
¶¶ 
int
©© 

stackLimit
©© 
=
©© 
def
©©  
.
©©  !

stackLimit
©©! +
;
©©+ ,
int
™™ 
actualNeeded
™™ 
=
™™ 
Math
™™ #
.
™™# $
Min
™™$ '
(
™™' (
needed
™™( .
,
™™. /

stackLimit
™™0 :
)
™™: ;
;
™™; <
Thing
≠≠ 
	extracted
≠≠ 
=
≠≠ $
ExtractItemForReserved
≠≠ 4
(
≠≠4 5
def
≠≠5 8
,
≠≠8 9
actualNeeded
≠≠: F
,
≠≠F G
stuff
≠≠H M
,
≠≠M N
quality
≠≠O V
)
≠≠V W
;
≠≠W X
if
ÆÆ 
(
ÆÆ 
	extracted
ÆÆ 
!=
ÆÆ 
null
ÆÆ !
)
ÆÆ! "
{
ØØ 
GenSpawn
±± 
.
±± 
Spawn
±± 
(
±± 
	extracted
±± (
,
±±( )
this
±±* .
.
±±. /
Position
±±/ 7
,
±±7 8
this
±±9 =
.
±±= >
Map
±±> A
)
±±A B
;
±±B C
if
≤≤ 
(
≤≤ $
DigitalStorageSettings
≤≤ *
.
≤≤* +
enableDebugLog
≤≤+ 9
)
≤≤9 :
{
≥≥ 
Log
¥¥ 
.
¥¥ 
Message
¥¥ 
(
¥¥  
$"
¥¥  "
$str
¥¥" C
{
¥¥C D
	extracted
¥¥D M
.
¥¥M N
Label
¥¥N S
}
¥¥S T
$str
¥¥T V
{
¥¥V W
	extracted
¥¥W `
.
¥¥` a

stackCount
¥¥a k
}
¥¥k l
"
¥¥l m
)
¥¥m n
;
¥¥n o
}
µµ 
return
∏∏ 
	extracted
∏∏  
;
∏∏  !
}
ππ 
else
∫∫ 
{
ªª 
if
ºº 
(
ºº $
DigitalStorageSettings
ºº *
.
ºº* +
enableDebugLog
ºº+ 9
)
ºº9 :
{
ΩΩ 
Log
ææ 
.
ææ 
Message
ææ 
(
ææ  
$"
ææ  "
$str
ææ" K
{
ææK L
def
ææL O
.
ææO P
label
ææP U
}
ææU V
$str
ææV X
{
ææX Y
actualNeeded
ææY e
}
ææe f
"
ææf g
)
ææg h
;
ææh i
}
øø 
return
¿¿ 
null
¿¿ 
;
¿¿ 
}
¡¡ 
}
¬¬ 	
private
«« 
string
«« 

GetItemKey
«« !
(
««! "
Thing
««" '
thing
««( -
)
««- .
{
»» 	
QualityCategory
…… 
quality
…… #
=
……$ %
thing
……& +
.
……+ ,

TryGetComp
……, 6
<
……6 7
CompQuality
……7 B
>
……B C
(
……C D
)
……D E
?
……E F
.
……F G
Quality
……G N
??
……O Q
QualityCategory
……R a
.
……a b
Normal
……b h
;
……h i
string
   
	stuffName
   
=
   
thing
   $
.
  $ %
Stuff
  % *
?
  * +
.
  + ,
defName
  , 3
??
  4 6
$str
  7 =
;
  = >
return
ÀÀ 
$"
ÀÀ 
{
ÀÀ 
thing
ÀÀ 
.
ÀÀ 
def
ÀÀ 
.
ÀÀ  
defName
ÀÀ  '
}
ÀÀ' (
$str
ÀÀ( )
{
ÀÀ) *
	stuffName
ÀÀ* 3
}
ÀÀ3 4
$str
ÀÀ4 5
{
ÀÀ5 6
quality
ÀÀ6 =
}
ÀÀ= >
"
ÀÀ> ?
;
ÀÀ? @
}
ÃÃ 	
private
ŒŒ 
string
ŒŒ 

GetItemKey
ŒŒ !
(
ŒŒ! "
ThingDef
ŒŒ" *
def
ŒŒ+ .
,
ŒŒ. /
ThingDef
ŒŒ0 8
stuff
ŒŒ9 >
,
ŒŒ> ?
QualityCategory
ŒŒ@ O
quality
ŒŒP W
)
ŒŒW X
{
œœ 	
string
–– 
	stuffName
–– 
=
–– 
stuff
–– $
?
––$ %
.
––% &
defName
––& -
??
––. 0
$str
––1 7
;
––7 8
return
—— 
$"
—— 
{
—— 
def
—— 
.
—— 
defName
—— !
}
——! "
$str
——" #
{
——# $
	stuffName
——$ -
}
——- .
$str
——. /
{
——/ 0
quality
——0 7
}
——7 8
"
——8 9
;
——9 :
}
““ 	
private
‘‘ 
ThingDef
‘‘ 
GetDefFromKey
‘‘ &
(
‘‘& '
string
‘‘' -
key
‘‘. 1
)
‘‘1 2
{
’’ 	
string
÷÷ 
[
÷÷ 
]
÷÷ 
parts
÷÷ 
=
÷÷ 
key
÷÷  
.
÷÷  !
Split
÷÷! &
(
÷÷& '
$char
÷÷' *
)
÷÷* +
;
÷÷+ ,
if
◊◊ 
(
◊◊ 
parts
◊◊ 
.
◊◊ 
Length
◊◊ 
>=
◊◊ 
$num
◊◊  !
)
◊◊! "
{
ÿÿ 
return
ŸŸ 
DefDatabase
ŸŸ "
<
ŸŸ" #
ThingDef
ŸŸ# +
>
ŸŸ+ ,
.
ŸŸ, - 
GetNamedSilentFail
ŸŸ- ?
(
ŸŸ? @
parts
ŸŸ@ E
[
ŸŸE F
$num
ŸŸF G
]
ŸŸG H
)
ŸŸH I
;
ŸŸI J
}
⁄⁄ 
return
€€ 
null
€€ 
;
€€ 
}
‹‹ 	
private
ﬁﬁ 
ThingDef
ﬁﬁ 
GetStuffFromKey
ﬁﬁ (
(
ﬁﬁ( )
string
ﬁﬁ) /
key
ﬁﬁ0 3
)
ﬁﬁ3 4
{
ﬂﬂ 	
string
‡‡ 
[
‡‡ 
]
‡‡ 
parts
‡‡ 
=
‡‡ 
key
‡‡  
.
‡‡  !
Split
‡‡! &
(
‡‡& '
$char
‡‡' *
)
‡‡* +
;
‡‡+ ,
if
·· 
(
·· 
parts
·· 
.
·· 
Length
·· 
>=
·· 
$num
··  !
&&
··" $
parts
··% *
[
··* +
$num
··+ ,
]
··, -
!=
··. 0
$str
··1 7
)
··7 8
{
‚‚ 
return
„„ 
DefDatabase
„„ "
<
„„" #
ThingDef
„„# +
>
„„+ ,
.
„„, - 
GetNamedSilentFail
„„- ?
(
„„? @
parts
„„@ E
[
„„E F
$num
„„F G
]
„„G H
)
„„H I
;
„„I J
}
‰‰ 
return
ÂÂ 
null
ÂÂ 
;
ÂÂ 
}
ÊÊ 	
private
ËË 
QualityCategory
ËË 
GetQualityFromKey
ËË  1
(
ËË1 2
string
ËË2 8
key
ËË9 <
)
ËË< =
{
ÈÈ 	
string
ÍÍ 
[
ÍÍ 
]
ÍÍ 
parts
ÍÍ 
=
ÍÍ 
key
ÍÍ  
.
ÍÍ  !
Split
ÍÍ! &
(
ÍÍ& '
$char
ÍÍ' *
)
ÍÍ* +
;
ÍÍ+ ,
if
ÎÎ 
(
ÎÎ 
parts
ÎÎ 
.
ÎÎ 
Length
ÎÎ 
>=
ÎÎ 
$num
ÎÎ  !
&&
ÎÎ" $
Enum
ÎÎ% )
.
ÎÎ) *
TryParse
ÎÎ* 2
<
ÎÎ2 3
QualityCategory
ÎÎ3 B
>
ÎÎB C
(
ÎÎC D
parts
ÎÎD I
[
ÎÎI J
$num
ÎÎJ K
]
ÎÎK L
,
ÎÎL M
out
ÎÎN Q
QualityCategory
ÎÎR a
quality
ÎÎb i
)
ÎÎi j
)
ÎÎj k
{
ÏÏ 
return
ÌÌ 
quality
ÌÌ 
;
ÌÌ 
}
ÓÓ 
return
ÔÔ 
QualityCategory
ÔÔ "
.
ÔÔ" #
Normal
ÔÔ# )
;
ÔÔ) *
}
 	
public
ıı 
void
ıı 7
)ConvertPhysicalItemsToVirtualWithReserved
ıı =
(
ıı= >
)
ıı> ?
{
ˆˆ 	
	SlotGroup
˜˜ 
	slotGroup
˜˜ 
=
˜˜  !
base
˜˜" &
.
˜˜& '
GetSlotGroup
˜˜' 3
(
˜˜3 4
)
˜˜4 5
;
˜˜5 6
if
¯¯ 
(
¯¯ 
	slotGroup
¯¯ 
==
¯¯ 
null
¯¯ !
)
¯¯! "
return
¯¯# )
;
¯¯) *
int
˙˙ 
reservedCount
˙˙ 
=
˙˙ $
DigitalStorageSettings
˙˙  6
.
˙˙6 7"
reservedCountPerItem
˙˙7 K
;
˙˙K L
if
¸¸ 
(
¸¸ $
DigitalStorageSettings
¸¸ &
.
¸¸& '!
enableConversionLog
¸¸' :
)
¸¸: ;
{
˝˝ 
Log
˛˛ 
.
˛˛ 
Message
˛˛ 
(
˛˛ 
$"
˛˛ 
$str
˛˛ 2
{
˛˛2 3
reservedCount
˛˛3 @
}
˛˛@ A
"
˛˛A B
)
˛˛B C
;
˛˛C D
}
ˇˇ 

Dictionary
ÇÇ 
<
ÇÇ 
string
ÇÇ 
,
ÇÇ 
int
ÇÇ "
>
ÇÇ" #
totalCountsByKey
ÇÇ$ 4
=
ÇÇ5 6
new
ÇÇ7 :

Dictionary
ÇÇ; E
<
ÇÇE F
string
ÇÇF L
,
ÇÇL M
int
ÇÇN Q
>
ÇÇQ R
(
ÇÇR S
)
ÇÇS T
;
ÇÇT U

Dictionary
ÉÉ 
<
ÉÉ 
string
ÉÉ 
,
ÉÉ 
List
ÉÉ #
<
ÉÉ# $
Thing
ÉÉ$ )
>
ÉÉ) *
>
ÉÉ* +
thingsByKey
ÉÉ, 7
=
ÉÉ8 9
new
ÉÉ: =

Dictionary
ÉÉ> H
<
ÉÉH I
string
ÉÉI O
,
ÉÉO P
List
ÉÉQ U
<
ÉÉU V
Thing
ÉÉV [
>
ÉÉ[ \
>
ÉÉ\ ]
(
ÉÉ] ^
)
ÉÉ^ _
;
ÉÉ_ `
if
ÖÖ 
(
ÖÖ $
DigitalStorageSettings
ÖÖ &
.
ÖÖ& '
enableDebugLog
ÖÖ' 5
)
ÖÖ5 6
{
ÜÜ 
Log
áá 
.
áá 
Message
áá 
(
áá 
$"
áá 
$str
áá A
"
ááA B
)
ááB C
;
ááC D
}
àà 
foreach
ää 
(
ää 
Thing
ää 
thing
ää  
in
ää! #
	slotGroup
ää$ -
.
ää- .

HeldThings
ää. 8
)
ää8 9
{
ãã 
if
åå 
(
åå 
thing
åå 
==
åå 
null
åå !
||
åå" $
!
åå% &
thing
åå& +
.
åå+ ,
Spawned
åå, 3
)
åå3 4
{
çç 
continue
éé 
;
éé 
}
èè 
string
ëë 
key
ëë 
=
ëë 

GetItemKey
ëë '
(
ëë' (
thing
ëë( -
)
ëë- .
;
ëë. /
if
íí 
(
íí 
!
íí 
totalCountsByKey
íí %
.
íí% &
ContainsKey
íí& 1
(
íí1 2
key
íí2 5
)
íí5 6
)
íí6 7
{
ìì 
totalCountsByKey
îî $
[
îî$ %
key
îî% (
]
îî( )
=
îî* +
$num
îî, -
;
îî- .
thingsByKey
ïï 
[
ïï  
key
ïï  #
]
ïï# $
=
ïï% &
new
ïï' *
List
ïï+ /
<
ïï/ 0
Thing
ïï0 5
>
ïï5 6
(
ïï6 7
)
ïï7 8
;
ïï8 9
}
ññ 
int
òò 

stackCount
òò 
=
òò  
thing
òò! &
.
òò& '

stackCount
òò' 1
;
òò1 2
totalCountsByKey
ôô  
[
ôô  !
key
ôô! $
]
ôô$ %
+=
ôô& (

stackCount
ôô) 3
;
ôô3 4
thingsByKey
öö 
[
öö 
key
öö 
]
öö  
.
öö  !
Add
öö! $
(
öö$ %
thing
öö% *
)
öö* +
;
öö+ ,
if
úú 
(
úú $
DigitalStorageSettings
úú *
.
úú* +
enableDebugLog
úú+ 9
)
úú9 :
{
ùù 
ThingDef
ûû 
def
ûû  
=
ûû! "
GetDefFromKey
ûû# 0
(
ûû0 1
key
ûû1 4
)
ûû4 5
;
ûû5 6
Log
üü 
.
üü 
Message
üü 
(
üü  
$"
üü  "
$str
üü" 6
{
üü6 7
thing
üü7 <
.
üü< =
Label
üü= B
}
üüB C
$str
üüC E
{
üüE F

stackCount
üüF P
}
üüP Q
$str
üüQ W
{
üüW X
thing
üüX ]
.
üü] ^
Position
üü^ f
}
üüf g
$str
üüg n
{
üün o
key
üüo r
}
üür s
$str
üüs 
{üü Ä 
totalCountsByKeyüüÄ ê
[üüê ë
keyüüë î
]üüî ï
}üüï ñ
$strüüñ £
{üü£ §
thingüü§ ©
.üü© ™
GetHashCodeüü™ µ
(üüµ ∂
)üü∂ ∑
}üü∑ ∏
"üü∏ π
)üüπ ∫
;üü∫ ª
}
†† 
}
°° 
if
££ 
(
££ $
DigitalStorageSettings
££ &
.
££& '
enableDebugLog
££' 5
)
££5 6
{
§§ 
Log
•• 
.
•• 
Message
•• 
(
•• 
$"
•• 
$str
•• A
"
••A B
)
••B C
;
••C D
}
¶¶ 
List
™™ 
<
™™ 
Thing
™™ 
>
™™ 
	toConvert
™™ !
=
™™" #
new
™™$ '
List
™™( ,
<
™™, -
Thing
™™- 2
>
™™2 3
(
™™3 4
)
™™4 5
;
™™5 6
if
¨¨ 
(
¨¨ $
DigitalStorageSettings
¨¨ &
.
¨¨& '
enableDebugLog
¨¨' 5
)
¨¨5 6
{
≠≠ 
Log
ÆÆ 
.
ÆÆ 
Message
ÆÆ 
(
ÆÆ 
$"
ÆÆ 
$str
ÆÆ A
"
ÆÆA B
)
ÆÆB C
;
ÆÆC D
}
ØØ 
foreach
±± 
(
±± 
var
±± 
kvp
±± 
in
±± 
totalCountsByKey
±±  0
)
±±0 1
{
≤≤ 
string
≥≥ 
key
≥≥ 
=
≥≥ 
kvp
≥≥  
.
≥≥  !
Key
≥≥! $
;
≥≥$ %
List
¥¥ 
<
¥¥ 
Thing
¥¥ 
>
¥¥ 
currentThings
¥¥ )
=
¥¥* +
thingsByKey
¥¥, 7
[
¥¥7 8
key
¥¥8 ;
]
¥¥; <
;
¥¥< =
int
µµ 
statStageTotal
µµ "
=
µµ# $
kvp
µµ% (
.
µµ( )
Value
µµ) .
;
µµ. /
int
∏∏ 

totalCount
∏∏ 
=
∏∏  
$num
∏∏! "
;
∏∏" #
if
ππ 
(
ππ $
DigitalStorageSettings
ππ *
.
ππ* +
enableDebugLog
ππ+ 9
)
ππ9 :
{
∫∫ 
Log
ªª 
.
ªª 
Message
ªª 
(
ªª  
$"
ªª  "
$str
ªª" ;
{
ªª; <
key
ªª< ?
}
ªª? @
$str
ªª@ J
{
ªªJ K
statStageTotal
ªªK Y
}
ªªY Z
$str
ªªZ a
{
ªªa b
currentThings
ªªb o
.
ªªo p
Count
ªªp u
}
ªªu v
"
ªªv w
)
ªªw x
;
ªªx y
}
ºº 
foreach
ææ 
(
ææ 
Thing
ææ 
thing
ææ $
in
ææ% '
currentThings
ææ( 5
)
ææ5 6
{
øø 
if
¿¿ 
(
¿¿ 
thing
¿¿ 
!=
¿¿  
null
¿¿! %
&&
¿¿& (
thing
¿¿) .
.
¿¿. /
Spawned
¿¿/ 6
)
¿¿6 7
{
¡¡ 
int
¬¬ 
currentStackCount
¬¬ -
=
¬¬. /
thing
¬¬0 5
.
¬¬5 6

stackCount
¬¬6 @
;
¬¬@ A

totalCount
√√ "
+=
√√# %
currentStackCount
√√& 7
;
√√7 8
if
ƒƒ 
(
ƒƒ $
DigitalStorageSettings
ƒƒ 2
.
ƒƒ2 3
enableDebugLog
ƒƒ3 A
)
ƒƒA B
{
≈≈ 
Log
∆∆ 
.
∆∆  
Message
∆∆  '
(
∆∆' (
$"
∆∆( *
$str
∆∆* @
{
∆∆@ A
thing
∆∆A F
.
∆∆F G
Label
∆∆G L
}
∆∆L M
$str
∆∆M O
{
∆∆O P
currentStackCount
∆∆P a
}
∆∆a b
$str
∆∆b h
{
∆∆h i
thing
∆∆i n
.
∆∆n o
Position
∆∆o w
}
∆∆w x
$str∆∆x Ö
{∆∆Ö Ü
thing∆∆Ü ã
.∆∆ã å
GetHashCode∆∆å ó
(∆∆ó ò
)∆∆ò ô
}∆∆ô ö
$str∆∆ö ¢
{∆∆¢ £

totalCount∆∆£ ≠
}∆∆≠ Æ
"∆∆Æ Ø
)∆∆Ø ∞
;∆∆∞ ±
}
«« 
}
»» 
else
…… 
{
   
if
ÀÀ 
(
ÀÀ $
DigitalStorageSettings
ÀÀ 2
.
ÀÀ2 3
enableDebugLog
ÀÀ3 A
)
ÀÀA B
{
ÃÃ 
Log
ÕÕ 
.
ÕÕ  
Message
ÕÕ  '
(
ÕÕ' (
$"
ÕÕ( *
$str
ÕÕ* K
{
ÕÕK L
(
ÕÕL M
thing
ÕÕM R
!=
ÕÕS U
null
ÕÕV Z
?
ÕÕ[ \
thing
ÕÕ] b
.
ÕÕb c
GetHashCode
ÕÕc n
(
ÕÕn o
)
ÕÕo p
.
ÕÕp q
ToString
ÕÕq y
(
ÕÕy z
)
ÕÕz {
:
ÕÕ| }
$strÕÕ~ Ñ
)ÕÕÑ Ö
}ÕÕÖ Ü
$strÕÕÜ ë
{ÕÕë í
(ÕÕí ì
thingÕÕì ò
!=ÕÕô õ
nullÕÕú †
?ÕÕ° ¢
thingÕÕ£ ®
.ÕÕ® ©
SpawnedÕÕ© ∞
.ÕÕ∞ ±
ToStringÕÕ± π
(ÕÕπ ∫
)ÕÕ∫ ª
:ÕÕº Ω
$strÕÕæ ƒ
)ÕÕƒ ≈
}ÕÕ≈ ∆
"ÕÕ∆ «
)ÕÕ« »
;ÕÕ» …
}
ŒŒ 
}
œœ 
}
–– 
if
““ 
(
““ $
DigitalStorageSettings
““ *
.
““* +!
enableConversionLog
““+ >
)
““> ?
{
”” 
Log
‘‘ 
.
‘‘ 
Message
‘‘ 
(
‘‘  
$"
‘‘  "
$str
‘‘" /
{
‘‘/ 0
def
‘‘0 3
?
‘‘3 4
.
‘‘4 5
label
‘‘5 :
??
‘‘; =
key
‘‘> A
}
‘‘A B
$str
‘‘B L
{
‘‘L M
statStageTotal
‘‘M [
}
‘‘[ \
$str
‘‘\ f
{
‘‘f g

totalCount
‘‘g q
}
‘‘q r
$str
‘‘r x
{
‘‘x y
reservedCount‘‘y Ü
}‘‘Ü á
$str‘‘á é
{‘‘é è
currentThings‘‘è ú
.‘‘ú ù
Count‘‘ù ¢
}‘‘¢ £
$str‘‘£ ©
{‘‘© ™

totalCount‘‘™ ¥
-‘‘µ ∂
statStageTotal‘‘∑ ≈
}‘‘≈ ∆
"‘‘∆ «
)‘‘« »
;‘‘» …
}
’’ 
if
◊◊ 
(
◊◊ $
DigitalStorageSettings
◊◊ *
.
◊◊* +
enableDebugLog
◊◊+ 9
)
◊◊9 :
{
ÿÿ 
Log
ŸŸ 
.
ŸŸ 
Message
ŸŸ 
(
ŸŸ  
$"
ŸŸ  "
$str
ŸŸ" 8
{
ŸŸ8 9
def
ŸŸ9 <
?
ŸŸ< =
.
ŸŸ= >
label
ŸŸ> C
??
ŸŸD F
key
ŸŸG J
}
ŸŸJ K
$str
ŸŸK U
{
ŸŸU V
statStageTotal
ŸŸV d
}
ŸŸd e
$str
ŸŸe o
{
ŸŸo p

totalCount
ŸŸp z
}
ŸŸz {
$strŸŸ{ Å
{ŸŸÅ Ç
reservedCountŸŸÇ è
}ŸŸè ê
$strŸŸê ó
{ŸŸó ò
currentThingsŸŸò •
.ŸŸ• ¶
CountŸŸ¶ ´
}ŸŸ´ ¨
$strŸŸ¨ ≤
{ŸŸ≤ ≥

totalCountŸŸ≥ Ω
-ŸŸæ ø
statStageTotalŸŸ¿ Œ
}ŸŸŒ œ
"ŸŸœ –
)ŸŸ– —
;ŸŸ— “
}
⁄⁄ 
if
€€ 
(
€€ 

totalCount
€€ 
>
€€  
reservedCount
€€! .
)
€€. /
{
‹‹ 
int
›› 
toConvertCount
›› &
=
››' (

totalCount
››) 3
-
››4 5
reservedCount
››6 C
;
››C D
int
ﬁﬁ 
	converted
ﬁﬁ !
=
ﬁﬁ" #
$num
ﬁﬁ$ %
;
ﬁﬁ% &
if
‡‡ 
(
‡‡ $
DigitalStorageSettings
‡‡ .
.
‡‡. /
enableDebugLog
‡‡/ =
)
‡‡= >
{
·· 
Log
‚‚ 
.
‚‚ 
Message
‚‚ #
(
‚‚# $
$"
‚‚$ &
$str
‚‚& =
{
‚‚= >
def
‚‚> A
?
‚‚A B
.
‚‚B C
label
‚‚C H
??
‚‚I K
key
‚‚L O
}
‚‚O P
$str
‚‚P V
{
‚‚V W

totalCount
‚‚W a
}
‚‚a b
$str
‚‚b h
{
‚‚h i
reservedCount
‚‚i v
}
‚‚v w
$str
‚‚w ~
{
‚‚~ 
toConvertCount‚‚ ç
}‚‚ç é
"‚‚é è
)‚‚è ê
;‚‚ê ë
}
„„ 
foreach
ÂÂ 
(
ÂÂ 
Thing
ÂÂ "
thing
ÂÂ# (
in
ÂÂ) +
currentThings
ÂÂ, 9
.
ÂÂ9 :
OrderBy
ÂÂ: A
(
ÂÂA B
t
ÂÂB C
=>
ÂÂD F
t
ÂÂG H
.
ÂÂH I

stackCount
ÂÂI S
)
ÂÂS T
)
ÂÂT U
{
ÊÊ 
if
ÁÁ 
(
ÁÁ 
	converted
ÁÁ %
>=
ÁÁ& (
toConvertCount
ÁÁ) 7
)
ÁÁ7 8
{
ËË 
if
ÈÈ 
(
ÈÈ  $
DigitalStorageSettings
ÈÈ  6
.
ÈÈ6 7
enableDebugLog
ÈÈ7 E
)
ÈÈE F
{
ÍÍ 
Log
ÎÎ  #
.
ÎÎ# $
Message
ÎÎ$ +
(
ÎÎ+ ,
$"
ÎÎ, .
$str
ÎÎ. N
{
ÎÎN O
	converted
ÎÎO X
}
ÎÎX Y
$str
ÎÎY `
{
ÎÎ` a
toConvertCount
ÎÎa o
}
ÎÎo p
"
ÎÎp q
)
ÎÎq r
;
ÎÎr s
}
ÏÏ 
break
ÌÌ !
;
ÌÌ! "
}
ÓÓ 
if
ÒÒ 
(
ÒÒ 
thing
ÒÒ !
==
ÒÒ" $
null
ÒÒ% )
||
ÒÒ* ,
!
ÒÒ- .
thing
ÒÒ. 3
.
ÒÒ3 4
Spawned
ÒÒ4 ;
)
ÒÒ; <
{
ÚÚ 
if
ÛÛ 
(
ÛÛ  $
DigitalStorageSettings
ÛÛ  6
.
ÛÛ6 7
enableDebugLog
ÛÛ7 E
)
ÛÛE F
{
ÙÙ 
Log
ıı  #
.
ıı# $
Message
ıı$ +
(
ıı+ ,
$"
ıı, .
$str
ıı. O
{
ııO P
(
ııP Q
thing
ııQ V
!=
ııW Y
null
ııZ ^
?
ıı_ `
thing
ııa f
.
ııf g
GetHashCode
ııg r
(
ıır s
)
ııs t
.
ııt u
ToString
ııu }
(
ıı} ~
)
ıı~ 
:ııÄ Å
$strııÇ à
)ııà â
}ııâ ä
"ııä ã
)ııã å
;ııå ç
}
ˆˆ 
continue
˜˜ $
;
˜˜$ %
}
¯¯ 
int
˚˚ 
currentStackCount
˚˚ -
=
˚˚. /
thing
˚˚0 5
.
˚˚5 6

stackCount
˚˚6 @
;
˚˚@ A
int
¸¸ 
	remaining
¸¸ %
=
¸¸& '
toConvertCount
¸¸( 6
-
¸¸7 8
	converted
¸¸9 B
;
¸¸B C
if
˛˛ 
(
˛˛ $
DigitalStorageSettings
˛˛ 2
.
˛˛2 3
enableDebugLog
˛˛3 A
)
˛˛A B
{
ˇˇ 
Log
ÄÄ 
.
ÄÄ  
Message
ÄÄ  '
(
ÄÄ' (
$"
ÄÄ( *
$str
ÄÄ* >
{
ÄÄ> ?
thing
ÄÄ? D
.
ÄÄD E
Label
ÄÄE J
}
ÄÄJ K
$str
ÄÄK M
{
ÄÄM N
currentStackCount
ÄÄN _
}
ÄÄ_ `
$str
ÄÄ` f
{
ÄÄf g
thing
ÄÄg l
.
ÄÄl m
Position
ÄÄm u
}
ÄÄu v
$strÄÄv É
{ÄÄÉ Ñ
thingÄÄÑ â
.ÄÄâ ä
GetHashCodeÄÄä ï
(ÄÄï ñ
)ÄÄñ ó
}ÄÄó ò
$strÄÄò °
{ÄÄ° ¢
	remainingÄÄ¢ ´
}ÄÄ´ ¨
$strÄÄ¨ ≥
{ÄÄ≥ ¥
	convertedÄÄ¥ Ω
}ÄÄΩ æ
"ÄÄæ ø
)ÄÄø ¿
;ÄÄ¿ ¡
}
ÅÅ 
if
ÉÉ 
(
ÉÉ 
currentStackCount
ÉÉ -
<=
ÉÉ. 0
	remaining
ÉÉ1 :
)
ÉÉ: ;
{
ÑÑ 
	toConvert
ÜÜ %
.
ÜÜ% &
Add
ÜÜ& )
(
ÜÜ) *
thing
ÜÜ* /
)
ÜÜ/ 0
;
ÜÜ0 1
	converted
áá %
+=
áá& (
currentStackCount
áá) :
;
áá: ;
if
àà 
(
àà  $
DigitalStorageSettings
àà  6
.
àà6 7
enableDebugLog
àà7 E
)
ààE F
{
ââ 
Log
ää  #
.
ää# $
Message
ää$ +
(
ää+ ,
$"
ää, .
$str
ää. D
{
ääD E
thing
ääE J
.
ääJ K
Label
ääK P
}
ääP Q
$str
ääQ S
{
ääS T
currentStackCount
ääT e
}
ääe f
$str
ääf m
{
ääm n
	converted
ään w
}
ääw x
"
ääx y
)
ääy z
;
ääz {
}
ãã 
}
åå 
else
çç 
{
éé 
Thing
ëë !
split
ëë" '
=
ëë( )
thing
ëë* /
.
ëë/ 0
SplitOff
ëë0 8
(
ëë8 9
	remaining
ëë9 B
)
ëëB C
;
ëëC D
if
íí 
(
íí  
split
íí  %
!=
íí& (
null
íí) -
&&
íí. 0
split
íí1 6
.
íí6 7

stackCount
íí7 A
>
ííB C
$num
ííD E
)
ííE F
{
ìì 
	toConvert
îî  )
.
îî) *
Add
îî* -
(
îî- .
split
îî. 3
)
îî3 4
;
îî4 5
	converted
ïï  )
+=
ïï* ,
split
ïï- 2
.
ïï2 3

stackCount
ïï3 =
;
ïï= >
if
ññ  "
(
ññ# $$
DigitalStorageSettings
ññ$ :
.
ññ: ;
enableDebugLog
ññ; I
)
ññI J
{
óó  !
Log
òò$ '
.
òò' (
Message
òò( /
(
òò/ 0
$"
òò0 2
$str
òò2 J
{
òòJ K
thing
òòK P
.
òòP Q
Label
òòQ V
}
òòV W
$str
òòW Y
{
òòY Z
currentStackCount
òòZ k
}
òòk l
$str
òòl v
{
òòv w
split
òòw |
.
òò| }

stackCountòò} á
}òòá à
$stròòà ì
{òòì î
thingòòî ô
.òòô ö

stackCountòòö §
}òò§ •
$stròò• ¨
{òò¨ ≠
	convertedòò≠ ∂
}òò∂ ∑
"òò∑ ∏
)òò∏ π
;òòπ ∫
}
ôô  !
}
öö 
else
õõ  
{
úú 
if
ùù  "
(
ùù# $$
DigitalStorageSettings
ùù$ :
.
ùù: ;
enableDebugLog
ùù; I
)
ùùI J
{
ûû  !
Log
üü$ '
.
üü' (
Message
üü( /
(
üü/ 0
$"
üü0 2
$str
üü2 L
{
üüL M
thing
üüM R
.
üüR S
Label
üüS X
}
üüX Y
$str
üüY [
{
üü[ \
currentStackCount
üü\ m
}
üüm n
$str
üün |
{
üü| }
(
üü} ~
splitüü~ É
!=üüÑ Ü
nullüüá ã
?üüå ç
splitüüé ì
.üüì î

stackCountüüî û
.üüû ü
ToStringüüü ß
(üüß ®
)üü® ©
:üü™ ´
$strüü¨ ≤
)üü≤ ≥
}üü≥ ¥
"üü¥ µ
)üüµ ∂
;üü∂ ∑
}
††  !
}
°° 
}
¢¢ 
}
££ 
if
•• 
(
•• $
DigitalStorageSettings
•• .
.
••. /!
enableConversionLog
••/ B
)
••B C
{
¶¶ 
ThingDef
ßß  
def2
ßß! %
=
ßß& '
GetDefFromKey
ßß( 5
(
ßß5 6
key
ßß6 9
)
ßß9 :
;
ßß: ;
Log
®® 
.
®® 
Message
®® #
(
®®# $
$"
®®$ &
$str
®®& 3
{
®®3 4
def2
®®4 8
?
®®8 9
.
®®9 :
label
®®: ?
??
®®@ B
key
®®C F
}
®®F G
$str
®®G M
{
®®M N

totalCount
®®N X
}
®®X Y
$str
®®Y _
{
®®_ `
reservedCount
®®` m
}
®®m n
$str
®®n u
{
®®u v
toConvertCount®®v Ñ
}®®Ñ Ö
$str®®Ö å
{®®å ç
	converted®®ç ñ
}®®ñ ó
$str®®ó ù
{®®ù û
toConvertCount®®û ¨
-®®≠ Æ
	converted®®Ø ∏
}®®∏ π
"®®π ∫
)®®∫ ª
;®®ª º
}
©© 
}
™™ 
else
´´ 
{
¨¨ 
if
≠≠ 
(
≠≠ $
DigitalStorageSettings
≠≠ .
.
≠≠. /!
enableConversionLog
≠≠/ B
)
≠≠B C
{
ÆÆ 
ThingDef
ØØ  
def3
ØØ! %
=
ØØ& '
GetDefFromKey
ØØ( 5
(
ØØ5 6
key
ØØ6 9
)
ØØ9 :
;
ØØ: ;
Log
∞∞ 
.
∞∞ 
Message
∞∞ #
(
∞∞# $
$"
∞∞$ &
$str
∞∞& 4
{
∞∞4 5
def3
∞∞5 9
?
∞∞9 :
.
∞∞: ;
label
∞∞; @
??
∞∞A C
key
∞∞D G
}
∞∞G H
$str
∞∞H N
{
∞∞N O

totalCount
∞∞O Y
}
∞∞Y Z
$str
∞∞Z `
{
∞∞` a
reservedCount
∞∞a n
}
∞∞n o
$str
∞∞o u
"
∞∞u v
)
∞∞v w
;
∞∞w x
}
±± 
}
≤≤ 
}
≥≥ 
if
µµ 
(
µµ $
DigitalStorageSettings
µµ &
.
µµ& '
enableDebugLog
µµ' 5
)
µµ5 6
{
∂∂ 
Log
∑∑ 
.
∑∑ 
Message
∑∑ 
(
∑∑ 
$"
∑∑ 
$str
∑∑ A
"
∑∑A B
)
∑∑B C
;
∑∑C D
}
∏∏ 
if
∫∫ 
(
∫∫ 
	toConvert
∫∫ 
.
∫∫ 
Count
∫∫ 
==
∫∫  "
$num
∫∫# $
)
∫∫$ %
{
ªª 
if
ºº 
(
ºº $
DigitalStorageSettings
ºº *
.
ºº* +!
enableConversionLog
ºº+ >
)
ºº> ?
{
ΩΩ 
Log
ææ 
.
ææ 
Message
ææ 
(
ææ  
$"
ææ  "
$str
ææ" :
"
ææ: ;
)
ææ; <
;
ææ< =
}
øø 
return
¿¿ 
;
¿¿ 
}
¡¡ 
if
√√ 
(
√√ $
DigitalStorageSettings
√√ &
.
√√& '!
enableConversionLog
√√' :
)
√√: ;
{
ƒƒ 
Log
≈≈ 
.
≈≈ 
Message
≈≈ 
(
≈≈ 
$"
≈≈ 
$str
≈≈ *
{
≈≈* +
	toConvert
≈≈+ 4
.
≈≈4 5
Count
≈≈5 :
}
≈≈: ;
$str
≈≈; ?
"
≈≈? @
)
≈≈@ A
;
≈≈A B
}
∆∆ 
int
…… !
totalConvertedCount
…… #
=
……$ %
$num
……& '
;
……' (
foreach
   
(
   
Thing
   
thing
    
in
  ! #
	toConvert
  $ -
)
  - .
{
ÀÀ 
if
ÃÃ 
(
ÃÃ 
thing
ÃÃ 
!=
ÃÃ 
null
ÃÃ !
&&
ÃÃ" $
thing
ÃÃ% *
.
ÃÃ* +

stackCount
ÃÃ+ 5
>
ÃÃ6 7
$num
ÃÃ8 9
)
ÃÃ9 :
{
ÕÕ 
int
ŒŒ 
beforeCount
ŒŒ #
=
ŒŒ$ %
GetItemCount
ŒŒ& 2
(
ŒŒ2 3
thing
ŒŒ3 8
.
ŒŒ8 9
def
ŒŒ9 <
,
ŒŒ< =
thing
ŒŒ> C
.
ŒŒC D
Stuff
ŒŒD I
)
ŒŒI J
;
ŒŒJ K
	StoreItem
œœ 
(
œœ 
thing
œœ #
)
œœ# $
;
œœ$ %
int
–– 

afterCount
–– "
=
––# $
GetItemCount
––% 1
(
––1 2
thing
––2 7
.
––7 8
def
––8 ;
,
––; <
thing
––= B
.
––B C
Stuff
––C H
)
––H I
;
––I J!
totalConvertedCount
—— '
+=
——( *
thing
——+ 0
.
——0 1

stackCount
——1 ;
;
——; <
if
”” 
(
”” $
DigitalStorageSettings
”” .
.
””. /
enableDebugLog
””/ =
)
””= >
{
‘‘ 
Log
’’ 
.
’’ 
Message
’’ #
(
’’# $
$"
’’$ &
$str
’’& 3
{
’’3 4
thing
’’4 9
.
’’9 :
Label
’’: ?
}
’’? @
$str
’’@ B
{
’’B C
thing
’’C H
.
’’H I

stackCount
’’I S
}
’’S T
$str
’’T _
{
’’_ `
beforeCount
’’` k
}
’’k l
$str
’’l w
{
’’w x

afterCount’’x Ç
}’’Ç É
"’’É Ñ
)’’Ñ Ö
;’’Ö Ü
}
÷÷ 
}
◊◊ 
}
ÿÿ 
foreach
€€ 
(
€€ 
Thing
€€ 
thing
€€  
in
€€! #
	toConvert
€€$ -
)
€€- .
{
‹‹ 
if
›› 
(
›› 
thing
›› 
!=
›› 
null
›› !
&&
››" $
thing
››% *
.
››* +
Spawned
››+ 2
)
››2 3
{
ﬁﬁ 
thing
ﬂﬂ 
.
ﬂﬂ 
DeSpawn
ﬂﬂ !
(
ﬂﬂ! "
DestroyMode
ﬂﬂ" -
.
ﬂﬂ- .
Vanish
ﬂﬂ. 4
)
ﬂﬂ4 5
;
ﬂﬂ5 6
}
‡‡ 
}
·· 
if
‰‰ 
(
‰‰ $
DigitalStorageSettings
‰‰ &
.
‰‰& '!
enableConversionLog
‰‰' :
&&
‰‰; =!
totalConvertedCount
‰‰> Q
>
‰‰R S
$num
‰‰T U
)
‰‰U V
{
ÂÂ 
Log
ÊÊ 
.
ÊÊ 
Message
ÊÊ 
(
ÊÊ 
$"
ÊÊ 
$str
ÊÊ -
{
ÊÊ- .!
totalConvertedCount
ÊÊ. A
}
ÊÊA B
$str
ÊÊB F
"
ÊÊF G
)
ÊÊG H
;
ÊÊH I
}
ÁÁ #
lastPhysicalItemCount
ÍÍ !
=
ÍÍ" #
	slotGroup
ÍÍ$ -
.
ÍÍ- .

HeldThings
ÍÍ. 8
.
ÍÍ8 9
Count
ÍÍ9 >
(
ÍÍ> ?
)
ÍÍ? @
;
ÍÍ@ A
}
ÎÎ 	
public
 
void
 
	StoreItem
 
(
 
Thing
 #
thing
$ )
)
) *
{
ÒÒ 	
if
ÚÚ 
(
ÚÚ 
thing
ÚÚ 
==
ÚÚ 
null
ÚÚ 
)
ÚÚ 
return
ÚÚ %
;
ÚÚ% &
StoredItemData
ıı 
data
ıı 
=
ıı  !
new
ıı" %
StoredItemData
ıı& 4
(
ıı4 5
thing
ıı5 :
)
ıı: ;
;
ıı; <
StoreItemData
ˆˆ 
(
ˆˆ 
data
ˆˆ 
)
ˆˆ 
;
ˆˆ  
}
˜˜ 	
public
¸¸ 
void
¸¸ 
StoreItemData
¸¸ !
(
¸¸! "
StoredItemData
¸¸" 0
data
¸¸1 5
)
¸¸5 6
{
˝˝ 	
if
˛˛ 
(
˛˛ 
data
˛˛ 
==
˛˛ 
null
˛˛ 
||
˛˛ 
data
˛˛  $
.
˛˛$ %
def
˛˛% (
==
˛˛) +
null
˛˛, 0
)
˛˛0 1
return
˛˛2 8
;
˛˛8 9
bool
ÅÅ 

hasQuality
ÅÅ 
=
ÅÅ 
data
ÅÅ "
.
ÅÅ" #
def
ÅÅ# &
.
ÅÅ& '
HasComp
ÅÅ' .
<
ÅÅ. /
CompQuality
ÅÅ/ :
>
ÅÅ: ;
(
ÅÅ; <
)
ÅÅ< =
;
ÅÅ= >
StoredItemData
ÑÑ 
match
ÑÑ  
=
ÑÑ! "
null
ÑÑ# '
;
ÑÑ' (
foreach
ÜÜ 
(
ÜÜ 
StoredItemData
ÜÜ #
existing
ÜÜ$ ,
in
ÜÜ- /
this
ÜÜ0 4
.
ÜÜ4 5
virtualStorage
ÜÜ5 C
)
ÜÜC D
{
áá 
if
àà 
(
àà 
existing
àà 
.
àà 
Matches
àà $
(
àà$ %
data
àà% )
.
àà) *
def
àà* -
,
àà- .
data
àà/ 3
.
àà3 4
stuffDef
àà4 <
)
àà< =
)
àà= >
{
ââ 
if
ãã 
(
ãã 
!
ãã 

hasQuality
ãã #
)
ãã# $
{
åå 
match
çç 
=
çç 
existing
çç  (
;
çç( )
break
éé 
;
éé 
}
èè 
else
ëë 
if
ëë 
(
ëë 
existing
ëë %
.
ëë% &
quality
ëë& -
==
ëë. 0
data
ëë1 5
.
ëë5 6
quality
ëë6 =
)
ëë= >
{
íí 
match
ìì 
=
ìì 
existing
ìì  (
;
ìì( )
break
îî 
;
îî 
}
ïï 
}
ññ 
}
óó 
if
öö 
(
öö 
match
öö 
!=
öö 
null
öö 
)
öö 
{
õõ 
match
úú 
.
úú 

stackCount
úú  
+=
úú! #
data
úú$ (
.
úú( )

stackCount
úú) 3
;
úú3 4
if
ûû 
(
ûû 
data
ûû 
.
ûû 
	hitPoints
ûû "
>
ûû# $
$num
ûû% &
&&
ûû' )
match
ûû* /
.
ûû/ 0
	hitPoints
ûû0 9
>
ûû: ;
$num
ûû< =
)
ûû= >
{
üü 
int
†† 
totalHitPoints
†† &
=
††' (
(
††) *
match
††* /
.
††/ 0
	hitPoints
††0 9
*
††: ;
match
††< A
.
††A B

stackCount
††B L
)
††L M
+
††N O
(
††P Q
data
††Q U
.
††U V
	hitPoints
††V _
*
††` a
data
††b f
.
††f g

stackCount
††g q
)
††q r
;
††r s
int
°° 

totalCount
°° "
=
°°# $
match
°°% *
.
°°* +

stackCount
°°+ 5
+
°°6 7
data
°°8 <
.
°°< =

stackCount
°°= G
;
°°G H
match
¢¢ 
.
¢¢ 
	hitPoints
¢¢ #
=
¢¢$ %
totalHitPoints
¢¢& 4
/
¢¢5 6

totalCount
¢¢7 A
;
¢¢A B
}
££ 
if
•• 
(
•• 

hasQuality
•• 
&&
•• !
data
••" &
.
••& '
quality
••' .
<
••/ 0
match
••1 6
.
••6 7
quality
••7 >
)
••> ?
{
¶¶ 
match
ßß 
.
ßß 
quality
ßß !
=
ßß" #
data
ßß$ (
.
ßß( )
quality
ßß) 0
;
ßß0 1
}
®® 
return
©© 
;
©© 
}
™™ 
this
≠≠ 
.
≠≠ 
virtualStorage
≠≠ 
.
≠≠  
Add
≠≠  #
(
≠≠# $
data
≠≠$ (
)
≠≠( )
;
≠≠) *
this
ÆÆ 
.
ÆÆ 

itemLookup
ÆÆ 
[
ÆÆ 
data
ÆÆ  
.
ÆÆ  !
uniqueId
ÆÆ! )
]
ÆÆ) *
=
ÆÆ+ ,
data
ÆÆ- 1
;
ÆÆ1 2
}
ØØ 	
private
¥¥ 
Thing
¥¥ $
ExtractItemForReserved
¥¥ ,
(
¥¥, -
ThingDef
¥¥- 5
def
¥¥6 9
,
¥¥9 :
int
¥¥; >
count
¥¥? D
,
¥¥D E
ThingDef
¥¥F N
stuff
¥¥O T
,
¥¥T U
QualityCategory
¥¥V e
quality
¥¥f m
)
¥¥m n
{
µµ 	
foreach
∂∂ 
(
∂∂ 
StoredItemData
∂∂ #
item
∂∂$ (
in
∂∂) +
this
∂∂, 0
.
∂∂0 1
virtualStorage
∂∂1 ?
)
∂∂? @
{
∑∑ 
if
∏∏ 
(
∏∏ 
item
∏∏ 
.
∏∏ 
Matches
∏∏  
(
∏∏  !
def
∏∏! $
,
∏∏$ %
stuff
∏∏& +
)
∏∏+ ,
&&
∏∏- /
item
∏∏0 4
.
∏∏4 5
quality
∏∏5 <
==
∏∏= ?
quality
∏∏@ G
&&
∏∏H J
item
∏∏K O
.
∏∏O P

stackCount
∏∏P Z
>=
∏∏[ ]
count
∏∏^ c
)
∏∏c d
{
ππ 
item
∫∫ 
.
∫∫ 

stackCount
∫∫ #
-=
∫∫$ &
count
∫∫' ,
;
∫∫, -
if
ºº 
(
ºº 
item
ºº 
.
ºº 

stackCount
ºº '
<=
ºº( *
$num
ºº+ ,
)
ºº, -
{
ΩΩ 
this
ææ 
.
ææ 
virtualStorage
ææ +
.
ææ+ ,
Remove
ææ, 2
(
ææ2 3
item
ææ3 7
)
ææ7 8
;
ææ8 9
this
øø 
.
øø 

itemLookup
øø '
.
øø' (
Remove
øø( .
(
øø. /
item
øø/ 3
.
øø3 4
uniqueId
øø4 <
)
øø< =
;
øø= >
}
¿¿ 
StoredItemData
¬¬ "
extractData
¬¬# .
=
¬¬/ 0
new
¬¬1 4
StoredItemData
¬¬5 C
{
√√ 
def
ƒƒ 
=
ƒƒ 
item
ƒƒ "
.
ƒƒ" #
def
ƒƒ# &
,
ƒƒ& '
stuffDef
≈≈  
=
≈≈! "
item
≈≈# '
.
≈≈' (
stuffDef
≈≈( 0
,
≈≈0 1
quality
∆∆ 
=
∆∆  !
item
∆∆" &
.
∆∆& '
quality
∆∆' .
,
∆∆. /
	hitPoints
«« !
=
««" #
item
««$ (
.
««( )
	hitPoints
««) 2
,
««2 3

stackCount
»» "
=
»»# $
count
»»% *
}
…… 
;
…… 
return
ÀÀ 
extractData
ÀÀ &
.
ÀÀ& '
CreateThing
ÀÀ' 2
(
ÀÀ2 3
)
ÀÀ3 4
;
ÀÀ4 5
}
ÃÃ 
}
ÕÕ 
return
œœ 
null
œœ 
;
œœ 
}
–– 	
public
’’ 
Thing
’’ 
ExtractItem
’’  
(
’’  !
ThingDef
’’! )
def
’’* -
,
’’- .
int
’’/ 2
count
’’3 8
,
’’8 9
ThingDef
’’: B
stuff
’’C H
=
’’I J
null
’’K O
)
’’O P
{
÷÷ 	
int
◊◊ 
beforeCount
◊◊ 
=
◊◊ 
GetItemCount
◊◊ *
(
◊◊* +
def
◊◊+ .
,
◊◊. /
stuff
◊◊0 5
)
◊◊5 6
;
◊◊6 7
if
ŸŸ 
(
ŸŸ $
DigitalStorageSettings
ŸŸ &
.
ŸŸ& '
enableDebugLog
ŸŸ' 5
)
ŸŸ5 6
{
⁄⁄ 
Log
€€ 
.
€€ 
Message
€€ 
(
€€ 
$"
€€ 
$str
€€ 8
{
€€8 9
def
€€9 <
?
€€< =
.
€€= >
label
€€> C
??
€€D F
$str
€€G M
}
€€M N
$str
€€N P
{
€€P Q
count
€€Q V
}
€€V W
$str
€€W _
{
€€_ `
stuff
€€` e
?
€€e f
.
€€f g
label
€€g l
??
€€m o
$str
€€p v
}
€€v w
$str€€w É
{€€É Ñ
beforeCount€€Ñ è
}€€è ê
"€€ê ë
)€€ë í
;€€í ì
}
‹‹ 
foreach
ﬁﬁ 
(
ﬁﬁ 
StoredItemData
ﬁﬁ #
item
ﬁﬁ$ (
in
ﬁﬁ) +
this
ﬁﬁ, 0
.
ﬁﬁ0 1
virtualStorage
ﬁﬁ1 ?
)
ﬁﬁ? @
{
ﬂﬂ 
if
‡‡ 
(
‡‡ 
item
‡‡ 
.
‡‡ 
Matches
‡‡  
(
‡‡  !
def
‡‡! $
,
‡‡$ %
stuff
‡‡& +
)
‡‡+ ,
&&
‡‡- /
item
‡‡0 4
.
‡‡4 5

stackCount
‡‡5 ?
>=
‡‡@ B
count
‡‡C H
)
‡‡H I
{
·· 
item
‚‚ 
.
‚‚ 

stackCount
‚‚ #
-=
‚‚$ &
count
‚‚' ,
;
‚‚, -
if
‰‰ 
(
‰‰ $
DigitalStorageSettings
‰‰ .
.
‰‰. /
enableDebugLog
‰‰/ =
)
‰‰= >
{
ÂÂ 
Log
ÊÊ 
.
ÊÊ 
Message
ÊÊ #
(
ÊÊ# $
$"
ÊÊ$ &
$str
ÊÊ& F
{
ÊÊF G
item
ÊÊG K
.
ÊÊK L

stackCount
ÊÊL V
+
ÊÊW X
count
ÊÊY ^
}
ÊÊ^ _
$str
ÊÊ_ e
{
ÊÊe f
item
ÊÊf j
.
ÊÊj k

stackCount
ÊÊk u
}
ÊÊu v
$str
ÊÊv }
{
ÊÊ} ~
countÊÊ~ É
}ÊÊÉ Ñ
"ÊÊÑ Ö
)ÊÊÖ Ü
;ÊÊÜ á
}
ÁÁ 
if
ÈÈ 
(
ÈÈ 
item
ÈÈ 
.
ÈÈ 

stackCount
ÈÈ '
<=
ÈÈ( *
$num
ÈÈ+ ,
)
ÈÈ, -
{
ÍÍ 
this
ÎÎ 
.
ÎÎ 
virtualStorage
ÎÎ +
.
ÎÎ+ ,
Remove
ÎÎ, 2
(
ÎÎ2 3
item
ÎÎ3 7
)
ÎÎ7 8
;
ÎÎ8 9
this
ÏÏ 
.
ÏÏ 

itemLookup
ÏÏ '
.
ÏÏ' (
Remove
ÏÏ( .
(
ÏÏ. /
item
ÏÏ/ 3
.
ÏÏ3 4
uniqueId
ÏÏ4 <
)
ÏÏ< =
;
ÏÏ= >
if
ÓÓ 
(
ÓÓ $
DigitalStorageSettings
ÓÓ 2
.
ÓÓ2 3
enableDebugLog
ÓÓ3 A
)
ÓÓA B
{
ÔÔ 
Log
 
.
  
Message
  '
(
' (
$"
( *
$str
* M
"
M N
)
N O
;
O P
}
ÒÒ 
}
ÚÚ 
StoredItemData
ÙÙ "
extractData
ÙÙ# .
=
ÙÙ/ 0
new
ÙÙ1 4
StoredItemData
ÙÙ5 C
{
ıı 
def
ˆˆ 
=
ˆˆ 
item
ˆˆ "
.
ˆˆ" #
def
ˆˆ# &
,
ˆˆ& '
stuffDef
˜˜  
=
˜˜! "
item
˜˜# '
.
˜˜' (
stuffDef
˜˜( 0
,
˜˜0 1
quality
¯¯ 
=
¯¯  !
item
¯¯" &
.
¯¯& '
quality
¯¯' .
,
¯¯. /
	hitPoints
˘˘ !
=
˘˘" #
item
˘˘$ (
.
˘˘( )
	hitPoints
˘˘) 2
,
˘˘2 3

stackCount
˙˙ "
=
˙˙# $
count
˙˙% *
}
˚˚ 
;
˚˚ 
int
˝˝ 

afterCount
˝˝ "
=
˝˝# $
GetItemCount
˝˝% 1
(
˝˝1 2
def
˝˝2 5
,
˝˝5 6
stuff
˝˝7 <
)
˝˝< =
;
˝˝= >
if
ˇˇ 
(
ˇˇ $
DigitalStorageSettings
ˇˇ .
.
ˇˇ. /
enableDebugLog
ˇˇ/ =
)
ˇˇ= >
{
ÄÄ 
Log
ÅÅ 
.
ÅÅ 
Message
ÅÅ #
(
ÅÅ# $
$"
ÅÅ$ &
$str
ÅÅ& H
{
ÅÅH I
beforeCount
ÅÅI T
}
ÅÅT U
$str
ÅÅU _
{
ÅÅ_ `

afterCount
ÅÅ` j
}
ÅÅj k
$str
ÅÅk p
{
ÅÅp q
beforeCount
ÅÅq |
-
ÅÅ} ~

afterCountÅÅ â
}ÅÅâ ä
"ÅÅä ã
)ÅÅã å
;ÅÅå ç
}
ÇÇ 
return
ÑÑ 
extractData
ÑÑ &
.
ÑÑ& '
CreateThing
ÑÑ' 2
(
ÑÑ2 3
)
ÑÑ3 4
;
ÑÑ4 5
}
ÖÖ 
}
ÜÜ 
if
àà 
(
àà $
DigitalStorageSettings
àà &
.
àà& '
enableDebugLog
àà' 5
)
àà5 6
{
ââ 
Log
ää 
.
ää 
Message
ää 
(
ää 
$"
ää 
$str
ää @
{
ää@ A
def
ääA D
?
ääD E
.
ääE F
label
ääF K
??
ääL N
$str
ääO U
}
ääU V
$str
ääV X
{
ääX Y
count
ääY ^
}
ää^ _
"
ää_ `
)
ää` a
;
ääa b
}
ãã 
return
çç 
null
çç 
;
çç 
}
éé 	
public
ìì 
bool
ìì 
HasItem
ìì 
(
ìì 
ThingDef
ìì $
def
ìì% (
,
ìì( )
ThingDef
ìì* 2
stuff
ìì3 8
=
ìì9 :
null
ìì; ?
)
ìì? @
{
îî 	
	SlotGroup
ññ 
	slotGroup
ññ 
=
ññ  !
base
ññ" &
.
ññ& '
GetSlotGroup
ññ' 3
(
ññ3 4
)
ññ4 5
;
ññ5 6
if
óó 
(
óó 
	slotGroup
óó 
!=
óó 
null
óó !
)
óó! "
{
òò 
foreach
ôô 
(
ôô 
Thing
ôô 
thing
ôô $
in
ôô% '
	slotGroup
ôô( 1
.
ôô1 2

HeldThings
ôô2 <
)
ôô< =
{
öö 
if
õõ 
(
õõ 
thing
õõ 
!=
õõ  
null
õõ! %
&&
õõ& (
thing
õõ) .
.
õõ. /
Spawned
õõ/ 6
&&
õõ7 9
thing
õõ: ?
.
õõ? @
def
õõ@ C
==
õõD F
def
õõG J
&&
õõK M
thing
õõN S
.
õõS T
Stuff
õõT Y
==
õõZ \
stuff
õõ] b
)
õõb c
{
úú 
return
ùù 
true
ùù #
;
ùù# $
}
ûû 
}
üü 
}
†† 
foreach
££ 
(
££ 
StoredItemData
££ #
item
££$ (
in
££) +
this
££, 0
.
££0 1
virtualStorage
££1 ?
)
££? @
{
§§ 
if
•• 
(
•• 
item
•• 
.
•• 
Matches
••  
(
••  !
def
••! $
,
••$ %
stuff
••& +
)
••+ ,
&&
••- /
item
••0 4
.
••4 5

stackCount
••5 ?
>
••@ A
$num
••B C
)
••C D
{
¶¶ 
return
ßß 
true
ßß 
;
ßß  
}
®® 
}
©© 
return
™™ 
false
™™ 
;
™™ 
}
´´ 	
public
∞∞ 
int
∞∞ 
GetItemCount
∞∞ 
(
∞∞  
ThingDef
∞∞  (
def
∞∞) ,
,
∞∞, -
ThingDef
∞∞. 6
stuff
∞∞7 <
=
∞∞= >
null
∞∞? C
)
∞∞C D
{
±± 	
int
≤≤ 
total
≤≤ 
=
≤≤ 
$num
≤≤ 
;
≤≤ 
	SlotGroup
µµ 
	slotGroup
µµ 
=
µµ  !
base
µµ" &
.
µµ& '
GetSlotGroup
µµ' 3
(
µµ3 4
)
µµ4 5
;
µµ5 6
if
∂∂ 
(
∂∂ 
	slotGroup
∂∂ 
!=
∂∂ 
null
∂∂ !
)
∂∂! "
{
∑∑ 
foreach
∏∏ 
(
∏∏ 
Thing
∏∏ 
thing
∏∏ $
in
∏∏% '
	slotGroup
∏∏( 1
.
∏∏1 2

HeldThings
∏∏2 <
)
∏∏< =
{
ππ 
if
∫∫ 
(
∫∫ 
thing
∫∫ 
!=
∫∫  
null
∫∫! %
&&
∫∫& (
thing
∫∫) .
.
∫∫. /
Spawned
∫∫/ 6
&&
∫∫7 9
thing
∫∫: ?
.
∫∫? @
def
∫∫@ C
==
∫∫D F
def
∫∫G J
&&
∫∫K M
thing
∫∫N S
.
∫∫S T
Stuff
∫∫T Y
==
∫∫Z \
stuff
∫∫] b
)
∫∫b c
{
ªª 
total
ºº 
+=
ºº  
thing
ºº! &
.
ºº& '

stackCount
ºº' 1
;
ºº1 2
}
ΩΩ 
}
ææ 
}
øø 
foreach
¬¬ 
(
¬¬ 
StoredItemData
¬¬ #
item
¬¬$ (
in
¬¬) +
this
¬¬, 0
.
¬¬0 1
virtualStorage
¬¬1 ?
)
¬¬? @
{
√√ 
if
ƒƒ 
(
ƒƒ 
item
ƒƒ 
.
ƒƒ 
Matches
ƒƒ  
(
ƒƒ  !
def
ƒƒ! $
,
ƒƒ$ %
stuff
ƒƒ& +
)
ƒƒ+ ,
)
ƒƒ, -
{
≈≈ 
total
∆∆ 
+=
∆∆ 
item
∆∆ !
.
∆∆! "

stackCount
∆∆" ,
;
∆∆, -
}
«« 
}
»» 
return
   
total
   
;
   
}
ÀÀ 	
public
–– 
int
–– "
GetReservedItemCount
–– '
(
––' (
ThingDef
––( 0
def
––1 4
,
––4 5
ThingDef
––6 >
stuff
––? D
=
––E F
null
––G K
)
––K L
{
—— 	
int
““ 
total
““ 
=
““ 
$num
““ 
;
““ 
	SlotGroup
”” 
	slotGroup
”” 
=
””  !
base
””" &
.
””& '
GetSlotGroup
””' 3
(
””3 4
)
””4 5
;
””5 6
if
‘‘ 
(
‘‘ 
	slotGroup
‘‘ 
!=
‘‘ 
null
‘‘ !
)
‘‘! "
{
’’ 
foreach
÷÷ 
(
÷÷ 
Thing
÷÷ 
thing
÷÷ $
in
÷÷% '
	slotGroup
÷÷( 1
.
÷÷1 2

HeldThings
÷÷2 <
)
÷÷< =
{
◊◊ 
if
ÿÿ 
(
ÿÿ 
thing
ÿÿ 
!=
ÿÿ  
null
ÿÿ! %
&&
ÿÿ& (
thing
ÿÿ) .
.
ÿÿ. /
Spawned
ÿÿ/ 6
&&
ÿÿ7 9
thing
ÿÿ: ?
.
ÿÿ? @
def
ÿÿ@ C
==
ÿÿD F
def
ÿÿG J
&&
ÿÿK M
thing
ÿÿN S
.
ÿÿS T
Stuff
ÿÿT Y
==
ÿÿZ \
stuff
ÿÿ] b
)
ÿÿb c
{
ŸŸ 
total
⁄⁄ 
+=
⁄⁄  
thing
⁄⁄! &
.
⁄⁄& '

stackCount
⁄⁄' 1
;
⁄⁄1 2
}
€€ 
}
‹‹ 
}
›› 
return
ﬁﬁ 
total
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 	
public
‰‰ 
Thing
‰‰ 
FindReservedItem
‰‰ %
(
‰‰% &
ThingDef
‰‰& .
def
‰‰/ 2
,
‰‰2 3
ThingDef
‰‰4 <
stuff
‰‰= B
=
‰‰C D
null
‰‰E I
)
‰‰I J
{
ÂÂ 	
	SlotGroup
ÊÊ 
	slotGroup
ÊÊ 
=
ÊÊ  !
base
ÊÊ" &
.
ÊÊ& '
GetSlotGroup
ÊÊ' 3
(
ÊÊ3 4
)
ÊÊ4 5
;
ÊÊ5 6
if
ÁÁ 
(
ÁÁ 
	slotGroup
ÁÁ 
!=
ÁÁ 
null
ÁÁ !
)
ÁÁ! "
{
ËË 
foreach
ÈÈ 
(
ÈÈ 
Thing
ÈÈ 
thing
ÈÈ $
in
ÈÈ% '
	slotGroup
ÈÈ( 1
.
ÈÈ1 2

HeldThings
ÈÈ2 <
)
ÈÈ< =
{
ÍÍ 
if
ÎÎ 
(
ÎÎ 
thing
ÎÎ 
!=
ÎÎ  
null
ÎÎ! %
&&
ÎÎ& (
thing
ÎÎ) .
.
ÎÎ. /
Spawned
ÎÎ/ 6
&&
ÎÎ7 9
thing
ÎÎ: ?
.
ÎÎ? @
def
ÎÎ@ C
==
ÎÎD F
def
ÎÎG J
&&
ÎÎK M
thing
ÎÎN S
.
ÎÎS T
Stuff
ÎÎT Y
==
ÎÎZ \
stuff
ÎÎ] b
)
ÎÎb c
{
ÏÏ 
return
ÌÌ 
thing
ÌÌ $
;
ÌÌ$ %
}
ÓÓ 
}
ÔÔ 
}
 
return
ÒÒ 
null
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
private
˜˜ 
bool
˜˜  
IsValidReservation
˜˜ '
(
˜˜' (
Thing
˜˜( -
thing
˜˜. 3
,
˜˜3 4
Map
˜˜5 8
map
˜˜9 <
)
˜˜< =
{
¯¯ 	
if
˘˘ 
(
˘˘ 
thing
˘˘ 
==
˘˘ 
null
˘˘ 
||
˘˘  
map
˘˘! $
==
˘˘% '
null
˘˘( ,
||
˘˘- /
map
˘˘0 3
.
˘˘3 4 
reservationManager
˘˘4 F
==
˘˘G I
null
˘˘J N
)
˘˘N O
{
˙˙ 
return
˚˚ 
false
˚˚ 
;
˚˚ 
}
¸¸ 
foreach
ˇˇ 
(
ˇˇ 
var
ˇˇ 
reservation
ˇˇ $
in
ˇˇ% '
map
ˇˇ( +
.
ˇˇ+ , 
reservationManager
ˇˇ, >
.
ˇˇ> ?"
ReservationsReadOnly
ˇˇ? S
)
ˇˇS T
{
Ä	Ä	 
if
Å	Å	 
(
Å	Å	 
reservation
Å	Å	 
.
Å	Å	  
Target
Å	Å	  &
.
Å	Å	& '
Thing
Å	Å	' ,
==
Å	Å	- /
thing
Å	Å	0 5
&&
Å	Å	6 8
reservation
Å	Å	9 D
.
Å	Å	D E
Claimant
Å	Å	E M
!=
Å	Å	N P
null
Å	Å	Q U
)
Å	Å	U V
{
Ç	Ç	 
Pawn
É	É	 
claimant
É	É	 !
=
É	É	" #
reservation
É	É	$ /
.
É	É	/ 0
Claimant
É	É	0 8
;
É	É	8 9
Job
Ñ	Ñ	 
reservationJob
Ñ	Ñ	 &
=
Ñ	Ñ	' (
reservation
Ñ	Ñ	) 4
.
Ñ	Ñ	4 5
Job
Ñ	Ñ	5 8
;
Ñ	Ñ	8 9
if
Ü	Ü	 
(
Ü	Ü	 
claimant
Ü	Ü	  
==
Ü	Ü	! #
null
Ü	Ü	$ (
||
Ü	Ü	) +
reservationJob
Ü	Ü	, :
==
Ü	Ü	; =
null
Ü	Ü	> B
)
Ü	Ü	B C
{
á	á	 
continue
à	à	  
;
à	à	  !
}
â	â	 
if
ç	ç	 
(
ç	ç	 
claimant
ç	ç	  
.
ç	ç	  !
CurJob
ç	ç	! '
==
ç	ç	( *
reservationJob
ç	ç	+ 9
)
ç	ç	9 :
{
é	é	 
return
è	è	 
true
è	è	 #
;
è	è	# $
}
ê	ê	 
if
ì	ì	 
(
ì	ì	 
claimant
ì	ì	  
.
ì	ì	  !
jobs
ì	ì	! %
!=
ì	ì	& (
null
ì	ì	) -
&&
ì	ì	. 0
claimant
ì	ì	1 9
.
ì	ì	9 :
jobs
ì	ì	: >
.
ì	ì	> ?
jobQueue
ì	ì	? G
!=
ì	ì	H J
null
ì	ì	K O
)
ì	ì	O P
{
î	î	 
foreach
ï	ï	 
(
ï	ï	  !
var
ï	ï	! $
	queuedJob
ï	ï	% .
in
ï	ï	/ 1
claimant
ï	ï	2 :
.
ï	ï	: ;
jobs
ï	ï	; ?
.
ï	ï	? @
jobQueue
ï	ï	@ H
)
ï	ï	H I
{
ñ	ñ	 
if
ó	ó	 
(
ó	ó	  
	queuedJob
ó	ó	  )
.
ó	ó	) *
job
ó	ó	* -
==
ó	ó	. 0
reservationJob
ó	ó	1 ?
)
ó	ó	? @
{
ò	ò	 
return
ô	ô	  &
true
ô	ô	' +
;
ô	ô	+ ,
}
ö	ö	 
}
õ	õ	 
}
ú	ú	 
}
ù	ù	 
}
û	û	 
return
ü	ü	 
false
ü	ü	 
;
ü	ü	 
}
†	†	 	
public
•	•	 
IEnumerable
•	•	 
<
•	•	 
StoredItemData
•	•	 )
>
•	•	) *
GetAllStoredItems
•	•	+ <
(
•	•	< =
)
•	•	= >
{
¶	¶	 	
return
ß	ß	 
this
ß	ß	 
.
ß	ß	 
virtualStorage
ß	ß	 &
;
ß	ß	& '
}
®	®	 	
private
™	™	 
void
™	™	 
RebuildLookup
™	™	 "
(
™	™	" #
)
™	™	# $
{
´	´	 	
this
¨	¨	 
.
¨	¨	 

itemLookup
¨	¨	 
.
¨	¨	 
Clear
¨	¨	 !
(
¨	¨	! "
)
¨	¨	" #
;
¨	¨	# $
foreach
≠	≠	 
(
≠	≠	 
StoredItemData
≠	≠	 #
item
≠	≠	$ (
in
≠	≠	) +
this
≠	≠	, 0
.
≠	≠	0 1
virtualStorage
≠	≠	1 ?
)
≠	≠	? @
{
Æ	Æ	 
if
Ø	Ø	 
(
Ø	Ø	 
!
Ø	Ø	 
string
Ø	Ø	 
.
Ø	Ø	 
IsNullOrEmpty
Ø	Ø	 )
(
Ø	Ø	) *
item
Ø	Ø	* .
.
Ø	Ø	. /
uniqueId
Ø	Ø	/ 7
)
Ø	Ø	7 8
)
Ø	Ø	8 9
{
∞	∞	 
this
±	±	 
.
±	±	 

itemLookup
±	±	 #
[
±	±	# $
item
±	±	$ (
.
±	±	( )
uniqueId
±	±	) 1
]
±	±	1 2
=
±	±	3 4
item
±	±	5 9
;
±	±	9 :
}
≤	≤	 
}
≥	≥	 
}
¥	¥	 	
}
µ	µ	 
}∂	∂	 