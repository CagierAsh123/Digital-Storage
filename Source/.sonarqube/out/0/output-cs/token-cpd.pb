„

VB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Properties\AssemblyInfo.cs
[		 
assembly		 	
:			 

AssemblyVersion		 
(		 
$str		 $
)		$ %
]		% &
[

 
assembly

 	
:

	 

AssemblyCompany

 
(

 
$str

 +
)

+ ,
]

, -
[ 
assembly 	
:	 
!
AssemblyConfiguration  
(  !
$str! (
)( )
]) *
[ 
assembly 	
:	 

AssemblyFileVersion 
( 
$str (
)( )
]) *
[ 
assembly 	
:	 
(
AssemblyInformationalVersion '
(' (
$str( /
)/ 0
]0 1
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str +
)+ ,
], -
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str )
)) *
]* +
[ 
assembly 	
:	 

SecurityPermission 
( 
SecurityAction ,
., -
RequestMinimum- ;
,; <
SkipVerification= M
=N O
trueP T
)T U
]U Vø
ZB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Threading\MainThreadInvoker.cs
	namespace 	
DigitalStorage
 
. 
	Threading "
{ 
public 

static 
class 
MainThreadInvoker )
{ 
private		 
static		 
readonly		 
ConcurrentQueue		  /
<		/ 0
Action		0 6
>		6 7
queue		8 =
=		> ?
new		@ C
ConcurrentQueue		D S
<		S T
Action		T Z
>		Z [
(		[ \
)		\ ]
;		] ^
public 
static 
void 
Enqueue "
(" #
Action# )
action* 0
)0 1
{ 	
if 
( 
action 
== 
null 
) 
{ 
return 
; 
} 
queue 
. 
Enqueue 
( 
action  
)  !
;! "
} 	
internal 
static 
void 
	FlushOnce &
(& '
)' (
{ 	
int 

maxExecute 
= 
$num  
;  !
while 
( 

maxExecute 
-- 
>  !
$num" #
&&$ &
queue' ,
., -

TryDequeue- 7
(7 8
out8 ;
Action< B
actionC I
)I J
)J K
{ 
try 
{ 
action 
( 
) 
; 
} 
catch 
( 
	Exception  
ex! #
)# $
{   
Log!! 
.!! 
Error!! 
(!! 
$"!!  
$str!!  H
{!!H I
ex!!I K
}!!K L
"!!L M
)!!M N
;!!N O
}"" 
}## 
}$$ 	
public&& 
static&& 
int&& 
PendingCount&& &
=>&&' )
queue&&* /
.&&/ 0
Count&&0 5
;&&5 6
}'' 
}(( Æ5
UB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Threading\JobScheduler.cs
	namespace 	
DigitalStorage
 
. 
	Threading "
{ 
public 

sealed 
class 
JobScheduler $
{		 
public

 
static

 
readonly

 
JobScheduler

 +
Instance

, 4
=

5 6
new

7 :
JobScheduler

; G
(

G H
)

H I
;

I J
private 
readonly 
ConcurrentQueue (
<( )
Action) /
>/ 0
queue1 6
=7 8
new9 <
ConcurrentQueue= L
<L M
ActionM S
>S T
(T U
)U V
;V W
private 
readonly 
AutoResetEvent '
signal( .
=/ 0
new1 4
AutoResetEvent5 C
(C D
falseD I
)I J
;J K
private 
readonly 
Thread 
[  
]  !
workers" )
;) *
private 
volatile 
bool 
running %
=& '
true( ,
;, -
private 
int 
pending 
; 
private 
const 
int 
MaxQueue "
=# $
$num% +
;+ ,
private 
JobScheduler 
( 
) 
{ 	
int 
workerCount 
= 
Math "
." #
Max# &
(& '
$num' (
,( )
Math* .
.. /
Min/ 2
(2 3
Environment3 >
.> ?
ProcessorCount? M
-N O
$numP Q
,Q R
$numS T
)T U
)U V
;V W
this 
. 
workers 
= 
new 
Thread %
[% &
workerCount& 1
]1 2
;2 3
for 
( 
int 
i 
= 
$num 
; 
i 
< 
workerCount  +
;+ ,
i- .
++. 0
)0 1
{ 
this 
. 
workers 
[ 
i 
] 
=  !
new" %
Thread& ,
(, -

WorkerLoop- 7
)7 8
{ 
Name 
= 
$" 
$str 3
{3 4
i4 5
}5 6
"6 7
,7 8
IsBackground  
=! "
true# '
} 
; 
this   
.   
workers   
[   
i   
]   
.    
Start    %
(  % &
)  & '
;  ' (
}!! 
}"" 	
private$$ 
void$$ 

WorkerLoop$$ 
($$  
)$$  !
{%% 	
while&& 
(&& 
this&& 
.&& 
running&& 
)&&  
{'' 
if(( 
((( 
this(( 
.(( 
queue(( 
.(( 

TryDequeue(( )
((() *
out((* -
Action((. 4
action((5 ;
)((; <
)((< =
{)) 
try** 
{++ 
action,, 
(,, 
),,  
;,,  !
}-- 
catch.. 
(.. 
	Exception.. $
ex..% '
)..' (
{// 
Log00 
.00 
Error00 !
(00! "
$"00" $
$str00$ =
{00= >
ex00> @
}00@ A
"00A B
)00B C
;00C D
}11 
finally22 
{33 
Interlocked44 #
.44# $
	Decrement44$ -
(44- .
ref44. 1
this442 6
.446 7
pending447 >
)44> ?
;44? @
}55 
}66 
else77 
{88 
this99 
.99 
signal99 
.99  
WaitOne99  '
(99' (
$num99( )
)99) *
;99* +
}:: 
};; 
}<< 	
public>> 
bool>> 

TryEnqueue>> 
(>> 
Action>> %
job>>& )
)>>) *
{?? 	
if@@ 
(@@ 
job@@ 
==@@ 
null@@ 
)@@ 
{AA 
returnBB 
falseBB 
;BB 
}CC 
ifEE 
(EE 
InterlockedEE 
.EE 
	IncrementEE %
(EE% &
refEE& )
thisEE* .
.EE. /
pendingEE/ 6
)EE6 7
>EE8 9
MaxQueueEE: B
)EEB C
{FF 
InterlockedGG 
.GG 
	DecrementGG %
(GG% &
refGG& )
thisGG* .
.GG. /
pendingGG/ 6
)GG6 7
;GG7 8
returnHH 
falseHH 
;HH 
}II 
thisKK 
.KK 
queueKK 
.KK 
EnqueueKK 
(KK 
jobKK "
)KK" #
;KK# $
thisLL 
.LL 
signalLL 
.LL 
SetLL 
(LL 
)LL 
;LL 
returnMM 
trueMM 
;MM 
}NN 	
publicPP 
intPP 
PendingPP 
=>PP 
thisPP "
.PP" #
pendingPP# *
;PP* +
publicRR 
voidRR 
StopRR 
(RR 
)RR 
{SS 	
thisTT 
.TT 
runningTT 
=TT 
falseTT  
;TT  !
forUU 
(UU 
intUU 
iUU 
=UU 
$numUU 
;UU 
iUU 
<UU 
thisUU  $
.UU$ %
workersUU% ,
.UU, -
LengthUU- 3
;UU3 4
iUU5 6
++UU6 8
)UU8 9
{VV 
thisWW 
.WW 
signalWW 
.WW 
SetWW 
(WW  
)WW  !
;WW! "
}XX 
foreachZZ 
(ZZ 
ThreadZZ 
workerZZ "
inZZ# %
thisZZ& *
.ZZ* +
workersZZ+ 2
)ZZ2 3
{[[ 
try\\ 
{]] 
worker^^ 
.^^ 
Join^^ 
(^^  
$num^^  #
)^^# $
;^^$ %
}__ 
catch`` 
{aa 
}cc 
}dd 
}ee 	
}ff 
}gg ∂M
VB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\UI\Dialog_ExtractAmount.cs
	namespace 	
DigitalStorage
 
. 
UI 
{ 
public 

class  
Dialog_ExtractAmount %
:& '
Window( .
{ 
private 
StoredItemData 
item #
;# $
private !
Dialog_VirtualStorage %
parentDialog& 2
;2 3
private 
string 
amountBuffer #
;# $
private 
int 
	maxAmount 
; 
public 
override 
Vector2 
InitialSize  +
=>, .
new/ 2
Vector23 :
(: ;
$num; ?
,? @
$numA E
)E F
;F G
public  
Dialog_ExtractAmount #
(# $
StoredItemData$ 2
item3 7
,7 8!
Dialog_VirtualStorage9 N
parentDialogO [
)[ \
{ 	
this 
. 
item 
= 
item 
; 
this 
. 
parentDialog 
= 
parentDialog  ,
;, -
this 
. 
	maxAmount 
= 
Mathf "
." #
Min# &
(& '
item' +
.+ ,

stackCount, 6
,6 7
item8 <
.< =
def= @
?@ A
.A B

stackLimitB L
??M O
$numP Q
)Q R
;R S
this 
. 
amountBuffer 
= 
this  $
.$ %
	maxAmount% .
.. /
ToString/ 7
(7 8
)8 9
;9 :
this 
. 
doCloseButton 
=  
false! &
;& '
this 
. 
doCloseX 
= 
true  
;  !
this 
. 

forcePause 
= 
true "
;" #
this 
. #
absorbInputAroundWindow (
=) *
true+ /
;/ 0
} 	
public!! 
override!! 
void!! 
DoWindowContents!! -
(!!- .
Rect!!. 2
inRect!!3 9
)!!9 :
{"" 	
Text## 
.## 
Font## 
=## 
GameFont##  
.##  !
Small##! &
;##& '
float%% 
curY%% 
=%% 
$num%% 
;%% 
Rect'' 
	titleRect'' 
='' 
new''  
Rect''! %
(''% &
$num''& (
,''( )
curY''* .
,''. /
inRect''0 6
.''6 7
width''7 <
,''< =
$num''> A
)''A B
;''B C
Text(( 
.(( 
Font(( 
=(( 
GameFont((  
.((  !
Medium((! '
;((' (
Widgets)) 
.)) 
Label)) 
()) 
	titleRect)) #
,))# $
$str))% +
)))+ ,
;)), -
Text** 
.** 
Font** 
=** 
GameFont**  
.**  !
Small**! &
;**& '
curY++ 
+=++ 
$num++ 
;++ 
Rect-- 
itemLabelRect-- 
=--  
new--! $
Rect--% )
(--) *
$num--* ,
,--, -
curY--. 2
,--2 3
inRect--4 :
.--: ;
width--; @
,--@ A
$num--B E
)--E F
;--F G
string.. 
	itemLabel.. 
=.. 
GetItemLabel.. +
(..+ ,
).., -
;..- .
Widgets// 
.// 
Label// 
(// 
itemLabelRect// '
,//' (
$"//) +
$str//+ /
{/// 0
	itemLabel//0 9
}//9 :
"//: ;
)//; <
;//< =
curY00 
+=00 
$num00 
;00 
Rect22 
availableRect22 
=22  
new22! $
Rect22% )
(22) *
$num22* ,
,22, -
curY22. 2
,222 3
inRect224 :
.22: ;
width22; @
,22@ A
$num22B E
)22E F
;22F G
Widgets33 
.33 
Label33 
(33 
availableRect33 '
,33' (
$"33) +
$str33+ /
{33/ 0
item330 4
.334 5

stackCount335 ?
}33? @
$str33@ I
{33I J
item33J N
.33N O
def33O R
?33R S
.33S T

stackLimit33T ^
??33_ a
$num33b c
}33c d
$str33d e
"33e f
)33f g
;33g h
curY44 
+=44 
$num44 
;44 
Rect66 
	inputRect66 
=66 
new66  
Rect66! %
(66% &
$num66& (
,66( )
curY66* .
,66. /
inRect660 6
.666 7
width667 <
-66= >
$num66? B
,66B C
$num66D G
)66G H
;66H I
amountBuffer77 
=77 
Widgets77 "
.77" #
	TextField77# ,
(77, -
	inputRect77- 6
,776 7
amountBuffer778 D
)77D E
;77E F
curY88 
+=88 
$num88 
;88 
float:: 
buttonWidth:: 
=:: 
(::  !
inRect::! '
.::' (
width::( -
-::. /
$num::0 3
)::3 4
/::5 6
$num::7 9
;::9 :
Rect<< 
confirmRect<< 
=<< 
new<< "
Rect<<# '
(<<' (
$num<<( *
,<<* +
curY<<, 0
,<<0 1
buttonWidth<<2 =
,<<= >
$num<<? B
)<<B C
;<<C D
if== 
(== 
Widgets== 
.== 

ButtonText== "
(==" #
confirmRect==# .
,==. /
$str==0 4
)==4 5
)==5 6
{>> 

TryExtract?? 
(?? 
)?? 
;?? 
}@@ 
RectBB 

cancelRectBB 
=BB 
newBB !
RectBB" &
(BB& '
buttonWidthBB' 2
+BB3 4
$numBB5 8
,BB8 9
curYBB: >
,BB> ?
buttonWidthBB@ K
,BBK L
$numBBM P
)BBP Q
;BBQ R
ifCC 
(CC 
WidgetsCC 
.CC 

ButtonTextCC "
(CC" #

cancelRectCC# -
,CC- .
$strCC/ 3
)CC3 4
)CC4 5
{DD 
CloseEE 
(EE 
)EE 
;EE 
}FF 
}GG 	
privateII 
voidII 

TryExtractII 
(II  
)II  !
{JJ 	
ifKK 
(KK 
!KK 
intKK 
.KK 
TryParseKK 
(KK 
amountBufferKK *
,KK* +
outKK, /
intKK0 3
amountKK4 :
)KK: ;
)KK; <
{LL 
MessagesMM 
.MM 
MessageMM  
(MM  !
$strMM! +
,MM+ ,
MessageTypeDefOfMM- =
.MM= >
RejectInputMM> I
)MMI J
;MMJ K
returnNN 
;NN 
}OO 
ifQQ 
(QQ 
amountQQ 
<=QQ 
$numQQ 
)QQ 
{RR 
MessagesSS 
.SS 
MessageSS  
(SS  !
$strSS! +
,SS+ ,
MessageTypeDefOfSS- =
.SS= >
RejectInputSS> I
)SSI J
;SSJ K
returnTT 
;TT 
}UU 
ifWW 
(WW 
amountWW 
>WW 
	maxAmountWW "
)WW" #
{XX 
MessagesYY 
.YY 
MessageYY  
(YY  !
$"YY! #
$strYY# *
{YY* +
	maxAmountYY+ 4
}YY4 5
"YY5 6
,YY6 7
MessageTypeDefOfYY8 H
.YYH I
RejectInputYYI T
)YYT U
;YYU V
returnZZ 
;ZZ 
}[[ 
if]] 
(]] 
parentDialog]] 
!=]] 
null]]  $
)]]$ %
{^^ 
parentDialog__ 
.__ 
ExtractItemPublic__ .
(__. /
item__/ 3
,__3 4
amount__5 ;
)__; <
;__< =
}`` 
Closebb 
(bb 
)bb 
;bb 
}cc 	
privateee 
stringee 
GetItemLabelee #
(ee# $
)ee$ %
{ff 	
ifgg 
(gg 
itemgg 
.gg 
defgg 
==gg 
nullgg  
)gg  !
{hh 
returnii 
$strii 
;ii 
}jj 
stringll 
labelll 
=ll 
itemll 
.ll  
defll  #
.ll# $
labelll$ )
;ll) *
ifmm 
(mm 
itemmm 
.mm 
stuffDefmm 
!=mm  
nullmm! %
)mm% &
{nn 
labeloo 
=oo 
itemoo 
.oo 
stuffDefoo %
.oo% &
labeloo& +
+oo, -
labeloo. 3
;oo3 4
}pp 
returnrr 
labelrr 
.rr 
CapitalizeFirstrr (
(rr( )
)rr) *
;rr* +
}ss 	
}tt 
}uu ⁄Ã
WB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\UI\Dialog_VirtualStorage.cs
	namespace		 	
DigitalStorage		
 
.		 
UI		 
{

 
public 

class !
Dialog_VirtualStorage &
:' (
Window) /
{ 
private  
Building_StorageCore $
core% )
;) *
private 
string 

searchText !
=" #
$str$ &
;& '
private 
Vector2 
scrollPosition &
=' (
Vector2) 0
.0 1
zero1 5
;5 6
private 
List 
< 
StoredItemData #
># $
filteredItems% 2
=3 4
new5 8
List9 =
<= >
StoredItemData> L
>L M
(M N
)N O
;O P
private 
const 
float 
	RowHeight %
=& '
$num( +
;+ ,
private 
const 
float 
SearchBarHeight +
=, -
$num. 1
;1 2
private 
const 
float 
HeaderHeight (
=) *
$num+ .
;. /
private 
const 
float 
ButtonWidth '
=( )
$num* .
;. /
private 
const 
float 
IconSize $
=% &
$num' *
;* +
public 
override 
Vector2 
InitialSize  +
=>, .
new/ 2
Vector23 :
(: ;
$num; @
,@ A
$numB F
)F G
;G H
public !
Dialog_VirtualStorage $
($ % 
Building_StorageCore% 9
core: >
)> ?
{ 	
this 
. 
core 
= 
core 
; 
this   
.   
doCloseButton   
=    
true  ! %
;  % &
this!! 
.!! 
doCloseX!! 
=!! 
true!!  
;!!  !
this"" 
."" 

forcePause"" 
="" 
false"" #
;""# $
this## 
.## #
absorbInputAroundWindow## (
=##) *
true##+ /
;##/ 0
UpdateFilteredItems$$ 
($$  
)$$  !
;$$! "
}%% 	
public'' 
override'' 
void'' 
DoWindowContents'' -
(''- .
Rect''. 2
inRect''3 9
)''9 :
{(( 	
Text)) 
.)) 
Font)) 
=)) 
GameFont))  
.))  !
Small))! &
;))& '
float++ 
curY++ 
=++ 
$num++ 
;++ 
Rect.. 
	titleRect.. 
=.. 
new..  
Rect..! %
(..% &
$num..& (
,..( )
curY..* .
,... /
inRect..0 6
...6 7
width..7 <
,..< =
HeaderHeight..> J
)..J K
;..K L
Text// 
.// 
Font// 
=// 
GameFont//  
.//  !
Medium//! '
;//' (
Widgets00 
.00 
Label00 
(00 
	titleRect00 #
,00# $
$"00% '
$str00' .
{00. /
core00/ 3
.003 4
NetworkName004 ?
}00? @
"00@ A
)00A B
;00B C
Text11 
.11 
Font11 
=11 
GameFont11  
.11  !
Small11! &
;11& '
curY22 
+=22 
HeaderHeight22  
;22  !
Rect55 
capacityRect55 
=55 
new55  #
Rect55$ (
(55( )
$num55) +
,55+ ,
curY55- 1
,551 2
inRect553 9
.559 :
width55: ?
,55? @
$num55A D
)55D E
;55E F
string66 
capacityText66 
=66  !
$"66" $
$str66$ (
{66( )
core66) -
.66- .
GetUsedCapacity66. =
(66= >
)66> ?
}66? @
$str66@ C
{66C D
core66D H
.66H I
GetCapacity66I T
(66T U
)66U V
}66V W
$str66W b
{66b c
filteredItems66c p
.66p q
Count66q v
}66v w
"66w x
;66x y
Widgets77 
.77 
Label77 
(77 
capacityRect77 &
,77& '
capacityText77( 4
)774 5
;775 6
curY88 
+=88 
$num88 
;88 
Rect;; 

searchRect;; 
=;; 
new;; !
Rect;;" &
(;;& '
$num;;' )
,;;) *
curY;;+ /
,;;/ 0
inRect;;1 7
.;;7 8
width;;8 =
-;;> ?
$num;;@ D
,;;D E
SearchBarHeight;;F U
);;U V
;;;V W
string<< 
newSearchText<<  
=<<! "
Widgets<<# *
.<<* +
	TextField<<+ 4
(<<4 5

searchRect<<5 ?
,<<? @

searchText<<A K
)<<K L
;<<L M
if== 
(== 
newSearchText== 
!===  

searchText==! +
)==+ ,
{>> 

searchText?? 
=?? 
newSearchText?? *
;??* +
UpdateFilteredItems@@ #
(@@# $
)@@$ %
;@@% &
}AA 
RectDD 
clearButtonRectDD  
=DD! "
newDD# &
RectDD' +
(DD+ ,
inRectDD, 2
.DD2 3
widthDD3 8
-DD9 :
$numDD; >
,DD> ?
curYDD@ D
,DDD E
$numDDF I
,DDI J
SearchBarHeightDDK Z
)DDZ [
;DD[ \
ifEE 
(EE 
WidgetsEE 
.EE 

ButtonTextEE "
(EE" #
clearButtonRectEE# 2
,EE2 3
$strEE4 8
)EE8 9
)EE9 :
{FF 

searchTextGG 
=GG 
$strGG 
;GG  
UpdateFilteredItemsHH #
(HH# $
)HH$ %
;HH% &
}II 
curYJJ 
+=JJ 
SearchBarHeightJJ #
+JJ$ %
$numJJ& )
;JJ) *
RectMM 

headerRectMM 
=MM 
newMM !
RectMM" &
(MM& '
$numMM' )
,MM) *
curYMM+ /
,MM/ 0
inRectMM1 7
.MM7 8
widthMM8 =
,MM= >
$numMM? B
)MMB C
;MMC D
DrawListHeaderNN 
(NN 

headerRectNN %
)NN% &
;NN& '
curYOO 
+=OO 
$numOO 
;OO 
RectRR 
scrollViewRectRR 
=RR  !
newRR" %
RectRR& *
(RR* +
$numRR+ -
,RR- .
curYRR/ 3
,RR3 4
inRectRR5 ;
.RR; <
widthRR< A
,RRA B
inRectRRC I
.RRI J
heightRRJ P
-RRQ R
curYRRS W
-RRX Y
$numRRZ ]
)RR] ^
;RR^ _
RectSS 
scrollContentRectSS "
=SS# $
newSS% (
RectSS) -
(SS- .
$numSS. 0
,SS0 1
$numSS2 4
,SS4 5
scrollViewRectSS6 D
.SSD E
widthSSE J
-SSK L
$numSSM P
,SSP Q
filteredItemsSSR _
.SS_ `
CountSS` e
*SSf g
	RowHeightSSh q
)SSq r
;SSr s
WidgetsUU 
.UU 
BeginScrollViewUU #
(UU# $
scrollViewRectUU$ 2
,UU2 3
refUU4 7
scrollPositionUU8 F
,UUF G
scrollContentRectUUH Y
)UUY Z
;UUZ [
floatWW 
itemYWW 
=WW 
$numWW 
;WW 
forXX 
(XX 
intXX 
iXX 
=XX 
$numXX 
;XX 
iXX 
<XX 
filteredItemsXX  -
.XX- .
CountXX. 3
;XX3 4
iXX5 6
++XX6 8
)XX8 9
{YY 
StoredItemDataZZ 
itemZZ #
=ZZ$ %
filteredItemsZZ& 3
[ZZ3 4
iZZ4 5
]ZZ5 6
;ZZ6 7
Rect[[ 
rowRect[[ 
=[[ 
new[[ "
Rect[[# '
([[' (
$num[[( *
,[[* +
itemY[[, 1
,[[1 2
scrollContentRect[[3 D
.[[D E
width[[E J
,[[J K
	RowHeight[[L U
)[[U V
;[[V W
DrawItemRow\\ 
(\\ 
rowRect\\ #
,\\# $
item\\% )
,\\) *
i\\+ ,
)\\, -
;\\- .
itemY]] 
+=]] 
	RowHeight]] "
;]]" #
}^^ 
Widgets`` 
.`` 
EndScrollView`` !
(``! "
)``" #
;``# $
}aa 	
privatecc 
voidcc 
DrawListHeadercc #
(cc# $
Rectcc$ (
rectcc) -
)cc- .
{dd 	
GUIee 
.ee 
coloree 
=ee 
newee 
Coloree !
(ee! "
$numee" &
,ee& '
$numee( ,
,ee, -
$numee. 2
,ee2 3
$numee4 6
)ee6 7
;ee7 8
Widgetsff 
.ff 
DrawLineHorizontalff &
(ff& '
rectff' +
.ff+ ,
xff, -
,ff- .
rectff/ 3
.ff3 4
yff4 5
,ff5 6
rectff7 ;
.ff; <
widthff< A
)ffA B
;ffB C
Widgetsgg 
.gg 
DrawLineHorizontalgg &
(gg& '
rectgg' +
.gg+ ,
xgg, -
,gg- .
rectgg/ 3
.gg3 4
yMaxgg4 8
,gg8 9
rectgg: >
.gg> ?
widthgg? D
)ggD E
;ggE F
GUIhh 
.hh 
colorhh 
=hh 
Colorhh 
.hh 
whitehh #
;hh# $
Textjj 
.jj 
Anchorjj 
=jj 

TextAnchorjj $
.jj$ %

MiddleLeftjj% /
;jj/ 0
Rectll 
iconRectll 
=ll 
newll 
Rectll  $
(ll$ %
rectll% )
.ll) *
xll* +
+ll, -
$numll. 0
,ll0 1
rectll2 6
.ll6 7
yll7 8
,ll8 9
$numll: =
,ll= >
rectll? C
.llC D
heightllD J
)llJ K
;llK L
Widgetsmm 
.mm 
Labelmm 
(mm 
iconRectmm "
,mm" #
$strmm$ (
)mm( )
;mm) *
Rectoo 
nameRectoo 
=oo 
newoo 
Rectoo  $
(oo$ %
rectoo% )
.oo) *
xoo* +
+oo, -
$numoo. 1
,oo1 2
rectoo3 7
.oo7 8
yoo8 9
,oo9 :
$numoo; ?
,oo? @
rectooA E
.ooE F
heightooF L
)ooL M
;ooM N
Widgetspp 
.pp 
Labelpp 
(pp 
nameRectpp "
,pp" #
$strpp$ (
)pp( )
;pp) *
Rectrr 
qualityRectrr 
=rr 
newrr "
Rectrr# '
(rr' (
rectrr( ,
.rr, -
xrr- .
+rr/ 0
$numrr1 5
,rr5 6
rectrr7 ;
.rr; <
yrr< =
,rr= >
$numrr? C
,rrC D
rectrrE I
.rrI J
heightrrJ P
)rrP Q
;rrQ R
Widgetsss 
.ss 
Labelss 
(ss 
qualityRectss %
,ss% &
$strss' +
)ss+ ,
;ss, -
Rectuu 
	countRectuu 
=uu 
newuu  
Rectuu! %
(uu% &
rectuu& *
.uu* +
xuu+ ,
+uu- .
$numuu/ 3
,uu3 4
rectuu5 9
.uu9 :
yuu: ;
,uu; <
$numuu= A
,uuA B
rectuuC G
.uuG H
heightuuH N
)uuN O
;uuO P
Widgetsvv 
.vv 
Labelvv 
(vv 
	countRectvv #
,vv# $
$strvv% )
)vv) *
;vv* +
Rectxx 
hpRectxx 
=xx 
newxx 
Rectxx "
(xx" #
rectxx# '
.xx' (
xxx( )
+xx* +
$numxx, 0
,xx0 1
rectxx2 6
.xx6 7
yxx7 8
,xx8 9
$numxx: =
,xx= >
rectxx? C
.xxC D
heightxxD J
)xxJ K
;xxK L
Widgetsyy 
.yy 
Labelyy 
(yy 
hpRectyy  
,yy  !
$stryy" &
)yy& '
;yy' (
Text{{ 
.{{ 
Anchor{{ 
={{ 

TextAnchor{{ $
.{{$ %
	UpperLeft{{% .
;{{. /
}|| 	
private~~ 
void~~ 
DrawItemRow~~  
(~~  !
Rect~~! %
rect~~& *
,~~* +
StoredItemData~~, :
item~~; ?
,~~? @
int~~A D
index~~E J
)~~J K
{ 	
if
ÄÄ 
(
ÄÄ 
index
ÄÄ 
%
ÄÄ 
$num
ÄÄ 
==
ÄÄ 
$num
ÄÄ 
)
ÄÄ 
{
ÅÅ 
Widgets
ÇÇ 
.
ÇÇ  
DrawLightHighlight
ÇÇ *
(
ÇÇ* +
rect
ÇÇ+ /
)
ÇÇ/ 0
;
ÇÇ0 1
}
ÉÉ 
if
ÖÖ 
(
ÖÖ 
Mouse
ÖÖ 
.
ÖÖ 
IsOver
ÖÖ 
(
ÖÖ 
rect
ÖÖ !
)
ÖÖ! "
)
ÖÖ" #
{
ÜÜ 
Widgets
áá 
.
áá 
DrawHighlight
áá %
(
áá% &
rect
áá& *
)
áá* +
;
áá+ ,
}
àà 
Rect
ää 
iconRect
ää 
=
ää 
new
ää 
Rect
ää  $
(
ää$ %
rect
ää% )
.
ää) *
x
ää* +
+
ää, -
$num
ää. 0
,
ää0 1
rect
ää2 6
.
ää6 7
y
ää7 8
+
ää9 :
(
ää; <
rect
ää< @
.
ää@ A
height
ääA G
-
ääH I
IconSize
ääJ R
)
ääR S
/
ääT U
$num
ääV X
,
ääX Y
IconSize
ääZ b
,
ääb c
IconSize
ääd l
)
ääl m
;
ääm n
if
ãã 
(
ãã 
item
ãã 
.
ãã 
def
ãã 
!=
ãã 
null
ãã  
)
ãã  !
{
åå 
Widgets
çç 
.
çç 
	ThingIcon
çç !
(
çç! "
iconRect
çç" *
,
çç* +
item
çç, 0
.
çç0 1
def
çç1 4
,
çç4 5
item
çç6 :
.
çç: ;
stuffDef
çç; C
)
ççC D
;
ççD E
if
èè 
(
èè 
Mouse
èè 
.
èè 
IsOver
èè  
(
èè  !
iconRect
èè! )
)
èè) *
)
èè* +
{
êê 
TooltipHandler
ëë "
.
ëë" #
	TipRegion
ëë# ,
(
ëë, -
iconRect
ëë- 5
,
ëë5 6
GetItemTooltip
ëë7 E
(
ëëE F
item
ëëF J
)
ëëJ K
)
ëëK L
;
ëëL M
}
íí 
}
ìì 
Text
ïï 
.
ïï 
Anchor
ïï 
=
ïï 

TextAnchor
ïï $
.
ïï$ %

MiddleLeft
ïï% /
;
ïï/ 0
Rect
óó 
nameRect
óó 
=
óó 
new
óó 
Rect
óó  $
(
óó$ %
rect
óó% )
.
óó) *
x
óó* +
+
óó, -
$num
óó. 1
,
óó1 2
rect
óó3 7
.
óó7 8
y
óó8 9
,
óó9 :
$num
óó; ?
,
óó? @
rect
óóA E
.
óóE F
height
óóF L
)
óóL M
;
óóM N
string
òò 
label
òò 
=
òò 
GetItemLabel
òò '
(
òò' (
item
òò( ,
)
òò, -
;
òò- .
Widgets
ôô 
.
ôô 
Label
ôô 
(
ôô 
nameRect
ôô "
,
ôô" #
label
ôô$ )
)
ôô) *
;
ôô* +
Rect
õõ 
qualityRect
õõ 
=
õõ 
new
õõ "
Rect
õõ# '
(
õõ' (
rect
õõ( ,
.
õõ, -
x
õõ- .
+
õõ/ 0
$num
õõ1 5
,
õõ5 6
rect
õõ7 ;
.
õõ; <
y
õõ< =
,
õõ= >
$num
õõ? C
,
õõC D
rect
õõE I
.
õõI J
height
õõJ P
)
õõP Q
;
õõQ R
if
úú 
(
úú 
item
úú 
.
úú 
quality
úú 
!=
úú 
QualityCategory
úú  /
.
úú/ 0
Normal
úú0 6
)
úú6 7
{
ùù 
GUI
ûû 
.
ûû 
color
ûû 
=
ûû 
GetQualityColor
ûû +
(
ûû+ ,
item
ûû, 0
.
ûû0 1
quality
ûû1 8
)
ûû8 9
;
ûû9 :
Widgets
üü 
.
üü 
Label
üü 
(
üü 
qualityRect
üü )
,
üü) *
item
üü+ /
.
üü/ 0
quality
üü0 7
.
üü7 8
GetLabel
üü8 @
(
üü@ A
)
üüA B
)
üüB C
;
üüC D
GUI
†† 
.
†† 
color
†† 
=
†† 
Color
†† !
.
††! "
white
††" '
;
††' (
}
°° 
Rect
££ 
	countRect
££ 
=
££ 
new
££  
Rect
££! %
(
££% &
rect
££& *
.
££* +
x
££+ ,
+
££- .
$num
££/ 3
,
££3 4
rect
££5 9
.
££9 :
y
££: ;
,
££; <
$num
££= A
,
££A B
rect
££C G
.
££G H
height
££H N
)
££N O
;
££O P
Widgets
§§ 
.
§§ 
Label
§§ 
(
§§ 
	countRect
§§ #
,
§§# $
item
§§% )
.
§§) *

stackCount
§§* 4
.
§§4 5
ToString
§§5 =
(
§§= >
)
§§> ?
)
§§? @
;
§§@ A
Rect
¶¶ 
hpRect
¶¶ 
=
¶¶ 
new
¶¶ 
Rect
¶¶ "
(
¶¶" #
rect
¶¶# '
.
¶¶' (
x
¶¶( )
+
¶¶* +
$num
¶¶, 0
,
¶¶0 1
rect
¶¶2 6
.
¶¶6 7
y
¶¶7 8
,
¶¶8 9
$num
¶¶: =
,
¶¶= >
rect
¶¶? C
.
¶¶C D
height
¶¶D J
)
¶¶J K
;
¶¶K L
if
ßß 
(
ßß 
item
ßß 
.
ßß 
	hitPoints
ßß 
>
ßß  
$num
ßß! "
&&
ßß# %
item
ßß& *
.
ßß* +
def
ßß+ .
!=
ßß/ 1
null
ßß2 6
)
ßß6 7
{
®® 
float
©© 
	hpPercent
©© 
=
©©  !
(
©©" #
float
©©# (
)
©©( )
item
©©) -
.
©©- .
	hitPoints
©©. 7
/
©©8 9
item
©©: >
.
©©> ?
def
©©? B
.
©©B C
BaseMaxHitPoints
©©C S
;
©©S T
string
™™ 
hpText
™™ 
=
™™ 
$"
™™  "
{
™™" #
Mathf
™™# (
.
™™( )

RoundToInt
™™) 3
(
™™3 4
	hpPercent
™™4 =
*
™™> ?
$num
™™@ C
)
™™C D
}
™™D E
$str
™™E F
"
™™F G
;
™™G H
if
¨¨ 
(
¨¨ 
	hpPercent
¨¨ 
<
¨¨ 
$num
¨¨  $
)
¨¨$ %
{
≠≠ 
GUI
ÆÆ 
.
ÆÆ 
color
ÆÆ 
=
ÆÆ 
Color
ÆÆ  %
.
ÆÆ% &
yellow
ÆÆ& ,
;
ÆÆ, -
}
ØØ 
if
∞∞ 
(
∞∞ 
	hpPercent
∞∞ 
<
∞∞ 
$num
∞∞  %
)
∞∞% &
{
±± 
GUI
≤≤ 
.
≤≤ 
color
≤≤ 
=
≤≤ 
Color
≤≤  %
.
≤≤% &
red
≤≤& )
;
≤≤) *
}
≥≥ 
Widgets
µµ 
.
µµ 
Label
µµ 
(
µµ 
hpRect
µµ $
,
µµ$ %
hpText
µµ& ,
)
µµ, -
;
µµ- .
GUI
∂∂ 
.
∂∂ 
color
∂∂ 
=
∂∂ 
Color
∂∂ !
.
∂∂! "
white
∂∂" '
;
∂∂' (
}
∑∑ 
Text
ππ 
.
ππ 
Anchor
ππ 
=
ππ 

TextAnchor
ππ $
.
ππ$ %
	UpperLeft
ππ% .
;
ππ. / 
DrawExtractButtons
ªª 
(
ªª 
rect
ªª #
,
ªª# $
item
ªª% )
)
ªª) *
;
ªª* +
}
ºº 	
private
ææ 
void
ææ  
DrawExtractButtons
ææ '
(
ææ' (
Rect
ææ( ,
rect
ææ- 1
,
ææ1 2
StoredItemData
ææ3 A
item
ææB F
)
ææF G
{
øø 	
float
¿¿ 
buttonX
¿¿ 
=
¿¿ 
rect
¿¿  
.
¿¿  !
xMax
¿¿! %
-
¿¿& '
ButtonWidth
¿¿( 3
*
¿¿4 5
$num
¿¿6 7
-
¿¿8 9
$num
¿¿: =
;
¿¿= >
Rect
¬¬ 
extract1Rect
¬¬ 
=
¬¬ 
new
¬¬  #
Rect
¬¬$ (
(
¬¬( )
buttonX
¬¬) 0
,
¬¬0 1
rect
¬¬2 6
.
¬¬6 7
y
¬¬7 8
+
¬¬9 :
$num
¬¬; =
,
¬¬= >
ButtonWidth
¬¬? J
-
¬¬K L
$num
¬¬M O
,
¬¬O P
rect
¬¬Q U
.
¬¬U V
height
¬¬V \
-
¬¬] ^
$num
¬¬_ b
)
¬¬b c
;
¬¬c d
if
√√ 
(
√√ 
Widgets
√√ 
.
√√ 

ButtonText
√√ "
(
√√" #
extract1Rect
√√# /
,
√√/ 0
$str
√√1 8
)
√√8 9
)
√√9 :
{
ƒƒ 
ExtractItem
≈≈ 
(
≈≈ 
item
≈≈  
,
≈≈  !
$num
≈≈" #
)
≈≈# $
;
≈≈$ %
}
∆∆ 
buttonX
»» 
+=
»» 
ButtonWidth
»» "
;
»»" #
Rect
…… 
extractStackRect
…… !
=
……" #
new
……$ '
Rect
……( ,
(
……, -
buttonX
……- 4
,
……4 5
rect
……6 :
.
……: ;
y
……; <
+
……= >
$num
……? A
,
……A B
ButtonWidth
……C N
-
……O P
$num
……Q S
,
……S T
rect
……U Y
.
……Y Z
height
……Z `
-
……a b
$num
……c f
)
……f g
;
……g h
int
   

stackLimit
   
=
   
item
   !
.
  ! "
def
  " %
?
  % &
.
  & '

stackLimit
  ' 1
??
  2 4
$num
  5 6
;
  6 7
string
ÀÀ 

stackLabel
ÀÀ 
=
ÀÀ 
$"
ÀÀ  "
$str
ÀÀ" &
"
ÀÀ& '
;
ÀÀ' (
if
ÕÕ 
(
ÕÕ 
item
ÕÕ 
.
ÕÕ 

stackCount
ÕÕ 
>=
ÕÕ  "

stackLimit
ÕÕ# -
)
ÕÕ- .
{
ŒŒ 
if
œœ 
(
œœ 
Widgets
œœ 
.
œœ 

ButtonText
œœ &
(
œœ& '
extractStackRect
œœ' 7
,
œœ7 8

stackLabel
œœ9 C
)
œœC D
)
œœD E
{
–– 
ExtractItem
—— 
(
——  
item
——  $
,
——$ %

stackLimit
——& 0
)
——0 1
;
——1 2
}
““ 
}
”” 
else
‘‘ 
{
’’ 
GUI
÷÷ 
.
÷÷ 
color
÷÷ 
=
÷÷ 
Color
÷÷ !
.
÷÷! "
gray
÷÷" &
;
÷÷& '
Widgets
◊◊ 
.
◊◊ 

ButtonText
◊◊ "
(
◊◊" #
extractStackRect
◊◊# 3
,
◊◊3 4

stackLabel
◊◊5 ?
)
◊◊? @
;
◊◊@ A
GUI
ÿÿ 
.
ÿÿ 
color
ÿÿ 
=
ÿÿ 
Color
ÿÿ !
.
ÿÿ! "
white
ÿÿ" '
;
ÿÿ' (
}
ŸŸ 
buttonX
€€ 
+=
€€ 
ButtonWidth
€€ "
;
€€" #
Rect
‹‹ 
extractCustomRect
‹‹ "
=
‹‹# $
new
‹‹% (
Rect
‹‹) -
(
‹‹- .
buttonX
‹‹. 5
,
‹‹5 6
rect
‹‹7 ;
.
‹‹; <
y
‹‹< =
+
‹‹> ?
$num
‹‹@ B
,
‹‹B C
ButtonWidth
‹‹D O
-
‹‹P Q
$num
‹‹R T
,
‹‹T U
rect
‹‹V Z
.
‹‹Z [
height
‹‹[ a
-
‹‹b c
$num
‹‹d g
)
‹‹g h
;
‹‹h i
if
›› 
(
›› 
Widgets
›› 
.
›› 

ButtonText
›› "
(
››" #
extractCustomRect
››# 4
,
››4 5
$str
››6 ;
)
››; <
)
››< =
{
ﬁﬁ 
Find
ﬂﬂ 
.
ﬂﬂ 
WindowStack
ﬂﬂ  
.
ﬂﬂ  !
Add
ﬂﬂ! $
(
ﬂﬂ$ %
new
ﬂﬂ% ("
Dialog_ExtractAmount
ﬂﬂ) =
(
ﬂﬂ= >
item
ﬂﬂ> B
,
ﬂﬂB C
this
ﬂﬂD H
)
ﬂﬂH I
)
ﬂﬂI J
;
ﬂﬂJ K
}
‡‡ 
}
·· 	
public
„„ 
void
„„ 
ExtractItemPublic
„„ %
(
„„% &
StoredItemData
„„& 4
item
„„5 9
,
„„9 :
int
„„; >
count
„„? D
)
„„D E
{
‰‰ 	
ExtractItem
ÂÂ 
(
ÂÂ 
item
ÂÂ 
,
ÂÂ 
count
ÂÂ #
)
ÂÂ# $
;
ÂÂ$ %
}
ÊÊ 	
private
ËË 
void
ËË 
ExtractItem
ËË  
(
ËË  !
StoredItemData
ËË! /
item
ËË0 4
,
ËË4 5
int
ËË6 9
count
ËË: ?
)
ËË? @
{
ÈÈ 	
if
ÍÍ 
(
ÍÍ 
core
ÍÍ 
==
ÍÍ 
null
ÍÍ 
||
ÍÍ 
!
ÍÍ  !
core
ÍÍ! %
.
ÍÍ% &
Spawned
ÍÍ& -
||
ÍÍ. 0
item
ÍÍ1 5
==
ÍÍ6 8
null
ÍÍ9 =
)
ÍÍ= >
{
ÎÎ 
Messages
ÏÏ 
.
ÏÏ 
Message
ÏÏ  
(
ÏÏ  !
$str
ÏÏ! (
,
ÏÏ( )
MessageTypeDefOf
ÏÏ* :
.
ÏÏ: ;
RejectInput
ÏÏ; F
)
ÏÏF G
;
ÏÏG H
return
ÌÌ 
;
ÌÌ 
}
ÓÓ 
int
 
actualCount
 
=
 
Mathf
 #
.
# $
Min
$ '
(
' (
count
( -
,
- .
item
/ 3
.
3 4

stackCount
4 >
)
> ?
;
? @
int
ÒÒ 

stackLimit
ÒÒ 
=
ÒÒ 
item
ÒÒ !
.
ÒÒ! "
def
ÒÒ" %
.
ÒÒ% &

stackLimit
ÒÒ& 0
;
ÒÒ0 1
int
ÚÚ 
totalExtracted
ÚÚ 
=
ÚÚ  
$num
ÚÚ! "
;
ÚÚ" #
while
ÙÙ 
(
ÙÙ 
actualCount
ÙÙ 
>
ÙÙ  
$num
ÙÙ! "
)
ÙÙ" #
{
ıı 
int
ˆˆ 

batchCount
ˆˆ 
=
ˆˆ  
Mathf
ˆˆ! &
.
ˆˆ& '
Min
ˆˆ' *
(
ˆˆ* +
actualCount
ˆˆ+ 6
,
ˆˆ6 7

stackLimit
ˆˆ8 B
)
ˆˆB C
;
ˆˆC D
Thing
˜˜ 
extractedThing
˜˜ $
=
˜˜% &
core
˜˜' +
.
˜˜+ ,
ExtractItem
˜˜, 7
(
˜˜7 8
item
˜˜8 <
.
˜˜< =
def
˜˜= @
,
˜˜@ A

batchCount
˜˜B L
,
˜˜L M
item
˜˜N R
.
˜˜R S
stuffDef
˜˜S [
)
˜˜[ \
;
˜˜\ ]
if
˘˘ 
(
˘˘ 
extractedThing
˘˘ "
==
˘˘# %
null
˘˘& *
)
˘˘* +
{
˙˙ 
break
˚˚ 
;
˚˚ 
}
¸¸ 
IntVec3
ˇˇ 
spawnPos
ˇˇ  
=
ˇˇ! "#
FindSpawnPositionNear
ˇˇ# 8
(
ˇˇ8 9
core
ˇˇ9 =
.
ˇˇ= >
Position
ˇˇ> F
,
ˇˇF G
core
ˇˇH L
.
ˇˇL M
Map
ˇˇM P
,
ˇˇP Q
$num
ˇˇR S
)
ˇˇS T
;
ˇˇT U
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 
spawnPos
ÄÄ 
.
ÄÄ 
IsValid
ÄÄ %
)
ÄÄ% &
{
ÅÅ 
core
ÇÇ 
.
ÇÇ 
	StoreItem
ÇÇ "
(
ÇÇ" #
extractedThing
ÇÇ# 1
)
ÇÇ1 2
;
ÇÇ2 3
Messages
ÉÉ 
.
ÉÉ 
Message
ÉÉ $
(
ÉÉ$ %
$str
ÉÉ% /
,
ÉÉ/ 0
MessageTypeDefOf
ÉÉ1 A
.
ÉÉA B
RejectInput
ÉÉB M
)
ÉÉM N
;
ÉÉN O
break
ÑÑ 
;
ÑÑ 
}
ÖÖ 
Thing
áá 
spawnedThing
áá "
=
áá# $
GenSpawn
áá% -
.
áá- .
Spawn
áá. 3
(
áá3 4
extractedThing
áá4 B
,
ááB C
spawnPos
ááD L
,
ááL M
core
ááN R
.
ááR S
Map
ááS V
)
ááV W
;
ááW X

FleckMaker
àà 
.
àà  
ThrowLightningGlow
àà -
(
àà- .
spawnedThing
àà. :
.
àà: ;
DrawPos
àà; B
,
ààB C
core
ààD H
.
ààH I
Map
ààI L
,
ààL M
$num
ààN R
)
ààR S
;
ààS T
totalExtracted
ää 
+=
ää !

batchCount
ää" ,
;
ää, -
actualCount
ãã 
-=
ãã 

batchCount
ãã )
;
ãã) *
}
åå 
if
éé 
(
éé 
totalExtracted
éé 
>
éé  
$num
éé! "
)
éé" #
{
èè 
Messages
êê 
.
êê 
Message
êê  
(
êê  !
$"
êê! #
$str
êê# '
{
êê' (
GetItemLabel
êê( 4
(
êê4 5
item
êê5 9
)
êê9 :
}
êê: ;
$str
êê; =
{
êê= >
totalExtracted
êê> L
}
êêL M
"
êêM N
,
êêN O
MessageTypeDefOf
êêP `
.
êê` a
TaskCompletion
êêa o
)
êêo p
;
êêp q!
UpdateFilteredItems
ëë #
(
ëë# $
)
ëë$ %
;
ëë% &
}
íí 
else
ìì 
{
îî 
Messages
ïï 
.
ïï 
Message
ïï  
(
ïï  !
$str
ïï! '
,
ïï' (
MessageTypeDefOf
ïï) 9
.
ïï9 :
RejectInput
ïï: E
)
ïïE F
;
ïïF G
}
ññ 
}
óó 	
private
ôô 
IntVec3
ôô #
FindSpawnPositionNear
ôô -
(
ôô- .
IntVec3
ôô. 5
center
ôô6 <
,
ôô< =
Map
ôô> A
map
ôôB E
,
ôôE F
int
ôôG J
radius
ôôK Q
)
ôôQ R
{
öö 	
for
õõ 
(
õõ 
int
õõ 
r
õõ 
=
õõ 
$num
õõ 
;
õõ 
r
õõ 
<=
õõ  
radius
õõ! '
;
õõ' (
r
õõ) *
++
õõ* ,
)
õõ, -
{
úú 
foreach
ùù 
(
ùù 
IntVec3
ùù  
cell
ùù! %
in
ùù& (
	GenRadial
ùù) 2
.
ùù2 3
RadialCellsAround
ùù3 D
(
ùùD E
center
ùùE K
,
ùùK L
r
ùùM N
,
ùùN O
true
ùùP T
)
ùùT U
)
ùùU V
{
ûû 
if
üü 
(
üü 
cell
üü 
.
üü 
InBounds
üü %
(
üü% &
map
üü& )
)
üü) *
&&
üü+ -
cell
üü. 2
.
üü2 3
	Standable
üü3 <
(
üü< =
map
üü= @
)
üü@ A
&&
üüB D
map
üüE H
.
üüH I
	thingGrid
üüI R
.
üüR S
ThingsListAt
üüS _
(
üü_ `
cell
üü` d
)
üüd e
.
üüe f
Count
üüf k
==
üül n
$num
üüo p
)
üüp q
{
†† 
return
°° 
cell
°° #
;
°°# $
}
¢¢ 
}
££ 
}
§§ 
return
•• 
IntVec3
•• 
.
•• 
Invalid
•• "
;
••" #
}
¶¶ 	
private
®® 
string
®® 
GetItemLabel
®® #
(
®®# $
StoredItemData
®®$ 2
item
®®3 7
)
®®7 8
{
©© 	
if
™™ 
(
™™ 
item
™™ 
.
™™ 
def
™™ 
==
™™ 
null
™™  
)
™™  !
{
´´ 
return
¨¨ 
$str
¨¨ 
;
¨¨ 
}
≠≠ 
string
ØØ 
label
ØØ 
=
ØØ 
item
ØØ 
.
ØØ  
def
ØØ  #
.
ØØ# $
label
ØØ$ )
;
ØØ) *
if
∞∞ 
(
∞∞ 
item
∞∞ 
.
∞∞ 
stuffDef
∞∞ 
!=
∞∞  
null
∞∞! %
)
∞∞% &
{
±± 
label
≤≤ 
=
≤≤ 
item
≤≤ 
.
≤≤ 
stuffDef
≤≤ %
.
≤≤% &
label
≤≤& +
+
≤≤, -
label
≤≤. 3
;
≤≤3 4
}
≥≥ 
return
µµ 
label
µµ 
.
µµ 
CapitalizeFirst
µµ (
(
µµ( )
)
µµ) *
;
µµ* +
}
∂∂ 	
private
∏∏ 
string
∏∏ 
GetItemTooltip
∏∏ %
(
∏∏% &
StoredItemData
∏∏& 4
item
∏∏5 9
)
∏∏9 :
{
ππ 	
if
∫∫ 
(
∫∫ 
item
∫∫ 
.
∫∫ 
def
∫∫ 
==
∫∫ 
null
∫∫  
)
∫∫  !
{
ªª 
return
ºº 
$str
ºº 
;
ºº 
}
ΩΩ 
string
øø 
tooltip
øø 
=
øø 
GetItemLabel
øø )
(
øø) *
item
øø* .
)
øø. /
;
øø/ 0
tooltip
¿¿ 
+=
¿¿ 
$"
¿¿ 
$str
¿¿ 
{
¿¿  
item
¿¿  $
.
¿¿$ %

stackCount
¿¿% /
}
¿¿/ 0
"
¿¿0 1
;
¿¿1 2
if
¬¬ 
(
¬¬ 
item
¬¬ 
.
¬¬ 
quality
¬¬ 
!=
¬¬ 
QualityCategory
¬¬  /
.
¬¬/ 0
Normal
¬¬0 6
)
¬¬6 7
{
√√ 
tooltip
ƒƒ 
+=
ƒƒ 
$"
ƒƒ 
$str
ƒƒ #
{
ƒƒ# $
item
ƒƒ$ (
.
ƒƒ( )
quality
ƒƒ) 0
.
ƒƒ0 1
GetLabel
ƒƒ1 9
(
ƒƒ9 :
)
ƒƒ: ;
}
ƒƒ; <
"
ƒƒ< =
;
ƒƒ= >
}
≈≈ 
if
«« 
(
«« 
item
«« 
.
«« 
	hitPoints
«« 
>
««  
$num
««! "
&&
««# %
item
««& *
.
««* +
def
««+ .
.
««. /
useHitPoints
««/ ;
)
««; <
{
»» 
float
…… 
	hpPercent
…… 
=
……  !
(
……" #
float
……# (
)
……( )
item
……) -
.
……- .
	hitPoints
……. 7
/
……8 9
item
……: >
.
……> ?
def
……? B
.
……B C
BaseMaxHitPoints
……C S
;
……S T
tooltip
   
+=
   
$"
   
$str
   #
{
  # $
item
  $ (
.
  ( )
	hitPoints
  ) 2
}
  2 3
$str
  3 6
{
  6 7
item
  7 ;
.
  ; <
def
  < ?
.
  ? @
BaseMaxHitPoints
  @ P
}
  P Q
$str
  Q S
{
  S T
Mathf
  T Y
.
  Y Z

RoundToInt
  Z d
(
  d e
	hpPercent
  e n
*
  o p
$num
  q t
)
  t u
}
  u v
$str
  v x
"
  x y
;
  y z
}
ÀÀ 
if
ÕÕ 
(
ÕÕ 
!
ÕÕ 
string
ÕÕ 
.
ÕÕ 
IsNullOrEmpty
ÕÕ %
(
ÕÕ% &
item
ÕÕ& *
.
ÕÕ* +
def
ÕÕ+ .
.
ÕÕ. /
description
ÕÕ/ :
)
ÕÕ: ;
)
ÕÕ; <
{
ŒŒ 
tooltip
œœ 
+=
œœ 
$"
œœ 
$str
œœ !
{
œœ! "
item
œœ" &
.
œœ& '
def
œœ' *
.
œœ* +
description
œœ+ 6
}
œœ6 7
"
œœ7 8
;
œœ8 9
}
–– 
return
““ 
tooltip
““ 
;
““ 
}
”” 	
private
’’ 
Color
’’ 
GetQualityColor
’’ %
(
’’% &
QualityCategory
’’& 5
quality
’’6 =
)
’’= >
{
÷÷ 	
switch
◊◊ 
(
◊◊ 
quality
◊◊ 
)
◊◊ 
{
ÿÿ 
case
ŸŸ 
QualityCategory
ŸŸ $
.
ŸŸ$ %
Awful
ŸŸ% *
:
ŸŸ* +
return
⁄⁄ 
new
⁄⁄ 
Color
⁄⁄ $
(
⁄⁄$ %
$num
⁄⁄% )
,
⁄⁄) *
$num
⁄⁄+ /
,
⁄⁄/ 0
$num
⁄⁄1 5
)
⁄⁄5 6
;
⁄⁄6 7
case
€€ 
QualityCategory
€€ $
.
€€$ %
Poor
€€% )
:
€€) *
return
‹‹ 
new
‹‹ 
Color
‹‹ $
(
‹‹$ %
$num
‹‹% )
,
‹‹) *
$num
‹‹+ /
,
‹‹/ 0
$num
‹‹1 5
)
‹‹5 6
;
‹‹6 7
case
›› 
QualityCategory
›› $
.
››$ %
Normal
››% +
:
››+ ,
return
ﬁﬁ 
Color
ﬁﬁ  
.
ﬁﬁ  !
white
ﬁﬁ! &
;
ﬁﬁ& '
case
ﬂﬂ 
QualityCategory
ﬂﬂ $
.
ﬂﬂ$ %
Good
ﬂﬂ% )
:
ﬂﬂ) *
return
‡‡ 
new
‡‡ 
Color
‡‡ $
(
‡‡$ %
$num
‡‡% )
,
‡‡) *
$num
‡‡+ /
,
‡‡/ 0
$num
‡‡1 5
)
‡‡5 6
;
‡‡6 7
case
·· 
QualityCategory
·· $
.
··$ %
	Excellent
··% .
:
··. /
return
‚‚ 
new
‚‚ 
Color
‚‚ $
(
‚‚$ %
$num
‚‚% )
,
‚‚) *
$num
‚‚+ /
,
‚‚/ 0
$num
‚‚1 3
)
‚‚3 4
;
‚‚4 5
case
„„ 
QualityCategory
„„ $
.
„„$ %

Masterwork
„„% /
:
„„/ 0
return
‰‰ 
new
‰‰ 
Color
‰‰ $
(
‰‰$ %
$num
‰‰% '
,
‰‰' (
$num
‰‰) -
,
‰‰- .
$num
‰‰/ 3
)
‰‰3 4
;
‰‰4 5
case
ÂÂ 
QualityCategory
ÂÂ $
.
ÂÂ$ %
	Legendary
ÂÂ% .
:
ÂÂ. /
return
ÊÊ 
new
ÊÊ 
Color
ÊÊ $
(
ÊÊ$ %
$num
ÊÊ% '
,
ÊÊ' (
$num
ÊÊ) -
,
ÊÊ- .
$num
ÊÊ/ 3
)
ÊÊ3 4
;
ÊÊ4 5
default
ÁÁ 
:
ÁÁ 
return
ËË 
Color
ËË  
.
ËË  !
white
ËË! &
;
ËË& '
}
ÈÈ 
}
ÍÍ 	
private
ÏÏ 
void
ÏÏ !
UpdateFilteredItems
ÏÏ (
(
ÏÏ( )
)
ÏÏ) *
{
ÌÌ 	
if
ÓÓ 
(
ÓÓ 
core
ÓÓ 
==
ÓÓ 
null
ÓÓ 
)
ÓÓ 
{
ÔÔ 
filteredItems
 
.
 
Clear
 #
(
# $
)
$ %
;
% &
return
ÒÒ 
;
ÒÒ 
}
ÚÚ 
IEnumerable
ÙÙ 
<
ÙÙ 
StoredItemData
ÙÙ &
>
ÙÙ& '
allItems
ÙÙ( 0
=
ÙÙ1 2
core
ÙÙ3 7
.
ÙÙ7 8
GetAllStoredItems
ÙÙ8 I
(
ÙÙI J
)
ÙÙJ K
;
ÙÙK L
if
ˆˆ 
(
ˆˆ 
string
ˆˆ 
.
ˆˆ 
IsNullOrEmpty
ˆˆ $
(
ˆˆ$ %

searchText
ˆˆ% /
)
ˆˆ/ 0
)
ˆˆ0 1
{
˜˜ 
filteredItems
¯¯ 
=
¯¯ 
allItems
¯¯  (
.
¯¯( )
ToList
¯¯) /
(
¯¯/ 0
)
¯¯0 1
;
¯¯1 2
}
˘˘ 
else
˙˙ 
{
˚˚ 
string
¸¸ 
searchLower
¸¸ "
=
¸¸# $

searchText
¸¸% /
.
¸¸/ 0
ToLower
¸¸0 7
(
¸¸7 8
)
¸¸8 9
;
¸¸9 :
filteredItems
˝˝ 
=
˝˝ 
allItems
˝˝  (
.
˝˝( )
Where
˝˝) .
(
˝˝. /
item
˝˝/ 3
=>
˝˝4 6
{
˛˛ 
if
ˇˇ 
(
ˇˇ 
item
ˇˇ 
.
ˇˇ 
def
ˇˇ  
==
ˇˇ! #
null
ˇˇ$ (
)
ˇˇ( )
{
ÄÄ 
return
ÅÅ 
false
ÅÅ $
;
ÅÅ$ %
}
ÇÇ 
string
ÑÑ 
label
ÑÑ  
=
ÑÑ! "
GetItemLabel
ÑÑ# /
(
ÑÑ/ 0
item
ÑÑ0 4
)
ÑÑ4 5
.
ÑÑ5 6
ToLower
ÑÑ6 =
(
ÑÑ= >
)
ÑÑ> ?
;
ÑÑ? @
return
ÖÖ 
label
ÖÖ  
.
ÖÖ  !
Contains
ÖÖ! )
(
ÖÖ) *
searchLower
ÖÖ* 5
)
ÖÖ5 6
;
ÖÖ6 7
}
ÜÜ 
)
ÜÜ 
.
ÜÜ 
ToList
ÜÜ 
(
ÜÜ 
)
ÜÜ 
;
ÜÜ 
}
áá 
filteredItems
ââ 
=
ââ 
filteredItems
ââ )
.
ââ) *
OrderBy
ââ* 1
(
ââ1 2
item
ââ2 6
=>
ââ7 9
GetItemLabel
ââ: F
(
ââF G
item
ââG K
)
ââK L
)
ââL M
.
ââM N
ToList
ââN T
(
ââT U
)
ââU V
;
ââV W
}
ää 	
}
ãã 
}åå …7
^B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Settings\DigitalStorageSettings.cs
	namespace 	
DigitalStorage
 
. 
Settings !
{ 
public 

class "
DigitalStorageSettings '
:( )
ModSettings* 5
{ 
public 
static 
float 
costMultiplier *
=+ ,
$num- 1
;1 2
public		 
static		 
bool		 
enableDebugLog		 )
=		* +
false		, 1
;		1 2
public

 
static

 
bool

 
enableConversionLog

 .
=

/ 0
false

1 6
;

6 7
public 
static 
int  
reservedCountPerItem .
=/ 0
$num1 4
;4 5
public 
override 
void 

ExposeData '
(' (
)( )
{ 	
Scribe_Values 
. 
Look 
( 
ref "
costMultiplier# 1
,1 2
$str3 C
,C D
$numE I
)I J
;J K
Scribe_Values 
. 
Look 
( 
ref "
enableDebugLog# 1
,1 2
$str3 C
,C D
falseE J
)J K
;K L
Scribe_Values 
. 
Look 
( 
ref "
enableConversionLog# 6
,6 7
$str8 M
,M N
falseO T
)T U
;U V
Scribe_Values 
. 
Look 
( 
ref " 
reservedCountPerItem# 7
,7 8
$str9 O
,O P
$numQ T
)T U
;U V
base 
. 

ExposeData 
( 
) 
; 
} 	
public 
static 
void $
DoSettingsWindowContents 3
(3 4
Rect4 8
inRect9 ?
)? @
{ 	
Listing_Standard 
listingStandard ,
=- .
new/ 2
Listing_Standard3 C
(C D
)D E
;E F
listingStandard 
. 
Begin !
(! "
inRect" (
)( )
;) *
Text 
. 
Font 
= 
GameFont  
.  !
Medium! '
;' (
listingStandard 
. 
Label !
(! "
$str" (
)( )
;) *
Text 
. 
Font 
= 
GameFont  
.  !
Small! &
;& '
listingStandard 
. 
Gap 
(  
$num  #
)# $
;$ %
listingStandard!! 
.!! 
Label!! !
(!!! "
string!!" (
.!!( )
Format!!) /
(!!/ 0
$str!!0 ?
,!!? @
costMultiplier!!A O
)!!O P
)!!P Q
;!!Q R
costMultiplier"" 
="" 
listingStandard"" ,
."", -
Slider""- 3
(""3 4
costMultiplier""4 B
,""B C
$num""D H
,""H I
$num""J M
)""M N
;""N O
listingStandard## 
.## 
Gap## 
(##  
$num##  "
)##" #
;### $
listingStandard%% 
.%% 
Label%% !
(%%! "
$str%%" 2
)%%2 3
;%%3 4
listingStandard&& 
.&& 
Gap&& 
(&&  
$num&&  #
)&&# $
;&&$ %
Text)) 
.)) 
Font)) 
=)) 
GameFont))  
.))  !
Medium))! '
;))' (
listingStandard** 
.** 
Label** !
(**! "
$str**" *
)*** +
;**+ ,
Text++ 
.++ 
Font++ 
=++ 
GameFont++  
.++  !
Small++! &
;++& '
listingStandard,, 
.,, 
Gap,, 
(,,  
$num,,  #
),,# $
;,,$ %
listingStandard.. 
... 
Label.. !
(..! "
string.." (
...( )
Format..) /
(../ 0
$str..0 ?
,..? @ 
reservedCountPerItem..A U
)..U V
)..V W
;..W X 
reservedCountPerItem//  
=//! "
(//# $
int//$ '
)//' (
listingStandard//( 7
.//7 8
Slider//8 >
(//> ? 
reservedCountPerItem//? S
,//S T
$num//U W
,//W X
$num//Y \
)//\ ]
;//] ^
listingStandard00 
.00 
Gap00 
(00  
$num00  "
)00" #
;00# $
listingStandard22 
.22 
Label22 !
(22! "
$str22" ?
)22? @
;22@ A
listingStandard33 
.33 
Gap33 
(33  
$num33  #
)33# $
;33$ %
Text66 
.66 
Font66 
=66 
GameFont66  
.66  !
Medium66! '
;66' (
listingStandard77 
.77 
Label77 !
(77! "
$str77" (
)77( )
;77) *
Text88 
.88 
Font88 
=88 
GameFont88  
.88  !
Small88! &
;88& '
listingStandard99 
.99 
Gap99 
(99  
$num99  #
)99# $
;99$ %
listingStandard;; 
.;; 
CheckboxLabeled;; +
(;;+ ,
$str;;, 4
,;;4 5
ref;;6 9
enableDebugLog;;: H
,;;H I
$str<< ,
)<<, -
;<<- .
listingStandard== 
.== 
Gap== 
(==  
$num==  "
)==" #
;==# $
listingStandard?? 
.?? 
CheckboxLabeled?? +
(??+ ,
$str??, 4
,??4 5
ref??6 9
enableConversionLog??: M
,??M N
$str@@ 2
)@@2 3
;@@3 4
listingStandardAA 
.AA 
GapAA 
(AA  
$numAA  "
)AA" #
;AA# $
GUIDD 
.DD 
colorDD 
=DD 
ColorDD 
.DD 
yellowDD $
;DD$ %
listingStandardEE 
.EE 
LabelEE !
(EE! "
$strEE" 9
)EE9 :
;EE: ;
GUIFF 
.FF 
colorFF 
=FF 
ColorFF 
.FF 
whiteFF #
;FF# $
listingStandardHH 
.HH 
EndHH 
(HH  
)HH  !
;HH! "
}II 	
}JJ 
}KK ¢
YB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Settings\DigitalStorageMod.cs
	namespace 	
DigitalStorage
 
. 
Settings !
{ 
public 

class 
DigitalStorageMod "
:# $
Mod% (
{ 
private "
DigitalStorageSettings &
settings' /
;/ 0
public

 
DigitalStorageMod

  
(

  !
ModContentPack

! /
content

0 7
)

7 8
:

9 :
base

; ?
(

? @
content

@ G
)

G H
{ 	
this 
. 
settings 
= 
GetSettings '
<' ("
DigitalStorageSettings( >
>> ?
(? @
)@ A
;A B
} 	
public 
override 
void $
DoSettingsWindowContents 5
(5 6
Rect6 :
inRect; A
)A B
{ 	"
DigitalStorageSettings "
." #$
DoSettingsWindowContents# ;
(; <
inRect< B
)B C
;C D
base 
. $
DoSettingsWindowContents )
() *
inRect* 0
)0 1
;1 2
} 	
public 
override 
string 
SettingsCategory /
(/ 0
)0 1
{ 	
return 
$str -
;- .
} 	
} 
}  J
jB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Caravan_VirtualStorage.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( $
Settlement_TraderTracker 1
)1 2
,2 3
nameof4 :
(: ;$
Settlement_TraderTracker; S
.S T$
ColonyThingsWillingToBuyT l
)l m
)m n
]n o
public 

static 
class C
7Patch_Settlement_TraderTracker_ColonyThingsWillingToBuy O
{ 
public 
static 
IEnumerable !
<! "
Thing" '
>' (
Postfix) 0
(0 1
IEnumerable1 <
<< =
Thing= B
>B C
__resultD L
,L M$
Settlement_TraderTrackerN f

__instanceg q
,q r
Pawns w
playerNegotiator	x à
)
à â
{ 	
foreach 
( 
var 
thing 
in !
__result" *
)* +
{ 
yield 
return 
thing "
;" #
} 
Caravan 
caravan 
= 
playerNegotiator .
?. /
./ 0

GetCaravan0 :
(: ;
); <
;< =
if   
(   
caravan   
==   
null   
||    "
!  # $ 
CaravanStorageAccess  $ 8
.  8 9%
CaravanHasTerminalImplant  9 R
(  R S
caravan  S Z
)  Z [
)  [ \
yield!! 
break!! 
;!! 
foreach$$ 
($$ 
var$$ 
virtualThing$$ %
in$$& ( 
CaravanStorageAccess$$) =
.$$= >&
GetVirtualThingsForCaravan$$> X
($$X Y
caravan$$Y `
)$$` a
)$$a b
{%% 
yield&& 
return&& 
virtualThing&& )
;&&) *
}'' 
}(( 	
})) 
[// 
HarmonyPatch// 
(// 
typeof// 
(// #
CaravanInventoryUtility// 0
)//0 1
,//1 2
nameof//3 9
(//9 :#
CaravanInventoryUtility//: Q
.//Q R
TryGetBestFood//R `
)//` a
)//a b
]//b c
public00 

static00 
class00 8
,Patch_CaravanInventoryUtility_TryGetBestFood00 D
{11 
public22 
static22 
void22 
Postfix22 "
(22" #
Caravan22# *
caravan22+ 2
,222 3
Pawn224 8
forPawn229 @
,22@ A
ref22B E
Thing22F K
food22L P
,22P Q
ref22R U
Pawn22V Z
owner22[ `
,22` a
ref22b e
bool22f j
__result22k s
)22s t
{33 	
if55 
(55 
__result55 
)55 
return55  
;55  !
if88 
(88 
caravan88 
==88 
null88 
||88  "
!88# $ 
CaravanStorageAccess88$ 8
.888 9%
CaravanHasTerminalImplant889 R
(88R S
caravan88S Z
)88Z [
)88[ \
return99 
;99 
Thing<< 
bestFood<< 
=<< 
null<< !
;<<! "
float== 
	bestScore== 
=== 
$num==  
;==  !
foreach?? 
(?? 
var?? 
virtualThing?? %
in??& ( 
CaravanStorageAccess??) =
.??= >&
GetVirtualThingsForCaravan??> X
(??X Y
caravan??Y `
)??` a
)??a b
{@@ 
ifAA 
(AA $
CaravanPawnsNeedsUtilityAA ,
.AA, -!
CanEatForNutritionNowAA- B
(AAB C
virtualThingAAC O
,AAO P
forPawnAAQ X
)AAX Y
)AAY Z
{BB 
floatCC 
scoreCC 
=CC  !$
CaravanPawnsNeedsUtilityCC" :
.CC: ;
GetFoodScoreCC; G
(CCG H
virtualThingCCH T
,CCT U
forPawnCCV ]
)CC] ^
;CC^ _
ifDD 
(DD 
bestFoodDD  
==DD! #
nullDD$ (
||DD) +
scoreDD, 1
>DD2 3
	bestScoreDD4 =
)DD= >
{EE 
bestFoodFF  
=FF! "
virtualThingFF# /
;FF/ 0
	bestScoreGG !
=GG" #
scoreGG$ )
;GG) *
}HH 
}II 
}JJ 
ifLL 
(LL 
bestFoodLL 
!=LL 
nullLL  
)LL  !
{MM 
ThingOO 
	extractedOO 
=OO  ! 
CaravanStorageAccessOO" 6
.OO6 7!
ExtractItemForCaravanOO7 L
(OOL M
caravanOOM T
,OOT U
bestFoodOOV ^
.OO^ _
defOO_ b
,OOb c
$numOOd e
,OOe f
bestFoodOOg o
.OOo p
StuffOOp u
)OOu v
;OOv w
ifPP 
(PP 
	extractedPP 
!=PP  
nullPP! %
)PP% &
{QQ 
foodRR 
=RR 
	extractedRR $
;RR$ %
ownerSS 
=SS #
CaravanInventoryUtilitySS 3
.SS3 4

GetOwnerOfSS4 >
(SS> ?
caravanSS? F
,SSF G
	extractedSSH Q
)SSQ R
;SSR S
__resultTT 
=TT 
trueTT #
;TT# $
}UU 
}VV 
}WW 	
}XX 
[^^ 
HarmonyPatch^^ 
(^^ 
typeof^^ 
(^^ #
CaravanInventoryUtility^^ 0
)^^0 1
,^^1 2
nameof^^3 9
(^^9 :#
CaravanInventoryUtility^^: Q
.^^Q R
TryGetBestMedicine^^R d
)^^d e
)^^e f
]^^f g
public__ 

static__ 
class__ <
0Patch_CaravanInventoryUtility_TryGetBestMedicine__ H
{`` 
publicaa 
staticaa 
voidaa 
Postfixaa "
(aa" #
Caravanaa# *
caravanaa+ 2
,aa2 3
Pawnaa4 8
patientaa9 @
,aa@ A
refaaB E
ThingaaF K
medicineaaL T
,aaT U
refaaV Y
PawnaaZ ^
owneraa_ d
,aad e
refaaf i
boolaaj n
__resultaao w
)aaw x
{bb 	
ifdd 
(dd 
__resultdd 
)dd 
returndd  
;dd  !
ifgg 
(gg 
caravangg 
==gg 
nullgg 
||gg  "
!gg# $ 
CaravanStorageAccessgg$ 8
.gg8 9%
CaravanHasTerminalImplantgg9 R
(ggR S
caravanggS Z
)ggZ [
)gg[ \
returnhh 
;hh 
Thingkk 
bestMedicinekk 
=kk  
nullkk! %
;kk% &
floatll 
bestPotencyll 
=ll 
$numll  "
;ll" #
foreachnn 
(nn 
varnn 
virtualThingnn %
innn& ( 
CaravanStorageAccessnn) =
.nn= >&
GetVirtualThingsForCaravannn> X
(nnX Y
caravannnY `
)nn` a
)nna b
{oo 
ifpp 
(pp 
virtualThingpp  
.pp  !
defpp! $
.pp$ %

IsMedicinepp% /
)pp/ 0
{qq 
floatrr 
potencyrr !
=rr" #
virtualThingrr$ 0
.rr0 1
GetStatValuerr1 =
(rr= >
	StatDefOfrr> G
.rrG H
MedicalPotencyrrH V
,rrV W
truerrX \
)rr\ ]
;rr] ^
ifss 
(ss 
bestMediciness $
==ss% '
nullss( ,
||ss- /
potencyss0 7
>ss8 9
bestPotencyss: E
)ssE F
{tt 
bestMedicineuu $
=uu% &
virtualThinguu' 3
;uu3 4
bestPotencyvv #
=vv$ %
potencyvv& -
;vv- .
}ww 
}xx 
}yy 
if{{ 
({{ 
bestMedicine{{ 
!={{ 
null{{  $
){{$ %
{|| 
Thing~~ 
	extracted~~ 
=~~  ! 
CaravanStorageAccess~~" 6
.~~6 7!
ExtractItemForCaravan~~7 L
(~~L M
caravan~~M T
,~~T U
bestMedicine~~V b
.~~b c
def~~c f
,~~f g
$num~~h i
,~~i j
bestMedicine~~k w
.~~w x
Stuff~~x }
)~~} ~
;~~~ 
if 
( 
	extracted 
!=  
null! %
)% &
{
ÄÄ 
medicine
ÅÅ 
=
ÅÅ 
	extracted
ÅÅ (
;
ÅÅ( )
owner
ÇÇ 
=
ÇÇ %
CaravanInventoryUtility
ÇÇ 3
.
ÇÇ3 4

GetOwnerOf
ÇÇ4 >
(
ÇÇ> ?
caravan
ÇÇ? F
,
ÇÇF G
	extracted
ÇÇH Q
)
ÇÇQ R
;
ÇÇR S
__result
ÉÉ 
=
ÉÉ 
true
ÉÉ #
;
ÉÉ# $
}
ÑÑ 
}
ÖÖ 
}
ÜÜ 	
}
áá 
}àà ÒQ
\B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Services\CaravanStorageAccess.cs
	namespace 	
DigitalStorage
 
. 
Services !
{ 
public 

static 
class  
CaravanStorageAccess ,
{ 
private 
static 

Dictionary !
<! "
Caravan" )
,) *
List+ /
</ 0
Thing0 5
>5 6
>6 7
virtualThingsCache8 J
=K L
newM P

DictionaryQ [
<[ \
Caravan\ c
,c d
Liste i
<i j
Thingj o
>o p
>p q
(q r
)r s
;s t
private 
static 
int 
lastCacheTick (
=) *
-+ ,
$num, -
;- .
public 
static 
bool %
CaravanHasTerminalImplant 4
(4 5
Caravan5 <
caravan= D
)D E
{ 	
if 
( 
caravan 
== 
null 
)  
return! '
false( -
;- .
foreach 
( 
Pawn 
pawn 
in !
caravan" )
.) *
PawnsListForReading* =
)= >
{ 
if 
( 
PawnStorageAccess %
.% &
HasTerminalImplant& 8
(8 9
pawn9 =
)= >
)> ?
return 
true 
;  
} 
return 
false 
; 
}   	
public%% 
static%% 
List%% 
<%% 
Thing%%  
>%%  !&
GetVirtualThingsForCaravan%%" <
(%%< =
Caravan%%= D
caravan%%E L
)%%L M
{&& 	
int(( 
currentTick(( 
=(( 
Find(( "
.((" #
TickManager((# .
.((. /
	TicksGame((/ 8
;((8 9
if)) 
()) 
lastCacheTick)) 
==))  
currentTick))! ,
&&))- /
virtualThingsCache))0 B
.))B C
TryGetValue))C N
())N O
caravan))O V
,))V W
out))X [
var))\ _
cached))` f
)))f g
)))g h
{** 
return++ 
cached++ 
;++ 
},, 
var.. 
result.. 
=.. 
new.. 
List.. !
<..! "
Thing.." '
>..' (
(..( )
)..) *
;..* +
var// 
gameComp// 
=// 
Current// "
.//" #
Game//# '
?//' (
.//( )
GetComponent//) 5
<//5 6'
DigitalStorageGameComponent//6 Q
>//Q R
(//R S
)//S T
;//T U
if00 
(00 
gameComp00 
==00 
null00  
)00  !
return00" (
result00) /
;00/ 0
foreach22 
(22 
var22 
core22 
in22  
gameComp22! )
.22) *
GetAllCores22* 5
(225 6
)226 7
)227 8
{33 
if44 
(44 
core44 
==44 
null44  
||44! #
!44$ %
core44% )
.44) *
Spawned44* 1
||442 4
!445 6
core446 :
.44: ;
Powered44; B
)44B C
continue44D L
;44L M
foreach66 
(66 
var66 
itemData66 %
in66& (
core66) -
.66- .
GetAllStoredItems66. ?
(66? @
)66@ A
)66A B
{77 
if88 
(88 
itemData88  
.88  !
def88! $
==88% '
null88( ,
||88- /
itemData880 8
.888 9

stackCount889 C
<=88D F
$num88G H
)88H I
continue88J R
;88R S
Thing;; 
virtualThing;; &
=;;' (
itemData;;) 1
.;;1 2
CreateThing;;2 =
(;;= >
);;> ?
;;;? @
if<< 
(<< 
virtualThing<< $
!=<<% '
null<<( ,
)<<, -
{== 
result>> 
.>> 
Add>> "
(>>" #
virtualThing>># /
)>>/ 0
;>>0 1
}?? 
}@@ 
}AA 
virtualThingsCacheDD 
[DD 
caravanDD &
]DD& '
=DD( )
resultDD* 0
;DD0 1
lastCacheTickEE 
=EE 
currentTickEE '
;EE' (
returnGG 
resultGG 
;GG 
}HH 	
publicMM 
staticMM 
ThingMM !
ExtractItemForCaravanMM 1
(MM1 2
CaravanMM2 9
caravanMM: A
,MMA B
ThingDefMMC K
defMML O
,MMO P
intMMQ T
countMMU Z
,MMZ [
ThingDefMM\ d
stuffMMe j
=MMk l
nullMMm q
)MMq r
{NN 	
varOO 
gameCompOO 
=OO 
CurrentOO "
.OO" #
GameOO# '
?OO' (
.OO( )
GetComponentOO) 5
<OO5 6'
DigitalStorageGameComponentOO6 Q
>OOQ R
(OOR S
)OOS T
;OOT U
ifPP 
(PP 
gameCompPP 
==PP 
nullPP  
)PP  !
returnPP" (
nullPP) -
;PP- .
ThingSS 
	extractedSS 
=SS 
gameCompSS &
.SS& '+
TryExtractItemFromAnyCoreGlobalSS' F
(SSF G
defSSG J
,SSJ K
countSSL Q
,SSQ R
stuffSSS X
,SSX Y
nullSSZ ^
)SS^ _
;SS_ `
ifTT 
(TT 
	extractedTT 
==TT 
nullTT !
)TT! "
returnTT# )
nullTT* .
;TT. /
PawnWW 
carrierWW 
=WW #
CaravanInventoryUtilityWW 2
.WW2 3%
FindPawnToMoveInventoryToWW3 L
(WWL M
	extractedWWM V
,WWV W
caravanWWX _
.WW_ `
PawnsListForReadingWW` s
,WWs t
nullWWu y
,WWy z
nullWW{ 
)	WW Ä
;
WWÄ Å
ifXX 
(XX 
carrierXX 
!=XX 
nullXX 
)XX  
{YY 
carrierZZ 
.ZZ 
	inventoryZZ !
.ZZ! "
TryAddAndUnforbidZZ" 3
(ZZ3 4
	extractedZZ4 =
)ZZ= >
;ZZ> ?
}[[ 
virtualThingsCache^^ 
.^^ 
Remove^^ %
(^^% &
caravan^^& -
)^^- .
;^^. /
return`` 
	extracted`` 
;`` 
}aa 	
publicff 
staticff 
boolff 
HasVirtualItemff )
(ff) *
ThingDefff* 2
defff3 6
,ff6 7
ThingDefff8 @
stuffffA F
=ffG H
nullffI M
)ffM N
{gg 	
varhh 
gameComphh 
=hh 
Currenthh "
.hh" #
Gamehh# '
?hh' (
.hh( )
GetComponenthh) 5
<hh5 6'
DigitalStorageGameComponenthh6 Q
>hhQ R
(hhR S
)hhS T
;hhT U
ifii 
(ii 
gameCompii 
==ii 
nullii  
)ii  !
returnii" (
falseii) .
;ii. /
foreachkk 
(kk 
varkk 
corekk 
inkk  
gameCompkk! )
.kk) *
GetAllCoreskk* 5
(kk5 6
)kk6 7
)kk7 8
{ll 
ifmm 
(mm 
coremm 
!=mm 
nullmm  
&&mm! #
coremm$ (
.mm( )
Spawnedmm) 0
&&mm1 3
coremm4 8
.mm8 9
Poweredmm9 @
&&mmA C
coremmD H
.mmH I
HasItemmmI P
(mmP Q
defmmQ T
,mmT U
stuffmmV [
)mm[ \
)mm\ ]
returnnn 
truenn 
;nn  
}oo 
returnpp 
falsepp 
;pp 
}qq 	
publicvv 
staticvv 
intvv 
GetVirtualItemCountvv -
(vv- .
ThingDefvv. 6
defvv7 :
,vv: ;
ThingDefvv< D
stuffvvE J
=vvK L
nullvvM Q
)vvQ R
{ww 	
varxx 
gameCompxx 
=xx 
Currentxx "
.xx" #
Gamexx# '
?xx' (
.xx( )
GetComponentxx) 5
<xx5 6'
DigitalStorageGameComponentxx6 Q
>xxQ R
(xxR S
)xxS T
;xxT U
ifyy 
(yy 
gameCompyy 
==yy 
nullyy  
)yy  !
returnyy" (
$numyy) *
;yy* +
int{{ 
total{{ 
={{ 
$num{{ 
;{{ 
foreach|| 
(|| 
var|| 
core|| 
in||  
gameComp||! )
.||) *
GetAllCores||* 5
(||5 6
)||6 7
)||7 8
{}} 
if~~ 
(~~ 
core~~ 
!=~~ 
null~~  
&&~~! #
core~~$ (
.~~( )
Spawned~~) 0
&&~~1 3
core~~4 8
.~~8 9
Powered~~9 @
)~~@ A
{ 
total
ÄÄ 
+=
ÄÄ 
core
ÄÄ !
.
ÄÄ! "
GetItemCount
ÄÄ" .
(
ÄÄ. /
def
ÄÄ/ 2
,
ÄÄ2 3
stuff
ÄÄ4 9
)
ÄÄ9 :
;
ÄÄ: ;
}
ÅÅ 
}
ÇÇ 
return
ÉÉ 
total
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
public
ââ 
static
ââ 
void
ââ 

ClearCache
ââ %
(
ââ% &
)
ââ& '
{
ää 	 
virtualThingsCache
ãã 
.
ãã 
Clear
ãã $
(
ãã$ %
)
ãã% &
;
ãã& '
lastCacheTick
åå 
=
åå 
-
åå 
$num
åå 
;
åå 
}
çç 	
}
éé 
}èè öÕ
ZB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Services\AsyncItemConverter.cs
	namespace

 	
DigitalStorage


 
.

 
Services

 !
{ 
public 

static 
class 
AsyncItemConverter *
{ 
private 
static 

Dictionary !
<! " 
Building_StorageCore" 6
,6 7
ConversionState8 G
>G H
activeConversionsI Z
=[ \
new] `

Dictionarya k
<k l!
Building_StorageCore	l Ä
,
Ä Å
ConversionState
Ç ë
>
ë í
(
í ì
)
ì î
;
î ï
private 
static 
Stack 
< 
ItemData %
>% &
_itemDataPool' 4
=5 6
new7 :
Stack; @
<@ A
ItemDataA I
>I J
(J K
$numK M
)M N
;N O
private 
sealed 
class 
ConversionState ,
{ 	
public 
List 
< 
Thing 
> 
	toConvert (
=) *
new+ .
List/ 3
<3 4
Thing4 9
>9 :
(: ;
); <
;< =
public 
List 
< 
ItemData  
>  !
preparedData" .
=/ 0
new1 4
List5 9
<9 :
ItemData: B
>B C
(C D
)D E
;E F
public 
int 
dataPreparedIndex (
=) *
$num+ ,
;, -
public 
int 
despawnIndex #
=$ %
$num& '
;' (
public 
int 
itemsPerFrame $
=% &
$num' )
;) *
} 	
private!! 
sealed!! 
class!! 
ItemData!! %
{"" 	
public## 
Thing## 
thing## 
;## 
public$$ 
StoredItemData$$ !
data$$" &
;$$& '
}%% 	
private(( 
static(( 
ItemData(( 
GetOrCreateItemData((  3
(((3 4
Thing((4 9
thing((: ?
,((? @
StoredItemData((A O
data((P T
)((T U
{)) 	
if** 
(** 
_itemDataPool** 
.** 
Count** #
>**$ %
$num**& '
)**' (
{++ 
ItemData,, 
itemData,, !
=,," #
_itemDataPool,,$ 1
.,,1 2
Pop,,2 5
(,,5 6
),,6 7
;,,7 8
itemData-- 
.-- 
thing-- 
=--  
thing--! &
;--& '
itemData.. 
... 
data.. 
=.. 
data..  $
;..$ %
return// 
itemData// 
;//  
}00 
return11 
new11 
ItemData11 
{11  !
thing11" '
=11( )
thing11* /
,11/ 0
data111 5
=116 7
data118 <
}11= >
;11> ?
}22 	
private55 
static55 
void55 
ReturnToPool55 (
(55( )
List55) -
<55- .
ItemData55. 6
>556 7
items558 =
)55= >
{66 	
foreach77 
(77 
ItemData77 
item77 "
in77# %
items77& +
)77+ ,
{88 
if:: 
(:: 
_itemDataPool:: !
.::! "
Count::" '
<::( )
$num::* ,
)::, -
{;; 
item<< 
.<< 
thing<< 
=<<  
null<<! %
;<<% &
item== 
.== 
data== 
=== 
null==  $
;==$ %
_itemDataPool>> !
.>>! "
Push>>" &
(>>& '
item>>' +
)>>+ ,
;>>, -
}?? 
}@@ 
}AA 	
publicFF 
staticFF 
voidFF  
StartAsyncConversionFF /
(FF/ 0 
Building_StorageCoreFF0 D
coreFFE I
)FFI J
{GG 	
ifHH 
(HH "
DigitalStorageSettingsHH &
.HH& '
enableConversionLogHH' :
)HH: ;
{II 
LogJJ 
.JJ 
MessageJJ 
(JJ 
$"JJ 
$strJJ W
{JJW X
(JJX Y
coreJJY ]
!=JJ^ `
nullJJa e
?JJf g
$strJJh l
:JJm n
$strJJo u
)JJu v
}JJv w
$str	JJw Å
{
JJÅ Ç
(
JJÇ É
core
JJÉ á
!=
JJà ä
null
JJã è
?
JJê ë
core
JJí ñ
.
JJñ ó
Powered
JJó û
.
JJû ü
ToString
JJü ß
(
JJß ®
)
JJ® ©
:
JJ™ ´
$str
JJ¨ ±
)
JJ± ≤
}
JJ≤ ≥
"
JJ≥ ¥
)
JJ¥ µ
;
JJµ ∂
}KK 
ifMM 
(MM 
coreMM 
==MM 
nullMM 
||MM 
!MM  !
coreMM! %
.MM% &
PoweredMM& -
)MM- .
{NN 
ifOO 
(OO "
DigitalStorageSettingsOO *
.OO* +
enableConversionLogOO+ >
)OO> ?
{PP 
LogQQ 
.QQ 
MessageQQ 
(QQ  
$"QQ  "
$strQQ" e
"QQe f
)QQf g
;QQg h
}RR 
returnSS 
;SS 
}TT 
	SlotGroupVV 
	slotGroupVV 
=VV  !
coreVV" &
.VV& '
GetSlotGroupVV' 3
(VV3 4
)VV4 5
;VV5 6
ifWW 
(WW 
	slotGroupWW 
==WW 
nullWW !
)WW! "
{XX 
ifYY 
(YY "
DigitalStorageSettingsYY *
.YY* +
enableConversionLogYY+ >
)YY> ?
{ZZ 
Log[[ 
.[[ 
Message[[ 
([[  
$"[[  "
$str[[" `
"[[` a
)[[a b
;[[b c
}\\ 
return]] 
;]] 
}^^ 
int`` 
reservedCount`` 
=`` "
DigitalStorageSettings``  6
.``6 7 
reservedCountPerItem``7 K
;``K L
ifaa 
(aa "
DigitalStorageSettingsaa &
.aa& '
enableConversionLogaa' :
)aa: ;
{bb 
Logcc 
.cc 
Messagecc 
(cc 
$"cc 
$strcc S
{ccS T
reservedCountccT a
}cca b
"ccb c
)ccc d
;ccd e
}dd 

Dictionarygg 
<gg 
stringgg 
,gg 
Listgg #
<gg# $
Thinggg$ )
>gg) *
>gg* +

itemsByKeygg, 6
=gg7 8
newgg9 <

Dictionarygg= G
<ggG H
stringggH N
,ggN O
ListggP T
<ggT U
ThingggU Z
>ggZ [
>gg[ \
(gg\ ]
)gg] ^
;gg^ _
foreachhh 
(hh 
Thinghh 
thinghh  
inhh! #
	slotGrouphh$ -
.hh- .

HeldThingshh. 8
)hh8 9
{ii 
ifjj 
(jj 
thingjj 
!=jj 
nulljj !
&&jj" $
thingjj% *
.jj* +
Spawnedjj+ 2
)jj2 3
{kk 
stringll 
keyll 
=ll  

GetItemKeyll! +
(ll+ ,
thingll, 1
)ll1 2
;ll2 3
ifmm 
(mm 
!mm 

itemsByKeymm #
.mm# $
ContainsKeymm$ /
(mm/ 0
keymm0 3
)mm3 4
)mm4 5
{nn 

itemsByKeyoo "
[oo" #
keyoo# &
]oo& '
=oo( )
newoo* -
Listoo. 2
<oo2 3
Thingoo3 8
>oo8 9
(oo9 :
)oo: ;
;oo; <
}pp 

itemsByKeyqq 
[qq 
keyqq "
]qq" #
.qq# $
Addqq$ '
(qq' (
thingqq( -
)qq- .
;qq. /
}rr 
}ss 
ifuu 
(uu "
DigitalStorageSettingsuu &
.uu& '
enableConversionLoguu' :
)uu: ;
{vv 
Logww 
.ww 
Messageww 
(ww 
$"ww 
$strww Z
{wwZ [

itemsByKeyww[ e
.wwe f
Countwwf k
}wwk l
"wwl m
)wwm n
;wwn o
}xx 
List{{ 
<{{ 
Thing{{ 
>{{ 
	toConvert{{ !
={{" #
new{{$ '
List{{( ,
<{{, -
Thing{{- 2
>{{2 3
({{3 4
){{4 5
;{{5 6
foreach|| 
(|| 
var|| 
kvp|| 
in|| 

itemsByKey||  *
)||* +
{}} 
List~~ 
<~~ 
Thing~~ 
>~~ 
things~~ "
=~~# $
kvp~~% (
.~~( )
Value~~) .
;~~. /
int
ÅÅ 

totalCount
ÅÅ 
=
ÅÅ  
things
ÅÅ! '
.
ÅÅ' (
Sum
ÅÅ( +
(
ÅÅ+ ,
t
ÅÅ, -
=>
ÅÅ. 0
t
ÅÅ1 2
.
ÅÅ2 3

stackCount
ÅÅ3 =
)
ÅÅ= >
;
ÅÅ> ?
if
ÉÉ 
(
ÉÉ $
DigitalStorageSettings
ÉÉ *
.
ÉÉ* +!
enableConversionLog
ÉÉ+ >
)
ÉÉ> ?
{
ÑÑ 
Log
ÖÖ 
.
ÖÖ 
Message
ÖÖ 
(
ÖÖ  
$"
ÖÖ  "
$str
ÖÖ" A
{
ÖÖA B
kvp
ÖÖB E
.
ÖÖE F
Key
ÖÖF I
}
ÖÖI J
$str
ÖÖJ P
{
ÖÖP Q

totalCount
ÖÖQ [
}
ÖÖ[ \
$str
ÖÖ\ a
{
ÖÖa b
reservedCount
ÖÖb o
}
ÖÖo p
"
ÖÖp q
)
ÖÖq r
;
ÖÖr s
}
ÜÜ 
if
ââ 
(
ââ 

totalCount
ââ 
>
ââ  
reservedCount
ââ! .
)
ââ. /
{
ää 
int
ãã 
toConvertCount
ãã &
=
ãã' (

totalCount
ãã) 3
-
ãã4 5
reservedCount
ãã6 C
;
ããC D
int
åå 
	converted
åå !
=
åå" #
$num
åå$ %
;
åå% &
if
éé 
(
éé $
DigitalStorageSettings
éé .
.
éé. /!
enableConversionLog
éé/ B
)
ééB C
{
èè 
Log
êê 
.
êê 
Message
êê #
(
êê# $
$"
êê$ &
$str
êê& K
{
êêK L
toConvertCount
êêL Z
}
êêZ [
"
êê[ \
)
êê\ ]
;
êê] ^
}
ëë 
foreach
ìì 
(
ìì 
Thing
ìì "
thing
ìì# (
in
ìì) +
things
ìì, 2
.
ìì2 3
OrderBy
ìì3 :
(
ìì: ;
t
ìì; <
=>
ìì= ?
t
ìì@ A
.
ììA B

stackCount
ììB L
)
ììL M
)
ììM N
{
îî 
if
ïï 
(
ïï 
	converted
ïï %
>=
ïï& (
toConvertCount
ïï) 7
)
ïï7 8
{
ññ 
break
óó !
;
óó! "
}
òò 
int
öö 
	remaining
öö %
=
öö& '
toConvertCount
öö( 6
-
öö7 8
	converted
öö9 B
;
ööB C
if
õõ 
(
õõ 
thing
õõ !
.
õõ! "

stackCount
õõ" ,
<=
õõ- /
	remaining
õõ0 9
)
õõ9 :
{
úú 
	toConvert
ûû %
.
ûû% &
Add
ûû& )
(
ûû) *
thing
ûû* /
)
ûû/ 0
;
ûû0 1
	converted
üü %
+=
üü& (
thing
üü) .
.
üü. /

stackCount
üü/ 9
;
üü9 :
}
†† 
else
°° 
{
¢¢ 
Thing
•• !
split
••" '
=
••( )
thing
••* /
.
••/ 0
SplitOff
••0 8
(
••8 9
	remaining
••9 B
)
••B C
;
••C D
if
¶¶ 
(
¶¶  
split
¶¶  %
!=
¶¶& (
null
¶¶) -
&&
¶¶. 0
split
¶¶1 6
.
¶¶6 7

stackCount
¶¶7 A
>
¶¶B C
$num
¶¶D E
)
¶¶E F
{
ßß 
if
©©  "
(
©©# $
!
©©$ %
split
©©% *
.
©©* +
Spawned
©©+ 2
&&
©©3 5
thing
©©6 ;
.
©©; <
Map
©©< ?
!=
©©@ B
null
©©C G
)
©©G H
{
™™  !
GenSpawn
´´$ ,
.
´´, -
Spawn
´´- 2
(
´´2 3
split
´´3 8
,
´´8 9
thing
´´: ?
.
´´? @
Position
´´@ H
,
´´H I
thing
´´J O
.
´´O P
Map
´´P S
)
´´S T
;
´´T U
if
¨¨$ &
(
¨¨' ($
DigitalStorageSettings
¨¨( >
.
¨¨> ?!
enableConversionLog
¨¨? R
)
¨¨R S
{
≠≠$ %
Log
ÆÆ( +
.
ÆÆ+ ,
Message
ÆÆ, 3
(
ÆÆ3 4
$"
ÆÆ4 6
$str
ÆÆ6 c
{
ÆÆc d
split
ÆÆd i
.
ÆÆi j
Label
ÆÆj o
}
ÆÆo p
$str
ÆÆp r
{
ÆÆr s
split
ÆÆs x
.
ÆÆx y

stackCountÆÆy É
}ÆÆÉ Ñ
$strÆÆÑ ä
{ÆÆä ã
thingÆÆã ê
.ÆÆê ë
PositionÆÆë ô
}ÆÆô ö
"ÆÆö õ
)ÆÆõ ú
;ÆÆú ù
}
ØØ$ %
}
∞∞  !
	toConvert
±±  )
.
±±) *
Add
±±* -
(
±±- .
split
±±. 3
)
±±3 4
;
±±4 5
	converted
≤≤  )
+=
≤≤* ,
split
≤≤- 2
.
≤≤2 3

stackCount
≤≤3 =
;
≤≤= >
}
≥≥ 
else
¥¥  
{
µµ 
if
∂∂  "
(
∂∂# $$
DigitalStorageSettings
∂∂$ :
.
∂∂: ;!
enableConversionLog
∂∂; N
)
∂∂N O
{
∑∑  !
Log
∏∏$ '
.
∏∏' (
Message
∏∏( /
(
∏∏/ 0
$"
∏∏0 2
$str
∏∏2 b
{
∏∏b c
(
∏∏c d
split
∏∏d i
!=
∏∏j l
null
∏∏m q
?
∏∏r s
split
∏∏t y
.
∏∏y z

stackCount∏∏z Ñ
.∏∏Ñ Ö
ToString∏∏Ö ç
(∏∏ç é
)∏∏é è
:∏∏ê ë
$str∏∏í ò
)∏∏ò ô
}∏∏ô ö
"∏∏ö õ
)∏∏õ ú
;∏∏ú ù
}
ππ  !
}
∫∫ 
}
ªª 
}
ºº 
if
ææ 
(
ææ $
DigitalStorageSettings
ææ .
.
ææ. /!
enableConversionLog
ææ/ B
)
ææB C
{
øø 
Log
¿¿ 
.
¿¿ 
Message
¿¿ #
(
¿¿# $
$"
¿¿$ &
$str
¿¿& N
{
¿¿N O
toConvertCount
¿¿O ]
}
¿¿] ^
$str
¿¿^ d
{
¿¿d e
	converted
¿¿e n
}
¿¿n o
"
¿¿o p
)
¿¿p q
;
¿¿q r
}
¡¡ 
}
¬¬ 
}
√√ 
if
≈≈ 
(
≈≈ 
	toConvert
≈≈ 
.
≈≈ 
Count
≈≈ 
==
≈≈  "
$num
≈≈# $
)
≈≈$ %
{
∆∆ 
if
«« 
(
«« $
DigitalStorageSettings
«« *
.
««* +!
enableConversionLog
««+ >
)
««> ?
{
»» 
Log
…… 
.
…… 
Message
…… 
(
……  
$"
……  "
$str
……" i
"
……i j
)
……j k
;
……k l
}
   
return
ÀÀ 
;
ÀÀ 
}
ÃÃ 
if
ŒŒ 
(
ŒŒ $
DigitalStorageSettings
ŒŒ &
.
ŒŒ& '!
enableConversionLog
ŒŒ' :
)
ŒŒ: ;
{
œœ 
Log
–– 
.
–– 
Message
–– 
(
–– 
$"
–– 
$str
–– S
{
––S T
	toConvert
––T ]
.
––] ^
Count
––^ c
}
––c d
$str
––d h
"
––h i
)
––i j
;
––j k
}
—— 
if
‘‘ 
(
‘‘ 
activeConversions
‘‘ !
.
‘‘! "
TryGetValue
‘‘" -
(
‘‘- .
core
‘‘. 2
,
‘‘2 3
out
‘‘4 7
ConversionState
‘‘8 G
existingState
‘‘H U
)
‘‘U V
)
‘‘V W
{
’’ 
existingState
◊◊ 
.
◊◊ 
	toConvert
◊◊ '
.
◊◊' (
AddRange
◊◊( 0
(
◊◊0 1
	toConvert
◊◊1 :
.
◊◊: ;
Except
◊◊; A
(
◊◊A B
existingState
◊◊B O
.
◊◊O P
	toConvert
◊◊P Y
)
◊◊Y Z
)
◊◊Z [
;
◊◊[ \
}
ÿÿ 
else
ŸŸ 
{
⁄⁄ 
activeConversions
‹‹ !
[
‹‹! "
core
‹‹" &
]
‹‹& '
=
‹‹( )
new
‹‹* -
ConversionState
‹‹. =
{
›› 
	toConvert
ﬁﬁ 
=
ﬁﬁ 
	toConvert
ﬁﬁ  )
}
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 
}
·· 	
public
ÊÊ 
static
ÊÊ 
void
ÊÊ 
Update
ÊÊ !
(
ÊÊ! "
)
ÊÊ" #
{
ÁÁ 	
if
ËË 
(
ËË 
activeConversions
ËË !
.
ËË! "
Count
ËË" '
==
ËË( *
$num
ËË+ ,
)
ËË, -
{
ÈÈ 
return
ÍÍ 
;
ÍÍ 
}
ÎÎ 
List
ÌÌ 
<
ÌÌ "
Building_StorageCore
ÌÌ %
>
ÌÌ% &
toRemove
ÌÌ' /
=
ÌÌ0 1
new
ÌÌ2 5
List
ÌÌ6 :
<
ÌÌ: ;"
Building_StorageCore
ÌÌ; O
>
ÌÌO P
(
ÌÌP Q
)
ÌÌQ R
;
ÌÌR S
foreach
ÔÔ 
(
ÔÔ 
var
ÔÔ 
kvp
ÔÔ 
in
ÔÔ 
activeConversions
ÔÔ  1
)
ÔÔ1 2
{
 "
Building_StorageCore
ÒÒ $
core
ÒÒ% )
=
ÒÒ* +
kvp
ÒÒ, /
.
ÒÒ/ 0
Key
ÒÒ0 3
;
ÒÒ3 4
ConversionState
ÚÚ 
state
ÚÚ  %
=
ÚÚ& '
kvp
ÚÚ( +
.
ÚÚ+ ,
Value
ÚÚ, 1
;
ÚÚ1 2
if
ÙÙ 
(
ÙÙ 
core
ÙÙ 
==
ÙÙ 
null
ÙÙ  
||
ÙÙ! #
!
ÙÙ$ %
core
ÙÙ% )
.
ÙÙ) *
Spawned
ÙÙ* 1
||
ÙÙ2 4
!
ÙÙ5 6
core
ÙÙ6 :
.
ÙÙ: ;
Powered
ÙÙ; B
)
ÙÙB C
{
ıı 
toRemove
ˆˆ 
.
ˆˆ 
Add
ˆˆ  
(
ˆˆ  !
core
ˆˆ! %
)
ˆˆ% &
;
ˆˆ& '
continue
˜˜ 
;
˜˜ 
}
¯¯ 
int
¸¸ 
prepared
¸¸ 
=
¸¸ 
$num
¸¸  
;
¸¸  !
while
˝˝ 
(
˝˝ 
state
˝˝ 
.
˝˝ 
dataPreparedIndex
˝˝ .
<
˝˝/ 0
state
˝˝1 6
.
˝˝6 7
	toConvert
˝˝7 @
.
˝˝@ A
Count
˝˝A F
&&
˝˝G I
prepared
˝˝J R
<
˝˝S T
state
˝˝U Z
.
˝˝Z [
itemsPerFrame
˝˝[ h
)
˝˝h i
{
˛˛ 
Thing
ˇˇ 
thing
ˇˇ 
=
ˇˇ  !
state
ˇˇ" '
.
ˇˇ' (
	toConvert
ˇˇ( 1
[
ˇˇ1 2
state
ˇˇ2 7
.
ˇˇ7 8
dataPreparedIndex
ˇˇ8 I
]
ˇˇI J
;
ˇˇJ K
if
ÅÅ 
(
ÅÅ 
thing
ÅÅ 
!=
ÅÅ  
null
ÅÅ! %
&&
ÅÅ& (
thing
ÅÅ) .
.
ÅÅ. /
Spawned
ÅÅ/ 6
&&
ÅÅ7 9
!
ÅÅ: ;
thing
ÅÅ; @
.
ÅÅ@ A
	Destroyed
ÅÅA J
)
ÅÅJ K
{
ÇÇ 
StoredItemData
ÑÑ &
data
ÑÑ' +
=
ÑÑ, -
new
ÑÑ. 1
StoredItemData
ÑÑ2 @
(
ÑÑ@ A
thing
ÑÑA F
)
ÑÑF G
;
ÑÑG H
ItemData
ÖÖ  
itemData
ÖÖ! )
=
ÖÖ* +!
GetOrCreateItemData
ÖÖ, ?
(
ÖÖ? @
thing
ÖÖ@ E
,
ÖÖE F
data
ÖÖG K
)
ÖÖK L
;
ÖÖL M
state
ÜÜ 
.
ÜÜ 
preparedData
ÜÜ *
.
ÜÜ* +
Add
ÜÜ+ .
(
ÜÜ. /
itemData
ÜÜ/ 7
)
ÜÜ7 8
;
ÜÜ8 9
}
áá 
state
ââ 
.
ââ 
dataPreparedIndex
ââ +
++
ââ+ -
;
ââ- .
prepared
ää 
++
ää 
;
ää 
}
ãã 
int
èè 
	processed
èè 
=
èè 
$num
èè  !
;
èè! "
while
êê 
(
êê 
state
êê 
.
êê 
despawnIndex
êê )
<
êê* +
state
êê, 1
.
êê1 2
preparedData
êê2 >
.
êê> ?
Count
êê? D
&&
êêE G
	processed
êêH Q
<
êêR S
state
êêT Y
.
êêY Z
itemsPerFrame
êêZ g
)
êêg h
{
ëë 
ItemData
íí 
itemData
íí %
=
íí& '
state
íí( -
.
íí- .
preparedData
íí. :
[
íí: ;
state
íí; @
.
íí@ A
despawnIndex
ííA M
]
ííM N
;
ííN O
Thing
ìì 
thing
ìì 
=
ìì  !
itemData
ìì" *
.
ìì* +
thing
ìì+ 0
;
ìì0 1
StoredItemData
îî "
data
îî# '
=
îî( )
itemData
îî* 2
.
îî2 3
data
îî3 7
;
îî7 8
if
ññ 
(
ññ 
thing
ññ 
!=
ññ  
null
ññ! %
&&
ññ& (
thing
ññ) .
.
ññ. /
Spawned
ññ/ 6
&&
ññ7 9
data
ññ: >
!=
ññ? A
null
ññB F
)
ññF G
{
óó 
core
ôô 
.
ôô 
StoreItemData
ôô *
(
ôô* +
data
ôô+ /
)
ôô/ 0
;
ôô0 1
thing
úú 
.
úú 
DeSpawn
úú %
(
úú% &
DestroyMode
úú& 1
.
úú1 2
Vanish
úú2 8
)
úú8 9
;
úú9 :
}
ùù 
state
üü 
.
üü 
despawnIndex
üü &
++
üü& (
;
üü( )
	processed
†† 
++
†† 
;
††  
}
°° 
if
•• 
(
•• 
state
•• 
.
•• 
dataPreparedIndex
•• +
>=
••, .
state
••/ 4
.
••4 5
	toConvert
••5 >
.
••> ?
Count
••? D
&&
••E G
state
¶¶ 
.
¶¶ 
despawnIndex
¶¶ &
>=
¶¶' )
state
¶¶* /
.
¶¶/ 0
preparedData
¶¶0 <
.
¶¶< =
Count
¶¶= B
)
¶¶B C
{
ßß 
state
®® 
.
®® 
	toConvert
®® #
.
®®# $
Clear
®®$ )
(
®®) *
)
®®* +
;
®®+ ,
ReturnToPool
™™  
(
™™  !
state
™™! &
.
™™& '
preparedData
™™' 3
)
™™3 4
;
™™4 5
state
´´ 
.
´´ 
preparedData
´´ &
.
´´& '
Clear
´´' ,
(
´´, -
)
´´- .
;
´´. /
toRemove
¨¨ 
.
¨¨ 
Add
¨¨  
(
¨¨  !
core
¨¨! %
)
¨¨% &
;
¨¨& '
}
≠≠ 
}
ÆÆ 
foreach
±± 
(
±± "
Building_StorageCore
±± )
core
±±* .
in
±±/ 1
toRemove
±±2 :
)
±±: ;
{
≤≤ 
activeConversions
≥≥ !
.
≥≥! "
Remove
≥≥" (
(
≥≥( )
core
≥≥) -
)
≥≥- .
;
≥≥. /
}
¥¥ 
}
µµ 	
private
∫∫ 
static
∫∫ 
string
∫∫ 

GetItemKey
∫∫ (
(
∫∫( )
Thing
∫∫) .
thing
∫∫/ 4
)
∫∫4 5
{
ªª 	
QualityCategory
ºº 
quality
ºº #
=
ºº$ %
thing
ºº& +
.
ºº+ ,

TryGetComp
ºº, 6
<
ºº6 7
CompQuality
ºº7 B
>
ººB C
(
ººC D
)
ººD E
?
ººE F
.
ººF G
Quality
ººG N
??
ººO Q
QualityCategory
ººR a
.
ººa b
Normal
ººb h
;
ººh i
string
ΩΩ 
	stuffName
ΩΩ 
=
ΩΩ 
thing
ΩΩ $
.
ΩΩ$ %
Stuff
ΩΩ% *
?
ΩΩ* +
.
ΩΩ+ ,
defName
ΩΩ, 3
??
ΩΩ4 6
$str
ΩΩ7 =
;
ΩΩ= >
return
ææ 
$"
ææ 
{
ææ 
thing
ææ 
.
ææ 
def
ææ 
.
ææ  
defName
ææ  '
}
ææ' (
$str
ææ( )
{
ææ) *
	stuffName
ææ* 3
}
ææ3 4
$str
ææ4 5
{
ææ5 6
quality
ææ6 =
}
ææ= >
"
ææ> ?
;
ææ? @
}
øø 	
public
ƒƒ 
static
ƒƒ 
bool
ƒƒ 
IsConverting
ƒƒ '
(
ƒƒ' ("
Building_StorageCore
ƒƒ( <
core
ƒƒ= A
)
ƒƒA B
{
≈≈ 	
return
∆∆ 
core
∆∆ 
!=
∆∆ 
null
∆∆ 
&&
∆∆  "
activeConversions
∆∆# 4
.
∆∆4 5
ContainsKey
∆∆5 @
(
∆∆@ A
core
∆∆A E
)
∆∆E F
;
∆∆F G
}
«« 	
public
ÃÃ 
static
ÃÃ 
void
ÃÃ 
ClearAll
ÃÃ #
(
ÃÃ# $
)
ÃÃ$ %
{
ÕÕ 	
activeConversions
ŒŒ 
.
ŒŒ 
Clear
ŒŒ #
(
ŒŒ# $
)
ŒŒ$ %
;
ŒŒ% &
_itemDataPool
–– 
.
–– 
Clear
–– 
(
––  
)
––  !
;
––! "
}
—— 	
}
““ 
}”” ¢
YB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Services\PawnStorageAccess.cs
	namespace 	
DigitalStorage
 
. 
Services !
{ 
public 

static 
class 
PawnStorageAccess )
{		 
public

 
static

 
bool

 
HasTerminalImplant

 -
(

- .
Pawn

. 2
pawn

3 7
)

7 8
{ 	
if 
( 
pawn 
== 
null 
|| 
pawn  $
.$ %
health% +
==, .
null/ 3
||4 6
pawn7 ;
.; <
health< B
.B C
	hediffSetC L
==M O
nullP T
)T U
{ 
return 
false 
; 
} 
if 
( 
pawn 
. 
health 
. 
	hediffSet %
.% &
	HasHediff& /
(/ 0
DefDatabase0 ;
<; <
	HediffDef< E
>E F
.F G
GetNamedG O
(O P
$strP p
,p q
falser w
)w x
,x y
falsez 
)	 Ä
)
Ä Å
{ 
return 
true 
; 
} 
if 
( 
pawn 
. 
IsColonyMech !
)! "
{ 
Pawn 
overseer 
= 
pawn  $
.$ %
GetOverseer% 0
(0 1
)1 2
;2 3
if 
( 
overseer 
!= 
null  $
&&% '
overseer( 0
.0 1
health1 7
!=8 :
null; ?
&&@ B
overseerC K
.K L
healthL R
.R S
	hediffSetS \
!=] _
null` d
)d e
{ 
if 
( 
overseer  
.  !
health! '
.' (
	hediffSet( 1
.1 2
	HasHediff2 ;
(; <
DefDatabase< G
<G H
	HediffDefH Q
>Q R
.R S
GetNamedS [
([ \
$str\ |
,| }
false	~ É
)
É Ñ
,
Ñ Ö
false
Ü ã
)
ã å
)
å ç
{ 
return 
true #
;# $
}   
}!! 
}"" 
return$$ 
false$$ 
;$$ 
}%% 	
}&& 
}'' Å∂
cB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Services\DigitalStorageGameComponent.cs
	namespace 	
DigitalStorage
 
. 
Services !
{ 
public 

class '
DigitalStorageGameComponent ,
:- .
GameComponent/ <
{ 
public '
DigitalStorageGameComponent *
(* +
Game+ /
game0 4
)4 5
{ 	
} 	
public 
override 
void 
GameComponentTick .
(. /
)/ 0
{ 	
base 
. 
GameComponentTick "
(" #
)# $
;$ %
} 	
public 
override 
void 
GameComponentUpdate 0
(0 1
)1 2
{ 	
base 
. 
GameComponentUpdate $
($ %
)% &
;& '
AsyncItemConverter!! 
.!! 
Update!! %
(!!% &
)!!& '
;!!' (
}"" 	
public$$ 
override$$ 
void$$ 

ExposeData$$ '
($$' (
)$$( )
{%% 	
base&& 
.&& 

ExposeData&& 
(&& 
)&& 
;&& 
Scribe_Collections'' 
.'' 
Look'' #
<''# $ 
Building_StorageCore''$ 8
>''8 9
(''9 :
ref'': =
this''> B
.''B C
globalCores''C N
,''N O
$str''P ]
,''] ^
LookMode''_ g
.''g h
	Reference''h q
)''q r
;''r s
if(( 
((( 
Scribe(( 
.(( 
mode(( 
==(( 
LoadSaveMode(( +
.((+ ,
LoadingVars((, 7
)((7 8
{)) 
if** 
(** 
this** 
.** 
globalCores** $
==**% '
null**( ,
)**, -
{++ 
this,, 
.,, 
globalCores,, $
=,,% &
new,,' *
List,,+ /
<,,/ 0 
Building_StorageCore,,0 D
>,,D E
(,,E F
),,F G
;,,G H
}-- 
this.. 
... 
RebuildCache.. !
(..! "
).." #
;..# $
}// 
}00 	
public22 
void22 
RegisterCore22  
(22  ! 
Building_StorageCore22! 5
core226 :
)22: ;
{33 	
if44 
(44 
core44 
==44 
null44 
||44 
this44  $
.44$ %
globalCores44% 0
.440 1
Contains441 9
(449 :
core44: >
)44> ?
)44? @
{55 
return66 
;66 
}77 
this99 
.99 
globalCores99 
.99 
Add99  
(99  !
core99! %
)99% &
;99& '
if;; 
(;; 
core;; 
.;; 
Map;; 
!=;; 
null;;  
);;  !
{<< 
if== 
(== 
!== 
this== 
.== 

coresByMap== $
.==$ %
TryGetValue==% 0
(==0 1
core==1 5
.==5 6
Map==6 9
,==9 :
out==; >
List==? C
<==C D 
Building_StorageCore==D X
>==X Y
list==Z ^
)==^ _
)==_ `
{>> 
list?? 
=?? 
new?? 
List?? #
<??# $ 
Building_StorageCore??$ 8
>??8 9
(??9 :
)??: ;
;??; <
this@@ 
.@@ 

coresByMap@@ #
[@@# $
core@@$ (
.@@( )
Map@@) ,
]@@, -
=@@. /
list@@0 4
;@@4 5
}AA 
ifCC 
(CC 
!CC 
listCC 
.CC 
ContainsCC "
(CC" #
coreCC# '
)CC' (
)CC( )
{DD 
listEE 
.EE 
AddEE 
(EE 
coreEE !
)EE! "
;EE" #
}FF 
}GG 
}HH 	
publicJJ 
voidJJ 
DeregisterCoreJJ "
(JJ" # 
Building_StorageCoreJJ# 7
coreJJ8 <
)JJ< =
{KK 	
ifLL 
(LL 
coreLL 
==LL 
nullLL 
)LL 
{MM 
returnNN 
;NN 
}OO 
thisQQ 
.QQ 
globalCoresQQ 
.QQ 
RemoveQQ #
(QQ# $
coreQQ$ (
)QQ( )
;QQ) *
ifSS 
(SS 
coreSS 
.SS 
MapSS 
!=SS 
nullSS  
&&SS! #
thisSS$ (
.SS( )

coresByMapSS) 3
.SS3 4
TryGetValueSS4 ?
(SS? @
coreSS@ D
.SSD E
MapSSE H
,SSH I
outSSJ M
ListSSN R
<SSR S 
Building_StorageCoreSSS g
>SSg h
listSSi m
)SSm n
)SSn o
{TT 
listUU 
.UU 
RemoveUU 
(UU 
coreUU  
)UU  !
;UU! "
}VV 
}WW 	
public\\ 
List\\ 
<\\  
Building_StorageCore\\ (
>\\( )
GetAllCores\\* 5
(\\5 6
)\\6 7
{]] 	
this^^ 
.^^ 
globalCores^^ 
.^^ 
	RemoveAll^^ &
(^^& '
(^^' ( 
Building_StorageCore^^( <
c^^= >
)^^> ?
=>^^@ B
c^^C D
==^^E G
null^^H L
||^^M O
c^^P Q
.^^Q R
	Destroyed^^R [
)^^[ \
;^^\ ]
return__ 
this__ 
.__ 
globalCores__ #
;__# $
}`` 	
publicee 
Listee 
<ee  
Building_StorageCoreee (
>ee( )
GetCoresOnMapee* 7
(ee7 8
Mapee8 ;
mapee< ?
)ee? @
{ff 	
ifgg 
(gg 
mapgg 
==gg 
nullgg 
)gg 
{hh 
returnii 
newii 
Listii 
<ii   
Building_StorageCoreii  4
>ii4 5
(ii5 6
)ii6 7
;ii7 8
}jj 
ifll 
(ll 
thisll 
.ll 

coresByMapll 
.ll  
TryGetValuell  +
(ll+ ,
mapll, /
,ll/ 0
outll1 4
Listll5 9
<ll9 : 
Building_StorageCorell: N
>llN O
listllP T
)llT U
)llU V
{mm 
listnn 
.nn 
	RemoveAllnn 
(nn 
(nn   
Building_StorageCorenn  4
cnn5 6
)nn6 7
=>nn8 :
cnn; <
==nn= ?
nullnn@ D
||nnE G
cnnH I
.nnI J
	DestroyednnJ S
)nnS T
;nnT U
returnoo 
listoo 
;oo 
}pp 
returnrr 
newrr 
Listrr 
<rr  
Building_StorageCorerr 0
>rr0 1
(rr1 2
)rr2 3
;rr3 4
}ss 	
privatexx 
voidxx 
RebuildCachexx !
(xx! "
)xx" #
{yy 	
thiszz 
.zz 

coresByMapzz 
.zz 
Clearzz !
(zz! "
)zz" #
;zz# $
this{{ 
.{{ 
globalCores{{ 
.{{ 
	RemoveAll{{ &
({{& '
({{' ( 
Building_StorageCore{{( <
c{{= >
){{> ?
=>{{@ B
c{{C D
=={{E G
null{{H L
||{{M O
c{{P Q
.{{Q R
	Destroyed{{R [
){{[ \
;{{\ ]
foreach}} 
(}}  
Building_StorageCore}} )
core}}* .
in}}/ 1
this}}2 6
.}}6 7
globalCores}}7 B
)}}B C
{~~ 
if 
( 
core 
. 
Map 
!= 
null  $
)$ %
{
ÄÄ 
if
ÅÅ 
(
ÅÅ 
!
ÅÅ 
this
ÅÅ 
.
ÅÅ 

coresByMap
ÅÅ (
.
ÅÅ( )
TryGetValue
ÅÅ) 4
(
ÅÅ4 5
core
ÅÅ5 9
.
ÅÅ9 :
Map
ÅÅ: =
,
ÅÅ= >
out
ÅÅ? B
List
ÅÅC G
<
ÅÅG H"
Building_StorageCore
ÅÅH \
>
ÅÅ\ ]
list
ÅÅ^ b
)
ÅÅb c
)
ÅÅc d
{
ÇÇ 
list
ÉÉ 
=
ÉÉ 
new
ÉÉ "
List
ÉÉ# '
<
ÉÉ' ("
Building_StorageCore
ÉÉ( <
>
ÉÉ< =
(
ÉÉ= >
)
ÉÉ> ?
;
ÉÉ? @
this
ÑÑ 
.
ÑÑ 

coresByMap
ÑÑ '
[
ÑÑ' (
core
ÑÑ( ,
.
ÑÑ, -
Map
ÑÑ- 0
]
ÑÑ0 1
=
ÑÑ2 3
list
ÑÑ4 8
;
ÑÑ8 9
}
ÖÖ 
list
ÜÜ 
.
ÜÜ 
Add
ÜÜ 
(
ÜÜ 
core
ÜÜ !
)
ÜÜ! "
;
ÜÜ" #
}
áá 
}
àà 
}
ââ 	
public
éé "
Building_StorageCore
éé #"
FindCoreWithItemType
éé$ 8
(
éé8 9
ThingDef
éé9 A
def
ééB E
,
ééE F
ThingDef
ééG O
stuff
ééP U
=
ééV W
null
ééX \
,
éé\ ]
Map
éé^ a
preferredMap
ééb n
=
ééo p
null
ééq u
)
ééu v
{
èè 	
if
ëë 
(
ëë 
preferredMap
ëë 
!=
ëë 
null
ëë  $
)
ëë$ %
{
íí 
List
ìì 
<
ìì "
Building_StorageCore
ìì )
>
ìì) *
mapCores
ìì+ 3
=
ìì4 5
this
ìì6 :
.
ìì: ;
GetCoresOnMap
ìì; H
(
ììH I
preferredMap
ììI U
)
ììU V
;
ììV W
foreach
îî 
(
îî "
Building_StorageCore
îî -
core
îî. 2
in
îî3 5
mapCores
îî6 >
)
îî> ?
{
ïï 
if
ññ 
(
ññ 
core
ññ 
!=
ññ 
null
ññ  $
&&
ññ% '
core
ññ( ,
.
ññ, -
Spawned
ññ- 4
&&
ññ5 7
core
ññ8 <
.
ññ< =
Powered
ññ= D
)
ññD E
{
óó 
if
òò 
(
òò 
core
òò  
.
òò  !
HasItem
òò! (
(
òò( )
def
òò) ,
,
òò, -
stuff
òò. 3
)
òò3 4
)
òò4 5
{
ôô 
return
öö "
core
öö# '
;
öö' (
}
õõ 
}
úú 
}
ùù 
}
ûû 
Map
°° 
preferredBaseMap
°°  
=
°°! "

GetBaseMap
°°# -
(
°°- .
preferredMap
°°. :
)
°°: ;
;
°°; <
HashSet
¢¢ 
<
¢¢ 
Map
¢¢ 
>
¢¢ 
searchedMaps
¢¢ %
=
¢¢& '
new
¢¢( +
HashSet
¢¢, 3
<
¢¢3 4
Map
¢¢4 7
>
¢¢7 8
(
¢¢8 9
)
¢¢9 :
;
¢¢: ;
if
££ 
(
££ 
preferredMap
££ 
!=
££ 
null
££  $
)
££$ %
{
§§ 
searchedMaps
•• 
.
•• 
Add
••  
(
••  !
preferredMap
••! -
)
••- .
;
••. /
}
¶¶ 
foreach
®® 
(
®® "
Building_StorageCore
®® )
core
®®* .
in
®®/ 1
this
®®2 6
.
®®6 7
GetAllCores
®®7 B
(
®®B C
)
®®C D
)
®®D E
{
©© 
if
™™ 
(
™™ 
core
™™ 
==
™™ 
null
™™  
||
™™! #
!
™™$ %
core
™™% )
.
™™) *
Spawned
™™* 1
||
™™2 4
!
™™5 6
core
™™6 :
.
™™: ;
Powered
™™; B
||
™™C E
core
™™F J
.
™™J K
Map
™™K N
==
™™O Q
null
™™R V
)
™™V W
{
´´ 
continue
¨¨ 
;
¨¨ 
}
≠≠ 
Map
∞∞ 
coreBaseMap
∞∞ 
=
∞∞  !

GetBaseMap
∞∞" ,
(
∞∞, -
core
∞∞- 1
.
∞∞1 2
Map
∞∞2 5
)
∞∞5 6
;
∞∞6 7
if
±± 
(
±± 
preferredBaseMap
±± $
!=
±±% '
null
±±( ,
&&
±±- /
coreBaseMap
±±0 ;
==
±±< >
preferredBaseMap
±±? O
)
±±O P
{
≤≤ 
continue
≥≥ 
;
≥≥ 
}
¥¥ 
if
∑∑ 
(
∑∑ 
searchedMaps
∑∑  
.
∑∑  !
Contains
∑∑! )
(
∑∑) *
core
∑∑* .
.
∑∑. /
Map
∑∑/ 2
)
∑∑2 3
)
∑∑3 4
{
∏∏ 
continue
ππ 
;
ππ 
}
∫∫ 
if
ºº 
(
ºº 
core
ºº 
.
ºº 
HasItem
ºº  
(
ºº  !
def
ºº! $
,
ºº$ %
stuff
ºº& +
)
ºº+ ,
)
ºº, -
{
ΩΩ 
return
ææ 
core
ææ 
;
ææ  
}
øø 
searchedMaps
¬¬ 
.
¬¬ 
Add
¬¬  
(
¬¬  !
core
¬¬! %
.
¬¬% &
Map
¬¬& )
)
¬¬) *
;
¬¬* +
}
√√ 
return
≈≈ 
null
≈≈ 
;
≈≈ 
}
∆∆ 	
private
ÀÀ 
Map
ÀÀ 

GetBaseMap
ÀÀ 
(
ÀÀ 
Map
ÀÀ "
map
ÀÀ# &
)
ÀÀ& '
{
ÃÃ 	
if
ÕÕ 
(
ÕÕ 
map
ÕÕ 
==
ÕÕ 
null
ÕÕ 
)
ÕÕ 
{
ŒŒ 
return
œœ 
null
œœ 
;
œœ 
}
–– 
try
”” 
{
‘‘ 
var
’’ 
baseMapMethod
’’ !
=
’’" #
typeof
’’$ *
(
’’* +
Map
’’+ .
)
’’. /
.
’’/ 0
	GetMethod
’’0 9
(
’’9 :
$str
’’: C
,
’’C D
System
’’E K
.
’’K L

Reflection
’’L V
.
’’V W
BindingFlags
’’W c
.
’’c d
Public
’’d j
|
’’k l
System
’’m s
.
’’s t

Reflection
’’t ~
.
’’~ 
BindingFlags’’ ã
.’’ã å
Instance’’å î
)’’î ï
;’’ï ñ
if
÷÷ 
(
÷÷ 
baseMapMethod
÷÷ !
!=
÷÷" $
null
÷÷% )
)
÷÷) *
{
◊◊ 
return
ÿÿ 
baseMapMethod
ÿÿ (
.
ÿÿ( )
Invoke
ÿÿ) /
(
ÿÿ/ 0
map
ÿÿ0 3
,
ÿÿ3 4
null
ÿÿ5 9
)
ÿÿ9 :
as
ÿÿ; =
Map
ÿÿ> A
??
ÿÿB D
map
ÿÿE H
;
ÿÿH I
}
ŸŸ 
}
⁄⁄ 
catch
€€ 
{
‹‹ 
}
ﬁﬁ 
return
‡‡ 
map
‡‡ 
;
‡‡ 
}
·· 	
public
ÊÊ "
Building_StorageCore
ÊÊ #
FindCoreWithItem
ÊÊ$ 4
(
ÊÊ4 5
Thing
ÊÊ5 :
item
ÊÊ; ?
)
ÊÊ? @
{
ÁÁ 	
if
ËË 
(
ËË 
item
ËË 
==
ËË 
null
ËË 
)
ËË 
{
ÈÈ 
return
ÍÍ 
null
ÍÍ 
;
ÍÍ 
}
ÎÎ 
if
ÓÓ 
(
ÓÓ 
item
ÓÓ 
.
ÓÓ 
Spawned
ÓÓ 
&&
ÓÓ 
item
ÓÓ  $
.
ÓÓ$ %
Map
ÓÓ% (
!=
ÓÓ) +
null
ÓÓ, 0
)
ÓÓ0 1
{
ÔÔ (
DigitalStorageMapComponent
 *
mapComp
+ 2
=
3 4
item
5 9
.
9 :
Map
: =
.
= >
GetComponent
> J
<
J K(
DigitalStorageMapComponent
K e
>
e f
(
f g
)
g h
;
h i"
Building_StorageCore
ÒÒ $
core
ÒÒ% )
=
ÒÒ* +
mapComp
ÒÒ, 3
?
ÒÒ3 4
.
ÒÒ4 5
FindCoreWithItem
ÒÒ5 E
(
ÒÒE F
item
ÒÒF J
)
ÒÒJ K
;
ÒÒK L
if
ÚÚ 
(
ÚÚ 
core
ÚÚ 
!=
ÚÚ 
null
ÚÚ  
)
ÚÚ  !
{
ÛÛ 
return
ÙÙ 
core
ÙÙ 
;
ÙÙ  
}
ıı 
}
ˆˆ 
return
˘˘ 
this
˘˘ 
.
˘˘ "
FindCoreWithItemType
˘˘ ,
(
˘˘, -
item
˘˘- 1
.
˘˘1 2
def
˘˘2 5
,
˘˘5 6
item
˘˘7 ;
.
˘˘; <
Stuff
˘˘< A
,
˘˘A B
item
˘˘C G
.
˘˘G H
Map
˘˘H K
)
˘˘K L
;
˘˘L M
}
˙˙ 	
public
ˇˇ 
Thing
ˇˇ -
TryExtractItemFromAnyCoreGlobal
ˇˇ 4
(
ˇˇ4 5
ThingDef
ˇˇ5 =
def
ˇˇ> A
,
ˇˇA B
int
ˇˇC F
count
ˇˇG L
,
ˇˇL M
ThingDef
ˇˇN V
stuff
ˇˇW \
=
ˇˇ] ^
null
ˇˇ_ c
,
ˇˇc d
Map
ˇˇe h
preferredMap
ˇˇi u
=
ˇˇv w
null
ˇˇx |
)
ˇˇ| }
{
ÄÄ 	
if
ÇÇ 
(
ÇÇ 
preferredMap
ÇÇ 
!=
ÇÇ 
null
ÇÇ  $
)
ÇÇ$ %
{
ÉÉ 
List
ÑÑ 
<
ÑÑ "
Building_StorageCore
ÑÑ )
>
ÑÑ) *
mapCores
ÑÑ+ 3
=
ÑÑ4 5
this
ÑÑ6 :
.
ÑÑ: ;
GetCoresOnMap
ÑÑ; H
(
ÑÑH I
preferredMap
ÑÑI U
)
ÑÑU V
;
ÑÑV W
foreach
ÖÖ 
(
ÖÖ "
Building_StorageCore
ÖÖ -
core
ÖÖ. 2
in
ÖÖ3 5
mapCores
ÖÖ6 >
)
ÖÖ> ?
{
ÜÜ 
if
áá 
(
áá 
core
áá 
!=
áá 
null
áá  $
&&
áá% '
core
áá( ,
.
áá, -
Spawned
áá- 4
&&
áá5 7
core
áá8 <
.
áá< =
Powered
áá= D
)
ááD E
{
àà 
if
ââ 
(
ââ 
core
ââ  
.
ââ  !
HasItem
ââ! (
(
ââ( )
def
ââ) ,
,
ââ, -
stuff
ââ. 3
)
ââ3 4
)
ââ4 5
{
ää 
Thing
ãã !
	extracted
ãã" +
=
ãã, -
core
ãã. 2
.
ãã2 3
ExtractItem
ãã3 >
(
ãã> ?
def
ãã? B
,
ããB C
count
ããD I
,
ããI J
stuff
ããK P
)
ããP Q
;
ããQ R
if
åå 
(
åå  
	extracted
åå  )
!=
åå* ,
null
åå- 1
)
åå1 2
{
çç 
return
éé  &
	extracted
éé' 0
;
éé0 1
}
èè 
}
êê 
}
ëë 
}
íí 
}
ìì 
Map
ññ 
preferredBaseMap
ññ  
=
ññ! "

GetBaseMap
ññ# -
(
ññ- .
preferredMap
ññ. :
)
ññ: ;
;
ññ; <
HashSet
óó 
<
óó 
Map
óó 
>
óó 
searchedMaps
óó %
=
óó& '
new
óó( +
HashSet
óó, 3
<
óó3 4
Map
óó4 7
>
óó7 8
(
óó8 9
)
óó9 :
;
óó: ;
if
òò 
(
òò 
preferredMap
òò 
!=
òò 
null
òò  $
)
òò$ %
{
ôô 
searchedMaps
öö 
.
öö 
Add
öö  
(
öö  !
preferredMap
öö! -
)
öö- .
;
öö. /
}
õõ 
foreach
ùù 
(
ùù "
Building_StorageCore
ùù )
core
ùù* .
in
ùù/ 1
this
ùù2 6
.
ùù6 7
GetAllCores
ùù7 B
(
ùùB C
)
ùùC D
)
ùùD E
{
ûû 
if
üü 
(
üü 
core
üü 
==
üü 
null
üü  
||
üü! #
!
üü$ %
core
üü% )
.
üü) *
Spawned
üü* 1
||
üü2 4
!
üü5 6
core
üü6 :
.
üü: ;
Powered
üü; B
||
üüC E
core
üüF J
.
üüJ K
Map
üüK N
==
üüO Q
null
üüR V
)
üüV W
{
†† 
continue
°° 
;
°° 
}
¢¢ 
Map
•• 
coreBaseMap
•• 
=
••  !

GetBaseMap
••" ,
(
••, -
core
••- 1
.
••1 2
Map
••2 5
)
••5 6
;
••6 7
if
¶¶ 
(
¶¶ 
preferredBaseMap
¶¶ $
!=
¶¶% '
null
¶¶( ,
&&
¶¶- /
coreBaseMap
¶¶0 ;
==
¶¶< >
preferredBaseMap
¶¶? O
)
¶¶O P
{
ßß 
continue
®® 
;
®® 
}
©© 
if
¨¨ 
(
¨¨ 
searchedMaps
¨¨  
.
¨¨  !
Contains
¨¨! )
(
¨¨) *
core
¨¨* .
.
¨¨. /
Map
¨¨/ 2
)
¨¨2 3
)
¨¨3 4
{
≠≠ 
continue
ÆÆ 
;
ÆÆ 
}
ØØ 
if
±± 
(
±± 
core
±± 
.
±± 
HasItem
±±  
(
±±  !
def
±±! $
,
±±$ %
stuff
±±& +
)
±±+ ,
)
±±, -
{
≤≤ 
Thing
≥≥ 
	extracted
≥≥ #
=
≥≥$ %
core
≥≥& *
.
≥≥* +
ExtractItem
≥≥+ 6
(
≥≥6 7
def
≥≥7 :
,
≥≥: ;
count
≥≥< A
,
≥≥A B
stuff
≥≥C H
)
≥≥H I
;
≥≥I J
if
¥¥ 
(
¥¥ 
	extracted
¥¥ !
!=
¥¥" $
null
¥¥% )
)
¥¥) *
{
µµ 
return
∂∂ 
	extracted
∂∂ (
;
∂∂( )
}
∑∑ 
}
∏∏ 
searchedMaps
ªª 
.
ªª 
Add
ªª  
(
ªª  !
core
ªª! %
.
ªª% &
Map
ªª& )
)
ªª) *
;
ªª* +
}
ºº 
return
ææ 
null
ææ 
;
ææ 
}
øø 	
private
¡¡ 
List
¡¡ 
<
¡¡ "
Building_StorageCore
¡¡ )
>
¡¡) *
globalCores
¡¡+ 6
=
¡¡7 8
new
¡¡9 <
List
¡¡= A
<
¡¡A B"
Building_StorageCore
¡¡B V
>
¡¡V W
(
¡¡W X
)
¡¡X Y
;
¡¡Y Z
private
¬¬ 

Dictionary
¬¬ 
<
¬¬ 
Map
¬¬ 
,
¬¬ 
List
¬¬  $
<
¬¬$ %"
Building_StorageCore
¬¬% 9
>
¬¬9 :
>
¬¬: ;

coresByMap
¬¬< F
=
¬¬G H
new
¬¬I L

Dictionary
¬¬M W
<
¬¬W X
Map
¬¬X [
,
¬¬[ \
List
¬¬] a
<
¬¬a b"
Building_StorageCore
¬¬b v
>
¬¬v w
>
¬¬w x
(
¬¬x y
)
¬¬y z
;
¬¬z {
}
√√ 
}ƒƒ ÿ#
iB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Achtung_Compatibility.cs
	namespace		 	
DigitalStorage		
 
.		 
HarmonyPatches		 '
{

 
[ 
HarmonyPatch 
( 
typeof 
( 
ReservationManager +
)+ ,
,, -
$str. :
): ;
]; <
public 

static 
class 7
+Patch_ReservationManager_CanReserve_Achtung C
{ 
public 
static 
void 
Postfix "
(" #
ref 
bool 
__result 
, 
ReservationManager 

__instance )
,) *
Pawn 
claimant 
, 
LocalTargetInfo 
target "
," #
int 
maxPawns 
, 
int 

stackCount 
, 
ReservationLayerDef 
layer  %
,% &
bool #
ignoreOtherReservations (
)( )
{ 	
if 
( 
__result 
) 
{ 
return 
; 
} 
if"" 
("" 
!"" 
target"" 
."" 
HasThing""  
)""  !
{## 
return$$ 
;$$ 
}%% 
Thing'' 
thing'' 
='' 
target''  
.''  !
Thing''! &
;''& '
if(( 
((( 
thing(( 
==(( 
null(( 
||((  
claimant((! )
==((* ,
null((- 1
)((1 2
{)) 
return** 
;** 
}++ 
if.. 
(.. 
!.. 
PawnStorageAccess.. "
..." #
HasTerminalImplant..# 5
(..5 6
claimant..6 >
)..> ?
)..? @
{// 
return00 
;00 
}11 
if44 
(44 
thing44 
.44 
Map44 
==44 
claimant44 %
.44% &
Map44& )
)44) *
{55 
return66 
;66 
}77 
Game:: 
game:: 
=:: 
Current:: 
.::  
Game::  $
;::$ %'
DigitalStorageGameComponent;; '
gameComp;;( 0
=;;1 2
(;;3 4
game;;4 8
!=;;9 ;
null;;< @
);;@ A
?;;B C
game;;D H
.;;H I
GetComponent;;I U
<;;U V'
DigitalStorageGameComponent;;V q
>;;q r
(;;r s
);;s t
:;;u v
null;;w {
;;;{ |
if<< 
(<< 
gameComp<< 
==<< 
null<<  
)<<  !
{== 
return>> 
;>> 
}??  
Building_StorageCoreBB  
coreBB! %
=BB& '
gameCompBB( 0
.BB0 1
FindCoreWithItemBB1 A
(BBA B
thingBBB G
)BBG H
;BBH I
ifCC 
(CC 
coreCC 
==CC 
nullCC 
||CC 
!CC  !
coreCC! %
.CC% &
PoweredCC& -
)CC- .
{DD 
returnEE 
;EE 
}FF 
	SlotGroupII 
	slotGroupII 
=II  !
coreII" &
.II& '
GetSlotGroupII' 3
(II3 4
)II4 5
;II5 6
ifJJ 
(JJ 
	slotGroupJJ 
==JJ 
nullJJ !
)JJ! "
{KK 
returnLL 
;LL 
}MM 
boolOO 

itemInCoreOO 
=OO 
falseOO #
;OO# $
foreachPP 
(PP 
ThingPP 
	heldThingPP $
inPP% '
	slotGroupPP( 1
.PP1 2

HeldThingsPP2 <
)PP< =
{QQ 
ifRR 
(RR 
	heldThingRR 
==RR  
thingRR! &
)RR& '
{SS 

itemInCoreTT 
=TT  
trueTT! %
;TT% &
breakUU 
;UU 
}VV 
}WW 
ifYY 
(YY 
!YY 

itemInCoreYY 
)YY 
{ZZ 
return[[ 
;[[ 
}\\ 
__result__ 
=__ 
true__ 
;__ 
}`` 	
}aa 
}bb Œ'
oB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_PickUpAndHaul_Compatibility.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[

 
HarmonyPatch

 
(

 
typeof

 
(

 
Pawn_JobTracker

 (
)

( )
,

) *
$str

+ 5
)

5 6
]

6 7
public 

static 
class +
Patch_PickUpAndHaul_FixJobCount 7
{ 
public 
static 
void 
Prefix !
(! "
Job" %
newJob& ,
,, -
Pawn. 2
___pawn3 :
): ;
{ 	
if 
( 
newJob 
== 
null 
|| !
___pawn" )
==* ,
null- 1
)1 2
{ 
return 
; 
} 
if 
( 
newJob 
. 
def 
. 
defName "
!=# %
$str& 7
)7 8
{ 
return 
; 
} 
if 
( 
newJob 
. 
targetQueueA #
!=$ &
null' +
&&, .
newJob/ 5
.5 6

countQueue6 @
!=A C
nullD H
)H I
{ 
for 
( 
int 
i 
= 
$num 
; 
i  !
<" #
newJob$ *
.* +

countQueue+ 5
.5 6
Count6 ;
;; <
i= >
++> @
)@ A
{ 
if 
( 
newJob 
. 

countQueue )
[) *
i* +
]+ ,
<=- /
$num0 1
)1 2
{   
if"" 
("" 
i"" 
<"" 
newJob""  &
.""& '
targetQueueA""' 3
.""3 4
Count""4 9
&&"": <
newJob""= C
.""C D
targetQueueA""D P
[""P Q
i""Q R
]""R S
.""S T
HasThing""T \
)""\ ]
{## 
Thing$$ !
thing$$" '
=$$( )
newJob$$* 0
.$$0 1
targetQueueA$$1 =
[$$= >
i$$> ?
]$$? @
.$$@ A
Thing$$A F
;$$F G
newJob%% "
.%%" #

countQueue%%# -
[%%- .
i%%. /
]%%/ 0
=%%1 2
thing%%3 8
.%%8 9

stackCount%%9 C
;%%C D
}&& 
else'' 
{(( 
newJob)) "
.))" #

countQueue))# -
[))- .
i)). /
]))/ 0
=))1 2
$num))3 4
;))4 5
}** 
}++ 
},, 
}-- 
if00 
(00 
newJob00 
.00 
count00 
<=00 
$num00  !
&&00" $
newJob00% +
.00+ ,
targetA00, 3
.003 4
HasThing004 <
)00< =
{11 
newJob22 
.22 
count22 
=22 
newJob22 %
.22% &
targetA22& -
.22- .
Thing22. 3
.223 4

stackCount224 >
;22> ?
}33 
}44 	
}55 
[:: 
HarmonyPatch:: 
(:: 
typeof:: 
(:: 

Toils_Haul:: #
)::# $
,::$ %
$str::& :
)::: ;
]::; <
public;; 

static;; 
class;; 2
&Patch_PickUpAndHaul_ErrorCheckForCarry;; >
{<< 
public== 
static== 
void== 
Prefix== !
(==! "
Pawn==" &
pawn==' +
,==+ ,
Thing==- 2
	haulThing==3 <
)==< =
{>> 	
if?? 
(?? 
pawn?? 
==?? 
null?? 
||?? 
	haulThing??  )
==??* ,
null??- 1
)??1 2
{@@ 
returnAA 
;AA 
}BB 
JobDD 
curJobDD 
=DD 
pawnDD 
.DD 
CurJobDD $
;DD$ %
ifEE 
(EE 
curJobEE 
==EE 
nullEE 
)EE 
{FF 
returnGG 
;GG 
}HH 
ifKK 
(KK 
curJobKK 
.KK 
countKK 
<=KK 
$numKK  !
||KK" $
curJobKK% +
.KK+ ,
countKK, 1
>KK2 3
	haulThingKK4 =
.KK= >

stackCountKK> H
)KKH I
{LL 
curJobMM 
.MM 
countMM 
=MM 
	haulThingMM (
.MM( )

stackCountMM) 3
;MM3 4
}NN 
}OO 	
}PP 
}QQ §)
nB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_StaticConstructorOnStartup.cs
	namespace		 	
DigitalStorage		
 
.		 
HarmonyPatches		 '
{

 
[ 
HarmonyPatch 
( 
typeof 
( -
!StaticConstructorOnStartupUtility :
): ;
,; <
$str= F
)F G
]G H
public 

static 
class ,
 Patch_StaticConstructorOnStartup 8
{ 
public 
static 
void 
Postfix "
(" #
)# $
{ 	
ApplyCostMultiplier 
(  
)  !
;! "
} 	
private 
static 
void 
ApplyCostMultiplier /
(/ 0
)0 1
{ 	
float 

multiplier 
= "
DigitalStorageSettings 5
.5 6
costMultiplier6 D
;D E
if 
( 
Mathf 
. 
Approximately #
(# $

multiplier$ .
,. /
$num0 4
)4 5
)5 6
{ 
return 
; 
} 
List 
< 
string 
> 
defNames !
=" #
new$ '
List( ,
<, -
string- 3
>3 4
{ 
$str!! ,
,!!, -
$str"" ,
,"", -
$str## *
,##* +
$str$$ /
,$$/ 0
$str&& *
,&&* +
$str'' +
,''+ ,
$str(( *
,((* +
$str** -
}++ 
;++ 
foreach-- 
(-- 
string-- 
defName-- #
in--$ &
defNames--' /
)--/ 0
{.. 
ThingDef// 
thingDef// !
=//" #
DefDatabase//$ /
</// 0
ThingDef//0 8
>//8 9
.//9 :
GetNamedSilentFail//: L
(//L M
defName//M T
)//T U
;//U V
if00 
(00 
thingDef00 
!=00 
null00  $
&&00% '
thingDef00( 0
.000 1
costList001 9
!=00: <
null00= A
)00A B
{11 
List22 
<22 
ThingDefCountClass22 +
>22+ ,
newCostList22- 8
=229 :
new22; >
List22? C
<22C D
ThingDefCountClass22D V
>22V W
(22W X
)22X Y
;22Y Z
foreach33 
(33 
ThingDefCountClass33 /
cost330 4
in335 7
thingDef338 @
.33@ A
costList33A I
)33I J
{44 
int55 
newCount55 $
=55% &
Mathf55' ,
.55, -

RoundToInt55- 7
(557 8
cost558 <
.55< =
count55= B
*55C D

multiplier55E O
)55O P
;55P Q
if77 
(77 
newCount77 $
<77% &
$num77' (
)77( )
{88 
newCount99 $
=99% &
$num99' (
;99( )
}:: 
newCostList;; #
.;;# $
Add;;$ '
(;;' (
new;;( +
ThingDefCountClass;;, >
(;;> ?
cost;;? C
.;;C D
thingDef;;D L
,;;L M
newCount;;N V
);;V W
);;W X
;;;X Y
}<< 
thingDef== 
.== 
costList== %
===& '
newCostList==( 3
;==3 4
}>> 
}?? 
ListBB 
<BB 
stringBB 
>BB 
recipeDefNamesBB '
=BB( )
newBB* -
ListBB. 2
<BB2 3
stringBB3 9
>BB9 :
{CC 
$strDD /
,DD/ 0
$strEE 0
,EE0 1
$strFF /
,FF/ 0
$strGG 2
}HH 
;HH 
foreachJJ 
(JJ 
stringJJ 

recipeNameJJ &
inJJ' )
recipeDefNamesJJ* 8
)JJ8 9
{KK 
	RecipeDefLL 
	recipeDefLL #
=LL$ %
DefDatabaseLL& 1
<LL1 2
	RecipeDefLL2 ;
>LL; <
.LL< =
GetNamedSilentFailLL= O
(LLO P

recipeNameLLP Z
)LLZ [
;LL[ \
ifMM 
(MM 
	recipeDefMM 
!=MM  
nullMM! %
&&MM& (
	recipeDefMM) 2
.MM2 3
ingredientsMM3 >
!=MM? A
nullMMB F
)MMF G
{NN 
foreachOO 
(OO 
IngredientCountOO ,

ingredientOO- 7
inOO8 :
	recipeDefOO; D
.OOD E
ingredientsOOE P
)OOP Q
{PP 

ingredientQQ "
.QQ" #
SetBaseCountQQ# /
(QQ/ 0

ingredientQQ0 :
.QQ: ;
GetBaseCountQQ; G
(QQG H
)QQH I
*QQJ K

multiplierQQL V
)QQV W
;QQW X
}RR 
}SS 
}TT 
}UU 	
}VV 
}WW Ù
tB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_CompRottable_TicksUntilRotAtTemp.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
CompRottable %
)% &
,& '
$str( =
)= >
]> ?
public 

static 
class 2
&Patch_CompRottable_TicksUntilRotAtTemp >
{		 
public

 
static

 
bool

 
Prefix

 !
(

! "
CompRottable

" .

__instance

/ 9
,

9 :
ref

; >
int

? B
__result

C K
)

K L
{ 	
return 
true 
; 
} 	
} 
} ‘
gB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_CompRottable_Active.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
CompRottable %
)% &
,& '
$str( 0
,0 1

MethodType2 <
.< =
Getter= C
)C D
]D E
public 

static 
class %
Patch_CompRottable_Active 1
{ 
public 
static 
bool 
Prefix !
(! "
CompRottable" .

__instance/ 9
,9 :
ref; >
bool? C
__resultD L
)L M
{ 	
Thing 
thing 
= 

__instance $
.$ %
parent% +
;+ ,
if 
( 
thing 
== 
null 
||  
!! "
thing" '
.' (
Spawned( /
)/ 0
return1 7
true8 <
;< =
	SlotGroup 
	slotGroup 
=  !
thing" '
.' (
Position( 0
.0 1
GetSlotGroup1 =
(= >
thing> C
.C D
MapD G
)G H
;H I
if 
( 
	slotGroup 
? 
. 
parent !
is" $ 
Building_StorageCore% 9
)9 :
{ 
__result 
= 
false  
;  !
return 
false 
; 
} 
return 
true 
; 
} 	
} 
} ï#
hB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Thing_DrawGUIOverlay.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[		 
HarmonyPatch		 
(		 
typeof		 
(		 
Thing		 
)		 
,		  
$str		! 1
)		1 2
]		2 3
public

 

static

 
class

 &
Patch_Thing_DrawGUIOverlay

 2
{ 
public 
static 
bool 
Prefix !
(! "
Thing" '

__instance( 2
)2 3
{ 	
bool 
flag 
= 

__instance "
." #
def# &
.& '
category' /
!=0 2
ThingCategory3 @
.@ A
ItemA E
;E F
bool 
flag2 
; 
if 
( 
flag 
) 
{ 
flag2 
= 
true 
; 
} 
else 
{ 
bool 
flag3 
= 

__instance '
.' (
Map( +
==, .
null/ 3
;3 4
if 
( 
flag3 
) 
{ 
flag2 
= 
true  
;  !
} 
else 
{  
Building_StorageCore (
core) -
=. /
GridsUtility0 <
.< =
GetFirstThing= J
<J K 
Building_StorageCoreK _
>_ `
(` a

__instancea k
.k l
Positionl t
,t u

__instance	v Ä
.
Ä Å
Map
Å Ñ
)
Ñ Ö
;
Ö Ü
bool 
flag4 
=  
core! %
!=& (
null) -
&&. 0
core1 5
.5 6
Spawned6 =
&&> @
coreA E
.E F
PoweredF M
;M N
if 
( 
flag4 
) 
{   
	SlotGroup!! !
	slotGroup!!" +
=!!, -
StoreUtility!!. :
.!!: ;
GetSlotGroup!!; G
(!!G H

__instance!!H R
.!!R S
Position!!S [
,!![ \

__instance!!] g
.!!g h
Map!!h k
)!!k l
;!!l m
bool"" 
flag5"" "
=""# $
	slotGroup""% .
!=""/ 1
null""2 6
&&""7 9
	slotGroup"": C
.""C D
parent""D J
==""K M
core""N R
;""R S
if## 
(## 
flag5## !
)##! "
{$$ 
return%% "
false%%# (
;%%( )
}&& 
}''  
Building_DiskCabinet(( (
cabinet(() 0
=((1 2
GridsUtility((3 ?
.((? @
GetFirstThing((@ M
<((M N 
Building_DiskCabinet((N b
>((b c
(((c d

__instance((d n
.((n o
Position((o w
,((w x

__instance	((y É
.
((É Ñ
Map
((Ñ á
)
((á à
;
((à â
bool)) 
flag6)) 
=))  
cabinet))! (
!=))) +
null)), 0
&&))1 3
cabinet))4 ;
.)); <
Spawned))< C
;))C D
if** 
(** 
flag6** 
)** 
{++ 
	SlotGroup,, !

slotGroup2,," ,
=,,- .
StoreUtility,,/ ;
.,,; <
GetSlotGroup,,< H
(,,H I

__instance,,I S
.,,S T
Position,,T \
,,,\ ]

__instance,,^ h
.,,h i
Map,,i l
),,l m
;,,m n
bool-- 
flag7-- "
=--# $

slotGroup2--% /
!=--0 2
null--3 7
&&--8 :

slotGroup2--; E
.--E F
parent--F L
==--M O
cabinet--P W
;--W X
if.. 
(.. 
flag7.. !
)..! "
{// 
return00 "
false00# (
;00( )
}11 
}22 
flag233 
=33 
true33  
;33  !
}44 
}55 
return66 
flag266 
;66 
}77 	
}88 
}99 ‰
_B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Thing_Print.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[		 
HarmonyPatch		 
(		 
typeof		 
(		 
Thing		 
)		 
,		  
$str		! (
)		( )
]		) *
public

 

static

 
class

 
Patch_Thing_Print

 )
{ 
public 
static 
bool 
Prefix !
(! "
Thing" '

__instance( 2
,2 3
SectionLayer4 @
layerA F
)F G
{ 	
if 
( 

__instance 
. 
def 
. 
category '
!=( *
ThingCategory+ 8
.8 9
Item9 =
)= >
{ 
return 
true 
; 
} 
if 
( 

__instance 
. 
Map 
== !
null" &
)& '
{ 
return 
true 
; 
} 
	SlotGroup 
	slotGroup 
=  !
StoreUtility" .
.. /
GetSlotGroup/ ;
(; <

__instance< F
.F G
PositionG O
,O P

__instanceQ [
.[ \
Map\ _
)_ `
;` a
if 
( 
	slotGroup 
== 
null !
)! "
{ 
return 
true 
; 
}  
Building_StorageCore""  
core""! %
=""& '
	slotGroup""( 1
.""1 2
parent""2 8
as""9 ; 
Building_StorageCore""< P
;""P Q
if## 
(## 
core## 
!=## 
null## 
&&## 
core##  $
.##$ %
Spawned##% ,
&&##- /
core##0 4
.##4 5
Powered##5 <
)##< =
{$$ 
return%% 
false%% 
;%% 
}&&  
Building_DiskCabinet))  
cabinet))! (
=))) *
	slotGroup))+ 4
.))4 5
parent))5 ;
as))< > 
Building_DiskCabinet))? S
;))S T
if** 
(** 
cabinet** 
!=** 
null** 
&&**  "
cabinet**# *
.*** +
Spawned**+ 2
)**2 3
{++ 
return,, 
false,, 
;,, 
}-- 
return// 
true// 
;// 
}00 	
}11 
}22 Ï
hB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Thing_TryAbsorbStack.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
Thing 
) 
,  
$str! 1
)1 2
]2 3
public 

static 
class &
Patch_Thing_TryAbsorbStack 2
{		 
public

 
static

 
bool

 
Prefix

 !
(

! "
Thing

" '

__instance

( 2
,

2 3
Thing

4 9
other

: ?
,

? @
ref

A D
bool

E I
__result

J R
)

R S
{ 	
bool 
flag 
= !
Patch_StackProtection -
.- .
IsProtectedDisk. =
(= >

__instance> H
)H I
||J L!
Patch_StackProtectionM b
.b c
IsProtectedDiskc r
(r s
others x
)x y
;y z
bool 
flag2 
; 
if 
( 
flag 
) 
{ 
__result 
= 
false  
;  !
flag2 
= 
false 
; 
} 
else 
{ 
flag2 
= 
true 
; 
} 
return 
flag2 
; 
} 	
} 
} Ë
fB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Thing_CanStackWith.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
Thing 
) 
,  
$str! /
)/ 0
]0 1
public 

static 
class $
Patch_Thing_CanStackWith 0
{		 
public

 
static

 
bool

 
Prefix

 !
(

! "
Thing

" '

__instance

( 2
,

2 3
Thing

4 9
other

: ?
,

? @
ref

A D
bool

E I
__result

J R
)

R S
{ 	
bool 
flag 
= !
Patch_StackProtection -
.- .
IsProtectedDisk. =
(= >

__instance> H
)H I
||J L!
Patch_StackProtectionM b
.b c
IsProtectedDiskc r
(r s
others x
)x y
;y z
bool 
flag2 
; 
if 
( 
flag 
) 
{ 
__result 
= 
false  
;  !
flag2 
= 
false 
; 
} 
else 
{ 
flag2 
= 
true 
; 
} 
return 
flag2 
; 
} 	
} 
} å
cB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_StackProtection.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ &
StaticConstructorOnStartup 
]  
public 

static 
class !
Patch_StackProtection -
{		 
static

 !
Patch_StackProtection

 $
(

$ %
)

% &
{ 	
LongEventHandler 
. 
QueueLongEvent +
(+ ,
new, /
Action0 6
(6 7!
Patch_StackProtection7 L
.L M
EnforceStackLimitsM _
)_ `
,` a
$str	b Ö
,
Ö Ü
false
á å
,
å ç
null
é í
,
í ì
true
î ò
,
ò ô
false
ö ü
,
ü †
null
° •
)
• ¶
;
¶ ß
} 	
private 
static 
void 
EnforceStackLimits .
(. /
)/ 0
{ 	
foreach 
( 
string 
defName #
in$ &!
Patch_StackProtection' <
.< =
ProtectedDiskDefs= N
)N O
{ 
ThingDef 
def 
= 
DefDatabase *
<* +
ThingDef+ 3
>3 4
.4 5
GetNamedSilentFail5 G
(G H
defNameH O
)O P
;P Q
bool 
flag 
= 
def 
!=  "
null# '
&&( *
def+ .
.. /

stackLimit/ 9
!=: <
$num= >
;> ?
if 
( 
flag 
) 
{ 
Log 
. 
Message 
(  
string  &
.& '
Format' -
(- .
$str. Q
,Q R
defNameS Z
,Z [
def\ _
._ `

stackLimit` j
)j k
)k l
;l m
def 
. 

stackLimit "
=# $
$num% &
;& '
} 
} 
} 	
public 
static 
bool 
IsProtectedDisk *
(* +
ThingDef+ 3
def4 7
)7 8
{ 	
return 
def 
!= 
null 
&& !!
Patch_StackProtection" 7
.7 8
ProtectedDiskDefs8 I
.I J
ContainsJ R
(R S
defS V
.V W
defNameW ^
)^ _
;_ `
}   	
public"" 
static"" 
bool"" 
IsProtectedDisk"" *
(""* +
Thing""+ 0
thing""1 6
)""6 7
{## 	
return$$ 
($$ 
($$ 
thing$$ 
!=$$ 
null$$ "
)$$" #
?$$$ %
thing$$& +
.$$+ ,
def$$, /
:$$0 1
null$$2 6
)$$6 7
!=$$8 :
null$$; ?
&&$$@ B!
Patch_StackProtection$$C X
.$$X Y
ProtectedDiskDefs$$Y j
.$$j k
Contains$$k s
($$s t
thing$$t y
.$$y z
def$$z }
.$$} ~
defName	$$~ Ö
)
$$Ö Ü
;
$$Ü á
}%% 	
private'' 
static'' 
readonly'' 
HashSet''  '
<''' (
string''( .
>''. /
ProtectedDiskDefs''0 A
=''B C
new''D G
HashSet''H O
<''O P
string''P V
>''V W
{''X Y
$str''Z t
,''t u
$str	''v ë
,
''ë í
$str
''ì ≠
}
''Æ Ø
;
''Ø ∞
}(( 
})) œ?
_B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_TradeAction.cs
	namespace		 	
DigitalStorage		
 
.		 
HarmonyPatches		 '
{

 
[ 
HarmonyPatch 
( 
typeof 
( 
Pawn_TraderTracker +
)+ ,
,, -
$str. E
)E F
]F G
public 

static 
class 3
'Patch_TradeAction_GiveSoldThingToTrader ?
{ 
public 
static 
bool 
Prefix !
(! "
Thing" '
toGive( .
,. /
int0 3
countToGive4 ?
,? @
PawnA E
playerNegotiatorF V
)V W
{ 	
if 
( 
toGive 
== 
null 
) 
{ 
return 
true 
; 
} 
var 
	tradeInfo 
= 
TradeItemTracker ,
., -
GetTradeItemInfo- =
(= >
toGive> D
)D E
;E F
if 
( 
	tradeInfo 
== 
null !
)! "
{ 
return 
true 
; 
} 
if!! 
(!! 
	tradeInfo!! 
.!! 

sourceCore!! $
!=!!% '
null!!( ,
&&!!- /
	tradeInfo!!0 9
.!!9 :

sourceCore!!: D
.!!D E
Spawned!!E L
&&!!M O
	tradeInfo!!P Y
.!!Y Z

sourceCore!!Z d
.!!d e
Powered!!e l
)!!l m
{"" 
Thing$$ 
	extracted$$ 
=$$  !
	tradeInfo$$" +
.$$+ ,

sourceCore$$, 6
.$$6 7
ExtractItem$$7 B
($$B C
	tradeInfo$$C L
.$$L M
def$$M P
,$$P Q
countToGive$$R ]
,$$] ^
	tradeInfo$$_ h
.$$h i
stuffDef$$i q
)$$q r
;$$r s
if&& 
(&& 
	extracted&& 
!=&&  
null&&! %
)&&% &
{'' 
	extracted)) 
.)) 
Destroy)) %
())% &
DestroyMode))& 1
.))1 2
Vanish))2 8
)))8 9
;))9 :
if++ 
(++ "
DigitalStorageSettings++ .
.++. /
enableDebugLog++/ =
)++= >
{,, 
Log-- 
.-- 
Message-- #
(--# $
$"--$ &
$str--& 3
{--3 4
	tradeInfo--4 =
.--= >
def--> A
.--A B
label--B G
}--G H
$str--H J
{--J K
countToGive--K V
}--V W
"--W X
)--X Y
;--Y Z
}.. 
}// 
}00 
TradeItemTracker33 
.33 
UnregisterTradeItem33 0
(330 1
toGive331 7
)337 8
;338 9
return66 
false66 
;66 
}77 	
}88 
[== 
HarmonyPatch== 
(== 
typeof== 
(== 
TradeUtility== %
)==% &
,==& '
$str==( <
)==< =
]=== >
public>> 

static>> 
class>> 1
%Patch_TradeUtility_LaunchThingsOfType>> =
{?? 
public@@ 
static@@ 
bool@@ 
Prefix@@ !
(@@! "
ThingDef@@" *
resDef@@+ 1
,@@1 2
int@@3 6
debt@@7 ;
,@@; <
Map@@= @
map@@A D
,@@D E
	TradeShip@@F O
trader@@P V
)@@V W
{AA 	
ifBB 
(BB 
debtBB 
<=BB 
$numBB 
||BB 
mapBB  
==BB! #
nullBB$ (
)BB( )
{CC 
returnDD 
trueDD 
;DD 
}EE '
DigitalStorageGameComponentHH '
gameCompHH( 0
=HH1 2
CurrentHH3 :
.HH: ;
GameHH; ?
?HH? @
.HH@ A
GetComponentHHA M
<HHM N'
DigitalStorageGameComponentHHN i
>HHi j
(HHj k
)HHk l
;HHl m
ifII 
(II 
gameCompII 
==II 
nullII  
)II  !
{JJ 
returnKK 
trueKK 
;KK 
}LL 
intNN 
	remainingNN 
=NN 
debtNN  
;NN  !
foreachQQ 
(QQ  
Building_StorageCoreQQ )
coreQQ* .
inQQ/ 1
gameCompQQ2 :
.QQ: ;
GetAllCoresQQ; F
(QQF G
)QQG H
)QQH I
{RR 
ifSS 
(SS 
coreSS 
==SS 
nullSS  
||SS! #
!SS$ %
coreSS% )
.SS) *
SpawnedSS* 1
||SS2 4
!SS5 6
coreSS6 :
.SS: ;
PoweredSS; B
||SSC E
coreSSF J
.SSJ K
MapSSK N
!=SSO Q
mapSSR U
)SSU V
{TT 
continueUU 
;UU 
}VV 
ifXX 
(XX 
	remainingXX 
<=XX  
$numXX! "
)XX" #
{YY 
breakZZ 
;ZZ 
}[[ 
int^^ 
	available^^ 
=^^ 
core^^  $
.^^$ %
GetItemCount^^% 1
(^^1 2
resDef^^2 8
,^^8 9
null^^: >
)^^> ?
;^^? @
if__ 
(__ 
	available__ 
>__ 
$num__  !
)__! "
{`` 
intaa 
	toExtractaa !
=aa" #
Systemaa$ *
.aa* +
Mathaa+ /
.aa/ 0
Minaa0 3
(aa3 4
	availableaa4 =
,aa= >
	remainingaa? H
)aaH I
;aaI J
Thingbb 
	extractedbb #
=bb$ %
corebb& *
.bb* +
ExtractItembb+ 6
(bb6 7
resDefbb7 =
,bb= >
	toExtractbb? H
,bbH I
nullbbJ N
)bbN O
;bbO P
ifdd 
(dd 
	extracteddd !
!=dd" $
nulldd% )
)dd) *
{ee 
	remainingff !
-=ff" $
	extractedff% .
.ff. /

stackCountff/ 9
;ff9 :
	extractedgg !
.gg! "
Destroygg" )
(gg) *
DestroyModegg* 5
.gg5 6
Vanishgg6 <
)gg< =
;gg= >
ifii 
(ii "
DigitalStorageSettingsii 2
.ii2 3
enableDebugLogii3 A
)iiA B
{jj 
Logkk 
.kk  
Messagekk  '
(kk' (
$"kk( *
$strkk* 9
{kk9 :
resDefkk: @
.kk@ A
labelkkA F
}kkF G
$strkkG I
{kkI J
	extractedkkJ S
.kkS T

stackCountkkT ^
}kk^ _
"kk_ `
)kk` a
;kka b
}ll 
}mm 
}nn 
}oo 
ifrr 
(rr 
	remainingrr 
>rr 
$numrr 
)rr 
{ss 
returnvv 
truevv 
;vv 
}ww 
returnzz 
falsezz 
;zz 
}{{ 	
}|| 
[
ÅÅ 
HarmonyPatch
ÅÅ 
(
ÅÅ 
typeof
ÅÅ 
(
ÅÅ 
Dialog_Trade
ÅÅ %
)
ÅÅ% &
,
ÅÅ& '
$str
ÅÅ( /
)
ÅÅ/ 0
]
ÅÅ0 1
public
ÇÇ 

static
ÇÇ 
class
ÇÇ &
Patch_Dialog_Trade_Close
ÇÇ 0
{
ÉÉ 
public
ÑÑ 
static
ÑÑ 
void
ÑÑ 
Postfix
ÑÑ "
(
ÑÑ" #
)
ÑÑ# $
{
ÖÖ 	
TradeItemTracker
áá 
.
áá 
Clear
áá "
(
áá" #
)
áá# $
;
áá$ %
}
àà 	
}
ââ 
}ää §ë
`B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_TradeUtility.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( '
Building_OrbitalTradeBeacon 4
)4 5
,5 6
$str7 C
)C D
]D E
public 

static 
class /
#Patch_OrbitalTradeBeacon_AllPowered ;
{ 
public 
static 
void 
Postfix "
(" #
Map# &
map' *
,* +
ref, /
IEnumerable0 ;
<; <'
Building_OrbitalTradeBeacon< W
>W X
__resultY a
)a b
{ 	
if 
( 
map 
== 
null 
) 
{ 
return 
; 
} '
DigitalStorageGameComponent   '
gameComp  ( 0
=  1 2
Current  3 :
.  : ;
Game  ; ?
?  ? @
.  @ A
GetComponent  A M
<  M N'
DigitalStorageGameComponent  N i
>  i j
(  j k
)  k l
;  l m
if!! 
(!! 
gameComp!! 
==!! 
null!!  
)!!  !
{"" 
return## 
;## 
}$$ 
bool&& 
hasActiveCore&& 
=&&  
false&&! &
;&&& '
foreach'' 
(''  
Building_StorageCore'' )
core''* .
in''/ 1
gameComp''2 :
.'': ;
GetAllCores''; F
(''F G
)''G H
)''H I
{(( 
if)) 
()) 
core)) 
!=)) 
null))  
&&))! #
core))$ (
.))( )
Spawned))) 0
&&))1 3
core))4 8
.))8 9
Powered))9 @
&&))A C
core))D H
.))H I
Map))I L
==))M O
map))P S
)))S T
{** 
hasActiveCore++ !
=++" #
true++$ (
;++( )
break,, 
;,, 
}-- 
}.. 
if00 
(00 
!00 
hasActiveCore00 
)00 
{11 
return22 
;22 
}33 
if66 
(66 
__result66 
!=66 
null66  
&&66! #
__result66$ ,
.66, -
Any66- 0
(660 1
)661 2
)662 3
{77 
return88 
;88 
}99 
ListAA 
<AA '
Building_OrbitalTradeBeaconAA ,
>AA, -

allBeaconsAA. 8
=AA9 :
newAA; >
ListAA? C
<AAC D'
Building_OrbitalTradeBeaconAAD _
>AA_ `
(AA` a
)AAa b
;AAb c
foreachBB 
(BB 
BuildingBB 
buildingBB &
inBB' )
mapBB* -
.BB- .
listerBuildingsBB. =
.BB= > 
allBuildingsColonistBB> R
)BBR S
{CC 
ifDD 
(DD 
buildingDD 
isDD '
Building_OrbitalTradeBeaconDD  ;
beaconDD< B
)DDB C
{EE 

allBeaconsFF 
.FF 
AddFF "
(FF" #
beaconFF# )
)FF) *
;FF* +
}GG 
}HH 
ifJJ 
(JJ 

allBeaconsJJ 
.JJ 
CountJJ  
>JJ! "
$numJJ# $
)JJ$ %
{KK 
__resultMM 
=MM 

allBeaconsMM %
;MM% &
}NN 
}PP 	
}QQ 
[VV 
HarmonyPatchVV 
(VV 
typeofVV 
(VV 
TradeUtilityVV %
)VV% &
,VV& '
$strVV( E
)VVE F
]VVF G
publicWW 

staticWW 
classWW :
.Patch_TradeUtility_AllLaunchableThingsForTradeWW F
{XX 
publicYY 
staticYY 
voidYY 
PostfixYY "
(YY" #
MapYY# &
mapYY' *
,YY* +
refYY, /
IEnumerableYY0 ;
<YY; <
ThingYY< A
>YYA B
__resultYYC K
)YYK L
{ZZ 	
if[[ 
([[ 
map[[ 
==[[ 
null[[ 
)[[ 
{\\ 
return]] 
;]] 
}^^ '
DigitalStorageGameComponent`` '
gameComp``( 0
=``1 2
Current``3 :
.``: ;
Game``; ?
?``? @
.``@ A
GetComponent``A M
<``M N'
DigitalStorageGameComponent``N i
>``i j
(``j k
)``k l
;``l m
ifaa 
(aa 
gameCompaa 
==aa 
nullaa  
)aa  !
{bb 
returncc 
;cc 
}dd 
Listgg 
<gg 
Thinggg 
>gg 
tradableThingsgg &
=gg' (
newgg) ,
Listgg- 1
<gg1 2
Thinggg2 7
>gg7 8
(gg8 9
__resultgg9 A
)ggA B
;ggB C
TradeUtilityHelperjj 
.jj "
AddVirtualStorageItemsjj 5
(jj5 6
gameCompjj6 >
,jj> ?
mapjj@ C
,jjC D
tradableThingsjjE S
)jjS T
;jjT U
__resultll 
=ll 
tradableThingsll %
;ll% &
ifnn 
(nn "
DigitalStorageSettingsnn &
.nn& '
enableDebugLognn' 5
)nn5 6
{oo 
Logpp 
.pp 
Messagepp 
(pp 
$"pp 
$strpp M
{ppM N
tradableThingsppN \
.pp\ ]
Countpp] b
}ppb c
$strppc e
"ppe f
)ppf g
;ppg h
}qq 
}rr 	
}ss 
[xx 
HarmonyPatchxx 
(xx 
typeofxx 
(xx 
Pawn_TraderTrackerxx +
)xx+ ,
,xx, -
$strxx. H
)xxH I
]xxI J
publicyy 

staticyy 
classyy =
1Patch_Pawn_TraderTracker_ColonyThingsWillingToBuyyy I
{zz 
public{{ 
static{{ 
void{{ 
Postfix{{ "
({{" #
Pawn{{# '
playerNegotiator{{( 8
,{{8 9
Pawn{{: >
___pawn{{? F
,{{F G
ref{{H K
IEnumerable{{L W
<{{W X
Thing{{X ]
>{{] ^
__result{{_ g
){{g h
{|| 	
if}} 
(}} 
___pawn}} 
==}} 
null}} 
||}}  "
___pawn}}# *
.}}* +
Map}}+ .
==}}/ 1
null}}2 6
)}}6 7
{~~ 
return 
; 
}
ÄÄ )
DigitalStorageGameComponent
ÇÇ '
gameComp
ÇÇ( 0
=
ÇÇ1 2
Current
ÇÇ3 :
.
ÇÇ: ;
Game
ÇÇ; ?
?
ÇÇ? @
.
ÇÇ@ A
GetComponent
ÇÇA M
<
ÇÇM N)
DigitalStorageGameComponent
ÇÇN i
>
ÇÇi j
(
ÇÇj k
)
ÇÇk l
;
ÇÇl m
if
ÉÉ 
(
ÉÉ 
gameComp
ÉÉ 
==
ÉÉ 
null
ÉÉ  
)
ÉÉ  !
{
ÑÑ 
return
ÖÖ 
;
ÖÖ 
}
ÜÜ 
List
ââ 
<
ââ 
Thing
ââ 
>
ââ 
tradableThings
ââ &
=
ââ' (
new
ââ) ,
List
ââ- 1
<
ââ1 2
Thing
ââ2 7
>
ââ7 8
(
ââ8 9
__result
ââ9 A
)
ââA B
;
ââB C 
TradeUtilityHelper
åå 
.
åå $
AddVirtualStorageItems
åå 5
(
åå5 6
gameComp
åå6 >
,
åå> ?
___pawn
åå@ G
.
ååG H
Map
ååH K
,
ååK L
tradableThings
ååM [
)
åå[ \
;
åå\ ]
__result
éé 
=
éé 
tradableThings
éé %
;
éé% &
if
êê 
(
êê $
DigitalStorageSettings
êê &
.
êê& '
enableDebugLog
êê' 5
)
êê5 6
{
ëë 
Log
íí 
.
íí 
Message
íí 
(
íí 
$"
íí 
$str
íí J
{
ííJ K
tradableThings
ííK Y
.
ííY Z
Count
ííZ _
}
íí_ `
$str
íí` b
"
ííb c
)
ííc d
;
ííd e
}
ìì 
}
îî 	
}
ïï 
[
öö 
HarmonyPatch
öö 
(
öö 
typeof
öö 
(
öö 
	TradeDeal
öö "
)
öö" #
,
öö# $
$str
öö% 9
)
öö9 :
]
öö: ;
public
õõ 

static
õõ 
class
õõ 0
"Patch_TradeDeal_InSellablePosition
õõ :
{
úú 
public
ùù 
static
ùù 
bool
ùù 
Prefix
ùù !
(
ùù! "
Thing
ùù" '
t
ùù( )
,
ùù) *
ref
ùù+ .
string
ùù/ 5
reason
ùù6 <
,
ùù< =
ref
ùù> A
bool
ùùB F
__result
ùùG O
)
ùùO P
{
ûû 	
if
üü 
(
üü 
t
üü 
==
üü 
null
üü 
)
üü 
{
†† 
return
°° 
true
°° 
;
°° 
}
¢¢ 
if
•• 
(
•• 
TradeItemTracker
••  
.
••  !
GetTradeItemInfo
••! 1
(
••1 2
t
••2 3
)
••3 4
!=
••5 7
null
••8 <
)
••< =
{
¶¶ 
reason
ßß 
=
ßß 
null
ßß 
;
ßß 
__result
®® 
=
®® 
true
®® 
;
®®  
return
©© 
false
©© 
;
©© 
}
™™ 
return
¨¨ 
true
¨¨ 
;
¨¨ 
}
≠≠ 	
}
ÆÆ 
public
≥≥ 

static
≥≥ 
class
≥≥  
TradeUtilityHelper
≥≥ *
{
¥¥ 
public
µµ 
static
µµ 
void
µµ $
AddVirtualStorageItems
µµ 1
(
µµ1 2)
DigitalStorageGameComponent
µµ2 M
gameComp
µµN V
,
µµV W
Map
µµX [
map
µµ\ _
,
µµ_ `
List
µµa e
<
µµe f
Thing
µµf k
>
µµk l
tradableThings
µµm {
)
µµ{ |
{
∂∂ 	
if
∑∑ 
(
∑∑ 
gameComp
∑∑ 
==
∑∑ 
null
∑∑  
||
∑∑! #
map
∑∑$ '
==
∑∑( *
null
∑∑+ /
)
∑∑/ 0
{
∏∏ 
return
ππ 
;
ππ 
}
∫∫ 
foreach
ΩΩ 
(
ΩΩ "
Building_StorageCore
ΩΩ )
core
ΩΩ* .
in
ΩΩ/ 1
gameComp
ΩΩ2 :
.
ΩΩ: ;
GetAllCores
ΩΩ; F
(
ΩΩF G
)
ΩΩG H
)
ΩΩH I
{
ææ 
if
øø 
(
øø 
core
øø 
==
øø 
null
øø  
||
øø! #
!
øø$ %
core
øø% )
.
øø) *
Spawned
øø* 1
||
øø2 4
!
øø5 6
core
øø6 :
.
øø: ;
Powered
øø; B
||
øøC E
core
øøF J
.
øøJ K
Map
øøK N
!=
øøO Q
map
øøR U
)
øøU V
{
¿¿ 
continue
¡¡ 
;
¡¡ 
}
¬¬ 
foreach
≈≈ 
(
≈≈ 
StoredItemData
≈≈ '
itemData
≈≈( 0
in
≈≈1 3
core
≈≈4 8
.
≈≈8 9
GetAllStoredItems
≈≈9 J
(
≈≈J K
)
≈≈K L
)
≈≈L M
{
∆∆ 
if
«« 
(
«« 
itemData
««  
==
««! #
null
««$ (
||
««) +
itemData
««, 4
.
««4 5
def
««5 8
==
««9 ;
null
««< @
||
««A C
itemData
««D L
.
««L M

stackCount
««M W
<=
««X Z
$num
««[ \
)
««\ ]
{
»» 
continue
……  
;
……  !
}
   
Thing
ÕÕ 

tradeThing
ÕÕ $
=
ÕÕ% &

ThingMaker
ÕÕ' 1
.
ÕÕ1 2
	MakeThing
ÕÕ2 ;
(
ÕÕ; <
itemData
ÕÕ< D
.
ÕÕD E
def
ÕÕE H
,
ÕÕH I
itemData
ÕÕJ R
.
ÕÕR S
stuffDef
ÕÕS [
)
ÕÕ[ \
;
ÕÕ\ ]

tradeThing
ŒŒ 
.
ŒŒ 

stackCount
ŒŒ )
=
ŒŒ* +
itemData
ŒŒ, 4
.
ŒŒ4 5

stackCount
ŒŒ5 ?
;
ŒŒ? @
CompQuality
—— 
qualityComp
——  +
=
——, -

tradeThing
——. 8
.
——8 9

TryGetComp
——9 C
<
——C D
CompQuality
——D O
>
——O P
(
——P Q
)
——Q R
;
——R S
if
““ 
(
““ 
itemData
““  
.
““  !
quality
““! (
!=
““) +
QualityCategory
““, ;
.
““; <
Awful
““< A
&&
““B D
qualityComp
““E P
!=
““Q S
null
““T X
)
““X Y
{
”” 
qualityComp
‘‘ #
.
‘‘# $

SetQuality
‘‘$ .
(
‘‘. /
itemData
‘‘/ 7
.
‘‘7 8
quality
‘‘8 ?
,
‘‘? @"
ArtGenerationContext
‘‘A U
.
‘‘U V
Colony
‘‘V \
)
‘‘\ ]
;
‘‘] ^
}
’’ 
if
ÿÿ 
(
ÿÿ 
itemData
ÿÿ  
.
ÿÿ  !
	hitPoints
ÿÿ! *
>
ÿÿ+ ,
$num
ÿÿ- .
&&
ÿÿ/ 1

tradeThing
ÿÿ2 <
.
ÿÿ< =
def
ÿÿ= @
.
ÿÿ@ A
useHitPoints
ÿÿA M
)
ÿÿM N
{
ŸŸ 

tradeThing
⁄⁄ "
.
⁄⁄" #
	HitPoints
⁄⁄# ,
=
⁄⁄- .
itemData
⁄⁄/ 7
.
⁄⁄7 8
	hitPoints
⁄⁄8 A
;
⁄⁄A B
}
€€ 
TradeItemTracker
ﬁﬁ $
.
ﬁﬁ$ %
RegisterTradeItem
ﬁﬁ% 6
(
ﬁﬁ6 7

tradeThing
ﬁﬁ7 A
,
ﬁﬁA B
core
ﬁﬁC G
,
ﬁﬁG H
itemData
ﬁﬁI Q
)
ﬁﬁQ R
;
ﬁﬁR S
tradableThings
‡‡ "
.
‡‡" #
Add
‡‡# &
(
‡‡& '

tradeThing
‡‡' 1
)
‡‡1 2
;
‡‡2 3
}
·· 
}
‚‚ 
}
„„ 	
}
‰‰ 
public
ÈÈ 

static
ÈÈ 
class
ÈÈ 
TradeItemTracker
ÈÈ (
{
ÍÍ 
private
ÎÎ 
static
ÎÎ 
readonly
ÎÎ 

Dictionary
ÎÎ  *
<
ÎÎ* +
Thing
ÎÎ+ 0
,
ÎÎ0 1
TradeItemInfo
ÎÎ2 ?
>
ÎÎ? @
_tradeItems
ÎÎA L
=
ÎÎM N
new
ÎÎO R

Dictionary
ÎÎS ]
<
ÎÎ] ^
Thing
ÎÎ^ c
,
ÎÎc d
TradeItemInfo
ÎÎe r
>
ÎÎr s
(
ÎÎs t
)
ÎÎt u
;
ÎÎu v
public
ÌÌ 
class
ÌÌ 
TradeItemInfo
ÌÌ "
{
ÓÓ 	
public
ÔÔ "
Building_StorageCore
ÔÔ '

sourceCore
ÔÔ( 2
;
ÔÔ2 3
public
 
ThingDef
 
def
 
;
  
public
ÒÒ 
ThingDef
ÒÒ 
stuffDef
ÒÒ $
;
ÒÒ$ %
public
ÚÚ 
int
ÚÚ 

stackCount
ÚÚ !
;
ÚÚ! "
public
ÛÛ 
QualityCategory
ÛÛ "
quality
ÛÛ# *
;
ÛÛ* +
public
ÙÙ 
int
ÙÙ 
	hitPoints
ÙÙ  
;
ÙÙ  !
}
ıı 	
public
˜˜ 
static
˜˜ 
void
˜˜ 
RegisterTradeItem
˜˜ ,
(
˜˜, -
Thing
˜˜- 2

tradeThing
˜˜3 =
,
˜˜= >"
Building_StorageCore
˜˜? S
core
˜˜T X
,
˜˜X Y
StoredItemData
˜˜Z h
itemData
˜˜i q
)
˜˜q r
{
¯¯ 	
_tradeItems
˘˘ 
[
˘˘ 

tradeThing
˘˘ "
]
˘˘" #
=
˘˘$ %
new
˘˘& )
TradeItemInfo
˘˘* 7
{
˙˙ 

sourceCore
˚˚ 
=
˚˚ 
core
˚˚ !
,
˚˚! "
def
¸¸ 
=
¸¸ 
itemData
¸¸ 
.
¸¸ 
def
¸¸ "
,
¸¸" #
stuffDef
˝˝ 
=
˝˝ 
itemData
˝˝ #
.
˝˝# $
stuffDef
˝˝$ ,
,
˝˝, -

stackCount
˛˛ 
=
˛˛ 
itemData
˛˛ %
.
˛˛% &

stackCount
˛˛& 0
,
˛˛0 1
quality
ˇˇ 
=
ˇˇ 
itemData
ˇˇ "
.
ˇˇ" #
quality
ˇˇ# *
,
ˇˇ* +
	hitPoints
ÄÄ 
=
ÄÄ 
itemData
ÄÄ $
.
ÄÄ$ %
	hitPoints
ÄÄ% .
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
public
ÑÑ 
static
ÑÑ 
TradeItemInfo
ÑÑ #
GetTradeItemInfo
ÑÑ$ 4
(
ÑÑ4 5
Thing
ÑÑ5 :

tradeThing
ÑÑ; E
)
ÑÑE F
{
ÖÖ 	
if
ÜÜ 
(
ÜÜ 

tradeThing
ÜÜ 
==
ÜÜ 
null
ÜÜ "
)
ÜÜ" #
{
áá 
return
àà 
null
àà 
;
àà 
}
ââ 
TradeItemInfo
ää 
info
ää 
;
ää 
_tradeItems
ãã 
.
ãã 
TryGetValue
ãã #
(
ãã# $

tradeThing
ãã$ .
,
ãã. /
out
ãã0 3
info
ãã4 8
)
ãã8 9
;
ãã9 :
return
åå 
info
åå 
;
åå 
}
çç 	
public
èè 
static
èè 
void
èè !
UnregisterTradeItem
èè .
(
èè. /
Thing
èè/ 4

tradeThing
èè5 ?
)
èè? @
{
êê 	
if
ëë 
(
ëë 

tradeThing
ëë 
!=
ëë 
null
ëë "
)
ëë" #
{
íí 
_tradeItems
ìì 
.
ìì 
Remove
ìì "
(
ìì" #

tradeThing
ìì# -
)
ìì- .
;
ìì. /
}
îî 
}
ïï 	
public
óó 
static
óó 
void
óó 
Clear
óó  
(
óó  !
)
óó! "
{
òò 	
_tradeItems
ôô 
.
ôô 
Clear
ôô 
(
ôô 
)
ôô 
;
ôô  
}
öö 	
}
õõ 
}úú ˛2
uB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_RecipeWorkerCounter_CountProducts.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{		 
[ 
HarmonyPatch 
( 
typeof 
( 
RecipeWorkerCounter ,
), -
,- .
$str/ >
)> ?
]? @
public 

static 
class 3
'Patch_RecipeWorkerCounter_CountProducts ?
{ 
public 
static 
void 
Postfix "
(" #
ref# &
int' *
__result+ 3
,3 4
Bill_Production5 D
billE I
)I J
{ 	
if 
( 
bill 
== 
null 
|| 
bill  $
.$ %
recipe% +
==, .
null/ 3
||4 6
bill7 ;
.; <
recipe< B
.B C
productsC K
==L N
nullO S
||T V
billW [
.[ \
recipe\ b
.b c
productsc k
.k l
Countl q
==r t
$numu v
)v w
{ 
return 
; 
} '
DigitalStorageGameComponent '
gameComp( 0
=1 2
Current3 :
.: ;
Game; ?
?? @
.@ A
GetComponentA M
<M N'
DigitalStorageGameComponentN i
>i j
(j k
)k l
;l m
if 
( 
gameComp 
== 
null  
)  !
{ 
return 
; 
} 
ThingDefCountClass 
product &
=' (
bill) -
.- .
recipe. 4
.4 5
products5 =
[= >
$num> ?
]? @
;@ A
ThingDef   
	targetDef   
=    
product  ! (
.  ( )
thingDef  ) 1
;  1 2
if"" 
("" 
	targetDef"" 
=="" 
null"" !
)""! "
{## 
return$$ 
;$$ 
}%% 
int(( 
virtualCount(( 
=(( 
$num((  
;((  !
foreach** 
(**  
Building_StorageCore** )
core*** .
in**/ 1
gameComp**2 :
.**: ;
GetAllCores**; F
(**F G
)**G H
)**H I
{++ 
if,, 
(,, 
core,, 
==,, 
null,,  
||,,! #
!,,$ %
core,,% )
.,,) *
Spawned,,* 1
||,,2 4
!,,5 6
core,,6 :
.,,: ;
Powered,,; B
),,B C
{-- 
continue.. 
;.. 
}// 
foreach22 
(22 
var22 
itemData22 %
in22& (
core22) -
.22- .
GetAllStoredItems22. ?
(22? @
)22@ A
)22A B
{33 
if44 
(44 
itemData44  
.44  !
def44! $
!=44% '
	targetDef44( 1
)441 2
{55 
continue66  
;66  !
}77 
if:: 
(:: 
!:: 
IsValidForBill:: '
(::' (
itemData::( 0
,::0 1
bill::2 6
,::6 7
	targetDef::8 A
)::A B
)::B C
{;; 
continue<<  
;<<  !
}== 
virtualCount??  
+=??! #
itemData??$ ,
.??, -

stackCount??- 7
;??7 8
}@@ 
}AA 
__resultDD 
+=DD 
virtualCountDD $
;DD$ %
}EE 	
privateJJ 
staticJJ 
boolJJ 
IsValidForBillJJ *
(JJ* +
StoredItemDataJJ+ 9
itemDataJJ: B
,JJB C
Bill_ProductionJJD S
billJJT X
,JJX Y
ThingDefJJZ b
	targetDefJJc l
)JJl m
{KK 	
ifMM 
(MM 
!MM 
billMM 
.MM 
includeTaintedMM $
&&MM% '
	targetDefMM( 1
.MM1 2
	IsApparelMM2 ;
)MM; <
{NN 
}PP 
ifSS 
(SS 
	targetDefSS 
.SS 
useHitPointsSS &
&&SS' )
itemDataSS* 2
.SS2 3
	hitPointsSS3 <
>SS= >
$numSS? @
)SS@ A
{TT 
floatUU 
	hpPercentUU 
=UU  !
(UU" #
floatUU# (
)UU( )
itemDataUU) 1
.UU1 2
	hitPointsUU2 ;
/UU< =
	targetDefUU> G
.UUG H
BaseMaxHitPointsUUH X
;UUX Y
ifVV 
(VV 
!VV 
billVV 
.VV 
hpRangeVV !
.VV! "
IncludesEpsilonVV" 1
(VV1 2
	hpPercentVV2 ;
)VV; <
)VV< =
{WW 
returnXX 
falseXX  
;XX  !
}YY 
}ZZ 
if]] 
(]] 
itemData]] 
.]] 
quality]]  
!=]]! #
QualityCategory]]$ 3
.]]3 4
Normal]]4 :
)]]: ;
{^^ 
if__ 
(__ 
!__ 
bill__ 
.__ 
qualityRange__ &
.__& '
Includes__' /
(__/ 0
itemData__0 8
.__8 9
quality__9 @
)__@ A
)__A B
{`` 
returnaa 
falseaa  
;aa  !
}bb 
}cc 
ifff 
(ff 
billff 
.ff 
limitToAllowedStuffff (
&&ff) +
itemDataff, 4
.ff4 5
stuffDefff5 =
!=ff> @
nullffA E
)ffE F
{gg 
ifhh 
(hh 
!hh 
billhh 
.hh 
ingredientFilterhh *
.hh* +
Allowshh+ 1
(hh1 2
itemDatahh2 :
.hh: ;
stuffDefhh; C
)hhC D
)hhD E
{ii 
returnjj 
falsejj  
;jj  !
}kk 
}ll 
returnnn 
truenn 
;nn 
}oo 	
}pp 
}qq πJ
cB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_ResourceCounter.cs
	namespace		 	
DigitalStorage		
 
.		 
HarmonyPatches		 '
{

 
[ 
HarmonyPatch 
( 
typeof 
( 
ResourceCounter (
)( )
,) *
$str+ 5
)5 6
]6 7
public 

static 
class *
Patch_ResourceCounter_GetCount 6
{ 
public 
static 
void 
Postfix "
(" #
ref# &
int' *
__result+ 3
,3 4
ThingDef5 =
rDef> B
,B C
ResourceCounterD S

__instanceT ^
)^ _
{ 	
if 
( 
rDef 
. #
resourceReadoutPriority ,
==- /!
ResourceCountPriority0 E
.E F
	UncountedF O
)O P
{ 
return 
; 
} 
Game 
game 
= 
Current 
.  
Game  $
;$ %'
DigitalStorageGameComponent '
gameComp( 0
=1 2
(3 4
game4 8
!=9 ;
null< @
)@ A
?B C
gameD H
.H I
GetComponentI U
<U V'
DigitalStorageGameComponentV q
>q r
(r s
)s t
:u v
nullw {
;{ |
if 
( 
gameComp 
== 
null  
)  !
{ 
return 
; 
} 
int"" 
totalInCores"" 
="" 
$num""  
;""  !
foreach$$ 
($$  
Building_StorageCore$$ )
core$$* .
in$$/ 1
gameComp$$2 :
.$$: ;
GetAllCores$$; F
($$F G
)$$G H
)$$H I
{%% 
if&& 
(&& 
core&& 
==&& 
null&&  
||&&! #
!&&$ %
core&&% )
.&&) *
Spawned&&* 1
||&&2 4
!&&5 6
core&&6 :
.&&: ;
Powered&&; B
)&&B C
{'' 
continue(( 
;(( 
})) 
totalInCores++ 
+=++ 
core++  $
.++$ %
GetItemCount++% 1
(++1 2
rDef++2 6
,++6 7
null++8 <
)++< =
;++= >
},, 
if// 
(// 
totalInCores// 
>// 
$num//  
)//  !
{00 
__result11 
+=11 
totalInCores11 (
;11( )
}22 
}33 	
}44 
[99 
HarmonyPatch99 
(99 
typeof99 
(99 
ResourceCounter99 (
)99( )
,99) *
$str99+ >
,99> ?

MethodType99@ J
.99J K
Getter99K Q
)99Q R
]99R S
public:: 

static:: 
class:: 3
'Patch_ResourceCounter_AllCountedAmounts:: ?
{;; 
private== 
static== 

Dictionary== !
<==! "
ThingDef==" *
,==* +
int==, /
>==/ 0$
_cachedAllCountedAmounts==1 I
===J K
new==L O

Dictionary==P Z
<==Z [
ThingDef==[ c
,==c d
int==e h
>==h i
(==i j
)==j k
;==k l
private>> 
static>> 
int>> 
_cacheFrame>> &
=>>' (
->>) *
$num>>* +
;>>+ ,
private?? 
const?? 
int?? !
CACHE_UPDATE_INTERVAL?? /
=??0 1
$num??2 4
;??4 5
publicAA 
staticAA 
voidAA 
PostfixAA "
(AA" #
refAA# &

DictionaryAA' 1
<AA1 2
ThingDefAA2 :
,AA: ;
intAA< ?
>AA? @
__resultAAA I
,AAI J
ResourceCounterAAK Z

__instanceAA[ e
)AAe f
{BB 	
intCC 
currentFrameCC 
=CC 
FindCC #
.CC# $
TickManagerCC$ /
.CC/ 0
	TicksGameCC0 9
;CC9 :
ifFF 
(FF 
currentFrameFF 
-FF 
_cacheFrameFF *
>=FF+ -!
CACHE_UPDATE_INTERVALFF. C
||FFD F$
_cachedAllCountedAmountsFFG _
.FF_ `
CountFF` e
==FFf h
$numFFi j
)FFj k
{GG $
_cachedAllCountedAmountsHH (
.HH( )
ClearHH) .
(HH. /
)HH/ 0
;HH0 1
_cacheFrameII 
=II 
currentFrameII *
;II* +
GameLL 
gameLL 
=LL 
CurrentLL #
.LL# $
GameLL$ (
;LL( )'
DigitalStorageGameComponentMM +
gameCompMM, 4
=MM5 6
(MM7 8
gameMM8 <
!=MM= ?
nullMM@ D
)MMD E
?MMF G
gameMMH L
.MML M
GetComponentMMM Y
<MMY Z'
DigitalStorageGameComponentMMZ u
>MMu v
(MMv w
)MMw x
:MMy z
nullMM{ 
;	MM Ä
ifNN 
(NN 
gameCompNN 
==NN 
nullNN  $
)NN$ %
{OO 
returnPP 
;PP 
}QQ 

DictionaryTT 
<TT 
ThingDefTT #
,TT# $
intTT% (
>TT( )
	newResultTT* 3
=TT4 5
newTT6 9

DictionaryTT: D
<TTD E
ThingDefTTE M
,TTM N
intTTO R
>TTR S
(TTS T
__resultTTT \
)TT\ ]
;TT] ^
foreachWW 
(WW  
Building_StorageCoreWW -
coreWW. 2
inWW3 5
gameCompWW6 >
.WW> ?
GetAllCoresWW? J
(WWJ K
)WWK L
)WWL M
{XX 
ifYY 
(YY 
coreYY 
==YY 
nullYY  $
||YY% '
!YY( )
coreYY) -
.YY- .
SpawnedYY. 5
||YY6 8
!YY9 :
coreYY: >
.YY> ?
PoweredYY? F
)YYF G
{ZZ 
continue[[  
;[[  !
}\\ 
foreach__ 
(__ 
var__  
item__! %
in__& (
core__) -
.__- .
GetAllStoredItems__. ?
(__? @
)__@ A
)__A B
{`` 
ifaa 
(aa 
itemaa  
.aa  !
defaa! $
.aa$ %#
resourceReadoutPriorityaa% <
==aa= ?!
ResourceCountPriorityaa@ U
.aaU V
	UncountedaaV _
)aa_ `
{bb 
continuecc $
;cc$ %
}dd 
ifff 
(ff 
	newResultff %
.ff% &
ContainsKeyff& 1
(ff1 2
itemff2 6
.ff6 7
defff7 :
)ff: ;
)ff; <
{gg 
	newResulthh %
[hh% &
itemhh& *
.hh* +
defhh+ .
]hh. /
+=hh0 2
itemhh3 7
.hh7 8

stackCounthh8 B
;hhB C
}ii 
elsejj 
{kk 
	newResultll %
[ll% &
itemll& *
.ll* +
defll+ .
]ll. /
=ll0 1
itemll2 6
.ll6 7

stackCountll7 A
;llA B
}mm 
}nn 
	SlotGroupqq 
	slotGroupqq '
=qq( )
coreqq* .
.qq. /
GetSlotGroupqq/ ;
(qq; <
)qq< =
;qq= >
ifrr 
(rr 
	slotGrouprr !
!=rr" $
nullrr% )
)rr) *
{ss 
foreachtt 
(tt  !
Thingtt! &
thingtt' ,
intt- /
	slotGrouptt0 9
.tt9 :

HeldThingstt: D
)ttD E
{uu 
ifvv 
(vv  
thingvv  %
!=vv& (
nullvv) -
&&vv. 0
thingvv1 6
.vv6 7
Spawnedvv7 >
&&vv? A
thingvvB G
.vvG H
defvvH K
.vvK L#
resourceReadoutPriorityvvL c
!=vvd f!
ResourceCountPriorityvvg |
.vv| }
	Uncounted	vv} Ü
)
vvÜ á
{ww 
ifxx  "
(xx# $
	newResultxx$ -
.xx- .
ContainsKeyxx. 9
(xx9 :
thingxx: ?
.xx? @
defxx@ C
)xxC D
)xxD E
{yy  !
	newResultzz$ -
[zz- .
thingzz. 3
.zz3 4
defzz4 7
]zz7 8
+=zz9 ;
thingzz< A
.zzA B

stackCountzzB L
;zzL M
}{{  !
else||  $
{}}  !
	newResult~~$ -
[~~- .
thing~~. 3
.~~3 4
def~~4 7
]~~7 8
=~~9 :
thing~~; @
.~~@ A

stackCount~~A K
;~~K L
}  !
}
ÄÄ 
}
ÅÅ 
}
ÇÇ 
}
ÉÉ &
_cachedAllCountedAmounts
ÖÖ (
=
ÖÖ) *
	newResult
ÖÖ+ 4
;
ÖÖ4 5
}
ÜÜ 
__result
ââ 
=
ââ &
_cachedAllCountedAmounts
ââ /
;
ââ/ 0
}
ää 	
}
ãã 
}åå ëW
dB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Designator_Build.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
Designator_Build )
)) *
,* +
$str, :
): ;
]; <
public 

static 
class /
#Patch_Designator_Build_ProcessInput ;
{ 
public 
static 
bool 
Prefix !
(! "
Designator_Build" 2

__instance3 =
,= >
Event? D
evE G
)G H
{ 	
if 
( 
Prefs 
. 
DevMode 
) 
{ 
bool 
originalGodMode $
=% &
DebugSettings' 4
.4 5
godMode5 <
;< =
try 
{ 
DebugSettings !
.! "
godMode" )
=* +
true, 0
;0 1
return 
true 
;  
}   
finally!! 
{"" 
DebugSettings## !
.##! "
godMode##" )
=##* +
originalGodMode##, ;
;##; <
}$$ 
}%% 
bool(( 
canInteract(( 
=(( 
(((  
bool((  $
)(($ %
AccessTools((% 0
.((0 1
Method((1 7
(((7 8
typeof((8 >
(((> ?

Designator((? I
)((I J
,((J K
$str((L ^
)((^ _
.((_ `
Invoke((` f
(((f g

__instance((g q
,((q r
null((s w
)((w x
;((x y
if)) 
()) 
!)) 
canInteract)) 
))) 
{** 
return++ 
false++ 
;++ 
},, 
ThingDef.. 
thingDef.. 
=.. 

__instance..  *
...* +

PlacingDef..+ 5
as..6 8
ThingDef..9 A
;..A B
if// 
(// 
thingDef// 
==// 
null//  
||//! #
!//$ %
thingDef//% -
.//- .
MadeFromStuff//. ;
)//; <
{00 
return22 
true22 
;22 
}33 
Game66 
game66 
=66 
Current66 
.66  
Game66  $
;66$ %'
DigitalStorageGameComponent77 '
gameComp77( 0
=771 2
(773 4
game774 8
!=779 ;
null77< @
)77@ A
?77B C
game77D H
.77H I
GetComponent77I U
<77U V'
DigitalStorageGameComponent77V q
>77q r
(77r s
)77s t
:77u v
null77w {
;77{ |
if88 
(88 
gameComp88 
==88 
null88  
||88! #
gameComp88$ ,
.88, -
GetAllCores88- 8
(888 9
)889 :
.88: ;
Count88; @
==88A C
$num88D E
)88E F
{99 
return;; 
true;; 
;;; 
}<< 
bool?? 
originalGodMode2?? !
=??" #
DebugSettings??$ 1
.??1 2
godMode??2 9
;??9 :
tryAA 
{BB 
DebugSettingsDD 
.DD 
godModeDD %
=DD& '
trueDD( ,
;DD, -
ListGG 
<GG 
FloatMenuOptionGG $
>GG$ %
listGG& *
=GG+ ,
newGG- 0
ListGG1 5
<GG5 6
FloatMenuOptionGG6 E
>GGE F
(GGF G
)GGG H
;GGH I
foreachII 
(II 
ThingDefII !
	thingDef2II" +
inII, .

__instanceII/ 9
.II9 :
MapII: =
.II= >
resourceCounterII> M
.IIM N
AllCountedAmountsIIN _
.II_ `
KeysII` d
.IId e
OrderByDescendingIIe v
(IIv w
delegateIIw 
(	II Ä
ThingDef
IIÄ à
d
IIâ ä
)
IIä ã
{JJ 
StuffPropertiesKK #

stuffPropsKK$ .
=KK/ 0
dKK1 2
.KK2 3

stuffPropsKK3 =
;KK= >
ifLL 
(LL 

stuffPropsLL "
==LL# %
nullLL& *
)LL* +
{MM 
returnNN 
floatNN $
.NN$ %
PositiveInfinityNN% 5
;NN5 6
}OO 
returnPP 

stuffPropsPP %
.PP% &
commonalityPP& 1
;PP1 2
}QQ 
)QQ 
.QQ 
ThenByQQ 
(QQ 
(QQ 
ThingDefQQ #
dQQ$ %
)QQ% &
=>QQ' )
dQQ* +
.QQ+ ,
BaseMarketValueQQ, ;
)QQ; <
)QQ< =
{RR 
ifTT 
(TT 
	thingDef2TT !
.TT! "
IsStuffTT" )
&&TT* ,
	thingDef2TT- 6
.TT6 7

stuffPropsTT7 A
.TTA B
CanMakeTTB I
(TTI J
thingDefTTJ R
)TTR S
&&TTT V
(UU 
DebugSettingsUU &
.UU& '
godModeUU' .
||UU/ 1

__instanceUU2 <
.UU< =
MapUU= @
.UU@ A
listerThingsUUA M
.UUM N
ThingsOfDefUUN Y
(UUY Z
	thingDef2UUZ c
)UUc d
.UUd e
CountUUe j
>UUk l
$numUUm n
)UUn o
)UUo p
{VV 
ThingDefWW  
localStuffDefWW! .
=WW/ 0
	thingDef2WW1 :
;WW: ;
stringXX 
textXX #
;XX# $
Precept_ThingStyleZZ *
sourcePreceptZZ+ 8
=ZZ9 :
TraverseZZ; C
.ZZC D
CreateZZD J
(ZZJ K

__instanceZZK U
)ZZU V
.ZZV W
FieldZZW \
(ZZ\ ]
$strZZ] l
)ZZl m
.ZZm n
GetValueZZn v
<ZZv w
Precept_ThingStyle	ZZw â
>
ZZâ ä
(
ZZä ã
)
ZZã å
;
ZZå ç
if[[ 
([[ 
sourcePrecept[[ )
!=[[* ,
null[[- 1
)[[1 2
{\\ 
text]]  
=]]! "
$str]]# :
.]]: ;
	Translate]]; D
(]]D E
localStuffDef]]E R
.]]R S
LabelAsStuff]]S _
,]]_ `
sourcePrecept]]a n
.]]n o
Label]]o t
)]]t u
;]]u v
}^^ 
else__ 
{`` 
textaa  
=aa! "
GenLabelaa# +
.aa+ ,

ThingLabelaa, 6
(aa6 7

__instanceaa7 A
.aaA B

PlacingDefaaB L
,aaL M
localStuffDefaaN [
,aa[ \
$numaa] ^
)aa^ _
;aa_ `
}bb 
textcc 
=cc 
textcc #
.cc# $
CapitalizeFirstcc$ 3
(cc3 4
)cc4 5
;cc5 6
listee 
.ee 
Addee  
(ee  !
newee! $
FloatMenuOptionee% 4
(ee4 5
textee5 9
,ee9 :
delegateee; C
{ff 
AccessToolshh '
.hh' (
Methodhh( .
(hh. /
typeofhh/ 5
(hh5 6

Designatorhh6 @
)hh@ A
,hhA B
$strhhC Q
)hhQ R
.hhR S
InvokehhS Y
(hhY Z

__instancehhZ d
,hhd e
newhhf i
objecthhj p
[hhp q
]hhq r
{hhs t
evhhu w
}hhx y
)hhy z
;hhz {
Findii  
.ii  !
DesignatorManagerii! 2
.ii2 3
Selectii3 9
(ii9 :

__instanceii: D
)iiD E
;iiE F
Traversejj $
.jj$ %
Createjj% +
(jj+ ,

__instancejj, 6
)jj6 7
.jj7 8
Fieldjj8 =
(jj= >
$strjj> H
)jjH I
.jjI J
SetValuejjJ R
(jjR S
localStuffDefjjS `
)jj` a
;jja b
Traversekk $
.kk$ %
Createkk% +
(kk+ ,

__instancekk, 6
)kk6 7
.kk7 8
Fieldkk8 =
(kk= >
$strkk> J
)kkJ K
.kkK L
SetValuekkL T
(kkT U
truekkU Y
)kkY Z
;kkZ [
}ll 
,ll 
	thingDef2ll $
,ll$ %
nullll& *
,ll* +
falsell, 1
,ll1 2
MenuOptionPriorityll3 E
.llE F
DefaultllF M
,llM N
nullllO S
,llS T
nullllU Y
,llY Z
$numll[ ]
,ll] ^
nullll_ c
,llc d
nulllle i
,lli j
truellk o
,llo p
$numllq r
,llr s
nullllt x
)llx y
{mm 
tutorTagnn $
=nn% &
$strnn' 5
+nn6 7
thingDefnn8 @
.nn@ A
defNamennA H
+nnI J
$strnnK N
+nnO P
localStuffDefnnQ ^
.nn^ _
defNamenn_ f
}oo 
)oo 
;oo 
}pp 
}qq 
ifss 
(ss 
listss 
.ss 
Countss 
==ss !
$numss" #
)ss# $
{tt 
Messagesuu 
.uu 
Messageuu $
(uu$ %
$struu% :
.uu: ;
	Translateuu; D
(uuD E
)uuE F
,uuF G
MessageTypeDefOfuuH X
.uuX Y
RejectInputuuY d
,uud e
falseuuf k
)uuk l
;uul m
returnvv 
falsevv  
;vv  !
}ww 
	FloatMenuyy 
	floatMenuyy #
=yy$ %
newyy& )
	FloatMenuyy* 3
(yy3 4
listyy4 8
)yy8 9
;yy9 :
	floatMenuzz 
.zz 
onCloseCallbackzz )
=zz* +
delegatezz, 4
{{{ 
Traverse|| 
.|| 
Create|| #
(||# $

__instance||$ .
)||. /
.||/ 0
Field||0 5
(||5 6
$str||6 B
)||B C
.||C D
SetValue||D L
(||L M
true||M Q
)||Q R
;||R S
}}} 
;}} 
Find~~ 
.~~ 
WindowStack~~  
.~~  !
Add~~! $
(~~$ %
	floatMenu~~% .
)~~. /
;~~/ 0
Find 
. 
DesignatorManager &
.& '
Select' -
(- .

__instance. 8
)8 9
;9 :
return
ÅÅ 
false
ÅÅ 
;
ÅÅ 
}
ÇÇ 
finally
ÉÉ 
{
ÑÑ 
DebugSettings
ÜÜ 
.
ÜÜ 
godMode
ÜÜ %
=
ÜÜ& '
originalGodMode2
ÜÜ( 8
;
ÜÜ8 9
}
áá 
}
àà 	
}
ââ 
}ää âŸ
zB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_WorkGiver_ConstructDeliverResources_V2.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( /
#WorkGiver_ConstructDeliverResources <
)< =
,= >
$str? V
)V W
]W X
public 

static 
class 8
,Patch_WorkGiver_ConstructDeliverResources_V2 D
{ 
private 
static 
bool 
LOG 
=>  ""
DigitalStorageSettings# 9
.9 :
enableDebugLog: H
;H I
public 
static 
void 
Postfix "
(" #
ref 
Job 
__result 
, /
#WorkGiver_ConstructDeliverResources /

__instance0 :
,: ;
Pawn 
pawn 
, 
IConstructible 
c 
, 
bool 4
(canRemoveExistingFloorUnderNearbyNeeders 9
,9 :
bool   
forced   
)   
{!! 	'
DigitalStorageGameComponent"" '
gameComp""( 0
=""1 2
Current""3 :
."": ;
Game""; ?
?""? @
.""@ A
GetComponent""A M
<""M N'
DigitalStorageGameComponent""N i
>""i j
(""j k
)""k l
;""l m
if## 
(## 
gameComp## 
==## 
null##  
)##  !
{$$ 
return%% 
;%% 
}&& 
bool(( 
hasChip(( 
=(( 
PawnStorageAccess(( ,
.((, -
HasTerminalImplant((- ?
(((? @
pawn((@ D
)((D E
;((E F
if** 
(** 
LOG** 
)** 
Log** 
.** 
Message**  
(**  !
$"**! #
$str**# 8
{**8 9
pawn**9 =
.**= >
Name**> B
}**B C
$str**C M
{**M N
hasChip**N U
}**U V
$str**V a
{**a b
__result**b j
!=**k m
null**n r
}**r s
"**s t
)**t u
;**u v
if.. 
(.. 
__result.. 
!=.. 
null..  
&&..! #
__result..$ ,
..., -
def..- 0
==..1 3
JobDefOf..4 <
...< =
HaulToContainer..= L
)..L M
{// 
if00 
(00 
LOG00 
)00 
Log00 
.00 
Message00 $
(00$ %
$"00% '
$str00' :
"00: ;
)00; <
;00< =
return11 
;11 
}22 
if55 
(55 
__result55 
!=55 
null55  
)55  !
{66 
if77 
(77 
LOG77 
)77 
Log77 
.77 
Message77 $
(77$ %
$"77% '
$str77' >
"77> ?
)77? @
;77@ A
return88 
;88 
}99 
IConstructible== 
constructible== (
===) *
c==+ ,
as==- /
IConstructible==0 >
;==> ?
if>> 
(>> 
constructible>> 
==>>  
null>>! %
)>>% &
{?? 
if@@ 
(@@ 
LOG@@ 
)@@ 
Log@@ 
.@@ 
Message@@ $
(@@$ %
$"@@% '
$str@@' A
"@@A B
)@@B C
;@@C D
returnAA 
;AA 
}BB 
ifDD 
(DD 
LOGDD 
)DD 
LogDD 
.DD 
MessageDD  
(DD  !
$"DD! #
$strDD# <
"DD< =
)DD= >
;DD> ?
foreachGG 
(GG 
ThingDefCountClassGG '
needGG( ,
inGG- /
constructibleGG0 =
.GG= >
TotalMaterialCostGG> O
(GGO P
)GGP Q
)GGQ R
{HH 
intII 
countNeededII 
=II  !
GetCountNeededII" 0
(II0 1
cII1 2
,II2 3
needII4 8
.II8 9
thingDefII9 A
,IIA B
pawnIIC G
,IIG H
forcedIII O
)IIO P
;IIP Q
ifJJ 
(JJ 
LOGJJ 
)JJ 
LogJJ 
.JJ 
MessageJJ $
(JJ$ %
$"JJ% '
$strJJ' 6
{JJ6 7
needJJ7 ;
.JJ; <
thingDefJJ< D
.JJD E
defNameJJE L
}JJL M
$strJJM [
{JJ[ \
countNeededJJ\ g
}JJg h
"JJh i
)JJi j
;JJj k
ifKK 
(KK 
countNeededKK 
<=KK  "
$numKK# $
)KK$ %
{LL 
continueMM 
;MM 
}NN 
intQQ 
maxCanCarryQQ 
=QQ  !
pawnQQ" &
.QQ& '
carryTrackerQQ' 3
.QQ3 4
MaxStackSpaceEverQQ4 E
(QQE F
needQQF J
.QQJ K
thingDefQQK S
)QQS T
;QQT U
intRR 
actualNeededRR  
=RR! "
MathRR# '
.RR' (
MinRR( +
(RR+ ,
countNeededRR, 7
,RR7 8
maxCanCarryRR9 D
)RRD E
;RRE F
ifSS 
(SS 
LOGSS 
)SS 
LogSS 
.SS 
MessageSS $
(SS$ %
$"SS% '
$strSS' =
{SS= >
maxCanCarrySS> I
}SSI J
$strSSJ Y
{SSY Z
actualNeededSSZ f
}SSf g
"SSg h
)SSh i
;SSi j
ThingVV 

finalThingVV  
=VV! ""
GetOrReplenishMaterialVV# 9
(VV9 :
gameCompVV: B
,VVB C
needVVD H
.VVH I
thingDefVVI Q
,VVQ R
actualNeededVVS _
,VV_ `
pawnVVa e
.VVe f
MapVVf i
)VVi j
;VVj k
ifXX 
(XX 

finalThingXX 
==XX !
nullXX" &
||XX' )
!XX* +

finalThingXX+ 5
.XX5 6
SpawnedXX6 =
)XX= >
{YY 
ifZZ 
(ZZ 
LOGZZ 
)ZZ 
LogZZ  
.ZZ  !
MessageZZ! (
(ZZ( )
$"ZZ) +
$strZZ+ S
"ZZS T
)ZZT U
;ZZU V
continue[[ 
;[[ 
}\\ 
if^^ 
(^^ 
LOG^^ 
)^^ 
Log^^ 
.^^ 
Message^^ $
(^^$ %
$"^^% '
$str^^' 7
{^^7 8

finalThing^^8 B
.^^B C
Label^^C H
}^^H I
$str^^I K
{^^K L

finalThing^^L V
.^^V W

stackCount^^W a
}^^a b
$str^^b f
{^^f g

finalThing^^g q
.^^q r
Position^^r z
}^^z {
"^^{ |
)^^| }
;^^} ~
__resultaa 
=aa 
CreateHaulJobaa (
(aa( )
pawnaa) -
,aa- .
caa/ 0
,aa0 1

finalThingaa2 <
,aa< =
actualNeededaa> J
)aaJ K
;aaK L
ifbb 
(bb 
LOGbb 
)bb 
Logbb 
.bb 
Messagebb $
(bb$ %
$"bb% '
$strbb' A
{bbA B
__resultbbB J
!=bbK M
nullbbN R
}bbR S
"bbS T
)bbT U
;bbU V
returncc 
;cc 
}dd 
}ee 	
privatejj 
staticjj 
Thingjj "
GetOrReplenishMaterialjj 3
(jj3 4'
DigitalStorageGameComponentjj4 O
gameCompjjP X
,jjX Y
ThingDefjjZ b
defjjc f
,jjf g
intjjh k
neededjjl r
,jjr s
Mapjjt w
mapjjx {
)jj{ |
{kk 	
ifll 
(ll 
LOGll 
)ll 
Logll 
.ll 
Messagell  
(ll  !
$"ll! #
$strll# D
{llD E
defllE H
.llH I
defNamellI P
}llP Q
$strllQ Z
{llZ [
neededll[ a
}lla b
"llb c
)llc d
;lld e
foreachnn 
(nn  
Building_StorageCorenn )
corenn* .
innn/ 1
gameCompnn2 :
.nn: ;
GetAllCoresnn; F
(nnF G
)nnG H
)nnH I
{oo 
ifpp 
(pp 
corepp 
==pp 
nullpp  
||pp! #
!pp$ %
corepp% )
.pp) *
Spawnedpp* 1
||pp2 4
!pp5 6
corepp6 :
.pp: ;
Poweredpp; B
||ppC E
coreppF J
.ppJ K
MapppK N
!=ppO Q
mapppR U
)ppU V
{qq 
continuerr 
;rr 
}ss 
Thingvv 
reservedThingvv #
=vv$ %
corevv& *
.vv* +
FindReservedItemvv+ ;
(vv; <
defvv< ?
,vv? @
nullvvA E
)vvE F
;vvF G
intww 
reservedCountww !
=ww" #
reservedThingww$ 1
?ww1 2
.ww2 3

stackCountww3 =
??ww> @
$numwwA B
;wwB C
intxx 
virtualCountxx  
=xx! "
corexx# '
.xx' (
GetItemCountxx( 4
(xx4 5
defxx5 8
,xx8 9
nullxx: >
)xx> ?
;xx? @
intyy 
totalAvailableyy "
=yy# $
reservedCountyy% 2
+yy3 4
virtualCountyy5 A
;yyA B
if{{ 
({{ 
LOG{{ 
){{ 
Log{{ 
.{{ 
Message{{ $
({{$ %
$"{{% '
$str{{' G
{{{G H
core{{H L
.{{L M
NetworkName{{M X
}{{X Y
$str{{Y i
{{{i j
reservedCount{{j w
}{{w x
$str	{{x á
{
{{á à
virtualCount
{{à î
}
{{î ï
$str
{{ï ¶
{
{{¶ ß
totalAvailable
{{ß µ
}
{{µ ∂
"
{{∂ ∑
)
{{∑ ∏
;
{{∏ π
if}} 
(}} 
totalAvailable}} "
<}}# $
needed}}% +
)}}+ ,
{~~ 
if 
( 
LOG 
) 
Log  
.  !
Message! (
(( )
$") +
$str+ Q
"Q R
)R S
;S T
continue
ÄÄ 
;
ÄÄ 
}
ÅÅ 
Thing
ÉÉ 

finalThing
ÉÉ  
;
ÉÉ  !
if
ÖÖ 
(
ÖÖ 
reservedCount
ÖÖ !
>=
ÖÖ" $
needed
ÖÖ% +
)
ÖÖ+ ,
{
ÜÜ 
if
áá 
(
áá 
LOG
áá 
)
áá 
Log
áá  
.
áá  !
Message
áá! (
(
áá( )
$"
áá) +
$str
áá+ S
{
ááS T
needed
ááT Z
}
ááZ [
$str
áá[ ]
"
áá] ^
)
áá^ _
;
áá_ `
if
ââ 
(
ââ 
reservedCount
ââ %
==
ââ& (
needed
ââ) /
)
ââ/ 0
{
ää 

finalThing
ãã "
=
ãã# $
reservedThing
ãã% 2
;
ãã2 3
}
åå 
else
çç 
{
éé 

finalThing
èè "
=
èè# $
reservedThing
èè% 2
.
èè2 3
SplitOff
èè3 ;
(
èè; <
needed
èè< B
)
èèB C
;
èèC D
GenSpawn
êê  
.
êê  !
Spawn
êê! &
(
êê& '

finalThing
êê' 1
,
êê1 2
reservedThing
êê3 @
.
êê@ A
Position
êêA I
,
êêI J
map
êêK N
,
êêN O
WipeMode
êêP X
.
êêX Y
Vanish
êêY _
)
êê_ `
;
êê` a
}
ëë 
}
íí 
else
ìì 
{
îî 
if
ïï 
(
ïï 
LOG
ïï 
)
ïï 
Log
ïï  
.
ïï  !
Message
ïï! (
(
ïï( )
$"
ïï) +
$str
ïï+ R
{
ïïR S
needed
ïïS Y
-
ïïZ [
reservedCount
ïï\ i
}
ïïi j
$str
ïïj l
"
ïïl m
)
ïïm n
;
ïïn o
int
óó 
needMore
óó  
=
óó! "
needed
óó# )
-
óó* +
reservedCount
óó, 9
;
óó9 :
Thing
òò 
	extracted
òò #
=
òò$ %
core
òò& *
.
òò* +
ExtractItem
òò+ 6
(
òò6 7
def
òò7 :
,
òò: ;
needMore
òò< D
,
òòD E
null
òòF J
)
òòJ K
;
òòK L
if
öö 
(
öö 
	extracted
öö !
==
öö" $
null
öö% )
)
öö) *
{
õõ 
if
úú 
(
úú 
LOG
úú 
)
úú  
Log
úú! $
.
úú$ %
Message
úú% ,
(
úú, -
$"
úú- /
$str
úú/ _
"
úú_ `
)
úú` a
;
úúa b
continue
ùù  
;
ùù  !
}
ûû 
if
†† 
(
†† 
LOG
†† 
)
†† 
Log
††  
.
††  !
Message
††! (
(
††( )
$"
††) +
$str
††+ L
{
††L M
	extracted
††M V
.
††V W
Label
††W \
}
††\ ]
$str
††] _
{
††_ `
	extracted
††` i
.
††i j

stackCount
††j t
}
††t u
"
††u v
)
††v w
;
††w x
if
¢¢ 
(
¢¢ 
reservedThing
¢¢ %
!=
¢¢& (
null
¢¢) -
&&
¢¢. 0
reservedThing
¢¢1 >
.
¢¢> ?
Spawned
¢¢? F
)
¢¢F G
{
££ 
if
•• 
(
•• 
LOG
•• 
)
••  
Log
••! $
.
••$ %
Message
••% ,
(
••, -
$"
••- /
$str
••/ S
"
••S T
)
••T U
;
••U V
reservedThing
¶¶ %
.
¶¶% &
TryAbsorbStack
¶¶& 4
(
¶¶4 5
	extracted
¶¶5 >
,
¶¶> ?
false
¶¶@ E
)
¶¶E F
;
¶¶F G
if
ßß 
(
ßß 
	extracted
ßß %
.
ßß% &

stackCount
ßß& 0
>
ßß1 2
$num
ßß3 4
)
ßß4 5
{
®® 
if
©© 
(
©©  
LOG
©©  #
)
©©# $
Log
©©% (
.
©©( )
Message
©©) 0
(
©©0 1
$"
©©1 3
$str
©©3 V
{
©©V W
	extracted
©©W `
.
©©` a

stackCount
©©a k
}
©©k l
$str
©©l t
"
©©t u
)
©©u v
;
©©v w
GenSpawn
™™ $
.
™™$ %
Spawn
™™% *
(
™™* +
	extracted
™™+ 4
,
™™4 5
reservedThing
™™6 C
.
™™C D
Position
™™D L
,
™™L M
map
™™N Q
,
™™Q R
WipeMode
™™S [
.
™™[ \
Vanish
™™\ b
)
™™b c
;
™™c d
}
´´ 

finalThing
¨¨ "
=
¨¨# $
reservedThing
¨¨% 2
;
¨¨2 3
}
≠≠ 
else
ÆÆ 
{
ØØ 
if
±± 
(
±± 
LOG
±± 
)
±±  
Log
±±! $
.
±±$ %
Message
±±% ,
(
±±, -
$"
±±- /
$str
±±/ U
"
±±U V
)
±±V W
;
±±W X
GenSpawn
≤≤  
.
≤≤  !
Spawn
≤≤! &
(
≤≤& '
	extracted
≤≤' 0
,
≤≤0 1
core
≤≤2 6
.
≤≤6 7
Position
≤≤7 ?
,
≤≤? @
map
≤≤A D
,
≤≤D E
WipeMode
≤≤F N
.
≤≤N O
Vanish
≤≤O U
)
≤≤U V
;
≤≤V W

finalThing
≥≥ "
=
≥≥# $
	extracted
≥≥% .
;
≥≥. /
}
¥¥ 
}
µµ 
if
∑∑ 
(
∑∑ 
LOG
∑∑ 
)
∑∑ 
Log
∑∑ 
.
∑∑ 
Message
∑∑ $
(
∑∑$ %
$"
∑∑% '
$str
∑∑' O
{
∑∑O P

finalThing
∑∑P Z
.
∑∑Z [
Label
∑∑[ `
}
∑∑` a
$str
∑∑a c
{
∑∑c d

finalThing
∑∑d n
.
∑∑n o

stackCount
∑∑o y
}
∑∑y z
$str
∑∑z ~
{
∑∑~ 

finalThing∑∑ â
.∑∑â ä
Position∑∑ä í
}∑∑í ì
"∑∑ì î
)∑∑î ï
;∑∑ï ñ
return
ªª 

finalThing
ªª !
;
ªª! "
}
ºº 
if
ææ 
(
ææ 
LOG
ææ 
)
ææ 
Log
ææ 
.
ææ 
Message
ææ  
(
ææ  !
$"
ææ! #
$str
ææ# I
"
ææI J
)
ææJ K
;
ææK L
return
øø 
null
øø 
;
øø 
}
¿¿ 	
private
≈≈ 
static
≈≈ 
Thing
≈≈ 
SplitAndTeleport
≈≈ -
(
≈≈- .
Thing
≈≈. 3
source
≈≈4 :
,
≈≈: ;
int
≈≈< ?
count
≈≈@ E
,
≈≈E F
IntVec3
≈≈G N
	targetPos
≈≈O X
,
≈≈X Y
Map
≈≈Z ]
map
≈≈^ a
)
≈≈a b
{
∆∆ 	
if
«« 
(
«« 
source
«« 
==
«« 
null
«« 
||
«« !
!
««" #
source
««# )
.
««) *
Spawned
««* 1
)
««1 2
{
»» 
return
…… 
null
…… 
;
…… 
}
   
Thing
ÃÃ 
thingToTeleport
ÃÃ !
;
ÃÃ! "
if
ÕÕ 
(
ÕÕ 
source
ÕÕ 
.
ÕÕ 

stackCount
ÕÕ !
<=
ÕÕ" $
count
ÕÕ% *
)
ÕÕ* +
{
ŒŒ 
source
œœ 
.
œœ 
DeSpawn
œœ 
(
œœ 
$num
œœ  
)
œœ  !
;
œœ! "
thingToTeleport
–– 
=
––  !
source
––" (
;
––( )
}
—— 
else
““ 
{
”” 
thingToTeleport
‘‘ 
=
‘‘  !
source
‘‘" (
.
‘‘( )
SplitOff
‘‘) 1
(
‘‘1 2
count
‘‘2 7
)
‘‘7 8
;
‘‘8 9
}
’’ 
Thing
◊◊ 
spawned
◊◊ 
=
◊◊ 
GenSpawn
◊◊ $
.
◊◊$ %
Spawn
◊◊% *
(
◊◊* +
thingToTeleport
◊◊+ :
,
◊◊: ;
	targetPos
◊◊< E
,
◊◊E F
map
◊◊G J
,
◊◊J K
WipeMode
◊◊L T
.
◊◊T U
Vanish
◊◊U [
)
◊◊[ \
;
◊◊\ ]

FleckMaker
ÿÿ 
.
ÿÿ  
ThrowLightningGlow
ÿÿ )
(
ÿÿ) *
spawned
ÿÿ* 1
.
ÿÿ1 2
DrawPos
ÿÿ2 9
,
ÿÿ9 :
map
ÿÿ; >
,
ÿÿ> ?
$num
ÿÿ@ D
)
ÿÿD E
;
ÿÿE F
if
⁄⁄ 
(
⁄⁄ $
DigitalStorageSettings
⁄⁄ &
.
⁄⁄& '
enableDebugLog
⁄⁄' 5
)
⁄⁄5 6
{
€€ 
Log
‹‹ 
.
‹‹ 
Message
‹‹ 
(
‹‹ 
$"
‹‹ 
$str
‹‹ +
{
‹‹+ ,
spawned
‹‹, 3
.
‹‹3 4
Label
‹‹4 9
}
‹‹9 :
$str
‹‹: <
{
‹‹< =
spawned
‹‹= D
.
‹‹D E

stackCount
‹‹E O
}
‹‹O P
$str
‹‹P S
{
‹‹S T
	targetPos
‹‹T ]
}
‹‹] ^
"
‹‹^ _
)
‹‹_ `
;
‹‹` a
}
›› 
return
ﬂﬂ 
spawned
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 	
private
‚‚ 
static
‚‚ "
Building_StorageCore
‚‚ +
FindCoreWithItem
‚‚, <
(
‚‚< =)
DigitalStorageGameComponent
‚‚= X
gameComp
‚‚Y a
,
‚‚a b
Thing
‚‚c h
item
‚‚i m
)
‚‚m n
{
„„ 	
foreach
‰‰ 
(
‰‰ "
Building_StorageCore
‰‰ )
core
‰‰* .
in
‰‰/ 1
gameComp
‰‰2 :
.
‰‰: ;
GetAllCores
‰‰; F
(
‰‰F G
)
‰‰G H
)
‰‰H I
{
ÂÂ 
if
ÊÊ 
(
ÊÊ 
core
ÊÊ 
==
ÊÊ 
null
ÊÊ  
||
ÊÊ! #
!
ÊÊ$ %
core
ÊÊ% )
.
ÊÊ) *
Spawned
ÊÊ* 1
||
ÊÊ2 4
!
ÊÊ5 6
core
ÊÊ6 :
.
ÊÊ: ;
Powered
ÊÊ; B
)
ÊÊB C
{
ÁÁ 
continue
ËË 
;
ËË 
}
ÈÈ 
	SlotGroup
ÎÎ 
	slotGroup
ÎÎ #
=
ÎÎ$ %
core
ÎÎ& *
.
ÎÎ* +
GetSlotGroup
ÎÎ+ 7
(
ÎÎ7 8
)
ÎÎ8 9
;
ÎÎ9 :
if
ÏÏ 
(
ÏÏ 
	slotGroup
ÏÏ 
!=
ÏÏ  
null
ÏÏ! %
)
ÏÏ% &
{
ÌÌ 
foreach
ÓÓ 
(
ÓÓ 
Thing
ÓÓ "
thing
ÓÓ# (
in
ÓÓ) +
	slotGroup
ÓÓ, 5
.
ÓÓ5 6

HeldThings
ÓÓ6 @
)
ÓÓ@ A
{
ÔÔ 
if
 
(
 
thing
 !
==
" $
item
% )
)
) *
{
ÒÒ 
return
ÚÚ "
core
ÚÚ# '
;
ÚÚ' (
}
ÛÛ 
}
ÙÙ 
}
ıı 
}
ˆˆ 
return
˜˜ 
null
˜˜ 
;
˜˜ 
}
¯¯ 	
private
˙˙ 
static
˙˙ 
int
˙˙ 
GetCountNeeded
˙˙ )
(
˙˙) *
IConstructible
˙˙* 8
c
˙˙9 :
,
˙˙: ;
ThingDef
˙˙< D
def
˙˙E H
,
˙˙H I
Pawn
˙˙J N
pawn
˙˙O S
,
˙˙S T
bool
˙˙U Y
forced
˙˙Z `
)
˙˙` a
{
˚˚ 	
if
¸¸ 
(
¸¸ 
forced
¸¸ 
)
¸¸ 
{
˝˝ 
return
˛˛ 
c
˛˛ 
.
˛˛ 
ThingCountNeeded
˛˛ )
(
˛˛) *
def
˛˛* -
)
˛˛- .
;
˛˛. /
}
ˇˇ 
IHaulEnroute
ÅÅ 
haulEnroute
ÅÅ $
=
ÅÅ% &
c
ÅÅ' (
as
ÅÅ) +
IHaulEnroute
ÅÅ, 8
;
ÅÅ8 9
if
ÇÇ 
(
ÇÇ 
haulEnroute
ÇÇ 
==
ÇÇ 
null
ÇÇ #
)
ÇÇ# $
{
ÉÉ 
return
ÑÑ 
c
ÑÑ 
.
ÑÑ 
ThingCountNeeded
ÑÑ )
(
ÑÑ) *
def
ÑÑ* -
)
ÑÑ- .
;
ÑÑ. /
}
ÖÖ 
return
áá 
haulEnroute
áá 
.
áá *
GetSpaceRemainingWithEnroute
áá ;
(
áá; <
def
áá< ?
,
áá? @
pawn
ááA E
)
ááE F
;
ááF G
}
àà 	
private
ää 
static
ää 
Thing
ää 
TeleportItem
ää )
(
ää) *
Thing
ää* /
item
ää0 4
,
ää4 5
IntVec3
ää6 =
	targetPos
ää> G
,
ääG H
Map
ääI L
map
ääM P
)
ääP Q
{
ãã 	
if
åå 
(
åå 
item
åå 
==
åå 
null
åå 
||
åå 
!
åå  !
item
åå! %
.
åå% &
Spawned
åå& -
||
åå. 0
map
åå1 4
==
åå5 7
null
åå8 <
)
åå< =
{
çç 
return
éé 
null
éé 
;
éé 
}
èè 
item
ëë 
.
ëë 
DeSpawn
ëë 
(
ëë 
$num
ëë 
)
ëë 
;
ëë 
Thing
íí 
spawned
íí 
=
íí 
GenSpawn
íí $
.
íí$ %
Spawn
íí% *
(
íí* +
item
íí+ /
,
íí/ 0
	targetPos
íí1 :
,
íí: ;
map
íí< ?
,
íí? @
$num
ííA B
)
ííB C
;
ííC D

FleckMaker
ìì 
.
ìì  
ThrowLightningGlow
ìì )
(
ìì) *
spawned
ìì* 1
.
ìì1 2
DrawPos
ìì2 9
,
ìì9 :
map
ìì; >
,
ìì> ?
$num
ìì@ D
)
ììD E
;
ììE F
if
ïï 
(
ïï $
DigitalStorageSettings
ïï &
.
ïï& '
enableDebugLog
ïï' 5
)
ïï5 6
{
ññ 
Log
óó 
.
óó 
Message
óó 
(
óó 
$"
óó 
$str
óó +
{
óó+ ,
spawned
óó, 3
.
óó3 4
Label
óó4 9
}
óó9 :
$str
óó: <
{
óó< =
spawned
óó= D
.
óóD E

stackCount
óóE O
}
óóO P
$str
óóP S
{
óóS T
	targetPos
óóT ]
}
óó] ^
"
óó^ _
)
óó_ `
;
óó` a
}
òò 
return
öö 
spawned
öö 
;
öö 
}
õõ 	
private
ùù 
static
ùù 
Job
ùù 
CreateHaulJob
ùù (
(
ùù( )
Pawn
ùù) -
pawn
ùù. 2
,
ùù2 3
IConstructible
ùù4 B
c
ùùC D
,
ùùD E
Thing
ùùF K
	realThing
ùùL U
,
ùùU V
int
ùùW Z
countNeeded
ùù[ f
)
ùùf g
{
ûû 	
if
üü 
(
üü 
	realThing
üü 
==
üü 
null
üü !
||
üü" $
!
üü% &
	realThing
üü& /
.
üü/ 0
Spawned
üü0 7
)
üü7 8
{
†† 
return
°° 
null
°° 
;
°° 
}
¢¢ 
int
§§ 
countToTake
§§ 
=
§§ 
Math
§§ "
.
§§" #
Min
§§# &
(
§§& '
countNeeded
§§' 2
,
§§2 3
pawn
§§4 8
.
§§8 9
carryTracker
§§9 E
.
§§E F
MaxStackSpaceEver
§§F W
(
§§W X
	realThing
§§X a
.
§§a b
def
§§b e
)
§§e f
)
§§f g
;
§§g h
Job
•• 
job
•• 
=
•• 
JobMaker
•• 
.
•• 
MakeJob
•• &
(
••& '
JobDefOf
••' /
.
••/ 0
HaulToContainer
••0 ?
)
••? @
;
••@ A
job
¶¶ 
.
¶¶ 
targetA
¶¶ 
=
¶¶ 
	realThing
¶¶ #
;
¶¶# $
job
ßß 
.
ßß 
targetB
ßß 
=
ßß 
(
ßß 
Thing
ßß  
)
ßß  !
c
ßß! "
;
ßß" #
job
®® 
.
®® 
count
®® 
=
®® 
countToTake
®® #
;
®®# $
if
™™ 
(
™™ 
!
™™ 
pawn
™™ 
.
™™ 
Map
™™ 
.
™™  
reservationManager
™™ ,
.
™™, -
Reserve
™™- 4
(
™™4 5
pawn
™™5 9
,
™™9 :
job
™™; >
,
™™> ?
	realThing
™™@ I
,
™™I J
$num
™™K L
,
™™L M
-
™™N O
$num
™™O P
,
™™P Q
null
™™R V
,
™™V W
false
™™X ]
,
™™] ^
false
™™_ d
)
™™d e
)
™™e f
{
´´ 
return
¨¨ 
null
¨¨ 
;
¨¨ 
}
≠≠ 
return
ØØ 
job
ØØ 
;
ØØ 
}
∞∞ 	
}
±± 
}≤≤ ¡€
B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_WorkGiver_DoBill_TryFindBestBillIngredients.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
WorkGiver_DoBill )
)) *
,* +
$str, H
)H I
]I J
public 

static 
class =
1Patch_WorkGiver_DoBill_TryFindBestBillIngredients I
{ 
public 
static 
void 
Postfix "
(" #
ref# &
bool' +
__result, 4
,4 5
Bill6 :
bill; ?
,? @
PawnA E
pawnF J
,J K
ThingL Q
	billGiverR [
,[ \
ref] `
Lista e
<e f

ThingCountf p
>p q
chosenr x
)x y
{ 	
if 
( 
__result 
) 
{ 
return 
; 
} '
DigitalStorageGameComponent '
gameComp( 0
=1 2
Current3 :
.: ;
Game; ?
?? @
.@ A
GetComponentA M
<M N'
DigitalStorageGameComponentN i
>i j
(j k
)k l
;l m
if   
(   
gameComp   
==   
null    
)    !
{!! 
return"" 
;"" 
}## 
Bill_Production%% 
billProd%% $
=%%% &
bill%%' +
as%%, .
Bill_Production%%/ >
;%%> ?
if&& 
(&& 
billProd&& 
==&& 
null&&  
)&&  !
{'' 
return(( 
;(( 
})) 
if++ 
(++ "
DigitalStorageSettings++ &
.++& '
enableDebugLog++' 5
)++5 6
Log,, 
.,, 
Message,, 
(,, 
$",, 
$str,, 2
{,,2 3
billProd,,3 ;
.,,; <
recipe,,< B
.,,B C
defName,,C J
},,J K
$str,,K R
{,,R S
pawn,,S W
.,,W X
Name,,X \
},,\ ]
",,] ^
),,^ _
;,,_ `
List// 
<// 
(// 
IngredientCount// !

ingredient//" ,
,//, -
int//. 1
needed//2 8
,//8 9 
Building_StorageCore//: N
core//O S
,//S T
ThingDef//U ]
def//^ a
,//a b
ThingDef//c k
stuff//l q
,//q r
Thing//s x
reservedThing	//y Ü
,
//Ü á
Thing
//à ç
mapThing
//é ñ
)
//ñ ó
>
//ó ò
materialSources
//ô ®
=
//© ™
new00 
List00 
<00 
(00 
IngredientCount00 )
,00) *
int00+ .
,00. / 
Building_StorageCore000 D
,00D E
ThingDef00F N
,00N O
ThingDef00P X
,00X Y
Thing00Z _
,00_ `
Thing00a f
)00f g
>00g h
(00h i
)00i j
;00j k
foreach22 
(22 
IngredientCount22 $

ingredient22% /
in220 2
billProd223 ;
.22; <
recipe22< B
.22B C
ingredients22C N
)22N O
{33 
ThingDef44 
anyDef44 
=44  !

ingredient44" ,
.44, -
filter44- 3
.443 4
AnyAllowedDef444 A
;44A B
if55 
(55 
anyDef55 
==55 
null55 "
)55" #
{66 
return77 
;77 
}88 
int:: 
neededCount:: 
=::  !

ingredient::" ,
.::, -
CountRequiredOfFor::- ?
(::? @
anyDef::@ F
,::F G
billProd::H P
.::P Q
recipe::Q W
,::W X
billProd::Y a
)::a b
;::b c
var== 

coreResult== 
===  
FindMaterialInCores==! 4
(==4 5
gameComp==5 =
,=== >

ingredient==? I
,==I J
billProd==K S
,==S T
neededCount==U `
,==` a
pawn==b f
.==f g
Map==g j
)==j k
;==k l
if>> 
(>> 

coreResult>> 
.>> 
core>> #
!=>>$ &
null>>' +
&&>>, .

coreResult>>/ 9
.>>9 :
def>>: =
!=>>> @
null>>A E
)>>E F
{?? 
if@@ 
(@@ "
DigitalStorageSettings@@ .
.@@. /
enableDebugLog@@/ =
)@@= >
LogAA 
.AA 
MessageAA #
(AA# $
$"AA$ &
$strAA& /
{AA/ 0
anyDefAA0 6
.AA6 7
defNameAA7 >
}AA> ?
$strAA? F
"AAF G
)AAG H
;AAH I
materialSourcesBB #
.BB# $
AddBB$ '
(BB' (
(BB( )

ingredientBB) 3
,BB3 4
neededCountBB5 @
,BB@ A

coreResultBBB L
.BBL M
coreBBM Q
,BBQ R

coreResultBBS ]
.BB] ^
defBB^ a
,BBa b

coreResultBBc m
.BBm n
stuffBBn s
,BBs t

coreResultBBu 
.	BB Ä
reservedThing
BBÄ ç
,
BBç é
null
BBè ì
)
BBì î
)
BBî ï
;
BBï ñ
continueCC 
;CC 
}DD 
ThingGG 
mapThingGG 
=GG  
FindMaterialOnMapGG! 2
(GG2 3
pawnGG3 7
,GG7 8

ingredientGG9 C
,GGC D
billProdGGE M
,GGM N
neededCountGGO Z
)GGZ [
;GG[ \
ifHH 
(HH 
mapThingHH 
!=HH 
nullHH  $
)HH$ %
{II 
ifJJ 
(JJ "
DigitalStorageSettingsJJ .
.JJ. /
enableDebugLogJJ/ =
)JJ= >
LogKK 
.KK 
MessageKK #
(KK# $
$"KK$ &
$strKK& /
{KK/ 0
anyDefKK0 6
.KK6 7
defNameKK7 >
}KK> ?
$strKK? G
{KKG H
mapThingKKH P
.KKP Q
LabelKKQ V
}KKV W
$strKKW [
{KK[ \
mapThingKK\ d
.KKd e
PositionKKe m
}KKm n
"KKn o
)KKo p
;KKp q
materialSourcesLL #
.LL# $
AddLL$ '
(LL' (
(LL( )

ingredientLL) 3
,LL3 4
neededCountLL5 @
,LL@ A
nullLLB F
,LLF G
mapThingLLH P
.LLP Q
defLLQ T
,LLT U
mapThingLLV ^
.LL^ _
StuffLL_ d
,LLd e
nullLLf j
,LLj k
mapThingLLl t
)LLt u
)LLu v
;LLv w
continueMM 
;MM 
}NN 
ifQQ 
(QQ "
DigitalStorageSettingsQQ *
.QQ* +
enableDebugLogQQ+ 9
)QQ9 :
LogRR 
.RR 
MessageRR 
(RR  
$"RR  "
$strRR" +
{RR+ ,
anyDefRR, 2
.RR2 3
defNameRR3 :
}RR: ;
$strRR; H
"RRH I
)RRI J
;RRJ K
returnSS 
;SS 
}TT 
ListWW 
<WW 

ThingCountWW 
>WW 
virtualIngredientsWW /
=WW0 1
newWW2 5
ListWW6 :
<WW: ;

ThingCountWW; E
>WWE F
(WWF G
)WWG H
;WWH I
foreachYY 
(YY 
varYY 
sourceYY 
inYY  "
materialSourcesYY# 2
)YY2 3
{ZZ 
Thing[[ 

finalThing[[  
;[[  !
if]] 
(]] 
source]] 
.]] 
core]] 
!=]]  "
null]]# '
)]]' (
{^^ 
IntVec3`` 
replenishPos`` (
=``) *
source``+ 1
.``1 2
reservedThing``2 ?
?``? @
.``@ A
Position``A I
??``J L
source``M S
.``S T
core``T X
.``X Y
Position``Y a
;``a b
intaa 
maxCanCarryaa #
=aa$ %
pawnaa& *
.aa* +
carryTrackeraa+ 7
.aa7 8
MaxStackSpaceEveraa8 I
(aaI J
sourceaaJ P
.aaP Q
defaaQ T
)aaT U
;aaU V
intbb 
actualCountbb #
=bb$ %
Mathbb& *
.bb* +
Minbb+ .
(bb. /
sourcebb/ 5
.bb5 6
neededbb6 <
,bb< =
maxCanCarrybb> I
)bbI J
;bbJ K

finalThingdd 
=dd  "
ReplenishToNeededCountdd! 7
(dd7 8
sourcedd8 >
.dd> ?
coredd? C
,ddC D
sourceddE K
.ddK L
defddL O
,ddO P
sourceddQ W
.ddW X
stuffddX ]
,dd] ^
actualCountdd_ j
,ddj k
replenishPosddl x
,ddx y
pawnddz ~
.dd~ 
Map	dd Ç
,
ddÇ É
source
ddÑ ä
.
ddä ã
reservedThing
ddã ò
)
ddò ô
;
ddô ö
ifff 
(ff 

finalThingff "
==ff# %
nullff& *
||ff+ -
!ff. /

finalThingff/ 9
.ff9 :
Spawnedff: A
)ffA B
{gg 
ifhh 
(hh "
DigitalStorageSettingshh 2
.hh2 3
enableDebugLoghh3 A
)hhA B
Logii 
.ii  
Messageii  '
(ii' (
$"ii( *
$strii* 9
{ii9 :
sourceii: @
.ii@ A
defiiA D
.iiD E
defNameiiE L
}iiL M
"iiM N
)iiN O
;iiO P
returnjj 
;jj 
}kk 
ifmm 
(mm "
DigitalStorageSettingsmm .
.mm. /
enableDebugLogmm/ =
)mm= >
Lognn 
.nn 
Messagenn #
(nn# $
$"nn$ &
$strnn& 5
{nn5 6

finalThingnn6 @
.nn@ A
LabelnnA F
}nnF G
$strnnG I
{nnI J

finalThingnnJ T
.nnT U

stackCountnnU _
}nn_ `
"nn` a
)nna b
;nnb c
}oo 
elsepp 
{qq 

finalThingss 
=ss  
sourcess! '
.ss' (
mapThingss( 0
;ss0 1
}tt 
ifww 
(ww 
!ww 
pawnww 
.ww 

CanReserveww $
(ww$ %

finalThingww% /
,ww/ 0
$numww1 2
,ww2 3
-ww4 5
$numww5 6
,ww6 7
nullww8 <
,ww< =
falseww> C
)wwC D
||wwE G
!wwH I
pawnwwI M
.wwM N
CanReachwwN V
(wwV W

finalThingwwW a
,wwa b
PathEndModewwc n
.wwn o
OnCellwwo u
,wwu v
Dangerwww }
.ww} ~
Deadly	ww~ Ñ
)
wwÑ Ö
)
wwÖ Ü
{xx 
ifyy 
(yy "
DigitalStorageSettingsyy .
.yy. /
enableDebugLogyy/ =
)yy= >
Logzz 
.zz 
Messagezz #
(zz# $
$"zz$ &
$strzz& 9
{zz9 :

finalThingzz: D
.zzD E
LabelzzE J
}zzJ K
"zzK L
)zzL M
;zzM N
return{{ 
;{{ 
}|| 
int~~ 

countToUse~~ 
=~~  
Math~~! %
.~~% &
Min~~& )
(~~) *
source~~* 0
.~~0 1
needed~~1 7
,~~7 8

finalThing~~9 C
.~~C D

stackCount~~D N
)~~N O
;~~O P
virtualIngredients "
." #
Add# &
(& '
new' *

ThingCount+ 5
(5 6

finalThing6 @
,@ A

countToUseB L
)L M
)M N
;N O
}
ÄÄ 
if
ÉÉ 
(
ÉÉ  
virtualIngredients
ÉÉ "
.
ÉÉ" #
Count
ÉÉ# (
==
ÉÉ) +
billProd
ÉÉ, 4
.
ÉÉ4 5
recipe
ÉÉ5 ;
.
ÉÉ; <
ingredients
ÉÉ< G
.
ÉÉG H
Count
ÉÉH M
)
ÉÉM N
{
ÑÑ 
if
ÖÖ 
(
ÖÖ 
chosen
ÖÖ 
==
ÖÖ 
null
ÖÖ "
)
ÖÖ" #
{
ÜÜ 
chosen
áá 
=
áá 
new
áá  
List
áá! %
<
áá% &

ThingCount
áá& 0
>
áá0 1
(
áá1 2
)
áá2 3
;
áá3 4
}
àà 
chosen
ââ 
.
ââ 
AddRange
ââ 
(
ââ   
virtualIngredients
ââ  2
)
ââ2 3
;
ââ3 4
__result
ää 
=
ää 
true
ää 
;
ää  
if
åå 
(
åå $
DigitalStorageSettings
åå *
.
åå* +
enableDebugLog
åå+ 9
)
åå9 :
Log
çç 
.
çç 
Message
çç 
(
çç  
$"
çç  "
$str
çç" 0
{
çç0 1 
virtualIngredients
çç1 C
.
ççC D
Count
ççD I
}
ççI J
$str
ççJ N
"
ççN O
)
ççO P
;
ççP Q
}
éé 
}
èè 	
private
ëë 
static
ëë 
Thing
ëë 
FindMaterialOnMap
ëë .
(
ëë. /
Pawn
ëë/ 3
pawn
ëë4 8
,
ëë8 9
IngredientCount
ëë: I

ingredient
ëëJ T
,
ëëT U
Bill_Production
ëëV e
billProd
ëëf n
,
ëën o
int
ëëp s
neededCount
ëët 
)ëë Ä
{
íí 	
return
ìì 

GenClosest
ìì 
.
ìì #
ClosestThingReachable
ìì 3
(
ìì3 4
pawn
îî 
.
îî 
Position
îî 
,
îî 
pawn
ïï 
.
ïï 
Map
ïï 
,
ïï 
ThingRequest
ññ 
.
ññ 
ForGroup
ññ %
(
ññ% &
ThingRequestGroup
ññ& 7
.
ññ7 8
HaulableEver
ññ8 D
)
ññD E
,
ññE F
PathEndMode
óó 
.
óó 
ClosestTouch
óó (
,
óó( )
TraverseParms
òò 
.
òò 
For
òò !
(
òò! "
pawn
òò" &
,
òò& '
Danger
òò( .
.
òò. /
Deadly
òò/ 5
,
òò5 6
TraverseMode
òò7 C
.
òòC D
ByPawn
òòD J
,
òòJ K
false
òòL Q
,
òòQ R
false
òòS X
,
òòX Y
true
òòZ ^
)
òò^ _
,
òò_ `
$num
ôô 
,
ôô 
t
öö 
=>
öö 
t
öö 
.
öö 
Spawned
öö 
&&
öö !

ingredient
õõ 
.
õõ  
filter
õõ  &
.
õõ& '
Allows
õõ' -
(
õõ- .
t
õõ. /
)
õõ/ 0
&&
õõ1 3
(
úú 
billProd
úú 
.
úú 
ingredientFilter
úú /
==
úú0 2
null
úú3 7
||
úú8 :
billProd
úú; C
.
úúC D
ingredientFilter
úúD T
.
úúT U
Allows
úúU [
(
úú[ \
t
úú\ ]
)
úú] ^
||
úú_ a

ingredient
úúb l
.
úúl m
IsFixedIngredient
úúm ~
)
úú~ 
&&úúÄ Ç
!
ùù 
t
ùù 
.
ùù 
IsForbidden
ùù #
(
ùù# $
pawn
ùù$ (
)
ùù( )
&&
ùù* ,
pawn
ûû 
.
ûû 

CanReserve
ûû $
(
ûû$ %
t
ûû% &
,
ûû& '
$num
ûû( )
,
ûû) *
-
ûû+ ,
$num
ûû, -
,
ûû- .
null
ûû/ 3
,
ûû3 4
false
ûû5 :
)
ûû: ;
&&
ûû< >
t
üü 
.
üü 

stackCount
üü !
>=
üü" $
neededCount
üü% 0
&&
üü1 3
!
†† 
t
†† 
.
†† 

IsNotFresh
†† "
(
††" #
)
††# $
,
††$ %
null
°° 
,
°° 
$num
°° 
,
°° 
-
°° 
$num
°° 
,
°° 
false
°° "
,
°°" #

RegionType
°°$ .
.
°°. /
Set_Passable
°°/ ;
,
°°; <
false
°°= B
,
°°B C
false
°°D I
)
°°I J
;
°°J K
}
¢¢ 	
private
§§ 
static
§§ 
(
§§ "
Building_StorageCore
§§ ,
core
§§- 1
,
§§1 2
ThingDef
§§3 ;
def
§§< ?
,
§§? @
ThingDef
§§A I
stuff
§§J O
,
§§O P
Thing
§§Q V
reservedThing
§§W d
)
§§d e!
FindMaterialInCores
§§f y
(
§§y z)
DigitalStorageGameComponent
•• '
gameComp
••( 0
,
••0 1
IngredientCount
••2 A

ingredient
••B L
,
••L M
Bill_Production
••N ]
billProd
••^ f
,
••f g
int
••h k
neededCount
••l w
,
••w x
Map
••y |
map••} Ä
)••Ä Å
{
¶¶ 	
foreach
ßß 
(
ßß "
Building_StorageCore
ßß )
core
ßß* .
in
ßß/ 1
gameComp
ßß2 :
.
ßß: ;
GetAllCores
ßß; F
(
ßßF G
)
ßßG H
)
ßßH I
{
®® 
if
©© 
(
©© 
core
©© 
==
©© 
null
©©  
||
©©! #
!
©©$ %
core
©©% )
.
©©) *
Spawned
©©* 1
||
©©2 4
!
©©5 6
core
©©6 :
.
©©: ;
Powered
©©; B
||
©©C E
core
©©F J
.
©©J K
Map
©©K N
!=
©©O Q
map
©©R U
)
©©U V
{
™™ 
continue
´´ 
;
´´ 
}
¨¨ 
ThingDef
ØØ 
anyDef
ØØ 
=
ØØ  !

ingredient
ØØ" ,
.
ØØ, -
filter
ØØ- 3
.
ØØ3 4
AnyAllowedDef
ØØ4 A
;
ØØA B
Thing
∞∞ 
reservedThing
∞∞ #
=
∞∞$ %
core
∞∞& *
.
∞∞* +
FindReservedItem
∞∞+ ;
(
∞∞; <
anyDef
∞∞< B
,
∞∞B C
null
∞∞D H
)
∞∞H I
;
∞∞I J
if
≤≤ 
(
≤≤ 
reservedThing
≤≤ !
!=
≤≤" $
null
≤≤% )
&&
≤≤* ,
reservedThing
≤≤- :
.
≤≤: ;
Spawned
≤≤; B
)
≤≤B C
{
≥≥ 
if
¥¥ 
(
¥¥ 
!
¥¥ 

ingredient
¥¥ #
.
¥¥# $
filter
¥¥$ *
.
¥¥* +
Allows
¥¥+ 1
(
¥¥1 2
reservedThing
¥¥2 ?
.
¥¥? @
def
¥¥@ C
)
¥¥C D
)
¥¥D E
{
µµ 
continue
∂∂  
;
∂∂  !
}
∑∑ 
bool
ππ 
billFilterAllows
ππ )
=
ππ* +
billProd
ππ, 4
.
ππ4 5
ingredientFilter
ππ5 E
==
ππF H
null
ππI M
||
ππN P
billProd
∫∫+ 3
.
∫∫3 4
ingredientFilter
∫∫4 D
.
∫∫D E
Allows
∫∫E K
(
∫∫K L
reservedThing
∫∫L Y
.
∫∫Y Z
def
∫∫Z ]
)
∫∫] ^
||
∫∫_ a

ingredient
ªª+ 5
.
ªª5 6
filter
ªª6 <
.
ªª< =
AllowedDefCount
ªª= L
==
ªªM O
$num
ªªP Q
;
ªªQ R
if
ΩΩ 
(
ΩΩ 
billFilterAllows
ΩΩ (
)
ΩΩ( )
{
ææ 
int
øø 
reservedCount
øø )
=
øø* +
reservedThing
øø, 9
.
øø9 :

stackCount
øø: D
;
øøD E
int
¿¿ 
virtualCount
¿¿ (
=
¿¿) *
core
¿¿+ /
.
¿¿/ 0
GetItemCount
¿¿0 <
(
¿¿< =
reservedThing
¿¿= J
.
¿¿J K
def
¿¿K N
,
¿¿N O
reservedThing
¿¿P ]
.
¿¿] ^
Stuff
¿¿^ c
)
¿¿c d
;
¿¿d e
if
¬¬ 
(
¬¬ 
reservedCount
¬¬ )
+
¬¬* +
virtualCount
¬¬, 8
>=
¬¬9 ;
neededCount
¬¬< G
)
¬¬G H
{
√√ 
return
ƒƒ "
(
ƒƒ# $
core
ƒƒ$ (
,
ƒƒ( )
reservedThing
ƒƒ* 7
.
ƒƒ7 8
def
ƒƒ8 ;
,
ƒƒ; <
reservedThing
ƒƒ= J
.
ƒƒJ K
Stuff
ƒƒK P
,
ƒƒP Q
reservedThing
ƒƒR _
)
ƒƒ_ `
;
ƒƒ` a
}
≈≈ 
}
∆∆ 
}
«« 
foreach
   
(
   
StoredItemData
   '
itemData
  ( 0
in
  1 3
core
  4 8
.
  8 9
GetAllStoredItems
  9 J
(
  J K
)
  K L
)
  L M
{
ÀÀ 
if
ÃÃ 
(
ÃÃ 
itemData
ÃÃ  
.
ÃÃ  !
def
ÃÃ! $
==
ÃÃ% '
null
ÃÃ( ,
||
ÃÃ- /
itemData
ÃÃ0 8
.
ÃÃ8 9

stackCount
ÃÃ9 C
<=
ÃÃD F
$num
ÃÃG H
)
ÃÃH I
{
ÕÕ 
continue
ŒŒ  
;
ŒŒ  !
}
œœ 
if
—— 
(
—— 
!
—— 

ingredient
—— #
.
——# $
filter
——$ *
.
——* +
Allows
——+ 1
(
——1 2
itemData
——2 :
.
——: ;
def
——; >
)
——> ?
)
——? @
{
““ 
continue
””  
;
””  !
}
‘‘ 
bool
÷÷ 
billFilterAllows
÷÷ )
=
÷÷* +
billProd
÷÷, 4
.
÷÷4 5
ingredientFilter
÷÷5 E
==
÷÷F H
null
÷÷I M
||
÷÷N P
billProd
◊◊+ 3
.
◊◊3 4
ingredientFilter
◊◊4 D
.
◊◊D E
Allows
◊◊E K
(
◊◊K L
itemData
◊◊L T
.
◊◊T U
def
◊◊U X
)
◊◊X Y
||
◊◊Z \

ingredient
ÿÿ+ 5
.
ÿÿ5 6
filter
ÿÿ6 <
.
ÿÿ< =
AllowedDefCount
ÿÿ= L
==
ÿÿM O
$num
ÿÿP Q
;
ÿÿQ R
if
⁄⁄ 
(
⁄⁄ 
billFilterAllows
⁄⁄ (
&&
⁄⁄) +
itemData
⁄⁄, 4
.
⁄⁄4 5

stackCount
⁄⁄5 ?
>=
⁄⁄@ B
neededCount
⁄⁄C N
)
⁄⁄N O
{
€€ 
return
‹‹ 
(
‹‹  
core
‹‹  $
,
‹‹$ %
itemData
‹‹& .
.
‹‹. /
def
‹‹/ 2
,
‹‹2 3
itemData
‹‹4 <
.
‹‹< =
stuffDef
‹‹= E
,
‹‹E F
null
‹‹G K
)
‹‹K L
;
‹‹L M
}
›› 
}
ﬁﬁ 
}
ﬂﬂ 
return
·· 
(
·· 
null
·· 
,
·· 
null
·· 
,
·· 
null
··  $
,
··$ %
null
··& *
)
··* +
;
··+ ,
}
‚‚ 	
private
‰‰ 
static
‰‰ 
Thing
‰‰ $
ReplenishToNeededCount
‰‰ 3
(
‰‰3 4"
Building_StorageCore
‰‰4 H
core
‰‰I M
,
‰‰M N
ThingDef
‰‰O W
def
‰‰X [
,
‰‰[ \
ThingDef
‰‰] e
stuff
‰‰f k
,
‰‰k l
int
‰‰m p
needed
‰‰q w
,
‰‰w x
IntVec3‰‰y Ä
position‰‰Å â
,‰‰â ä
Map‰‰ã é
map‰‰è í
,‰‰í ì
Thing‰‰î ô 
existingReserved‰‰ö ™
)‰‰™ ´
{
ÂÂ 	
if
ÊÊ 
(
ÊÊ 
core
ÊÊ 
==
ÊÊ 
null
ÊÊ 
||
ÊÊ 
def
ÊÊ  #
==
ÊÊ$ &
null
ÊÊ' +
||
ÊÊ, .
needed
ÊÊ/ 5
<=
ÊÊ6 8
$num
ÊÊ9 :
||
ÊÊ; =
map
ÊÊ> A
==
ÊÊB D
null
ÊÊE I
)
ÊÊI J
{
ÁÁ 
return
ËË 
null
ËË 
;
ËË 
}
ÈÈ 
int
ÎÎ 
currentCount
ÎÎ 
=
ÎÎ 
existingReserved
ÎÎ /
?
ÎÎ/ 0
.
ÎÎ0 1

stackCount
ÎÎ1 ;
??
ÎÎ< >
$num
ÎÎ? @
;
ÎÎ@ A
int
ÏÏ 
needMore
ÏÏ 
=
ÏÏ 
needed
ÏÏ !
-
ÏÏ" #
currentCount
ÏÏ$ 0
;
ÏÏ0 1
if
ÓÓ 
(
ÓÓ 
needMore
ÓÓ 
<=
ÓÓ 
$num
ÓÓ 
)
ÓÓ 
{
ÔÔ 
return
 
existingReserved
 '
;
' (
}
ÒÒ 
Thing
ÛÛ 
	extracted
ÛÛ 
=
ÛÛ 
core
ÛÛ "
.
ÛÛ" #
ExtractItem
ÛÛ# .
(
ÛÛ. /
def
ÛÛ/ 2
,
ÛÛ2 3
needMore
ÛÛ4 <
,
ÛÛ< =
stuff
ÛÛ> C
)
ÛÛC D
;
ÛÛD E
if
ÙÙ 
(
ÙÙ 
	extracted
ÙÙ 
==
ÙÙ 
null
ÙÙ !
)
ÙÙ! "
{
ıı 
return
ˆˆ 
existingReserved
ˆˆ '
;
ˆˆ' (
}
˜˜ 
if
˘˘ 
(
˘˘ 
existingReserved
˘˘  
!=
˘˘! #
null
˘˘$ (
&&
˘˘) +
existingReserved
˘˘, <
.
˘˘< =
Spawned
˘˘= D
)
˘˘D E
{
˙˙ 
bool
˚˚ 
absorbed
˚˚ 
=
˚˚ 
existingReserved
˚˚  0
.
˚˚0 1
TryAbsorbStack
˚˚1 ?
(
˚˚? @
	extracted
˚˚@ I
,
˚˚I J
false
˚˚K P
)
˚˚P Q
;
˚˚Q R
if
¸¸ 
(
¸¸ 
absorbed
¸¸ 
)
¸¸ 
{
˝˝ 
try
˛˛ 
{
ˇˇ 
if
ÄÄ 
(
ÄÄ 
	extracted
ÄÄ %
!=
ÄÄ& (
null
ÄÄ) -
&&
ÄÄ. 0
!
ÄÄ1 2
	extracted
ÄÄ2 ;
.
ÄÄ; <
	Destroyed
ÄÄ< E
&&
ÄÄF H
	extracted
ÄÄI R
.
ÄÄR S

stackCount
ÄÄS ]
>
ÄÄ^ _
$num
ÄÄ` a
)
ÄÄa b
{
ÅÅ 
GenSpawn
ÇÇ $
.
ÇÇ$ %
Spawn
ÇÇ% *
(
ÇÇ* +
	extracted
ÇÇ+ 4
,
ÇÇ4 5
existingReserved
ÇÇ6 F
.
ÇÇF G
Position
ÇÇG O
,
ÇÇO P
map
ÇÇQ T
,
ÇÇT U
WipeMode
ÇÇV ^
.
ÇÇ^ _
Vanish
ÇÇ_ e
)
ÇÇe f
;
ÇÇf g
}
ÉÉ 
}
ÑÑ 
catch
ÖÖ 
{
ÖÖ 
}
ÖÖ 
return
ÜÜ 
existingReserved
ÜÜ +
;
ÜÜ+ ,
}
áá 
else
àà 
{
ââ 
GenSpawn
ää 
.
ää 
Spawn
ää "
(
ää" #
	extracted
ää# ,
,
ää, -
existingReserved
ää. >
.
ää> ?
Position
ää? G
,
ääG H
map
ääI L
,
ääL M
WipeMode
ääN V
.
ääV W
Vanish
ääW ]
)
ää] ^
;
ää^ _
return
ãã 
existingReserved
ãã +
;
ãã+ ,
}
åå 
}
çç 
else
éé 
{
èè 
GenSpawn
êê 
.
êê 
Spawn
êê 
(
êê 
	extracted
êê (
,
êê( )
position
êê* 2
,
êê2 3
map
êê4 7
,
êê7 8
WipeMode
êê9 A
.
êêA B
Vanish
êêB H
)
êêH I
;
êêI J
return
ëë 
	extracted
ëë  
;
ëë  !
}
íí 
}
ìì 	
}
îî 
}ïï ¥ã
uB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\Patch_Pawn_JobTracker_StartJob_Teleport.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ 
HarmonyPatch 
( 
typeof 
( 
Pawn_JobTracker (
)( )
,) *
$str+ 5
)5 6
]6 7
public 

static 
class 3
'Patch_Pawn_JobTracker_StartJob_Teleport ?
{ 
public 
static 
bool 
Prefix !
(! "
Job" %
newJob& ,
,, -
Pawn. 2
___pawn3 :
): ;
{ 	
if 
( 
newJob 
== 
null 
|| !
___pawn" )
==* ,
null- 1
||2 4
___pawn5 <
.< =
Map= @
==A C
nullD H
||I K
newJobL R
.R S
defS V
==W Y
nullZ ^
)^ _
{ 
return 
true 
; 
} 
if 
( 
newJob 
. 
def 
== 
JobDefOf &
.& '
DoBill' -
&&. 0
newJob1 7
.7 8

countQueue8 B
!=C E
nullF J
&&K M
newJobN T
.T U
targetQueueBU a
!=b d
nulle i
)i j
{ 
HandleDoBill   
(   
newJob   #
,  # $
___pawn  % ,
)  , -
;  - .
}!! 
else## 
if## 
(## 
newJob## 
.## 
def## 
==##  "
JobDefOf### +
.##+ ,
HaulToContainer##, ;
)##; <
{$$ !
HandleHaulToContainer%% %
(%%% &
newJob%%& ,
,%%, -
___pawn%%. 5
)%%5 6
;%%6 7
}&& 
return(( 
true(( 
;(( 
})) 	
private++ 
static++ 
void++ 
HandleDoBill++ (
(++( )
Job++) ,
job++- 0
,++0 1
Pawn++2 6
pawn++7 ;
)++; <
{,, 	
Thing-- 
	billGiver-- 
=-- 
job-- !
.--! "
targetA--" )
.--) *
Thing--* /
;--/ 0
if.. 
(.. 
	billGiver.. 
==.. 
null.. !
||.." $
	billGiver..% .
.... /
Map../ 2
==..3 5
null..6 :
)..: ;
{// 
return00 
;00 
}11 
if33 
(33 
job33 
.33 
targetQueueB33  
==33! #
null33$ (
||33) +
job33, /
.33/ 0

countQueue330 :
==33; =
null33> B
)33B C
{44 
return55 
;55 
}66 
bool88 
hasChip88 
=88 
PawnStorageAccess88 ,
.88, -
HasTerminalImplant88- ?
(88? @
pawn88@ D
)88D E
;88E F
if99 
(99 
!99 
hasChip99 
)99 
{:: 
return;; 
;;; 
}<< 
IntVec3?? 
workbenchPos??  
=??! " 
GetBillGiverRootCell??# 7
(??7 8
	billGiver??8 A
,??A B
pawn??C G
)??G H
;??H I
bool@@ 
hasVirtualMaterial@@ #
=@@$ %
false@@& +
;@@+ ,
forBB 
(BB 
intBB 
iBB 
=BB 
$numBB 
;BB 
iBB 
<BB 
jobBB  #
.BB# $
targetQueueBBB$ 0
.BB0 1
CountBB1 6
;BB6 7
iBB8 9
++BB9 ;
)BB; <
{CC 
ifDD 
(DD 
iDD 
>=DD 
jobDD 
.DD 

countQueueDD '
.DD' (
CountDD( -
)DD- .
{EE 
continueFF 
;FF 
}GG 
LocalTargetInfoII 

targetInfoII  *
=II+ ,
jobII- 0
.II0 1
targetQueueBII1 =
[II= >
iII> ?
]II? @
;II@ A
ifJJ 
(JJ 
!JJ 

targetInfoJJ 
.JJ  
IsValidJJ  '
||JJ( *
!JJ+ ,

targetInfoJJ, 6
.JJ6 7
HasThingJJ7 ?
)JJ? @
{KK 
continueLL 
;LL 
}MM 
ThingOO 
materialOO 
=OO  

targetInfoOO! +
.OO+ ,
ThingOO, 1
;OO1 2
ifPP 
(PP 
materialPP 
==PP 
nullPP  $
||PP% '
materialPP( 0
.PP0 1
	DestroyedPP1 :
)PP: ;
{QQ 
continueRR 
;RR 
}SS 
intUU 
countNeededUU 
=UU  !
jobUU" %
.UU% &

countQueueUU& 0
[UU0 1
iUU1 2
]UU2 3
;UU3 4 
Building_StorageCoreXX $
materialCoreXX% 1
=XX2 3
FindCoreWithItemXX4 D
(XXD E
materialXXE M
,XXM N
pawnXXO S
.XXS T
MapXXT W
)XXW X
;XXX Y
ifYY 
(YY 
materialCoreYY  
!=YY! #
nullYY$ (
)YY( )
{ZZ 
hasVirtualMaterial[[ &
=[[' (
true[[) -
;[[- .
Thing]] 
thingToTeleport]] )
;]]) *
if^^ 
(^^ 
material^^  
.^^  !

stackCount^^! +
<=^^, .
countNeeded^^/ :
)^^: ;
{__ 
materialaa  
.aa  !
DeSpawnaa! (
(aa( )
$numaa) *
)aa* +
;aa+ ,
GenSpawnbb  
.bb  !
Spawnbb! &
(bb& '
materialbb' /
,bb/ 0
workbenchPosbb1 =
,bb= >
pawnbb? C
.bbC D
MapbbD G
,bbG H
WipeModebbI Q
.bbQ R
VanishbbR X
)bbX Y
;bbY Z
thingToTeleportcc '
=cc( )
materialcc* 2
;cc2 3
}dd 
elseee 
{ff 
thingToTeleporthh '
=hh( )
materialhh* 2
.hh2 3
SplitOffhh3 ;
(hh; <
countNeededhh< G
)hhG H
;hhH I
GenSpawnii  
.ii  !
Spawnii! &
(ii& '
thingToTeleportii' 6
,ii6 7
workbenchPosii8 D
,iiD E
pawniiF J
.iiJ K
MapiiK N
,iiN O
WipeModeiiP X
.iiX Y
VanishiiY _
)ii_ `
;ii` a
}jj 

FleckMakerll 
.ll 
ThrowLightningGlowll 1
(ll1 2
thingToTeleportll2 A
.llA B
DrawPosllB I
,llI J
thingToTeleportllK Z
.llZ [
Mapll[ ^
,ll^ _
$numll` d
)lld e
;lle f
jobmm 
.mm 
targetQueueBmm $
[mm$ %
imm% &
]mm& '
=mm( )
thingToTeleportmm* 9
;mm9 :
ifoo 
(oo "
DigitalStorageSettingsoo .
.oo. /
enableDebugLogoo/ =
)oo= >
{pp 
Logqq 
.qq 
Messageqq #
(qq# $
$"qq$ &
$strqq& 9
{qq9 :
thingToTeleportqq: I
.qqI J
LabelqqJ O
}qqO P
$strqqP R
{qqR S
thingToTeleportqqS b
.qqb c

stackCountqqc m
}qqm n
$strqqn t
{qqt u
workbenchPos	qqu Å
}
qqÅ Ç
"
qqÇ É
)
qqÉ Ñ
;
qqÑ Ö
}rr 
}ss 
}tt 
ifvv 
(vv 
hasVirtualMaterialvv "
)vv" #
{ww 
pawnxx 
.xx #
ClearReservationsForJobxx ,
(xx, -
jobxx- 0
)xx0 1
;xx1 2
}yy 
}zz 	
private|| 
static|| 
IntVec3||  
GetBillGiverRootCell|| 3
(||3 4
Thing||4 9
	billGiver||: C
,||C D
Pawn||E I
pawn||J N
)||N O
{}} 	
Building~~ 
building~~ 
=~~ 
	billGiver~~  )
as~~* ,
Building~~- 5
;~~5 6
if 
( 
building 
== 
null  
)  !
{
ÄÄ 
return
ÅÅ 
	billGiver
ÅÅ  
.
ÅÅ  !
Position
ÅÅ! )
;
ÅÅ) *
}
ÇÇ 
if
ÉÉ 
(
ÉÉ 
building
ÉÉ 
.
ÉÉ 
def
ÉÉ 
.
ÉÉ  
hasInteractionCell
ÉÉ /
)
ÉÉ/ 0
{
ÑÑ 
return
ÖÖ 
building
ÖÖ 
.
ÖÖ  
InteractionCell
ÖÖ  /
;
ÖÖ/ 0
}
ÜÜ 
return
áá 
pawn
áá 
.
áá 
Position
áá  
;
áá  !
}
àà 	
private
ää 
static
ää 
void
ää #
HandleHaulToContainer
ää 1
(
ää1 2
Job
ää2 5
job
ää6 9
,
ää9 :
Pawn
ää; ?
pawn
ää@ D
)
ääD E
{
ãã 	
if
åå 
(
åå $
DigitalStorageSettings
åå &
.
åå& '
enableDebugLog
åå' 5
)
åå5 6
Log
çç 
.
çç 
Message
çç 
(
çç 
$"
çç 
$str
çç A
{
ççA B
pawn
ççB F
.
ççF G
Name
ççG K
}
ççK L
$str
ççL Z
{
ççZ [
job
çç[ ^
.
çç^ _
targetA
çç_ f
}
ççf g
$str
ççg s
{
ççs t
job
ççt w
.
ççw x
count
ççx }
}
çç} ~
"
çç~ 
)çç Ä
;ççÄ Å
if
èè 
(
èè 
job
èè 
.
èè 
targetA
èè 
.
èè 
Thing
èè !
==
èè" $
null
èè% )
||
èè* ,
job
èè- 0
.
èè0 1
targetA
èè1 8
.
èè8 9
Thing
èè9 >
.
èè> ?
Map
èè? B
==
èèC E
null
èèF J
)
èèJ K
{
êê 
return
ëë 
;
ëë 
}
íí 
bool
îî 
hasChip
îî 
=
îî 
PawnStorageAccess
îî ,
.
îî, - 
HasTerminalImplant
îî- ?
(
îî? @
pawn
îî@ D
)
îîD E
;
îîE F
if
ïï 
(
ïï 
!
ïï 
hasChip
ïï 
)
ïï 
{
ññ 
return
óó 
;
óó 
}
òò 
Thing
öö 
material
öö 
=
öö 
job
öö  
.
öö  !
targetA
öö! (
.
öö( )
Thing
öö) .
;
öö. /
if
õõ 
(
õõ 
material
õõ 
==
õõ 
null
õõ  
||
õõ! #
material
õõ$ ,
.
õõ, -
	Destroyed
õõ- 6
)
õõ6 7
{
úú 
return
ùù 
;
ùù 
}
ûû "
Building_StorageCore
°°  
materialCore
°°! -
=
°°. /
FindCoreWithItem
°°0 @
(
°°@ A
material
°°A I
,
°°I J
pawn
°°K O
.
°°O P
Map
°°P S
)
°°S T
;
°°T U
if
££ 
(
££ 
materialCore
££ 
!=
££ 
null
££  $
)
££$ %
{
§§ 
int
¶¶ 
countNeeded
¶¶ 
=
¶¶  !
job
¶¶" %
.
¶¶% &
count
¶¶& +
>
¶¶, -
$num
¶¶. /
?
¶¶0 1
job
¶¶2 5
.
¶¶5 6
count
¶¶6 ;
:
¶¶< =
material
¶¶> F
.
¶¶F G

stackCount
¶¶G Q
;
¶¶Q R
Thing
®® 
thingToTeleport
®® %
;
®®% &
if
©© 
(
©© 
material
©© 
.
©© 

stackCount
©© '
>
©©( )
countNeeded
©©* 5
)
©©5 6
{
™™ 
thingToTeleport
¨¨ #
=
¨¨$ %
material
¨¨& .
.
¨¨. /
SplitOff
¨¨/ 7
(
¨¨7 8
countNeeded
¨¨8 C
)
¨¨C D
;
¨¨D E
GenSpawn
≠≠ 
.
≠≠ 
Spawn
≠≠ "
(
≠≠" #
thingToTeleport
≠≠# 2
,
≠≠2 3
material
≠≠4 <
.
≠≠< =
Position
≠≠= E
,
≠≠E F
pawn
≠≠G K
.
≠≠K L
Map
≠≠L O
,
≠≠O P
WipeMode
≠≠Q Y
.
≠≠Y Z
Vanish
≠≠Z `
)
≠≠` a
;
≠≠a b
}
ÆÆ 
else
ØØ 
{
∞∞ 
thingToTeleport
≤≤ #
=
≤≤$ %
material
≤≤& .
;
≤≤. /
}
≥≥ 
thingToTeleport
∂∂ 
.
∂∂  
DeSpawn
∂∂  '
(
∂∂' (
$num
∂∂( )
)
∂∂) *
;
∂∂* +
GenSpawn
∑∑ 
.
∑∑ 
Spawn
∑∑ 
(
∑∑ 
thingToTeleport
∑∑ .
,
∑∑. /
pawn
∑∑0 4
.
∑∑4 5
Position
∑∑5 =
,
∑∑= >
pawn
∑∑? C
.
∑∑C D
Map
∑∑D G
,
∑∑G H
WipeMode
∑∑I Q
.
∑∑Q R
Vanish
∑∑R X
)
∑∑X Y
;
∑∑Y Z

FleckMaker
∏∏ 
.
∏∏  
ThrowLightningGlow
∏∏ -
(
∏∏- .
thingToTeleport
∏∏. =
.
∏∏= >
DrawPos
∏∏> E
,
∏∏E F
thingToTeleport
∏∏G V
.
∏∏V W
Map
∏∏W Z
,
∏∏Z [
$num
∏∏\ `
)
∏∏` a
;
∏∏a b
job
ªª 
.
ªª 
targetA
ªª 
=
ªª 
thingToTeleport
ªª -
;
ªª- .
pawn
ææ 
.
ææ %
ClearReservationsForJob
ææ ,
(
ææ, -
job
ææ- 0
)
ææ0 1
;
ææ1 2
if
¿¿ 
(
¿¿ $
DigitalStorageSettings
¿¿ *
.
¿¿* +
enableDebugLog
¿¿+ 9
)
¿¿9 :
Log
¡¡ 
.
¡¡ 
Message
¡¡ 
(
¡¡  
$"
¡¡  "
$str
¡¡" =
{
¡¡= >
thingToTeleport
¡¡> M
.
¡¡M N
Label
¡¡N S
}
¡¡S T
$str
¡¡T V
{
¡¡V W
thingToTeleport
¡¡W f
.
¡¡f g

stackCount
¡¡g q
}
¡¡q r
$str
¡¡r u
{
¡¡u v
pawn
¡¡v z
.
¡¡z {
Position¡¡{ É
}¡¡É Ñ
"¡¡Ñ Ö
)¡¡Ö Ü
;¡¡Ü á
}
¬¬ 
}
√√ 	
private
≈≈ 
static
≈≈ "
Building_StorageCore
≈≈ +
FindCoreWithItem
≈≈, <
(
≈≈< =
Thing
≈≈= B
item
≈≈C G
,
≈≈G H
Map
≈≈I L
map
≈≈M P
)
≈≈P Q
{
∆∆ 	)
DigitalStorageGameComponent
«« '
gameComp
««( 0
=
««1 2
Current
««3 :
.
««: ;
Game
««; ?
?
««? @
.
««@ A
GetComponent
««A M
<
««M N)
DigitalStorageGameComponent
««N i
>
««i j
(
««j k
)
««k l
;
««l m
if
»» 
(
»» 
gameComp
»» 
==
»» 
null
»»  
)
»»  !
{
…… 
return
   
null
   
;
   
}
ÀÀ 
foreach
ÕÕ 
(
ÕÕ "
Building_StorageCore
ÕÕ )
core
ÕÕ* .
in
ÕÕ/ 1
gameComp
ÕÕ2 :
.
ÕÕ: ;
GetAllCores
ÕÕ; F
(
ÕÕF G
)
ÕÕG H
)
ÕÕH I
{
ŒŒ 
if
œœ 
(
œœ 
core
œœ 
==
œœ 
null
œœ  
||
œœ! #
!
œœ$ %
core
œœ% )
.
œœ) *
Spawned
œœ* 1
||
œœ2 4
!
œœ5 6
core
œœ6 :
.
œœ: ;
Powered
œœ; B
||
œœC E
core
œœF J
.
œœJ K
Map
œœK N
!=
œœO Q
map
œœR U
)
œœU V
{
–– 
continue
—— 
;
—— 
}
““ 
	SlotGroup
‘‘ 
	slotGroup
‘‘ #
=
‘‘$ %
core
‘‘& *
.
‘‘* +
GetSlotGroup
‘‘+ 7
(
‘‘7 8
)
‘‘8 9
;
‘‘9 :
if
’’ 
(
’’ 
	slotGroup
’’ 
!=
’’  
null
’’! %
)
’’% &
{
÷÷ 
foreach
ÿÿ 
(
ÿÿ 
Thing
ÿÿ "
thing
ÿÿ# (
in
ÿÿ) +
	slotGroup
ÿÿ, 5
.
ÿÿ5 6

HeldThings
ÿÿ6 @
)
ÿÿ@ A
{
ŸŸ 
if
⁄⁄ 
(
⁄⁄ 
thing
⁄⁄ !
==
⁄⁄" $
item
⁄⁄% )
)
⁄⁄) *
{
€€ 
return
‹‹ "
core
‹‹# '
;
‹‹' (
}
›› 
}
ﬁﬁ 
if
·· 
(
·· 
	slotGroup
·· !
.
··! "
	CellsList
··" +
.
··+ ,
Contains
··, 4
(
··4 5
item
··5 9
.
··9 :
Position
··: B
)
··B C
)
··C D
{
‚‚ 
return
„„ 
core
„„ #
;
„„# $
}
‰‰ 
}
ÂÂ 
}
ÊÊ 
return
ËË 
null
ËË 
;
ËË 
}
ÈÈ 	
}
ÍÍ 
}ÎÎ Î
YB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\HarmonyPatches\HarmonyInit.cs
	namespace 	
DigitalStorage
 
. 
HarmonyPatches '
{ 
[ &
StaticConstructorOnStartup 
]  
public 

static 
class 
HarmonyInit #
{ 
static		 
HarmonyInit		 
(		 
)		 
{

 	
Harmony 
harmony 
= 
new !
Harmony" )
() *
$str* I
)I J
;J K
harmony 
. 
PatchAll 
( 
) 
; 
Log 
. 
Message 
( 
$str G
)G H
;H I
} 	
} 
} Å?
RB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Data\StoredItemData.cs
	namespace 	
DigitalStorage
 
. 
Data 
{ 
public

 

class

 
StoredItemData

 
:

  !

IExposable

" ,
{ 
public 
ThingDef 
def 
; 
public 
ThingDef 
stuffDef  
;  !
public 
QualityCategory 
quality &
=' (
QualityCategory) 8
.8 9
Normal9 ?
;? @
public 
int 
	hitPoints 
= 
-  
$num  !
;! "
public 
int 

stackCount 
= 
$num  !
;! "
public 
string 
uniqueId 
; 
public 
StoredItemData 
( 
) 
{ 	
this 
. 
uniqueId 
= 
Guid  
.  !
NewGuid! (
(( )
)) *
.* +
ToString+ 3
(3 4
)4 5
;5 6
} 	
public 
StoredItemData 
( 
Thing #
thing$ )
)) *
{ 	
this 
. 
def 
= 
thing 
. 
def  
;  !
this 
. 
stuffDef 
= 
thing !
.! "
Stuff" '
;' (
this 
. 

stackCount 
= 
thing #
.# $

stackCount$ .
;. /
this 
. 
	hitPoints 
= 
thing "
." #
	HitPoints# ,
;, -
this   
.   
uniqueId   
=   
Guid    
.    !
NewGuid  ! (
(  ( )
)  ) *
.  * +
ToString  + 3
(  3 4
)  4 5
;  5 6
CompQuality## 
compQuality## #
=##$ %
thing##& +
.##+ ,

TryGetComp##, 6
<##6 7
CompQuality##7 B
>##B C
(##C D
)##D E
;##E F
if$$ 
($$ 
compQuality$$ 
!=$$ 
null$$ #
)$$# $
{%% 
this&& 
.&& 
quality&& 
=&& 
compQuality&& *
.&&* +
Quality&&+ 2
;&&2 3
}'' 
}(( 	
public** 
void** 

ExposeData** 
(** 
)**  
{++ 	
Scribe_Defs,, 
.,, 
Look,, 
(,, 
ref,,  
this,,! %
.,,% &
def,,& )
,,,) *
$str,,+ 0
),,0 1
;,,1 2
Scribe_Defs-- 
.-- 
Look-- 
(-- 
ref--  
this--! %
.--% &
stuffDef--& .
,--. /
$str--0 :
)--: ;
;--; <
Scribe_Values.. 
... 
Look.. 
(.. 
ref.. "
this..# '
...' (
quality..( /
,../ 0
$str..1 :
,..: ;
QualityCategory..< K
...K L
Normal..L R
)..R S
;..S T
Scribe_Values// 
.// 
Look// 
(// 
ref// "
this//# '
.//' (
	hitPoints//( 1
,//1 2
$str//3 >
,//> ?
-//@ A
$num//A B
)//B C
;//C D
Scribe_Values00 
.00 
Look00 
(00 
ref00 "
this00# '
.00' (

stackCount00( 2
,002 3
$str004 @
,00@ A
$num00B C
)00C D
;00D E
Scribe_Values11 
.11 
Look11 
(11 
ref11 "
this11# '
.11' (
uniqueId11( 0
,110 1
$str112 <
,11< =
null11> B
)11B C
;11C D
if33 
(33 
Scribe33 
.33 
mode33 
==33 
LoadSaveMode33 +
.33+ ,
PostLoadInit33, 8
&&339 ;
string33< B
.33B C
IsNullOrEmpty33C P
(33P Q
this33Q U
.33U V
uniqueId33V ^
)33^ _
)33_ `
{44 
this55 
.55 
uniqueId55 
=55 
Guid55  $
.55$ %
NewGuid55% ,
(55, -
)55- .
.55. /
ToString55/ 7
(557 8
)558 9
;559 :
}66 
}77 	
public<< 
Thing<< 
CreateThing<<  
(<<  !
)<<! "
{== 	
if>> 
(>> 
this>> 
.>> 
def>> 
==>> 
null>>  
)>>  !
{?? 
return@@ 
null@@ 
;@@ 
}AA 
ThingCC 
thingCC 
=CC 

ThingMakerCC $
.CC$ %
	MakeThingCC% .
(CC. /
thisCC/ 3
.CC3 4
defCC4 7
,CC7 8
thisCC9 =
.CC= >
stuffDefCC> F
)CCF G
;CCG H
thingDD 
.DD 

stackCountDD 
=DD 
thisDD #
.DD# $

stackCountDD$ .
;DD. /
ifFF 
(FF 
thisFF 
.FF 
	hitPointsFF 
>FF  
$numFF! "
)FF" #
{GG 
thingHH 
.HH 
	HitPointsHH 
=HH  !
thisHH" &
.HH& '
	hitPointsHH' 0
;HH0 1
}II 
CompQualityKK 
compQualityKK #
=KK$ %
thingKK& +
.KK+ ,

TryGetCompKK, 6
<KK6 7
CompQualityKK7 B
>KKB C
(KKC D
)KKD E
;KKE F
ifLL 
(LL 
compQualityLL 
!=LL 
nullLL #
)LL# $
{MM 
compQualityNN 
.NN 

SetQualityNN &
(NN& '
thisNN' +
.NN+ ,
qualityNN, 3
,NN3 4 
ArtGenerationContextNN5 I
.NNI J
ColonyNNJ P
)NNP Q
;NNQ R
}OO 
returnQQ 
thingQQ 
;QQ 
}RR 	
publicWW 
boolWW 
MatchesWW 
(WW 
ThingDefWW $
thingDefWW% -
,WW- .
ThingDefWW/ 7
stuffWW8 =
=WW> ?
nullWW@ D
)WWD E
{XX 	
returnYY 
thisYY 
.YY 
defYY 
==YY 
thingDefYY '
&&YY( *
thisYY+ /
.YY/ 0
stuffDefYY0 8
==YY9 ;
stuffYY< A
;YYA B
}ZZ 	
public\\ 
override\\ 
string\\ 
ToString\\ '
(\\' (
)\\( )
{]] 	
string^^ 
label^^ 
=^^ 
this^^ 
.^^  
def^^  #
?^^# $
.^^$ %
label^^% *
??^^+ -
$str^^. 7
;^^7 8
if__ 
(__ 
this__ 
.__ 
stuffDef__ 
!=__  
null__! %
)__% &
{`` 
labelaa 
=aa 
thisaa 
.aa 
stuffDefaa %
.aa% &
labelaa& +
+aa, -
$straa. 1
+aa2 3
labelaa4 9
;aa9 :
}bb 
returncc 
$"cc 
{cc 
labelcc 
}cc 
$strcc 
{cc 
thiscc #
.cc# $

stackCountcc$ .
}cc. /
"cc/ 0
;cc0 1
}dd 	
}ee 
}ff ⁄
gB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\CompUseEffect_TerminalImplant.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
public		 

class		 )
CompUseEffect_TerminalImplant		 .
:		/ 0
CompUseEffect		1 >
{

 
public 
override 
void 
DoEffect %
(% &
Pawn& *
user+ /
)/ 0
{ 	
base 
. 
DoEffect 
( 
user 
) 
;  "
Hediff_TerminalImplant "
." #
AddTerminalImplant# 5
(5 6
user6 :
): ;
;; <
Messages 
. 
Message 
( 
$" 
{  
user  $
.$ %

LabelShort% /
}/ 0
$str0 G
"G H
,H I
userJ N
,N O
MessageTypeDefOfP `
.` a
PositiveEventa n
)n o
;o p
} 	
public 
override 
AcceptanceReport (
CanBeUsedBy) 4
(4 5
Pawn5 9
p: ;
); <
{ 	
if 
( 
p 
== 
null 
|| 
! 
p 
.  
	RaceProps  )
.) *
	Humanlike* 3
)3 4
return 
$str !
;! "
if 
( "
Hediff_TerminalImplant &
.& '
HasTerminalImplant' 9
(9 :
p: ;
); <
)< =
return 
$str  
;  !
return 
true 
; 
} 	
public 
override 
TaggedString $
ConfirmMessage% 3
(3 4
Pawn4 8
p9 :
): ;
{ 	
return 
$" 
$str 
{ 
p 
. 

LabelShort '
}' (
$str( P
"P Q
;Q R
}   	
}!! 
public## 

class## 4
(CompProperties_UseEffect_TerminalImplant## 9
:##: ;$
CompProperties_UseEffect##< T
{$$ 
public%% 4
(CompProperties_UseEffect_TerminalImplant%% 7
(%%7 8
)%%8 9
{&& 	
this'' 
.'' 
	compClass'' 
='' 
typeof'' #
(''# $)
CompUseEffect_TerminalImplant''$ A
)''A B
;''B C
}(( 	
})) 
}** ¨*
_B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\CompVirtualIngredient.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
public		 

class		 ,
 CompProperties_VirtualIngredient		 1
:		2 3
CompProperties		4 B
{

 
public ,
 CompProperties_VirtualIngredient /
(/ 0
)0 1
{ 	
this 
. 
	compClass 
= 
typeof #
(# $!
CompVirtualIngredient$ 9
)9 :
;: ;
} 	
} 
public 

class !
CompVirtualIngredient &
:' (
	ThingComp) 2
{ 
private 
bool 
	isVirtual 
=  
false! &
;& '
private  
Building_StorageCore $

sourceCore% /
;/ 0
private 
Map 
	sourceMap 
; 
private 
bool 
isFromReserved #
=$ %
false& +
;+ ,
private 
bool %
reservedThingPositionOnly .
=/ 0
false1 6
;6 7
private 
Thing 
reservedThing #
=$ %
null& *
;* +
public   
bool   
	IsVirtual   
=>    
	isVirtual  ! *
;  * +
public""  
Building_StorageCore"" #

SourceCore""$ .
=>""/ 1

sourceCore""2 <
;""< =
public$$ 
Map$$ 
	SourceMap$$ 
=>$$ 
	sourceMap$$  )
;$$) *
public&& 
bool&& 
IsFromReserved&& "
=>&&# %
isFromReserved&&& 4
;&&4 5
public(( 
bool(( %
ReservedThingPositionOnly(( -
=>((. 0%
reservedThingPositionOnly((1 J
;((J K
public** 
Thing** 
ReservedThing** "
=>**# %
reservedThing**& 3
;**3 4
public,, 
void,, 

SetVirtual,, 
(,, 
bool,, #
value,,$ )
),,) *
{-- 	
	isVirtual.. 
=.. 
value.. 
;.. 
}// 	
public11 
void11 
SetSourceCore11 !
(11! " 
Building_StorageCore11" 6
core117 ;
)11; <
{22 	

sourceCore33 
=33 
core33 
;33 
}44 	
public66 
void66 
SetSourceMap66  
(66  !
Map66! $
map66% (
)66( )
{77 	
	sourceMap88 
=88 
map88 
;88 
}99 	
public;; 
void;; 
SetFromReserved;; #
(;;# $
bool;;$ (
value;;) .
,;;. /
Thing;;0 5
reservedThing;;6 C
=;;D E
null;;F J
);;J K
{<< 	
isFromReserved== 
=== 
value== "
;==" #
this>> 
.>> 
reservedThing>> 
=>>  
reservedThing>>! .
;>>. /
this?? 
.?? %
reservedThingPositionOnly?? *
=??+ ,
false??- 2
;??2 3
}@@ 	
publicBB 
voidBB (
SetReservedThingPositionOnlyBB 0
(BB0 1
boolBB1 5
valueBB6 ;
,BB; <
ThingBB= B
reservedThingBBC P
=BBQ R
nullBBS W
)BBW X
{CC 	
isFromReservedDD 
=DD 
falseDD "
;DD" #
thisEE 
.EE %
reservedThingPositionOnlyEE *
=EE+ ,
valueEE- 2
;EE2 3
thisFF 
.FF 
reservedThingFF 
=FF  
reservedThingFF! .
;FF. /
}GG 	
publicII 
overrideII 
voidII 
PostExposeDataII +
(II+ ,
)II, -
{JJ 	
baseKK 
.KK 
PostExposeDataKK 
(KK  
)KK  !
;KK! "
Scribe_ValuesLL 
.LL 
LookLL 
(LL 
refLL "
	isVirtualLL# ,
,LL, -
$strLL. 9
,LL9 :
falseLL; @
)LL@ A
;LLA B
Scribe_ReferencesMM 
.MM 
LookMM "
(MM" #
refMM# &

sourceCoreMM' 1
,MM1 2
$strMM3 ?
,MM? @
falseMMA F
)MMF G
;MMG H
Scribe_ValuesNN 
.NN 
LookNN 
(NN 
refNN "
isFromReservedNN# 1
,NN1 2
$strNN3 C
,NNC D
falseNNE J
)NNJ K
;NNK L
Scribe_ValuesOO 
.OO 
LookOO 
(OO 
refOO "%
reservedThingPositionOnlyOO# <
,OO< =
$strOO> Y
,OOY Z
falseOO[ `
)OO` a
;OOa b
Scribe_ReferencesPP 
.PP 
LookPP "
(PP" #
refPP# &
reservedThingPP' 4
,PP4 5
$strPP6 E
,PPE F
falsePPG L
)PPL M
;PPM N
}RR 	
}SS 
}TT ˚$
`B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\Hediff_TerminalImplant.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
public 

class "
Hediff_TerminalImplant '
:( )
Hediff* 0
{ 
public 
static 
bool 
HasTerminalImplant -
(- .
Pawn. 2
pawn3 7
)7 8
{		 	
bool

 
flag

 
=

 
pawn

 
==

 
null

  $
||

% '
pawn

( ,
.

, -
health

- 3
==

4 6
null

7 ;
;

; <
return 
! 
flag 
&& 
pawn  
.  !
health! '
.' (
	hediffSet( 1
.1 2
	HasHediff2 ;
(; <
DefDatabase< G
<G H
	HediffDefH Q
>Q R
.R S
GetNamedS [
([ \
$str\ |
,| }
true	~ Ç
)
Ç É
,
É Ñ
false
Ö ä
)
ä ã
;
ã å
} 	
public 
static 
void 
AddTerminalImplant -
(- .
Pawn. 2
pawn3 7
)7 8
{ 	
bool 
flag 
= 
pawn 
== 
null  $
||% '
pawn( ,
., -
health- 3
==4 6
null7 ;
;; <
if 
( 
! 
flag 
) 
{ 
bool 
flag2 
= "
Hediff_TerminalImplant 3
.3 4
HasTerminalImplant4 F
(F G
pawnG K
)K L
;L M
if 
( 
! 
flag2 
) 
{ 
	HediffDef 
	hediffDef '
=( )
DefDatabase* 5
<5 6
	HediffDef6 ?
>? @
.@ A
GetNamedA I
(I J
$strJ j
,j k
truel p
)p q
;q r
Hediff 
hediff !
=" #
HediffMaker$ /
./ 0

MakeHediff0 :
(: ;
	hediffDef; D
,D E
pawnF J
,J K
nullL P
)P Q
;Q R
pawn 
. 
health 
.  
	AddHediff  )
() *
hediff* 0
,0 1
null2 6
,6 7
null8 <
,< =
null> B
)B C
;C D
} 
} 
} 	
public 
static 
void !
RemoveTerminalImplant 0
(0 1
Pawn1 5
pawn6 :
): ;
{ 	
bool 
flag 
= 
pawn 
== 
null  $
||% '
pawn( ,
., -
health- 3
==4 6
null7 ;
;; <
if   
(   
!   
flag   
)   
{!! 
Hediff"" 
hediff"" 
="" 
pawn""  $
.""$ %
health""% +
.""+ ,
	hediffSet"", 5
.""5 6
GetFirstHediffOfDef""6 I
(""I J
DefDatabase""J U
<""U V
	HediffDef""V _
>""_ `
.""` a
GetNamed""a i
(""i j
$str	""j ä
,
""ä ã
true
""å ê
)
""ê ë
,
""ë í
false
""ì ò
)
""ò ô
;
""ô ö
bool## 
flag2## 
=## 
hediff## #
!=##$ &
null##' +
;##+ ,
if$$ 
($$ 
flag2$$ 
)$$ 
{%% 
pawn&& 
.&& 
health&& 
.&&  
RemoveHediff&&  ,
(&&, -
hediff&&- 3
)&&3 4
;&&4 5
}'' 
}(( 
})) 	
public++ 
override++ 
void++ 
Notify_PawnKilled++ .
(++. /
)++/ 0
{,, 	
base-- 
.-- 
Notify_PawnKilled-- "
(--" #
)--# $
;--$ %
}.. 	
public00 
override00 
void00 

ExposeData00 '
(00' (
)00( )
{11 	
base22 
.22 

ExposeData22 
(22 
)22 
;22 
}33 	
}44 
}55 ≥)
^B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\Dialog_RenameNetwork.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
public 

class  
Dialog_RenameNetwork %
:& '
Window( .
{ 
public		  
Dialog_RenameNetwork		 #
(		# $ 
Building_StorageCore		$ 8
core		9 =
)		= >
:

 
base

 
(

 
null

 
)

 
{ 	
this 
. 
core 
= 
core 
; 
this 
. 
curName 
= 
core 
.  
NetworkName  +
;+ ,
this 
. 

forcePause 
= 
true "
;" #
this 
. 
doCloseX 
= 
true  
;  !
this 
. #
absorbInputAroundWindow (
=) *
true+ /
;/ 0
this 
. !
closeOnClickedOutside &
=' (
true) -
;- .
} 	
public 
override 
Vector2 
InitialSize  +
{ 	
get 
{ 
return 
new 
Vector2 "
(" #
$num# '
,' (
$num) -
)- .
;. /
} 
} 	
public 
override 
void 
DoWindowContents -
(- .
Rect. 2
inRect3 9
)9 :
{ 	
Text 
. 
Font 
= 
GameFont  
.  !
Small! &
;& '
Widgets 
. 
Label 
( 
new 
Rect "
(" #
$num# %
,% &
$num' )
,) *
inRect+ 1
.1 2
width2 7
,7 8
$num9 <
)< =
,= >
$str? H
)H I
;I J
this   
.   
curName   
=   
Widgets   "
.  " #
	TextField  # ,
(  , -
new  - 0
Rect  1 5
(  5 6
$num  6 8
,  8 9
$num  : =
,  = >
inRect  ? E
.  E F
width  F K
,  K L
$num  M P
)  P Q
,  Q R
this  S W
.  W X
curName  X _
)  _ `
;  ` a
bool!! 
flag!! 
=!! 
Widgets!! 
.!!  

ButtonText!!  *
(!!* +
new!!+ .
Rect!!/ 3
(!!3 4
$num!!4 6
,!!6 7
inRect!!8 >
.!!> ?
height!!? E
-!!F G
$num!!H K
,!!K L
inRect!!M S
.!!S T
width!!T Y
/!!Z [
$num!!\ ^
-!!_ `
$num!!a c
,!!c d
$num!!e h
)!!h i
,!!i j
$str!!k o
,!!o p
true!!q u
,!!u v
true!!w {
,!!{ |
true	!!} Å
,
!!Å Ç
null
!!É á
)
!!á à
;
!!à â
if"" 
("" 
flag"" 
)"" 
{## 
bool$$ 
flag2$$ 
=$$ 
!$$ 
string$$ $
.$$$ %
IsNullOrEmpty$$% 2
($$2 3
this$$3 7
.$$7 8
curName$$8 ?
)$$? @
;$$@ A
if%% 
(%% 
flag2%% 
)%% 
{&& 
this'' 
.'' 
core'' 
.'' 
NetworkName'' )
=''* +
this'', 0
.''0 1
curName''1 8
;''8 9
}(( 
this)) 
.)) 
Close)) 
()) 
true)) 
)))  
;))  !
}** 
bool++ 
flag3++ 
=++ 
Widgets++  
.++  !

ButtonText++! +
(+++ ,
new++, /
Rect++0 4
(++4 5
inRect++5 ;
.++; <
width++< A
/++B C
$num++D F
+++G H
$num++I K
,++K L
inRect++M S
.++S T
height++T Z
-++[ \
$num++] `
,++` a
inRect++b h
.++h i
width++i n
/++o p
$num++q s
-++t u
$num++v x
,++x y
$num++z }
)++} ~
,++~ 
$str
++Ä Ñ
,
++Ñ Ö
true
++Ü ä
,
++ä ã
true
++å ê
,
++ê ë
true
++í ñ
,
++ñ ó
null
++ò ú
)
++ú ù
;
++ù û
if,, 
(,, 
flag3,, 
),, 
{-- 
this.. 
... 
Close.. 
(.. 
true.. 
)..  
;..  !
}// 
}00 	
private22  
Building_StorageCore22 $
core22% )
;22) *
private44 
string44 
curName44 
;44 
}55 
}66 åG
dB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\DigitalStorageMapComponent.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
public 

class &
DigitalStorageMapComponent +
:, -
MapComponent. :
{		 
private

 
List

 
<

  
Building_StorageCore

 )
>

) *
cores

+ 0
=

1 2
new

3 6
List

7 ;
<

; < 
Building_StorageCore

< P
>

P Q
(

Q R
)

R S
;

S T
private 
HashSet 
< 
IntVec3 
>  
cabinetPositions! 1
=2 3
new4 7
HashSet8 ?
<? @
IntVec3@ G
>G H
(H I
)I J
;J K
public &
DigitalStorageMapComponent )
() *
Map* -
map. 1
)1 2
: 
base 
( 
map 
) 
{ 	
} 	
public 
void 
RegisterCore  
(  ! 
Building_StorageCore! 5
core6 :
): ;
{ 	
if 
( 
core 
!= 
null 
&& 
!  !
this! %
.% &
cores& +
.+ ,
Contains, 4
(4 5
core5 9
)9 :
): ;
{ 
this 
. 
cores 
. 
Add 
( 
core #
)# $
;$ %
} 
} 	
public 
void 
DeregisterCore "
(" # 
Building_StorageCore# 7
core8 <
)< =
{ 	
if 
( 
core 
!= 
null 
) 
{ 
this 
. 
cores 
. 
Remove !
(! "
core" &
)& '
;' (
} 
}   	
public"" 
List"" 
<""  
Building_StorageCore"" (
>""( )
GetAllCores""* 5
(""5 6
)""6 7
{## 	
return$$ 
this$$ 
.$$ 
cores$$ 
;$$ 
}%% 	
public'' 
void'' 
RegisterCabinet'' #
(''# $ 
Building_DiskCabinet''$ 8
cabinet''9 @
)''@ A
{(( 	
if)) 
()) 
cabinet)) 
!=)) 
null)) 
)))  
{** 
this++ 
.++ 
cabinetPositions++ %
.++% &
Add++& )
(++) *
cabinet++* 1
.++1 2
Position++2 :
)++: ;
;++; <
},, 
}-- 	
public// 
void// 
DeregisterCabinet// %
(//% & 
Building_DiskCabinet//& :
cabinet//; B
)//B C
{00 	
if11 
(11 
cabinet11 
!=11 
null11 
)11  
{22 
this33 
.33 
cabinetPositions33 %
.33% &
Remove33& ,
(33, -
cabinet33- 4
.334 5
Position335 =
)33= >
;33> ?
}44 
}55 	
public77 
bool77 
IsCabinetPosition77 %
(77% &
IntVec377& -
pos77. 1
)771 2
{88 	
return99 
this99 
.99 
cabinetPositions99 (
.99( )
Contains99) 1
(991 2
pos992 5
)995 6
;996 7
}:: 	
public??  
Building_StorageCore?? #
FindCoreWithItem??$ 4
(??4 5
Thing??5 :
thing??; @
)??@ A
{@@ 	
ifAA 
(AA 
thingAA 
==AA 
nullAA 
||AA  
!AA! "
thingAA" '
.AA' (
SpawnedAA( /
)AA/ 0
{BB 
returnCC 
nullCC 
;CC 
}DD 
forFF 
(FF 
intFF 
iFF 
=FF 
$numFF 
;FF 
iFF 
<FF 
thisFF  $
.FF$ %
coresFF% *
.FF* +
CountFF+ 0
;FF0 1
iFF2 3
++FF3 5
)FF5 6
{GG  
Building_StorageCoreHH $
coreHH% )
=HH* +
thisHH, 0
.HH0 1
coresHH1 6
[HH6 7
iHH7 8
]HH8 9
;HH9 :
ifII 
(II 
coreII 
==II 
nullII  
||II! #
!II$ %
coreII% )
.II) *
SpawnedII* 1
||II2 4
!II5 6
coreII6 :
.II: ;
PoweredII; B
)IIB C
{JJ 
continueKK 
;KK 
}LL 
	SlotGroupNN 
	slotGroupNN #
=NN$ %
coreNN& *
.NN* +
GetSlotGroupNN+ 7
(NN7 8
)NN8 9
;NN9 :
ifOO 
(OO 
	slotGroupOO 
!=OO  
nullOO! %
)OO% &
{PP 
foreachRR 
(RR 
ThingRR "
tRR# $
inRR% '
	slotGroupRR( 1
.RR1 2

HeldThingsRR2 <
)RR< =
{SS 
ifTT 
(TT 
tTT 
==TT  
thingTT! &
)TT& '
{UU 
returnVV "
coreVV# '
;VV' (
}WW 
}XX 
}YY 
if\\ 
(\\ 
	slotGroup\\ 
!=\\  
null\\! %
&&\\& (
	slotGroup\\) 2
.\\2 3
	CellsList\\3 <
!=\\= ?
null\\@ D
)\\D E
{]] 
foreach^^ 
(^^ 
IntVec3^^ $
cell^^% )
in^^* ,
	slotGroup^^- 6
.^^6 7
	CellsList^^7 @
)^^@ A
{__ 
if`` 
(`` 
cell``  
==``! #
thing``$ )
.``) *
Position``* 2
)``2 3
{aa 
Listbb  
<bb  !
Thingbb! &
>bb& '
thingsAtCellbb( 4
=bb5 6
thingbb7 <
.bb< =
Mapbb= @
.bb@ A
	thingGridbbA J
.bbJ K
ThingsListAtbbK W
(bbW X
cellbbX \
)bb\ ]
;bb] ^
forcc 
(cc  !
intcc! $
jcc% &
=cc' (
$numcc) *
;cc* +
jcc, -
<cc. /
thingsAtCellcc0 <
.cc< =
Countcc= B
;ccB C
jccD E
++ccE G
)ccG H
{dd 
Thingee  %
t2ee& (
=ee) *
thingsAtCellee+ 7
[ee7 8
jee8 9
]ee9 :
;ee: ;
ifff  "
(ff# $
t2ff$ &
==ff' )
thingff* /
||ff0 2
(ff3 4
t2ff4 6
.ff6 7
defff7 :
==ff; =
thingff> C
.ffC D
defffD G
&&ffH J
t2ffK M
.ffM N
StuffffN S
==ffT V
thingffW \
.ff\ ]
Stuffff] b
)ffb c
)ffc d
{gg  !
returnhh$ *
corehh+ /
;hh/ 0
}ii  !
}jj 
}kk 
}ll 
}mm 
ifpp 
(pp 
corepp 
.pp 
HasItempp  
(pp  !
thingpp! &
.pp& '
defpp' *
,pp* +
thingpp, 1
.pp1 2
Stuffpp2 7
)pp7 8
)pp8 9
{qq 
returnrr 
corerr 
;rr  
}ss 
}tt 
returnvv 
nullvv 
;vv 
}ww 	
publicyy 
boolyy 
IsCorePositionyy "
(yy" #
IntVec3yy# *
posyy+ .
)yy. /
{zz 	
for{{ 
({{ 
int{{ 
i{{ 
={{ 
$num{{ 
;{{ 
i{{ 
<{{ 
this{{  $
.{{$ %
cores{{% *
.{{* +
Count{{+ 0
;{{0 1
i{{2 3
++{{3 5
){{5 6
{||  
Building_StorageCore}} $ 
building_StorageCore}}% 9
=}}: ;
this}}< @
.}}@ A
cores}}A F
[}}F G
i}}G H
]}}H I
;}}I J
if~~ 
(~~  
building_StorageCore~~ (
!=~~) +
null~~, 0
&&~~1 3 
building_StorageCore~~4 H
.~~H I
Position~~I Q
==~~R T
pos~~U X
)~~X Y
{ 
return
ÄÄ 
true
ÄÄ 
;
ÄÄ  
}
ÅÅ 
}
ÇÇ 
return
ÉÉ 
false
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
}
ÖÖ 
}ÜÜ ©w
aB:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\Building_InputInterface.cs
	namespace		 	
DigitalStorage		
 
.		 

Components		 #
{

 
public 

class #
Building_InputInterface (
:) *
Building_Storage+ ;
{ 
private  
Building_StorageCore $
	boundCore% .
;. /
private 
CompPowerTrader 
	powerComp  )
;) *
public  
Building_StorageCore #
	BoundCore$ -
=>. 0
	boundCore1 :
;: ;
public 
bool 
Powered 
=> 
	powerComp (
!=) +
null, 0
&&1 3
	powerComp4 =
.= >
PowerOn> E
;E F
public 
bool 
IsActive 
=> 
Powered  '
&&( *
	boundCore+ 4
!=5 7
null8 <
&&= ?
	boundCore@ I
.I J
PoweredJ Q
;Q R
public 
override 
void 

SpawnSetup '
(' (
Map( +
map, /
,/ 0
bool1 5
respawningAfterLoad6 I
)I J
{ 	
base 
. 

SpawnSetup 
( 
map 
,  
respawningAfterLoad! 4
)4 5
;5 6
	powerComp 
= 
GetComp 
<  
CompPowerTrader  /
>/ 0
(0 1
)1 2
;2 3
if 
( 
! 
respawningAfterLoad $
&&% '
	boundCore( 1
==2 4
null5 9
&&: <
Map= @
!=A C
nullD H
)H I
{   
TryAutoConnect!! 
(!! 
)!!  
;!!  !
}""  
RefreshStoreSettings##  
(##  !
)##! "
;##" #
}$$ 	
public&& 
override&& 
void&& 
DeSpawn&& $
(&&$ %
DestroyMode&&% 0
mode&&1 5
=&&6 7
DestroyMode&&8 C
.&&C D
Vanish&&D J
)&&J K
{'' 	
SetBoundCore(( 
((( 
null(( 
)(( 
;(( 
base)) 
.)) 
DeSpawn)) 
()) 
mode)) 
))) 
;)) 
}** 	
public,, 
override,, 
void,, 

ExposeData,, '
(,,' (
),,( )
{-- 	
base.. 
... 

ExposeData.. 
(.. 
).. 
;.. 
Scribe_References// 
.// 
Look// "
(//" #
ref//# &
	boundCore//' 0
,//0 1
$str//2 =
)//= >
;//> ?
}00 	
public22 
override22 
string22 
GetInspectString22 /
(22/ 0
)220 1
{33 	
StringBuilder44 
sb44 
=44 
new44 "
StringBuilder44# 0
(440 1
)441 2
;442 3
string55 
baseStr55 
=55 
base55 !
.55! "
GetInspectString55" 2
(552 3
)553 4
;554 5
if66 
(66 
!66 
string66 
.66 
IsNullOrEmpty66 %
(66% &
baseStr66& -
)66- .
)66. /
{77 
sb88 
.88 

AppendLine88 
(88 
baseStr88 %
)88% &
;88& '
}99 
if;; 
(;; 
	boundCore;; 
!=;; 
null;; !
);;! "
{<< 
sb== 
.== 

AppendLine== 
(== 
$str== %
+==& '
	boundCore==( 1
.==1 2
NetworkName==2 =
)=== >
;==> ?
sb>> 
.>> 

AppendLine>> 
(>> 
$">>  
$str>>  $
{>>$ %
	boundCore>>% .
.>>. /
GetUsedCapacity>>/ >
(>>> ?
)>>? @
}>>@ A
$str>>A B
{>>B C
	boundCore>>C L
.>>L M
GetCapacity>>M X
(>>X Y
)>>Y Z
}>>Z [
">>[ \
)>>\ ]
;>>] ^
}?? 
else@@ 
{AA 
sbBB 
.BB 

AppendLineBB 
(BB 
$strBB #
)BB# $
;BB$ %
}CC 
ifEE 
(EE 
!EE 
PoweredEE 
)EE 
{FF 
sbGG 
.GG 

AppendLineGG 
(GG 
$strGG #
)GG# $
;GG$ %
}HH 
returnII 
sbII 
.II 
ToStringII 
(II 
)II  
.II  !
TrimEndII! (
(II( )
)II) *
;II* +
}JJ 	
publicLL 
overrideLL 
IEnumerableLL #
<LL# $
GizmoLL$ )
>LL) *
	GetGizmosLL+ 4
(LL4 5
)LL5 6
{MM 	
foreachNN 
(NN 
GizmoNN 
gizmoNN  
inNN! #
baseNN$ (
.NN( )
	GetGizmosNN) 2
(NN2 3
)NN3 4
)NN4 5
{OO 
yieldPP 
returnPP 
gizmoPP "
;PP" #
}QQ 
yieldSS 
returnSS 
newSS 
Command_ActionSS +
{TT 
defaultLabelUU 
=UU 
$strUU &
,UU& '
defaultDescVV 
=VV 
$strVV *
,VV* +
iconWW 
=WW 
ContentFinderWW $
<WW$ %
	Texture2DWW% .
>WW. /
.WW/ 0
GetWW0 3
(WW3 4
$strWW4 N
,WWN O
trueWWP T
)WWT U
,WWU V
actionXX 
=XX 
delegateXX !
{YY 
ListZZ 
<ZZ 
FloatMenuOptionZZ (
>ZZ( )
optionsZZ* 1
=ZZ2 3
newZZ4 7
ListZZ8 <
<ZZ< =
FloatMenuOptionZZ= L
>ZZL M
(ZZM N
)ZZN O
;ZZO P'
DigitalStorageGameComponent[[ /
gameComp[[0 8
=[[9 :
Current[[; B
.[[B C
Game[[C G
?[[G H
.[[H I
GetComponent[[I U
<[[U V'
DigitalStorageGameComponent[[V q
>[[q r
([[r s
)[[s t
;[[t u
if]] 
(]] 
gameComp]]  
!=]]! #
null]]$ (
)]]( )
{^^ 
foreach__ 
(__  ! 
Building_StorageCore__! 5
core__6 :
in__; =
gameComp__> F
.__F G
GetAllCores__G R
(__R S
)__S T
)__T U
{`` 
ifaa 
(aa  
coreaa  $
!=aa% '
nullaa( ,
&&aa- /
coreaa0 4
.aa4 5
Spawnedaa5 <
&&aa= ?
coreaa@ D
.aaD E
MapaaE H
==aaI K
MapaaL O
)aaO P
{bb 
optionscc  '
.cc' (
Addcc( +
(cc+ ,
newcc, /
FloatMenuOptioncc0 ?
(cc? @
corecc@ D
.ccD E
NetworkNameccE P
,ccP Q
(ccR S
)ccS T
=>ccU W
SetBoundCoreccX d
(ccd e
corecce i
)cci j
)ccj k
)cck l
;ccl m
}dd 
}ee 
}ff 
ifhh 
(hh 
optionshh 
.hh  
Counthh  %
==hh& (
$numhh) *
)hh* +
{ii 
optionsjj 
.jj  
Addjj  #
(jj# $
newjj$ '
FloatMenuOptionjj( 7
(jj7 8
$strjj8 ?
,jj? @
nulljjA E
)jjE F
)jjF G
;jjG H
}kk 
Findll 
.ll 
WindowStackll $
.ll$ %
Addll% (
(ll( )
newll) ,
	FloatMenull- 6
(ll6 7
optionsll7 >
)ll> ?
)ll? @
;ll@ A
}mm 
}nn 
;nn 
}oo 	
publicqq 
voidqq 
SetBoundCoreqq  
(qq  ! 
Building_StorageCoreqq! 5
coreqq6 :
)qq: ;
{rr 	
	boundCoress 
=ss 
coress 
;ss  
RefreshStoreSettingstt  
(tt  !
)tt! "
;tt" #
}uu 	
privateww 
voidww 
TryAutoConnectww #
(ww# $
)ww$ %
{xx 	
ifyy 
(yy 
Mapyy 
==yy 
nullyy 
)yy 
returnyy #
;yy# $
foreach{{ 
({{ 
IntVec3{{ 
cell{{ !
in{{" $
GenAdj{{% +
.{{+ ,
CellsAdjacent8Way{{, =
({{= >
this{{> B
){{B C
){{C D
{|| 
if}} 
(}} 
!}} 
cell}} 
.}} 
InBounds}} "
(}}" #
Map}}# &
)}}& '
)}}' (
continue~~ 
;~~ "
Building_StorageCore
ÄÄ $
core
ÄÄ% )
=
ÄÄ* +
cell
ÄÄ, 0
.
ÄÄ0 1
GetFirstBuilding
ÄÄ1 A
(
ÄÄA B
Map
ÄÄB E
)
ÄÄE F
as
ÄÄG I"
Building_StorageCore
ÄÄJ ^
;
ÄÄ^ _
if
ÅÅ 
(
ÅÅ 
core
ÅÅ 
!=
ÅÅ 
null
ÅÅ  
)
ÅÅ  !
{
ÇÇ 
SetBoundCore
ÉÉ  
(
ÉÉ  !
core
ÉÉ! %
)
ÉÉ% &
;
ÉÉ& '
break
ÑÑ 
;
ÑÑ 
}
ÖÖ 
}
ÜÜ 
}
áá 	
private
ââ 
void
ââ "
RefreshStoreSettings
ââ )
(
ââ) *
)
ââ* +
{
ää 	
if
ãã 
(
ãã 
	boundCore
ãã 
!=
ãã 
null
ãã !
)
ãã! "
{
åå 
settings
çç 
=
çç 
	boundCore
çç $
.
çç$ %
GetStoreSettings
çç% 5
(
çç5 6
)
çç6 7
;
çç7 8
}
éé 
}
èè 	
public
îî 
override
îî 
void
îî "
Notify_ReceivedThing
îî 1
(
îî1 2
Thing
îî2 7
newItem
îî8 ?
)
îî? @
{
ïï 	
base
ññ 
.
ññ "
Notify_ReceivedThing
ññ %
(
ññ% &
newItem
ññ& -
)
ññ- .
;
ññ. /
if
òò 
(
òò 
!
òò 
IsActive
òò 
||
òò 
	boundCore
òò &
==
òò' )
null
òò* .
||
òò/ 1
	boundCore
òò2 ;
.
òò; <
Map
òò< ?
==
òò@ B
null
òòC G
)
òòG H
{
ôô 
return
öö 
;
öö 
}
õõ 
if
ùù 
(
ùù 
!
ùù 
	boundCore
ùù 
.
ùù 
CanReceiveThing
ùù *
(
ùù* +
newItem
ùù+ 2
)
ùù2 3
)
ùù3 4
{
ûû 
return
üü 
;
üü 
}
†† 
if
££ 
(
££ 
newItem
££ 
.
££ 
Spawned
££ 
)
££  
{
§§ 
newItem
•• 
.
•• 
DeSpawn
•• 
(
••  
DestroyMode
••  +
.
••+ ,
Vanish
••, 2
)
••2 3
;
••3 4
}
¶¶ 
GenPlace
®® 
.
®® 
TryPlaceThing
®® "
(
®®" #
newItem
®®# *
,
®®* +
	boundCore
®®, 5
.
®®5 6
Position
®®6 >
,
®®> ?
	boundCore
®®@ I
.
®®I J
Map
®®J M
,
®®M N
ThingPlaceMode
®®O ]
.
®®] ^
Near
®®^ b
)
®®b c
;
®®c d

FleckMaker
©© 
.
©©  
ThrowLightningGlow
©© )
(
©©) *
	boundCore
©©* 3
.
©©3 4
DrawPos
©©4 ;
,
©©; <
	boundCore
©©= F
.
©©F G
Map
©©G J
,
©©J K
$num
©©L P
)
©©P Q
;
©©Q R
if
´´ 
(
´´ $
DigitalStorageSettings
´´ &
.
´´& '
enableDebugLog
´´' 5
)
´´5 6
{
¨¨ 
Log
≠≠ 
.
≠≠ 
Message
≠≠ 
(
≠≠ 
$"
≠≠ 
$str
≠≠ -
{
≠≠- .
newItem
≠≠. 5
.
≠≠5 6
Label
≠≠6 ;
}
≠≠; <
$str
≠≠< >
{
≠≠> ?
newItem
≠≠? F
.
≠≠F G

stackCount
≠≠G Q
}
≠≠Q R
$str
≠≠R U
{
≠≠U V
	boundCore
≠≠V _
.
≠≠_ `
NetworkName
≠≠` k
}
≠≠k l
"
≠≠l m
)
≠≠m n
;
≠≠n o
}
ÆÆ 
}
ØØ 	
public
±± 
new
±± 
bool
±± 
Accepts
±± 
(
±±  
Thing
±±  %
t
±±& '
)
±±' (
{
≤≤ 	
if
≥≥ 
(
≥≥ 
!
≥≥ 
IsActive
≥≥ 
||
≥≥ 
	boundCore
≥≥ &
==
≥≥' )
null
≥≥* .
)
≥≥. /
{
¥¥ 
return
µµ 
false
µµ 
;
µµ 
}
∂∂ 
if
∏∏ 
(
∏∏ 
!
∏∏ 
	boundCore
∏∏ 
.
∏∏ 
CanReceiveThing
∏∏ *
(
∏∏* +
t
∏∏+ ,
)
∏∏, -
)
∏∏- .
{
ππ 
return
∫∫ 
false
∫∫ 
;
∫∫ 
}
ªª 
return
ΩΩ 
base
ΩΩ 
.
ΩΩ 
Accepts
ΩΩ 
(
ΩΩ  
t
ΩΩ  !
)
ΩΩ! "
;
ΩΩ" #
}
ææ 	
public
¿¿ 
new
¿¿ 
StorageSettings
¿¿ "
GetStoreSettings
¿¿# 3
(
¿¿3 4
)
¿¿4 5
{
¡¡ 	
return
¬¬ 
	boundCore
¬¬ 
?
¬¬ 
.
¬¬ 
GetStoreSettings
¬¬ .
(
¬¬. /
)
¬¬/ 0
??
¬¬1 3
settings
¬¬4 <
;
¬¬< =
}
√√ 	
public
≈≈ 
new
≈≈ 
StorageSettings
≈≈ "$
GetParentStoreSettings
≈≈# 9
(
≈≈9 :
)
≈≈: ;
{
∆∆ 	
if
«« 
(
«« 
	boundCore
«« 
!=
«« 
null
«« !
)
««! "
{
»» 
return
…… 
	boundCore
……  
.
……  !$
GetParentStoreSettings
……! 7
(
……7 8
)
……8 9
;
……9 :
}
   
return
ÀÀ 
def
ÀÀ 
.
ÀÀ 
building
ÀÀ 
?
ÀÀ  
.
ÀÀ  !"
fixedStorageSettings
ÀÀ! 5
??
ÀÀ6 8
StorageSettings
ÀÀ9 H
.
ÀÀH I'
EverStorableFixedSettings
ÀÀI b
(
ÀÀb c
)
ÀÀc d
;
ÀÀd e
}
ÃÃ 	
}
ÕÕ 
}ŒŒ ∫ß
^B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\Building_DiskCabinet.cs
	namespace

 	
DigitalStorage


 
.

 

Components

 #
{ 
[ &
StaticConstructorOnStartup 
]  
public 

class  
Building_DiskCabinet %
:& '
Building_Storage( 8
{ 
private 
static 
readonly 
	Texture2D  )
LinkTex* 1
=2 3
ContentFinder4 A
<A B
	Texture2DB K
>K L
.L M
GetM P
(P Q
$strQ k
,k l
truem q
)q r
;r s
public 
const 
int 
MaxDiskCount %
=& '
$num( )
;) *
private 
static 
readonly 

Dictionary  *
<* +
string+ 1
,1 2
int3 6
>6 7
DiskCapacities8 F
=G H
newI L

DictionaryM W
<W X
stringX ^
,^ _
int` c
>c d
{ 	
{ 
$str (
,( )
$num* ,
}- .
,. /
{ 
$str )
,) *
$num+ .
}/ 0
,0 1
{ 
$str (
,( )
$num* -
}. /
} 	
;	 

private  
Building_StorageCore $
	boundCore% .
;. /
public 
override 
void 

SpawnSetup '
(' (
Map( +
map, /
,/ 0
bool1 5
respawningAfterLoad6 I
)I J
{ 	
base 
. 

SpawnSetup 
( 
map 
,  
respawningAfterLoad! 4
)4 5
;5 6&
DigitalStorageMapComponent &
	component' 0
=1 2
map3 6
.6 7
GetComponent7 C
<C D&
DigitalStorageMapComponentD ^
>^ _
(_ `
)` a
;a b
if 
( 
	component 
!= 
null !
)! "
{ 
	component   
.   
RegisterCabinet   )
(  ) *
this  * .
)  . /
;  / 0
}!! 
if"" 
("" 
this"" 
."" 
	boundCore"" 
=="" !
null""" &
&&""' )
!""* +
respawningAfterLoad""+ >
)""> ?
{## 
this$$ 
.$$ 
TryAutoConnect$$ #
($$# $
)$$$ %
;$$% &
}%% 
}&& 	
public(( 
override(( 
void(( 
DeSpawn(( $
((($ %
DestroyMode((% 0
mode((1 5
=((6 7
DestroyMode((8 C
.((C D
Vanish((D J
)((J K
{)) 	
Map** 
map** 
=** 
base** 
.** 
Map** 
;** 
if++ 
(++ 
map++ 
!=++ 
null++ 
)++ 
{,, &
DigitalStorageMapComponent-- *
	component--+ 4
=--5 6
map--7 :
.--: ;
GetComponent--; G
<--G H&
DigitalStorageMapComponent--H b
>--b c
(--c d
)--d e
;--e f
if.. 
(.. 
	component.. 
!=..  
null..! %
)..% &
{// 
	component00 
.00 
DeregisterCabinet00 /
(00/ 0
this000 4
)004 5
;005 6
}11 
}22 
this33 
.33 
SetBoundCore33 
(33 
null33 "
)33" #
;33# $
this44 
.44 
DropAllDisks44 
(44 
)44 
;44  
base55 
.55 
DeSpawn55 
(55 
mode55 
)55 
;55 
}66 	
public88 
override88 
void88 
PostMake88 %
(88% &
)88& '
{99 	
base:: 
.:: 
PostMake:: 
(:: 
):: 
;:: 
this;; 
.;; 
	boundCore;; 
=;; 
null;; !
;;;! "
}<< 	
public>> 
override>> 
void>> 

ExposeData>> '
(>>' (
)>>( )
{?? 	
base@@ 
.@@ 

ExposeData@@ 
(@@ 
)@@ 
;@@ 
Scribe_ReferencesAA 
.AA 
LookAA "
<AA" # 
Building_StorageCoreAA# 7
>AA7 8
(AA8 9
refAA9 <
thisAA= A
.AAA B
	boundCoreAAB K
,AAK L
$strAAM X
,AAX Y
falseAAZ _
)AA_ `
;AA` a
}BB 	
publicDD 
overrideDD 
voidDD  
Notify_ReceivedThingDD 1
(DD1 2
ThingDD2 7
newItemDD8 ?
)DD? @
{EE 	
baseFF 
.FF  
Notify_ReceivedThingFF %
(FF% &
newItemFF& -
)FF- .
;FF. /
ifGG 
(GG 
thisGG 
.GG 
GetDiskCountGG !
(GG! "
)GG" #
>GG$ %
$numGG& '
)GG' (
{HH 
ListII 
<II 
ThingII 
>II 
disksII !
=II" #
thisII$ (
.II( )
GetDisksII) 1
(II1 2
)II2 3
.II3 4
ToListII4 :
(II: ;
)II; <
;II< =
whileJJ 
(JJ 
disksJJ 
.JJ 
CountJJ "
>JJ# $
$numJJ% &
)JJ& '
{KK 
ThingLL 
diskLL 
=LL  
disksLL! &
[LL& '
disksLL' ,
.LL, -
CountLL- 2
-LL3 4
$numLL5 6
]LL6 7
;LL7 8
disksMM 
.MM 
RemoveMM  
(MM  !
diskMM! %
)MM% &
;MM& '
diskNN 
.NN 
DeSpawnNN  
(NN  !
DestroyModeNN! ,
.NN, -
VanishNN- 3
)NN3 4
;NN4 5
GenPlaceOO 
.OO 
TryPlaceThingOO *
(OO* +
diskOO+ /
,OO/ 0
baseOO1 5
.OO5 6
PositionOO6 >
,OO> ?
baseOO@ D
.OOD E
MapOOE H
,OOH I
ThingPlaceModeOOJ X
.OOX Y
NearOOY ]
,OO] ^
nullOO_ c
,OOc d
nullOOe i
,OOi j
nullOOk o
,OOo p
$numOOq r
)OOr s
;OOs t
}PP 
}QQ 
}RR 	
publicTT 
overrideTT 
stringTT 
GetInspectStringTT /
(TT/ 0
)TT0 1
{UU 	
StringBuilderVV 
sbVV 
=VV 
newVV "
StringBuilderVV# 0
(VV0 1
)VV1 2
;VV2 3
stringWW 
baseStrWW 
=WW 
baseWW !
.WW! "
GetInspectStringWW" 2
(WW2 3
)WW3 4
;WW4 5
ifXX 
(XX 
!XX 
stringXX 
.XX 
IsNullOrEmptyXX %
(XX% &
baseStrXX& -
)XX- .
)XX. /
{YY 
sbZZ 
.ZZ 

AppendLineZZ 
(ZZ 
baseStrZZ %
)ZZ% &
;ZZ& '
}[[ 
sb\\ 
.\\ 

AppendLine\\ 
(\\ 
string\\  
.\\  !
Format\\! '
(\\' (
$str\\( 5
,\\5 6
this\\7 ;
.\\; <
GetDiskCount\\< H
(\\H I
)\\I J
,\\J K
$num\\L M
)\\M N
)\\N O
;\\O P
sb]] 
.]] 

AppendLine]] 
(]] 
string]]  
.]]  !
Format]]! '
(]]' (
$str]]( 4
,]]4 5
this]]6 :
.]]: ;
GetProvidedCapacity]]; N
(]]N O
)]]O P
)]]P Q
)]]Q R
;]]R S
if^^ 
(^^ 
this^^ 
.^^ 
	boundCore^^ 
!=^^ !
null^^" &
)^^& '
{__ 
sb`` 
.`` 

AppendLine`` 
(`` 
$str`` %
+``& '
this``( ,
.``, -
	boundCore``- 6
.``6 7
NetworkName``7 B
)``B C
;``C D
}aa 
elsebb 
{cc 
sbdd 
.dd 

AppendLinedd 
(dd 
$strdd #
)dd# $
;dd$ %
}ee 
returnff 
sbff 
.ff 
ToStringff 
(ff 
)ff  
.ff  !
TrimEndff! (
(ff( )
)ff) *
;ff* +
}gg 	
publicii 
overrideii 
IEnumerableii #
<ii# $
Gizmoii$ )
>ii) *
	GetGizmosii+ 4
(ii4 5
)ii5 6
{jj 	
foreachkk 
(kk 
Gizmokk 
gizmokk  
inkk! #
basekk$ (
.kk( )
	GetGizmoskk) 2
(kk2 3
)kk3 4
)kk4 5
{ll 
yieldmm 
returnmm 
gizmomm "
;mm" #
}nn 
yieldpp 
returnpp 
newpp 
Command_Actionpp +
{qq 
defaultLabelrr 
=rr 
$strrr &
,rr& '
defaultDescss 
=ss 
$strss 1
,ss1 2
icontt 
=tt 
LinkTextt 
,tt 
actionuu 
=uu 
delegateuu !
(uu! "
)uu" #
{vv 
Listww 
<ww 
FloatMenuOptionww (
>ww( )
optionsww* 1
=ww2 3
newww4 7
Listww8 <
<ww< =
FloatMenuOptionww= L
>wwL M
(wwM N
)wwN O
;wwO P
Gamezz 
gamezz 
=zz 
Currentzz  '
.zz' (
Gamezz( ,
;zz, -'
DigitalStorageGameComponent{{ /
gameComp{{0 8
={{9 :
({{; <
game{{< @
!={{A C
null{{D H
){{H I
?{{J K
game{{L P
.{{P Q
GetComponent{{Q ]
<{{] ^'
DigitalStorageGameComponent{{^ y
>{{y z
({{z {
){{{ |
:{{} ~
null	{{ É
;
{{É Ñ
if}} 
(}} 
gameComp}}  
!=}}! #
null}}$ (
)}}( )
{~~ 
foreach
ÄÄ 
(
ÄÄ  !"
Building_StorageCore
ÄÄ! 5
core
ÄÄ6 :
in
ÄÄ; =
gameComp
ÄÄ> F
.
ÄÄF G
GetAllCores
ÄÄG R
(
ÄÄR S
)
ÄÄS T
)
ÄÄT U
{
ÅÅ 
if
ÇÇ 
(
ÇÇ  
core
ÇÇ  $
!=
ÇÇ% '
null
ÇÇ( ,
&&
ÇÇ- /
core
ÇÇ0 4
.
ÇÇ4 5
Spawned
ÇÇ5 <
)
ÇÇ< =
{
ÉÉ 
string
ÑÑ  &
label
ÑÑ' ,
=
ÑÑ- .
core
ÑÑ/ 3
.
ÑÑ3 4
NetworkName
ÑÑ4 ?
;
ÑÑ? @
if
ÜÜ  "
(
ÜÜ# $
core
ÜÜ$ (
.
ÜÜ( )
Map
ÜÜ) ,
!=
ÜÜ- /
base
ÜÜ0 4
.
ÜÜ4 5
Map
ÜÜ5 8
)
ÜÜ8 9
{
áá  !
label
àà$ )
=
àà* +
string
àà, 2
.
àà2 3
Format
àà3 9
(
àà9 :
$str
àà: H
,
ààH I
core
ààJ N
.
ààN O
NetworkName
ààO Z
,
ààZ [
core
àà\ `
.
àà` a
Map
ààa d
?
ààd e
.
ààe f
Index
ààf k
??
ààl n
-
àào p
$num
ààp q
)
ààq r
;
ààr s
}
ââ  !
options
ãã  '
.
ãã' (
Add
ãã( +
(
ãã+ ,
new
ãã, /
FloatMenuOption
ãã0 ?
(
ãã? @
label
ãã@ E
,
ããE F
delegate
ããG O
(
ããO P
)
ããP Q
{
åå  !
this
çç$ (
.
çç( )
SetBoundCore
çç) 5
(
çç5 6
core
çç6 :
)
çç: ;
;
çç; <
}
éé  !
)
éé! "
)
éé" #
;
éé# $
}
èè 
}
êê 
}
ëë 
else
íí 
{
ìì 
foreach
ïï 
(
ïï  !"
Building_StorageCore
ïï! 5
core
ïï6 :
in
ïï; =
base
ïï> B
.
ïïB C
Map
ïïC F
.
ïïF G
listerBuildings
ïïG V
.
ïïV W)
AllBuildingsColonistOfClass
ïïW r
<
ïïr s#
Building_StorageCoreïïs á
>ïïá à
(ïïà â
)ïïâ ä
)ïïä ã
{
ññ 
options
óó #
.
óó# $
Add
óó$ '
(
óó' (
new
óó( +
FloatMenuOption
óó, ;
(
óó; <
core
óó< @
.
óó@ A
NetworkName
óóA L
,
óóL M
delegate
óóN V
(
óóV W
)
óóW X
{
òò 
this
ôô  $
.
ôô$ %
SetBoundCore
ôô% 1
(
ôô1 2
core
ôô2 6
)
ôô6 7
;
ôô7 8
}
öö 
)
öö 
)
öö 
;
öö  
}
õõ 
}
úú 
if
ûû 
(
ûû 
options
ûû 
.
ûû  
Count
ûû  %
==
ûû& (
$num
ûû) *
)
ûû* +
{
üü 
options
†† 
.
††  
Add
††  #
(
††# $
new
††$ '
FloatMenuOption
††( 7
(
††7 8
$str
††8 ?
,
††? @
null
††A E
)
††E F
)
††F G
;
††G H
}
°° 
Find
¢¢ 
.
¢¢ 
WindowStack
¢¢ $
.
¢¢$ %
Add
¢¢% (
(
¢¢( )
new
¢¢) ,
	FloatMenu
¢¢- 6
(
¢¢6 7
options
¢¢7 >
)
¢¢> ?
)
¢¢? @
;
¢¢@ A
}
££ 
}
§§ 
;
§§ 
yield
•• 
break
•• 
;
•• 
}
¶¶ 	
public
®® 
void
®® 
SetBoundCore
®®  
(
®®  !"
Building_StorageCore
®®! 5
core
®®6 :
)
®®: ;
{
©© 	
if
™™ 
(
™™ 
this
™™ 
.
™™ 
	boundCore
™™ 
!=
™™ !
null
™™" &
)
™™& '
{
´´ 
this
¨¨ 
.
¨¨ 
	boundCore
¨¨ 
.
¨¨ #
DeregisterDiskCabinet
¨¨ 4
(
¨¨4 5
this
¨¨5 9
)
¨¨9 :
;
¨¨: ;
}
≠≠ 
this
ÆÆ 
.
ÆÆ 
	boundCore
ÆÆ 
=
ÆÆ 
core
ÆÆ !
;
ÆÆ! "
if
ØØ 
(
ØØ 
this
ØØ 
.
ØØ 
	boundCore
ØØ 
!=
ØØ !
null
ØØ" &
)
ØØ& '
{
∞∞ 
this
±± 
.
±± 
	boundCore
±± 
.
±± !
RegisterDiskCabinet
±± 2
(
±±2 3
this
±±3 7
)
±±7 8
;
±±8 9
}
≤≤ 
}
≥≥ 	
public
µµ "
Building_StorageCore
µµ #
GetBoundCore
µµ$ 0
(
µµ0 1
)
µµ1 2
{
∂∂ 	
return
∑∑ 
this
∑∑ 
.
∑∑ 
	boundCore
∑∑ !
;
∑∑! "
}
∏∏ 	
public
∫∫ 
int
∫∫ 
GetDiskCount
∫∫ 
(
∫∫  
)
∫∫  !
{
ªª 	
return
ºº 
this
ºº 
.
ºº 
GetDisks
ºº  
(
ºº  !
)
ºº! "
.
ºº" #
Count
ºº# (
(
ºº( )
)
ºº) *
;
ºº* +
}
ΩΩ 	
public
øø 
IEnumerable
øø 
<
øø 
Thing
øø  
>
øø  !
GetDisks
øø" *
(
øø* +
)
øø+ ,
{
¿¿ 	
	SlotGroup
¡¡ 
	slotGroup
¡¡ 
=
¡¡  !
base
¡¡" &
.
¡¡& '
GetSlotGroup
¡¡' 3
(
¡¡3 4
)
¡¡4 5
;
¡¡5 6
return
¬¬ 
	slotGroup
¬¬ 
!=
¬¬ 
null
¬¬  $
?
¬¬% &
	slotGroup
¬¬' 0
.
¬¬0 1

HeldThings
¬¬1 ;
.
¬¬; <
Where
¬¬< A
(
¬¬A B
IsDisk
¬¬B H
)
¬¬H I
:
¬¬J K

Enumerable
¬¬L V
.
¬¬V W
Empty
¬¬W \
<
¬¬\ ]
Thing
¬¬] b
>
¬¬b c
(
¬¬c d
)
¬¬d e
;
¬¬e f
}
√√ 	
public
≈≈ 
int
≈≈ !
GetProvidedCapacity
≈≈ &
(
≈≈& '
)
≈≈' (
{
∆∆ 	
int
«« 
total
«« 
=
«« 
$num
«« 
;
«« 
foreach
»» 
(
»» 
Thing
»» 
disk
»» 
in
»»  "
this
»»# '
.
»»' (
GetDisks
»»( 0
(
»»0 1
)
»»1 2
)
»»2 3
{
…… 
int
   
capacity
   
;
   
if
ÀÀ 
(
ÀÀ 
DiskCapacities
ÀÀ "
.
ÀÀ" #
TryGetValue
ÀÀ# .
(
ÀÀ. /
disk
ÀÀ/ 3
.
ÀÀ3 4
def
ÀÀ4 7
.
ÀÀ7 8
defName
ÀÀ8 ?
,
ÀÀ? @
out
ÀÀA D
capacity
ÀÀE M
)
ÀÀM N
)
ÀÀN O
{
ÃÃ 
total
ÕÕ 
+=
ÕÕ 
capacity
ÕÕ %
;
ÕÕ% &
}
ŒŒ 
}
œœ 
return
–– 
total
–– 
;
–– 
}
—— 	
private
”” 
static
”” 
bool
”” 
IsDisk
”” "
(
””" #
Thing
””# (
thing
””) .
)
””. /
{
‘‘ 	
return
’’ 
thing
’’ 
!=
’’ 
null
’’  
&&
’’! #
DiskCapacities
’’$ 2
.
’’2 3
ContainsKey
’’3 >
(
’’> ?
thing
’’? D
.
’’D E
def
’’E H
.
’’H I
defName
’’I P
)
’’P Q
;
’’Q R
}
÷÷ 	
private
ÿÿ 
void
ÿÿ 
TryAutoConnect
ÿÿ #
(
ÿÿ# $
)
ÿÿ$ %
{
ŸŸ 	
foreach
⁄⁄ 
(
⁄⁄ 
IntVec3
⁄⁄ 
cell
⁄⁄ !
in
⁄⁄" $
GenAdj
⁄⁄% +
.
⁄⁄+ ,
CellsAdjacent8Way
⁄⁄, =
(
⁄⁄= >
this
⁄⁄> B
)
⁄⁄B C
)
⁄⁄C D
{
€€ 
if
‹‹ 
(
‹‹ 
!
‹‹ 
cell
‹‹ 
.
‹‹ 
InBounds
‹‹ "
(
‹‹" #
base
‹‹# '
.
‹‹' (
Map
‹‹( +
)
‹‹+ ,
)
‹‹, -
continue
›› 
;
›› 
Building
ﬂﬂ 
building
ﬂﬂ !
=
ﬂﬂ" #
cell
ﬂﬂ$ (
.
ﬂﬂ( )
GetFirstBuilding
ﬂﬂ) 9
(
ﬂﬂ9 :
base
ﬂﬂ: >
.
ﬂﬂ> ?
Map
ﬂﬂ? B
)
ﬂﬂB C
;
ﬂﬂC D"
Building_StorageCore
‡‡ $
core
‡‡% )
=
‡‡* +
building
‡‡, 4
as
‡‡5 7"
Building_StorageCore
‡‡8 L
;
‡‡L M
if
·· 
(
·· 
core
·· 
!=
·· 
null
··  
)
··  !
{
‚‚ 
this
„„ 
.
„„ 
SetBoundCore
„„ %
(
„„% &
core
„„& *
)
„„* +
;
„„+ ,
break
‰‰ 
;
‰‰ 
}
ÂÂ 
}
ÊÊ 
}
ÁÁ 	
private
ÈÈ 
void
ÈÈ 
DropAllDisks
ÈÈ !
(
ÈÈ! "
)
ÈÈ" #
{
ÍÍ 	
foreach
ÎÎ 
(
ÎÎ 
Thing
ÎÎ 
disk
ÎÎ 
in
ÎÎ  "
this
ÎÎ# '
.
ÎÎ' (
GetDisks
ÎÎ( 0
(
ÎÎ0 1
)
ÎÎ1 2
.
ÎÎ2 3
ToList
ÎÎ3 9
(
ÎÎ9 :
)
ÎÎ: ;
)
ÎÎ; <
{
ÏÏ 
if
ÌÌ 
(
ÌÌ 
disk
ÌÌ 
!=
ÌÌ 
null
ÌÌ  
&&
ÌÌ! #
!
ÌÌ$ %
disk
ÌÌ% )
.
ÌÌ) *
	Destroyed
ÌÌ* 3
)
ÌÌ3 4
{
ÓÓ 
disk
ÔÔ 
.
ÔÔ 
DeSpawn
ÔÔ  
(
ÔÔ  !
DestroyMode
ÔÔ! ,
.
ÔÔ, -
Vanish
ÔÔ- 3
)
ÔÔ3 4
;
ÔÔ4 5
GenPlace
 
.
 
TryPlaceThing
 *
(
* +
disk
+ /
,
/ 0
base
1 5
.
5 6
Position
6 >
,
> ?
base
@ D
.
D E
Map
E H
,
H I
ThingPlaceMode
J X
.
X Y
Near
Y ]
,
] ^
null
_ c
,
c d
null
e i
,
i j
null
k o
,
o p
$num
q r
)
r s
;
s t
}
ÒÒ 
}
ÚÚ 
}
ÛÛ 	
}
ÙÙ 
}ıı ä≈
^B:\rimworld code\_SourceCode\Develop\Êï∞Â≠óÂ≠òÂÇ®2.0\Source\Components\Building_StorageCore.cs
	namespace 	
DigitalStorage
 
. 

Components #
{ 
[ &
StaticConstructorOnStartup 
]  
public 

class  
Building_StorageCore %
:& '
Building_Storage( 8
,8 9
IRenameable: E
{ 
private 
static 
readonly 
	Texture2D  )
	RenameTex* 3
=4 5
ContentFinder6 C
<C D
	Texture2DD M
>M N
.N O
GetO R
(R S
$strS f
,f g
trueh l
)l m
;m n
private 
static 
readonly 
Material  (
LightMat) 1
=2 3
MaterialPool4 @
.@ A
MatFromA H
(H I
$strI R
,R S
ShaderDatabaseT b
.b c
MoteGlowc k
)k l
;l m
private 
static 
readonly 
Material  (
OrbMat) /
=0 1
MaterialPool2 >
.> ?
MatFrom? F
(F G
$strG P
,P Q
ShaderDatabaseR `
.` a
Cutouta g
)g h
;h i
private 
const 
int 
BaseCapacity &
=' (
$num) ,
;, -
private   
string   
networkName   "
;  " #
private!! 
List!! 
<!!  
Building_DiskCabinet!! )
>!!) *
diskCabinets!!+ 7
=!!8 9
new!!: =
List!!> B
<!!B C 
Building_DiskCabinet!!C W
>!!W X
(!!X Y
)!!Y Z
;!!Z [
private"" 
CompPowerTrader"" 
	powerComp""  )
;"") *
private%% 
List%% 
<%% 
StoredItemData%% #
>%%# $
virtualStorage%%% 3
=%%4 5
new%%6 9
List%%: >
<%%> ?
StoredItemData%%? M
>%%M N
(%%N O
)%%O P
;%%P Q
private&& 

Dictionary&& 
<&& 
string&& !
,&&! "
StoredItemData&&# 1
>&&1 2

itemLookup&&3 =
=&&> ?
new&&@ C

Dictionary&&D N
<&&N O
string&&O U
,&&U V
StoredItemData&&W e
>&&e f
(&&f g
)&&g h
;&&h i
private++ 

Dictionary++ 
<++ 
string++ !
,++! "
int++# &
>++& '
reservedItemCounts++( :
=++; <
new++= @

Dictionary++A K
<++K L
string++L R
,++R S
int++T W
>++W X
(++X Y
)++Y Z
;++Z [
public-- 
string-- 
RenamableLabel-- $
{.. 	
get// 
{// 
return// 
this// 
.// 
networkName// )
??//* ,
this//- 1
.//1 2
LabelCapNoCount//2 A
;//A B
}//C D
set00 
{00 
this00 
.00 
networkName00 "
=00# $
value00% *
;00* +
}00, -
}11 	
public33 
string33 
	BaseLabel33 
{44 	
get55 
{55 
return55 
this55 
.55 
LabelCapNoCount55 -
;55- .
}55/ 0
}66 	
public88 
string88 
InspectLabel88 "
{99 	
get:: 
{:: 
return:: 
this:: 
.:: 
LabelCap:: &
;::& '
}::( )
};; 	
public== 
string== 
NetworkName== !
{>> 	
get?? 
{?? 
return?? 
this?? 
.?? 
networkName?? )
????* ,
$str??- 4
;??4 5
}??6 7
set@@ 
{@@ 
this@@ 
.@@ 
networkName@@ "
=@@# $
value@@% *
;@@* +
}@@, -
}AA 	
publicCC 
boolCC 
PoweredCC 
{DD 	
getEE 
{FF 
CompPowerTraderGG 
compPowerTraderGG  /
=GG0 1
thisGG2 6
.GG6 7
	powerCompGG7 @
;GG@ A
returnHH 
compPowerTraderHH &
!=HH' )
nullHH* .
&&HH/ 1
compPowerTraderHH2 A
.HHA B
PowerOnHHB I
;HHI J
}II 
}JJ 	
	protectedLL 
overrideLL 
voidLL 
DrawAtLL  &
(LL& '
Vector3LL' .
drawLocLL/ 6
,LL6 7
boolLL8 <
flipLL= A
=LLB C
falseLLD I
)LLI J
{MM 	
baseOO 
.OO 
DrawAtOO 
(OO 
drawLocOO 
,OO  
flipOO! %
)OO% &
;OO& '
Vector3RR 
lightPosRR 
=RR 
drawLocRR &
;RR& '
lightPosSS 
.SS 
ySS 
=SS 
AltitudeLayerSS &
.SS& '
BuildingOnTopSS' 4
.SS4 5
AltitudeForSS5 @
(SS@ A
)SSA B
;SSB C
	Matrix4x4TT 
lightMatTT 
=TT  
	Matrix4x4TT! *
.TT* +
TRSTT+ .
(TT. /
lightPosTT/ 7
,TT7 8

QuaternionTT9 C
.TTC D
identityTTD L
,TTL M
newTTN Q
Vector3TTR Y
(TTY Z
$numTTZ \
,TT\ ]
$numTT^ a
,TTa b
$numTTc e
)TTe f
)TTf g
;TTg h
GraphicsUU 
.UU 
DrawMeshUU 
(UU 
MeshPoolUU &
.UU& '
plane10UU' .
,UU. /
lightMatUU0 8
,UU8 9
LightMatUU: B
,UUB C
$numUUD E
)UUE F
;UUF G
floatXX 
floatOffsetXX 
=XX 
MathfXX  %
.XX% &
SinXX& )
(XX) *
TimeXX* .
.XX. / 
realtimeSinceStartupXX/ C
*XXD E
$numXXF H
)XXH I
*XXJ K
$numXXL Q
;XXQ R
Vector3YY 
orbPosYY 
=YY 
drawLocYY $
;YY$ %
orbPosZZ 
.ZZ 
yZZ 
=ZZ 
AltitudeLayerZZ $
.ZZ$ %
BuildingOnTopZZ% 2
.ZZ2 3
AltitudeForZZ3 >
(ZZ> ?
)ZZ? @
+ZZA B
$numZZC H
;ZZH I
orbPos[[ 
.[[ 
z[[ 
+=[[ 
floatOffset[[ #
;[[# $
	Matrix4x4\\ 
orbMat\\ 
=\\ 
	Matrix4x4\\ (
.\\( )
TRS\\) ,
(\\, -
orbPos\\- 3
,\\3 4

Quaternion\\5 ?
.\\? @
identity\\@ H
,\\H I
new\\J M
Vector3\\N U
(\\U V
$num\\V X
,\\X Y
$num\\Z ]
,\\] ^
$num\\_ a
)\\a b
)\\b c
;\\c d
Graphics]] 
.]] 
DrawMesh]] 
(]] 
MeshPool]] &
.]]& '
plane10]]' .
,]]. /
orbMat]]0 6
,]]6 7
OrbMat]]8 >
,]]> ?
$num]]@ A
)]]A B
;]]B C
}^^ 	
public`` 
override`` 
void`` 

SpawnSetup`` '
(``' (
Map``( +
map``, /
,``/ 0
bool``1 5
respawningAfterLoad``6 I
)``I J
{aa 	
basebb 
.bb 

SpawnSetupbb 
(bb 
mapbb 
,bb  
respawningAfterLoadbb! 4
)bb4 5
;bb5 6
thiscc 
.cc 
	powerCompcc 
=cc 
basecc !
.cc! "
GetCompcc" )
<cc) *
CompPowerTradercc* 9
>cc9 :
(cc: ;
)cc; <
;cc< =&
DigitalStorageMapComponentdd &
	componentdd' 0
=dd1 2
mapdd3 6
.dd6 7
GetComponentdd7 C
<ddC D&
DigitalStorageMapComponentddD ^
>dd^ _
(dd_ `
)dd` a
;dda b
ifee 
(ee 
	componentee 
!=ee 
nullee !
)ee! "
{ff 
	componentgg 
.gg 
RegisterCoregg &
(gg& '
thisgg' +
)gg+ ,
;gg, -
}hh 
Gameii 
gameii 
=ii 
Currentii 
.ii  
Gameii  $
;ii$ %
ifjj 
(jj 
gamejj 
!=jj 
nulljj 
)jj 
{kk '
DigitalStorageGameComponentll +

component2ll, 6
=ll7 8
gamell9 =
.ll= >
GetComponentll> J
<llJ K'
DigitalStorageGameComponentllK f
>llf g
(llg h
)llh i
;lli j
ifmm 
(mm 

component2mm 
!=mm !
nullmm" &
)mm& '
{nn 

component2oo 
.oo 
RegisterCoreoo +
(oo+ ,
thisoo, 0
)oo0 1
;oo1 2
}pp 
}qq 
}rr 	
publictt 
overridett 
voidtt 
DeSpawntt $
(tt$ %
DestroyModett% 0
modett1 5
=tt6 7
DestroyModett8 C
.ttC D
VanishttD J
)ttJ K
{uu 	
Mapvv 
mapvv 
=vv 
basevv 
.vv 
Mapvv 
;vv 
ifww 
(ww 
mapww 
!=ww 
nullww 
)ww 
{xx &
DigitalStorageMapComponentyy *
	componentyy+ 4
=yy5 6
mapyy7 :
.yy: ;
GetComponentyy; G
<yyG H&
DigitalStorageMapComponentyyH b
>yyb c
(yyc d
)yyd e
;yye f
ifzz 
(zz 
	componentzz 
!=zz  
nullzz! %
)zz% &
{{{ 
	component|| 
.|| 
DeregisterCore|| ,
(||, -
this||- 1
)||1 2
;||2 3
}}} 
}~~ 
Game 
game 
= 
Current 
.  
Game  $
;$ %
if
ÄÄ 
(
ÄÄ 
game
ÄÄ 
!=
ÄÄ 
null
ÄÄ 
)
ÄÄ 
{
ÅÅ )
DigitalStorageGameComponent
ÇÇ +

component2
ÇÇ, 6
=
ÇÇ7 8
game
ÇÇ9 =
.
ÇÇ= >
GetComponent
ÇÇ> J
<
ÇÇJ K)
DigitalStorageGameComponent
ÇÇK f
>
ÇÇf g
(
ÇÇg h
)
ÇÇh i
;
ÇÇi j
if
ÉÉ 
(
ÉÉ 

component2
ÉÉ 
!=
ÉÉ !
null
ÉÉ" &
)
ÉÉ& '
{
ÑÑ 

component2
ÖÖ 
.
ÖÖ 
DeregisterCore
ÖÖ -
(
ÖÖ- .
this
ÖÖ. 2
)
ÖÖ2 3
;
ÖÖ3 4
}
ÜÜ 
}
áá 
foreach
àà 
(
àà "
Building_DiskCabinet
àà )
cabinet
àà* 1
in
àà2 4
this
àà5 9
.
àà9 :
diskCabinets
àà: F
.
ààF G
Where
ààG L
(
ààL M
c
ààM N
=>
ààO Q
c
ààR S
!=
ààT V
null
ààW [
)
àà[ \
)
àà\ ]
{
ââ 
cabinet
ää 
.
ää 
SetBoundCore
ää $
(
ää$ %
null
ää% )
)
ää) *
;
ää* +
}
ãã 
this
åå 
.
åå 
diskCabinets
åå 
.
åå 
Clear
åå #
(
åå# $
)
åå$ %
;
åå% &
base
éé 
.
éé 
DeSpawn
éé 
(
éé 
mode
éé 
)
éé 
;
éé 
}
èè 	
public
ëë 
override
ëë 
IEnumerable
ëë #
<
ëë# $
Gizmo
ëë$ )
>
ëë) *
	GetGizmos
ëë+ 4
(
ëë4 5
)
ëë5 6
{
íí 	
foreach
ìì 
(
ìì 
Gizmo
ìì 
gizmo
ìì  
in
ìì! #
base
ìì$ (
.
ìì( )
	GetGizmos
ìì) 2
(
ìì2 3
)
ìì3 4
)
ìì4 5
{
îî 
yield
ïï 
return
ïï 
gizmo
ïï "
;
ïï" #
}
ññ 
yield
òò 
return
òò 
new
òò 
Command_Action
òò +
{
ôô 
defaultLabel
öö 
=
öö 
$str
öö %
,
öö% &
defaultDesc
õõ 
=
õõ 
$str
õõ ,
,
õõ, -
icon
úú 
=
úú 
ContentFinder
úú $
<
úú$ %
	Texture2D
úú% .
>
úú. /
.
úú/ 0
Get
úú0 3
(
úú3 4
$str
úú4 N
,
úúN O
true
úúP T
)
úúT U
,
úúU V
action
ùù 
=
ùù 
delegate
ùù !
(
ùù! "
)
ùù" #
{
ûû 
Find
üü 
.
üü 
WindowStack
üü $
.
üü$ %
Add
üü% (
(
üü( )
new
üü) ,
DigitalStorage
üü- ;
.
üü; <
UI
üü< >
.
üü> ?#
Dialog_VirtualStorage
üü? T
(
üüT U
this
üüU Y
)
üüY Z
)
üüZ [
;
üü[ \
}
†† 
}
°° 
;
°° 
yield
££ 
return
££ 
new
££ 
Command_Action
££ +
{
§§ 
defaultLabel
•• 
=
•• 
$str
•• &
,
••& '
defaultDesc
¶¶ 
=
¶¶ 
$str
¶¶ ,
,
¶¶, -
icon
ßß 
=
ßß 
	RenameTex
ßß  
,
ßß  !
action
®® 
=
®® 
delegate
®® !
(
®®! "
)
®®" #
{
©© 
Find
™™ 
.
™™ 
WindowStack
™™ $
.
™™$ %
Add
™™% (
(
™™( )
new
™™) ,"
Dialog_RenameNetwork
™™- A
(
™™A B
this
™™B F
)
™™F G
)
™™G H
;
™™H I
}
´´ 
}
¨¨ 
;
¨¨ 
yield
≠≠ 
break
≠≠ 
;
≠≠ 
}
ÆÆ 	
public
∞∞ 
override
∞∞ 
void
∞∞ 
PostMake
∞∞ %
(
∞∞% &
)
∞∞& '
{
±± 	
base
≤≤ 
.
≤≤ 
PostMake
≤≤ 
(
≤≤ 
)
≤≤ 
;
≤≤ 
this
≥≥ 
.
≥≥ 
diskCabinets
≥≥ 
=
≥≥ 
new
≥≥  #
List
≥≥$ (
<
≥≥( )"
Building_DiskCabinet
≥≥) =
>
≥≥= >
(
≥≥> ?
)
≥≥? @
;
≥≥@ A
this
¥¥ 
.
¥¥ 
virtualStorage
¥¥ 
=
¥¥  !
new
¥¥" %
List
¥¥& *
<
¥¥* +
StoredItemData
¥¥+ 9
>
¥¥9 :
(
¥¥: ;
)
¥¥; <
;
¥¥< =
this
µµ 
.
µµ 

itemLookup
µµ 
=
µµ 
new
µµ !

Dictionary
µµ" ,
<
µµ, -
string
µµ- 3
,
µµ3 4
StoredItemData
µµ5 C
>
µµC D
(
µµD E
)
µµE F
;
µµF G
this
∂∂ 
.
∂∂  
reservedItemCounts
∂∂ #
=
∂∂$ %
new
∂∂& )

Dictionary
∂∂* 4
<
∂∂4 5
string
∂∂5 ;
,
∂∂; <
int
∂∂= @
>
∂∂@ A
(
∂∂A B
)
∂∂B C
;
∂∂C D
}
∑∑ 	
public
ππ 
override
ππ 
void
ππ 

ExposeData
ππ '
(
ππ' (
)
ππ( )
{
∫∫ 	
base
ªª 
.
ªª 

ExposeData
ªª 
(
ªª 
)
ªª 
;
ªª 
Scribe_Values
ºº 
.
ºº 
Look
ºº 
<
ºº 
string
ºº %
>
ºº% &
(
ºº& '
ref
ºº' *
this
ºº+ /
.
ºº/ 0
networkName
ºº0 ;
,
ºº; <
$str
ºº= J
,
ººJ K
null
ººL P
,
ººP Q
false
ººR W
)
ººW X
;
ººX Y 
Scribe_Collections
ΩΩ 
.
ΩΩ 
Look
ΩΩ #
<
ΩΩ# $"
Building_DiskCabinet
ΩΩ$ 8
>
ΩΩ8 9
(
ΩΩ9 :
ref
ΩΩ: =
this
ΩΩ> B
.
ΩΩB C
diskCabinets
ΩΩC O
,
ΩΩO P
$str
ΩΩQ _
,
ΩΩ_ `
LookMode
ΩΩa i
.
ΩΩi j
	Reference
ΩΩj s
,
ΩΩs t
Array
ΩΩu z
.
ΩΩz {
EmptyΩΩ{ Ä
<ΩΩÄ Å
objectΩΩÅ á
>ΩΩá à
(ΩΩà â
)ΩΩâ ä
)ΩΩä ã
;ΩΩã å 
Scribe_Collections
ææ 
.
ææ 
Look
ææ #
<
ææ# $
StoredItemData
ææ$ 2
>
ææ2 3
(
ææ3 4
ref
ææ4 7
this
ææ8 <
.
ææ< =
virtualStorage
ææ= K
,
ææK L
$str
ææM ]
,
ææ] ^
LookMode
ææ_ g
.
ææg h
Deep
ææh l
)
ææl m
;
ææm n 
Scribe_Collections
øø 
.
øø 
Look
øø #
<
øø# $
string
øø$ *
,
øø* +
int
øø, /
>
øø/ 0
(
øø0 1
ref
øø1 4
this
øø5 9
.
øø9 : 
reservedItemCounts
øø: L
,
øøL M
$str
øøN b
,
øøb c
LookMode
øød l
.
øøl m
Value
øøm r
,
øør s
LookMode
øøt |
.
øø| }
Valueøø} Ç
)øøÇ É
;øøÉ Ñ
if
¡¡ 
(
¡¡ 
Scribe
¡¡ 
.
¡¡ 
mode
¡¡ 
==
¡¡ 
LoadSaveMode
¡¡ +
.
¡¡+ ,
PostLoadInit
¡¡, 8
)
¡¡8 9
{
¬¬ 
if
√√ 
(
√√ 
this
√√ 
.
√√ 
diskCabinets
√√ %
==
√√& (
null
√√) -
)
√√- .
{
ƒƒ 
this
≈≈ 
.
≈≈ 
diskCabinets
≈≈ %
=
≈≈& '
new
≈≈( +
List
≈≈, 0
<
≈≈0 1"
Building_DiskCabinet
≈≈1 E
>
≈≈E F
(
≈≈F G
)
≈≈G H
;
≈≈H I
}
∆∆ 
if
«« 
(
«« 
this
«« 
.
«« 
virtualStorage
«« '
==
««( *
null
««+ /
)
««/ 0
{
»» 
this
…… 
.
…… 
virtualStorage
…… '
=
……( )
new
……* -
List
……. 2
<
……2 3
StoredItemData
……3 A
>
……A B
(
……B C
)
……C D
;
……D E
}
   
if
ÀÀ 
(
ÀÀ 
this
ÀÀ 
.
ÀÀ  
reservedItemCounts
ÀÀ +
==
ÀÀ, .
null
ÀÀ/ 3
)
ÀÀ3 4
{
ÃÃ 
this
ÕÕ 
.
ÕÕ  
reservedItemCounts
ÕÕ +
=
ÕÕ, -
new
ÕÕ. 1

Dictionary
ÕÕ2 <
<
ÕÕ< =
string
ÕÕ= C
,
ÕÕC D
int
ÕÕE H
>
ÕÕH I
(
ÕÕI J
)
ÕÕJ K
;
ÕÕK L
}
ŒŒ 
RebuildLookup
—— 
(
—— 
)
—— 
;
——  
}
““ 
}
”” 	
public
’’ 
override
’’ 
string
’’ 
GetInspectString
’’ /
(
’’/ 0
)
’’0 1
{
÷÷ 	
StringBuilder
◊◊ 
sb
◊◊ 
=
◊◊ 
new
◊◊ "
StringBuilder
◊◊# 0
(
◊◊0 1
)
◊◊1 2
;
◊◊2 3
string
ÿÿ 
baseStr
ÿÿ 
=
ÿÿ 
base
ÿÿ !
.
ÿÿ! "
GetInspectString
ÿÿ" 2
(
ÿÿ2 3
)
ÿÿ3 4
;
ÿÿ4 5
if
ŸŸ 
(
ŸŸ 
!
ŸŸ 
string
ŸŸ 
.
ŸŸ 
IsNullOrEmpty
ŸŸ %
(
ŸŸ% &
baseStr
ŸŸ& -
)
ŸŸ- .
)
ŸŸ. /
{
⁄⁄ 
sb
€€ 
.
€€ 

AppendLine
€€ 
(
€€ 
baseStr
€€ %
)
€€% &
;
€€& '
}
‹‹ 
sb
›› 
.
›› 

AppendLine
›› 
(
›› 
$str
››  
+
››! "
this
››# '
.
››' (
NetworkName
››( 3
)
››3 4
;
››4 5
sb
ﬁﬁ 
.
ﬁﬁ 

AppendLine
ﬁﬁ 
(
ﬁﬁ 
string
ﬁﬁ  
.
ﬁﬁ  !
Format
ﬁﬁ! '
(
ﬁﬁ' (
$str
ﬁﬁ( 7
,
ﬁﬁ7 8
this
ﬁﬁ9 =
.
ﬁﬁ= >
GetUsedCapacity
ﬁﬁ> M
(
ﬁﬁM N
)
ﬁﬁN O
,
ﬁﬁO P
this
ﬁﬁQ U
.
ﬁﬁU V
GetCapacity
ﬁﬁV a
(
ﬁﬁa b
)
ﬁﬁb c
)
ﬁﬁc d
)
ﬁﬁd e
;
ﬁﬁe f
sb
ﬂﬂ 
.
ﬂﬂ 

AppendLine
ﬂﬂ 
(
ﬂﬂ 
string
ﬂﬂ  
.
ﬂﬂ  !
Format
ﬂﬂ! '
(
ﬂﬂ' (
$str
ﬂﬂ( 2
,
ﬂﬂ2 3
this
ﬂﬂ4 8
.
ﬂﬂ8 9
diskCabinets
ﬂﬂ9 E
.
ﬂﬂE F
Count
ﬂﬂF K
)
ﬂﬂK L
)
ﬂﬂL M
;
ﬂﬂM N
if
‡‡ 
(
‡‡ 
!
‡‡ 
this
‡‡ 
.
‡‡ 
Powered
‡‡ 
)
‡‡ 
{
·· 
sb
‚‚ 
.
‚‚ 

AppendLine
‚‚ 
(
‚‚ 
$str
‚‚ #
)
‚‚# $
;
‚‚$ %
}
„„ 
return
‰‰ 
sb
‰‰ 
.
‰‰ 
ToString
‰‰ 
(
‰‰ 
)
‰‰  
.
‰‰  !
TrimEnd
‰‰! (
(
‰‰( )
)
‰‰) *
;
‰‰* +
}
ÂÂ 	
public
ÍÍ 
int
ÍÍ 
GetCapacity
ÍÍ 
(
ÍÍ 
)
ÍÍ  
{
ÎÎ 	
return
ÏÏ 
BaseCapacity
ÏÏ 
+
ÏÏ  !
this
ÏÏ" &
.
ÏÏ& '
GetDiskCapacity
ÏÏ' 6
(
ÏÏ6 7
)
ÏÏ7 8
;
ÏÏ8 9
}
ÌÌ 	
public
ÚÚ 
int
ÚÚ 
GetUsedCapacity
ÚÚ "
(
ÚÚ" #
)
ÚÚ# $
{
ÛÛ 	
return
ıı 
this
ıı 
.
ıı 
virtualStorage
ıı &
.
ıı& '
Count
ıı' ,
;
ıı, -
}
ˆˆ 	
public
¯¯ 
int
¯¯ 
GetDiskCapacity
¯¯ "
(
¯¯" #
)
¯¯# $
{
˘˘ 	
int
˙˙ 
total
˙˙ 
=
˙˙ 
$num
˙˙ 
;
˙˙ 
foreach
˚˚ 
(
˚˚ "
Building_DiskCabinet
˚˚ )
cabinet
˚˚* 1
in
˚˚2 4
this
˚˚5 9
.
˚˚9 :
diskCabinets
˚˚: F
)
˚˚F G
{
¸¸ 
if
˝˝ 
(
˝˝ 
cabinet
˝˝ 
!=
˝˝ 
null
˝˝ #
&&
˝˝$ &
cabinet
˝˝' .
.
˝˝. /
Spawned
˝˝/ 6
)
˝˝6 7
{
˛˛ 
total
ˇˇ 
+=
ˇˇ 
cabinet
ˇˇ $
.
ˇˇ$ %!
GetProvidedCapacity
ˇˇ% 8
(
ˇˇ8 9
)
ˇˇ9 :
;
ˇˇ: ;
}
ÄÄ 
}
ÅÅ 
return
ÇÇ 
total
ÇÇ 
;
ÇÇ 
}
ÉÉ 	
public
ââ 
new
ââ 
bool
ââ 
Accepts
ââ 
(
ââ  
Thing
ââ  %
t
ââ& '
)
ââ' (
{
ää 	
if
åå 
(
åå 
!
åå 
base
åå 
.
åå 
Accepts
åå 
(
åå 
t
åå 
)
åå  
)
åå  !
{
çç 
return
éé 
false
éé 
;
éé 
}
èè 
if
íí 
(
íí 
!
íí 
this
íí 
.
íí 
Powered
íí 
)
íí 
{
ìì 
return
îî 
false
îî 
;
îî 
}
ïï 
bool
òò 
canMerge
òò 
=
òò 
false
òò !
;
òò! "
foreach
ôô 
(
ôô 
StoredItemData
ôô #
existing
ôô$ ,
in
ôô- /
this
ôô0 4
.
ôô4 5
virtualStorage
ôô5 C
)
ôôC D
{
öö 
if
õõ 
(
õõ 
existing
õõ 
.
õõ 
Matches
õõ $
(
õõ$ %
t
õõ% &
.
õõ& '
def
õõ' *
,
õõ* +
t
õõ, -
.
õõ- .
Stuff
õõ. 3
)
õõ3 4
&&
õõ5 7
existing
úú 
.
úú 
quality
úú $
==
úú% '
(
úú( )
t
úú) *
.
úú* +

TryGetComp
úú+ 5
<
úú5 6
CompQuality
úú6 A
>
úúA B
(
úúB C
)
úúC D
?
úúD E
.
úúE F
Quality
úúF M
??
úúN P
QualityCategory
úúQ `
.
úú` a
Normal
úúa g
)
úúg h
)
úúh i
{
ùù 
canMerge
üü 
=
üü 
true
üü #
;
üü# $
break
†† 
;
†† 
}
°° 
}
¢¢ 
if
•• 
(
•• 
canMerge
•• 
)
•• 
{
¶¶ 
return
ßß 
true
ßß 
;
ßß 
}
®® 
else
©© 
{
™™ 
return
¨¨ 
this
¨¨ 
.
¨¨ 
GetUsedCapacity
¨¨ +
(
¨¨+ ,
)
¨¨, -
<
¨¨. /
this
¨¨0 4
.
¨¨4 5
GetCapacity
¨¨5 @
(
¨¨@ A
)
¨¨A B
;
¨¨B C
}
≠≠ 
}
ÆÆ 	
public
∞∞ 
bool
∞∞ 
CanReceiveThing
∞∞ #
(
∞∞# $
Thing
∞∞$ )
item
∞∞* .
)
∞∞. /
{
±± 	
return
≤≤ 
this
≤≤ 
.
≤≤ 
Accepts
≤≤ 
(
≤≤  
item
≤≤  $
)
≤≤$ %
;
≤≤% &
}
≥≥ 	
public
µµ 
void
µµ !
RegisterDiskCabinet
µµ '
(
µµ' ("
Building_DiskCabinet
µµ( <
cabinet
µµ= D
)
µµD E
{
∂∂ 	
if
∑∑ 
(
∑∑ 
cabinet
∑∑ 
!=
∑∑ 
null
∑∑ 
&&
∑∑  "
!
∑∑# $
this
∑∑$ (
.
∑∑( )
diskCabinets
∑∑) 5
.
∑∑5 6
Contains
∑∑6 >
(
∑∑> ?
cabinet
∑∑? F
)
∑∑F G
)
∑∑G H
{
∏∏ 
this
ππ 
.
ππ 
diskCabinets
ππ !
.
ππ! "
Add
ππ" %
(
ππ% &
cabinet
ππ& -
)
ππ- .
;
ππ. /
}
∫∫ 
}
ªª 	
public
ΩΩ 
void
ΩΩ #
DeregisterDiskCabinet
ΩΩ )
(
ΩΩ) *"
Building_DiskCabinet
ΩΩ* >
cabinet
ΩΩ? F
)
ΩΩF G
{
ææ 	
this
øø 
.
øø 
diskCabinets
øø 
.
øø 
Remove
øø $
(
øø$ %
cabinet
øø% ,
)
øø, -
;
øø- .
}
¿¿ 	
private
√√ 

Dictionary
√√ 
<
√√ 
string
√√ !
,
√√! "
int
√√# &
>
√√& '
_cachedItemCounts
√√( 9
=
√√: ;
new
√√< ?

Dictionary
√√@ J
<
√√J K
string
√√K Q
,
√√Q R
int
√√S V
>
√√V W
(
√√W X
)
√√X Y
;
√√Y Z
private
ƒƒ 

Dictionary
ƒƒ 
<
ƒƒ 
string
ƒƒ !
,
ƒƒ! "
int
ƒƒ# &
>
ƒƒ& '#
_cachedPhysicalCounts
ƒƒ( =
=
ƒƒ> ?
new
ƒƒ@ C

Dictionary
ƒƒD N
<
ƒƒN O
string
ƒƒO U
,
ƒƒU V
int
ƒƒW Z
>
ƒƒZ [
(
ƒƒ[ \
)
ƒƒ\ ]
;
ƒƒ] ^
private
«« 
int
«« #
lastPhysicalItemCount
«« )
=
««* +
$num
««, -
;
««- .
	protected
…… 
override
…… 
void
…… 
Tick
……  $
(
……$ %
)
……% &
{
   	
base
ÀÀ 
.
ÀÀ 
Tick
ÀÀ 
(
ÀÀ 
)
ÀÀ 
;
ÀÀ 
if
ÕÕ 
(
ÕÕ 
!
ÕÕ 
this
ÕÕ 
.
ÕÕ 
Powered
ÕÕ 
)
ÕÕ 
{
ŒŒ 
return
œœ 
;
œœ 
}
–– 
if
”” 
(
”” 
Find
”” 
.
”” 
TickManager
””  
.
””  !
	TicksGame
””! *
%
””+ ,
$num
””- /
==
””0 2
$num
””3 4
)
””4 5
{
‘‘ #
MaintainReservedItems
’’ %
(
’’% &
)
’’& '
;
’’' (
}
÷÷ 
if
⁄⁄ 
(
⁄⁄ 
Find
⁄⁄ 
.
⁄⁄ 
TickManager
⁄⁄  
.
⁄⁄  !
	TicksGame
⁄⁄! *
%
⁄⁄+ ,
$num
⁄⁄- 0
==
⁄⁄1 3
$num
⁄⁄4 5
)
⁄⁄5 6
{
€€ 
if
‹‹ 
(
‹‹ $
DigitalStorageSettings
‹‹ *
.
‹‹* +!
enableConversionLog
‹‹+ >
)
‹‹> ?
{
›› 
Log
ﬁﬁ 
.
ﬁﬁ 
Message
ﬁﬁ 
(
ﬁﬁ  
$"
ﬁﬁ  "
$str
ﬁﬁ" ;
{
ﬁﬁ; <
Find
ﬁﬁ< @
.
ﬁﬁ@ A
TickManager
ﬁﬁA L
.
ﬁﬁL M
	TicksGame
ﬁﬁM V
}
ﬁﬁV W
$str
ﬁﬁW a
{
ﬁﬁa b
this
ﬁﬁb f
.
ﬁﬁf g
Powered
ﬁﬁg n
}
ﬁﬁn o
"
ﬁﬁo p
)
ﬁﬁp q
;
ﬁﬁq r
}
ﬂﬂ 
	SlotGroup
·· 
	slotGroup
·· #
=
··$ %
base
··& *
.
··* +
GetSlotGroup
··+ 7
(
··7 8
)
··8 9
;
··9 :
if
‚‚ 
(
‚‚ 
	slotGroup
‚‚ 
!=
‚‚  
null
‚‚! %
)
‚‚% &
{
„„ 
int
‰‰ 
reservedCount
‰‰ %
=
‰‰& '$
DigitalStorageSettings
‰‰( >
.
‰‰> ?"
reservedCountPerItem
‰‰? S
;
‰‰S T
int
ÂÂ 

totalItems
ÂÂ "
=
ÂÂ# $
	slotGroup
ÂÂ% .
.
ÂÂ. /

HeldThings
ÂÂ/ 9
.
ÂÂ9 :
Count
ÂÂ: ?
(
ÂÂ? @
)
ÂÂ@ A
;
ÂÂA B
if
ÁÁ 
(
ÁÁ $
DigitalStorageSettings
ÁÁ .
.
ÁÁ. /!
enableConversionLog
ÁÁ/ B
)
ÁÁB C
{
ËË 
Log
ÈÈ 
.
ÈÈ 
Message
ÈÈ #
(
ÈÈ# $
$"
ÈÈ$ &
$str
ÈÈ& G
{
ÈÈG H
reservedCount
ÈÈH U
}
ÈÈU V
$str
ÈÈV ^
{
ÈÈ^ _

totalItems
ÈÈ_ i
}
ÈÈi j
"
ÈÈj k
)
ÈÈk l
;
ÈÈl m
}
ÍÍ 
bool
ÌÌ 
needsConversion
ÌÌ (
=
ÌÌ) *
false
ÌÌ+ 0
;
ÌÌ0 1
_cachedItemCounts
ÓÓ %
.
ÓÓ% &
Clear
ÓÓ& +
(
ÓÓ+ ,
)
ÓÓ, -
;
ÓÓ- .
List
ÒÒ 
<
ÒÒ 
Thing
ÒÒ 
>
ÒÒ 

heldThings
ÒÒ  *
=
ÒÒ+ ,
	slotGroup
ÒÒ- 6
.
ÒÒ6 7

HeldThings
ÒÒ7 A
.
ÒÒA B
ToList
ÒÒB H
(
ÒÒH I
)
ÒÒI J
;
ÒÒJ K
for
ÚÚ 
(
ÚÚ 
int
ÚÚ 
i
ÚÚ 
=
ÚÚ  
$num
ÚÚ! "
;
ÚÚ" #
i
ÚÚ$ %
<
ÚÚ& '

heldThings
ÚÚ( 2
.
ÚÚ2 3
Count
ÚÚ3 8
;
ÚÚ8 9
i
ÚÚ: ;
++
ÚÚ; =
)
ÚÚ= >
{
ÛÛ 
Thing
ÙÙ 
thing
ÙÙ #
=
ÙÙ$ %

heldThings
ÙÙ& 0
[
ÙÙ0 1
i
ÙÙ1 2
]
ÙÙ2 3
;
ÙÙ3 4
if
ıı 
(
ıı 
thing
ıı !
==
ıı" $
null
ıı% )
||
ıı* ,
!
ıı- .
thing
ıı. 3
.
ıı3 4
Spawned
ıı4 ;
)
ıı; <
{
ˆˆ 
continue
˜˜ $
;
˜˜$ %
}
¯¯ 
if
¸¸ 
(
¸¸ 
this
¸¸  
.
¸¸  !
Map
¸¸! $
!=
¸¸% '
null
¸¸( ,
)
¸¸, -
{
˝˝ 
if
˛˛ 
(
˛˛  
this
˛˛  $
.
˛˛$ %
Map
˛˛% (
.
˛˛( ) 
reservationManager
˛˛) ;
.
˛˛; <"
IsReservedByAnyoneOf
˛˛< P
(
˛˛P Q
new
˛˛Q T
LocalTargetInfo
˛˛U d
(
˛˛d e
thing
˛˛e j
)
˛˛j k
,
˛˛k l
Faction
˛˛m t
.
˛˛t u
OfPlayer
˛˛u }
)
˛˛} ~
)
˛˛~ 
{
ˇˇ 
if
ÇÇ  "
(
ÇÇ# $ 
IsValidReservation
ÇÇ$ 6
(
ÇÇ6 7
thing
ÇÇ7 <
,
ÇÇ< =
this
ÇÇ> B
.
ÇÇB C
Map
ÇÇC F
)
ÇÇF G
)
ÇÇG H
{
ÉÉ  !
if
ÑÑ$ &
(
ÑÑ' ($
DigitalStorageSettings
ÑÑ( >
.
ÑÑ> ?!
enableConversionLog
ÑÑ? R
)
ÑÑR S
{
ÖÖ$ %
Log
ÜÜ( +
.
ÜÜ+ ,
Message
ÜÜ, 3
(
ÜÜ3 4
$"
ÜÜ4 6
$str
ÜÜ6 Q
{
ÜÜQ R
thing
ÜÜR W
.
ÜÜW X
Label
ÜÜX ]
}
ÜÜ] ^
"
ÜÜ^ _
)
ÜÜ_ `
;
ÜÜ` a
}
áá$ %
continue
àà$ ,
;
àà, -
}
ââ  !
if
ãã  "
(
ãã# $$
DigitalStorageSettings
ãã$ :
.
ãã: ;!
enableConversionLog
ãã; N
)
ããN O
{
åå  !
Log
çç$ '
.
çç' (
Message
çç( /
(
çç/ 0
$"
çç0 2
$str
çç2 L
{
ççL M
thing
ççM R
.
ççR S
Label
ççS X
}
ççX Y
"
ççY Z
)
ççZ [
;
çç[ \
}
éé  !
}
èè 
}
êê 
string
íí 
key
íí "
=
íí# $

GetItemKey
íí% /
(
íí/ 0
thing
íí0 5
)
íí5 6
;
íí6 7
if
ìì 
(
ìì 
!
ìì 
_cachedItemCounts
ìì .
.
ìì. /
ContainsKey
ìì/ :
(
ìì: ;
key
ìì; >
)
ìì> ?
)
ìì? @
{
îî 
_cachedItemCounts
ïï -
[
ïï- .
key
ïï. 1
]
ïï1 2
=
ïï3 4
$num
ïï5 6
;
ïï6 7
}
ññ 
_cachedItemCounts
óó )
[
óó) *
key
óó* -
]
óó- .
+=
óó/ 1
thing
óó2 7
.
óó7 8

stackCount
óó8 B
;
óóB C
if
öö 
(
öö 
_cachedItemCounts
öö -
[
öö- .
key
öö. 1
]
öö1 2
>
öö3 4
reservedCount
öö5 B
)
ööB C
{
õõ 
needsConversion
úú +
=
úú, -
true
úú. 2
;
úú2 3
if
ùù 
(
ùù  $
DigitalStorageSettings
ùù  6
.
ùù6 7!
enableConversionLog
ùù7 J
)
ùùJ K
{
ûû 
Log
üü  #
.
üü# $
Message
üü$ +
(
üü+ ,
$"
üü, .
$str
üü. L
{
üüL M
key
üüM P
}
üüP Q
$str
üüQ V
{
üüV W
_cachedItemCounts
üüW h
[
üüh i
key
üüi l
]
üül m
}
üüm n
$str
üün s
{
üüs t
reservedCountüüt Å
}üüÅ Ç
"üüÇ É
)üüÉ Ñ
;üüÑ Ö
}
†† 
break
°° !
;
°°! "
}
¢¢ 
}
££ 
if
•• 
(
•• 
needsConversion
•• '
)
••' (
{
¶¶ 
if
ßß 
(
ßß $
DigitalStorageSettings
ßß 2
.
ßß2 3!
enableConversionLog
ßß3 F
)
ßßF G
{
®® 
Log
©© 
.
©©  
Message
©©  '
(
©©' (
$"
©©( *
$str
©©* b
"
©©b c
)
©©c d
;
©©d e
}
™™ 
Services
≠≠  
.
≠≠  ! 
AsyncItemConverter
≠≠! 3
.
≠≠3 4"
StartAsyncConversion
≠≠4 H
(
≠≠H I
this
≠≠I M
)
≠≠M N
;
≠≠N O
}
ÆÆ 
else
ØØ 
{
∞∞ 
if
±± 
(
±± $
DigitalStorageSettings
±± 2
.
±±2 3!
enableConversionLog
±±3 F
)
±±F G
{
≤≤ 
Log
≥≥ 
.
≥≥  
Message
≥≥  '
(
≥≥' (
$"
≥≥( *
$str
≥≥* =
"
≥≥= >
)
≥≥> ?
;
≥≥? @
}
¥¥ 
}
µµ #
lastPhysicalItemCount
∏∏ )
=
∏∏* +

heldThings
∏∏, 6
.
∏∏6 7
Count
∏∏7 <
;
∏∏< =
}
ππ 
else
∫∫ 
{
ªª 
if
ºº 
(
ºº $
DigitalStorageSettings
ºº .
.
ºº. /!
enableConversionLog
ºº/ B
)
ººB C
{
ΩΩ 
Log
ææ 
.
ææ 
Message
ææ #
(
ææ# $
$"
ææ$ &
$str
ææ& C
"
ææC D
)
ææD E
;
ææE F
}
øø 
}
¿¿ 
}
¡¡ 
}
¬¬ 	
private
«« 
void
«« #
MaintainReservedItems
«« *
(
««* +
)
««+ ,
{
»» 	
int
…… 
reservedCount
…… 
=
…… $
DigitalStorageSettings
……  6
.
……6 7"
reservedCountPerItem
……7 K
;
……K L
	SlotGroup
   
	slotGroup
   
=
    !
base
  " &
.
  & '
GetSlotGroup
  ' 3
(
  3 4
)
  4 5
;
  5 6
if
ÀÀ 
(
ÀÀ 
	slotGroup
ÀÀ 
==
ÀÀ 
null
ÀÀ !
)
ÀÀ! "
{
ÃÃ 
return
ÕÕ 
;
ÕÕ 
}
ŒŒ #
_cachedPhysicalCounts
—— !
.
——! "
Clear
——" '
(
——' (
)
——( )
;
——) *
List
‘‘ 
<
‘‘ 
Thing
‘‘ 
>
‘‘ 

heldThings
‘‘ "
=
‘‘# $
	slotGroup
‘‘% .
.
‘‘. /

HeldThings
‘‘/ 9
.
‘‘9 :
ToList
‘‘: @
(
‘‘@ A
)
‘‘A B
;
‘‘B C
for
’’ 
(
’’ 
int
’’ 
i
’’ 
=
’’ 
$num
’’ 
;
’’ 
i
’’ 
<
’’ 

heldThings
’’  *
.
’’* +
Count
’’+ 0
;
’’0 1
i
’’2 3
++
’’3 5
)
’’5 6
{
÷÷ 
Thing
◊◊ 
thing
◊◊ 
=
◊◊ 

heldThings
◊◊ (
[
◊◊( )
i
◊◊) *
]
◊◊* +
;
◊◊+ ,
if
ÿÿ 
(
ÿÿ 
thing
ÿÿ 
==
ÿÿ 
null
ÿÿ !
||
ÿÿ" $
!
ÿÿ% &
thing
ÿÿ& +
.
ÿÿ+ ,
Spawned
ÿÿ, 3
)
ÿÿ3 4
{
ŸŸ 
continue
⁄⁄ 
;
⁄⁄ 
}
€€ 
string
›› 
key
›› 
=
›› 

GetItemKey
›› '
(
››' (
thing
››( -
)
››- .
;
››. /
if
ﬁﬁ 
(
ﬁﬁ 
!
ﬁﬁ #
_cachedPhysicalCounts
ﬁﬁ *
.
ﬁﬁ* +
ContainsKey
ﬁﬁ+ 6
(
ﬁﬁ6 7
key
ﬁﬁ7 :
)
ﬁﬁ: ;
)
ﬁﬁ; <
{
ﬂﬂ #
_cachedPhysicalCounts
‡‡ )
[
‡‡) *
key
‡‡* -
]
‡‡- .
=
‡‡/ 0
$num
‡‡1 2
;
‡‡2 3
}
·· #
_cachedPhysicalCounts
‚‚ %
[
‚‚% &
key
‚‚& )
]
‚‚) *
+=
‚‚+ -
thing
‚‚. 3
.
‚‚3 4

stackCount
‚‚4 >
;
‚‚> ?
}
„„ 
foreach
ËË 
(
ËË 
StoredItemData
ËË #
itemData
ËË$ ,
in
ËË- /
this
ËË0 4
.
ËË4 5
virtualStorage
ËË5 C
.
ËËC D
ToList
ËËD J
(
ËËJ K
)
ËËK L
)
ËËL M
{
ÈÈ 
if
ÍÍ 
(
ÍÍ 
itemData
ÍÍ 
==
ÍÍ 
null
ÍÍ  $
||
ÍÍ% '
itemData
ÍÍ( 0
.
ÍÍ0 1
def
ÍÍ1 4
==
ÍÍ5 7
null
ÍÍ8 <
||
ÍÍ= ?
itemData
ÍÍ@ H
.
ÍÍH I

stackCount
ÍÍI S
<=
ÍÍT V
$num
ÍÍW X
)
ÍÍX Y
{
ÎÎ 
continue
ÏÏ 
;
ÏÏ 
}
ÌÌ 
string
ÔÔ 
key
ÔÔ 
=
ÔÔ 

GetItemKey
ÔÔ '
(
ÔÔ' (
itemData
ÔÔ( 0
.
ÔÔ0 1
def
ÔÔ1 4
,
ÔÔ4 5
itemData
ÔÔ6 >
.
ÔÔ> ?
stuffDef
ÔÔ? G
,
ÔÔG H
itemData
ÔÔI Q
.
ÔÔQ R
quality
ÔÔR Y
)
ÔÔY Z
;
ÔÔZ [
int
ÚÚ 
currentCount
ÚÚ  
=
ÚÚ! "#
_cachedPhysicalCounts
ÚÚ# 8
.
ÚÚ8 9
ContainsKey
ÚÚ9 D
(
ÚÚD E
key
ÚÚE H
)
ÚÚH I
?
ÚÚJ K#
_cachedPhysicalCounts
ÚÚL a
[
ÚÚa b
key
ÚÚb e
]
ÚÚe f
:
ÚÚg h
$num
ÚÚi j
;
ÚÚj k
if
ˆˆ 
(
ˆˆ 
currentCount
ˆˆ  
<
ˆˆ! "
reservedCount
ˆˆ# 0
)
ˆˆ0 1
{
˜˜ 
int
¯¯ 
needed
¯¯ 
=
¯¯  
reservedCount
¯¯! .
-
¯¯/ 0
currentCount
¯¯1 =
;
¯¯= >
ThingDef
˘˘ 
def
˘˘  
=
˘˘! "
itemData
˘˘# +
.
˘˘+ ,
def
˘˘, /
;
˘˘/ 0
ThingDef
˙˙ 
stuff
˙˙ "
=
˙˙# $
itemData
˙˙% -
.
˙˙- .
stuffDef
˙˙. 6
;
˙˙6 7
QualityCategory
˚˚ #
quality
˚˚$ +
=
˚˚, -
itemData
˚˚. 6
.
˚˚6 7
quality
˚˚7 >
;
˚˚> ?
int
˛˛ 

stackLimit
˛˛ "
=
˛˛# $
def
˛˛% (
.
˛˛( )

stackLimit
˛˛) 3
;
˛˛3 4
int
ˇˇ 
actualNeeded
ˇˇ $
=
ˇˇ% &
Math
ˇˇ' +
.
ˇˇ+ ,
Min
ˇˇ, /
(
ˇˇ/ 0
needed
ˇˇ0 6
,
ˇˇ6 7

stackLimit
ˇˇ8 B
)
ˇˇB C
;
ˇˇC D
Thing
ÇÇ 
	extracted
ÇÇ #
=
ÇÇ$ %$
ExtractItemForReserved
ÇÇ& <
(
ÇÇ< =
def
ÇÇ= @
,
ÇÇ@ A
actualNeeded
ÇÇB N
,
ÇÇN O
stuff
ÇÇP U
,
ÇÇU V
quality
ÇÇW ^
)
ÇÇ^ _
;
ÇÇ_ `
if
ÉÉ 
(
ÉÉ 
	extracted
ÉÉ !
!=
ÉÉ" $
null
ÉÉ% )
)
ÉÉ) *
{
ÑÑ 
GenSpawn
ÜÜ  
.
ÜÜ  !
Spawn
ÜÜ! &
(
ÜÜ& '
	extracted
ÜÜ' 0
,
ÜÜ0 1
this
ÜÜ2 6
.
ÜÜ6 7
Position
ÜÜ7 ?
,
ÜÜ? @
this
ÜÜA E
.
ÜÜE F
Map
ÜÜF I
)
ÜÜI J
;
ÜÜJ K
if
áá 
(
áá $
DigitalStorageSettings
áá 2
.
áá2 3
enableDebugLog
áá3 A
)
ááA B
{
àà 
Log
ââ 
.
ââ  
Message
ââ  '
(
ââ' (
$"
ââ( *
$str
ââ* 9
{
ââ9 :
	extracted
ââ: C
.
ââC D
Label
ââD I
}
ââI J
$str
ââJ L
{
ââL M
	extracted
ââM V
.
ââV W

stackCount
ââW a
}
ââa b
$str
ââb g
{
ââg h
currentCount
ââh t
}
âât u
$str
ââu z
{
ââz {
actualNeededââ{ á
}ââá à
$strââà â
{âââ ä
neededââä ê
}ââê ë
"ââë í
)ââí ì
;ââì î
}
ää 
}
ãã 
}
åå 
}
çç 
foreach
êê 
(
êê 
var
êê 
kvp
êê 
in
êê #
_cachedPhysicalCounts
êê  5
)
êê5 6
{
ëë 
this
íí 
.
íí  
reservedItemCounts
íí '
[
íí' (
kvp
íí( +
.
íí+ ,
Key
íí, /
]
íí/ 0
=
íí1 2
kvp
íí3 6
.
íí6 7
Value
íí7 <
;
íí< =
}
ìì 
}
îî 	
public
üü 
Thing
üü 
TryReplenishItem
üü %
(
üü% &
ThingDef
üü& .
def
üü/ 2
,
üü2 3
ThingDef
üü4 <
stuff
üü= B
,
üüB C
int
üüD G
needed
üüH N
,
üüN O
QualityCategory
üüP _
quality
üü` g
)
üüg h
{
†† 	
if
°° 
(
°° 
def
°° 
==
°° 
null
°° 
||
°° 
needed
°° %
<=
°°& (
$num
°°) *
||
°°+ -
!
°°. /
this
°°/ 3
.
°°3 4
Powered
°°4 ;
)
°°; <
{
¢¢ 
return
££ 
null
££ 
;
££ 
}
§§ 
int
ßß 

stackLimit
ßß 
=
ßß 
def
ßß  
.
ßß  !

stackLimit
ßß! +
;
ßß+ ,
int
®® 
actualNeeded
®® 
=
®® 
Math
®® #
.
®®# $
Min
®®$ '
(
®®' (
needed
®®( .
,
®®. /

stackLimit
®®0 :
)
®®: ;
;
®®; <
Thing
´´ 
	extracted
´´ 
=
´´ $
ExtractItemForReserved
´´ 4
(
´´4 5
def
´´5 8
,
´´8 9
actualNeeded
´´: F
,
´´F G
stuff
´´H M
,
´´M N
quality
´´O V
)
´´V W
;
´´W X
if
¨¨ 
(
¨¨ 
	extracted
¨¨ 
!=
¨¨ 
null
¨¨ !
)
¨¨! "
{
≠≠ 
GenSpawn
ØØ 
.
ØØ 
Spawn
ØØ 
(
ØØ 
	extracted
ØØ (
,
ØØ( )
this
ØØ* .
.
ØØ. /
Position
ØØ/ 7
,
ØØ7 8
this
ØØ9 =
.
ØØ= >
Map
ØØ> A
)
ØØA B
;
ØØB C
if
∞∞ 
(
∞∞ $
DigitalStorageSettings
∞∞ *
.
∞∞* +
enableDebugLog
∞∞+ 9
)
∞∞9 :
{
±± 
Log
≤≤ 
.
≤≤ 
Message
≤≤ 
(
≤≤  
$"
≤≤  "
$str
≤≤" C
{
≤≤C D
	extracted
≤≤D M
.
≤≤M N
Label
≤≤N S
}
≤≤S T
$str
≤≤T V
{
≤≤V W
	extracted
≤≤W `
.
≤≤` a

stackCount
≤≤a k
}
≤≤k l
"
≤≤l m
)
≤≤m n
;
≤≤n o
}
≥≥ 
return
∂∂ 
	extracted
∂∂  
;
∂∂  !
}
∑∑ 
else
∏∏ 
{
ππ 
if
∫∫ 
(
∫∫ $
DigitalStorageSettings
∫∫ *
.
∫∫* +
enableDebugLog
∫∫+ 9
)
∫∫9 :
{
ªª 
Log
ºº 
.
ºº 
Message
ºº 
(
ºº  
$"
ºº  "
$str
ºº" K
{
ººK L
def
ººL O
.
ººO P
label
ººP U
}
ººU V
$str
ººV X
{
ººX Y
actualNeeded
ººY e
}
ººe f
"
ººf g
)
ººg h
;
ººh i
}
ΩΩ 
return
ææ 
null
ææ 
;
ææ 
}
øø 
}
¿¿ 	
public
≈≈ 
void
≈≈ 
	StoreItem
≈≈ 
(
≈≈ 
Thing
≈≈ #
thing
≈≈$ )
)
≈≈) *
{
∆∆ 	
if
«« 
(
«« 
thing
«« 
==
«« 
null
«« 
)
«« 
return
«« %
;
««% &
StoredItemData
   
data
   
=
    !
new
  " %
StoredItemData
  & 4
(
  4 5
thing
  5 :
)
  : ;
;
  ; <
StoreItemData
ÀÀ 
(
ÀÀ 
data
ÀÀ 
)
ÀÀ 
;
ÀÀ  
}
ÃÃ 	
private
—— 
static
—— 
string
—— 

GetItemKey
—— (
(
——( )
Thing
——) .
thing
——/ 4
)
——4 5
{
““ 	
QualityCategory
”” 
quality
”” #
=
””$ %
thing
””& +
.
””+ ,

TryGetComp
””, 6
<
””6 7
CompQuality
””7 B
>
””B C
(
””C D
)
””D E
?
””E F
.
””F G
Quality
””G N
??
””O Q
QualityCategory
””R a
.
””a b
Normal
””b h
;
””h i
string
‘‘ 
	stuffName
‘‘ 
=
‘‘ 
thing
‘‘ $
.
‘‘$ %
Stuff
‘‘% *
?
‘‘* +
.
‘‘+ ,
defName
‘‘, 3
??
‘‘4 6
$str
‘‘7 =
;
‘‘= >
return
’’ 
$"
’’ 
{
’’ 
thing
’’ 
.
’’ 
def
’’ 
.
’’  
defName
’’  '
}
’’' (
$str
’’( )
{
’’) *
	stuffName
’’* 3
}
’’3 4
$str
’’4 5
{
’’5 6
quality
’’6 =
}
’’= >
"
’’> ?
;
’’? @
}
÷÷ 	
private
ÿÿ 
static
ÿÿ 
string
ÿÿ 

GetItemKey
ÿÿ (
(
ÿÿ( )
ThingDef
ÿÿ) 1
def
ÿÿ2 5
,
ÿÿ5 6
ThingDef
ÿÿ7 ?
stuff
ÿÿ@ E
,
ÿÿE F
QualityCategory
ÿÿG V
quality
ÿÿW ^
)
ÿÿ^ _
{
ŸŸ 	
string
⁄⁄ 
	stuffName
⁄⁄ 
=
⁄⁄ 
stuff
⁄⁄ $
?
⁄⁄$ %
.
⁄⁄% &
defName
⁄⁄& -
??
⁄⁄. 0
$str
⁄⁄1 7
;
⁄⁄7 8
return
€€ 
$"
€€ 
{
€€ 
def
€€ 
.
€€ 
defName
€€ !
}
€€! "
$str
€€" #
{
€€# $
	stuffName
€€$ -
}
€€- .
$str
€€. /
{
€€/ 0
quality
€€0 7
}
€€7 8
"
€€8 9
;
€€9 :
}
‹‹ 	
public
·· 
void
·· 
StoreItemData
·· !
(
··! "
StoredItemData
··" 0
data
··1 5
)
··5 6
{
‚‚ 	
if
„„ 
(
„„ 
data
„„ 
==
„„ 
null
„„ 
||
„„ 
data
„„  $
.
„„$ %
def
„„% (
==
„„) +
null
„„, 0
)
„„0 1
return
„„2 8
;
„„8 9
bool
ÊÊ 

hasQuality
ÊÊ 
=
ÊÊ 
data
ÊÊ "
.
ÊÊ" #
def
ÊÊ# &
.
ÊÊ& '
HasComp
ÊÊ' .
<
ÊÊ. /
CompQuality
ÊÊ/ :
>
ÊÊ: ;
(
ÊÊ; <
)
ÊÊ< =
;
ÊÊ= >
StoredItemData
ÈÈ 
match
ÈÈ  
=
ÈÈ! "
this
ÈÈ# '
.
ÈÈ' (
virtualStorage
ÈÈ( 6
.
ÈÈ6 7
FirstOrDefault
ÈÈ7 E
(
ÈÈE F
existing
ÈÈF N
=>
ÈÈO Q
existing
ÍÍ 
.
ÍÍ 
Matches
ÍÍ  
(
ÍÍ  !
data
ÍÍ! %
.
ÍÍ% &
def
ÍÍ& )
,
ÍÍ) *
data
ÍÍ+ /
.
ÍÍ/ 0
stuffDef
ÍÍ0 8
)
ÍÍ8 9
&&
ÍÍ: <
(
ÎÎ 
!
ÎÎ 

hasQuality
ÎÎ 
||
ÎÎ 
existing
ÎÎ  (
.
ÎÎ( )
quality
ÎÎ) 0
==
ÎÎ1 3
data
ÎÎ4 8
.
ÎÎ8 9
quality
ÎÎ9 @
)
ÎÎ@ A
)
ÎÎA B
;
ÎÎB C
if
ÓÓ 
(
ÓÓ 
match
ÓÓ 
!=
ÓÓ 
null
ÓÓ 
)
ÓÓ 
{
ÔÔ 
match
 
.
 

stackCount
  
+=
! #
data
$ (
.
( )

stackCount
) 3
;
3 4
if
ÚÚ 
(
ÚÚ 
data
ÚÚ 
.
ÚÚ 
	hitPoints
ÚÚ "
>
ÚÚ# $
$num
ÚÚ% &
&&
ÚÚ' )
match
ÚÚ* /
.
ÚÚ/ 0
	hitPoints
ÚÚ0 9
>
ÚÚ: ;
$num
ÚÚ< =
)
ÚÚ= >
{
ÛÛ 
int
ÙÙ 
totalHitPoints
ÙÙ &
=
ÙÙ' (
(
ÙÙ) *
match
ÙÙ* /
.
ÙÙ/ 0
	hitPoints
ÙÙ0 9
*
ÙÙ: ;
match
ÙÙ< A
.
ÙÙA B

stackCount
ÙÙB L
)
ÙÙL M
+
ÙÙN O
(
ÙÙP Q
data
ÙÙQ U
.
ÙÙU V
	hitPoints
ÙÙV _
*
ÙÙ` a
data
ÙÙb f
.
ÙÙf g

stackCount
ÙÙg q
)
ÙÙq r
;
ÙÙr s
int
ıı 

totalCount
ıı "
=
ıı# $
match
ıı% *
.
ıı* +

stackCount
ıı+ 5
+
ıı6 7
data
ıı8 <
.
ıı< =

stackCount
ıı= G
;
ııG H
match
ˆˆ 
.
ˆˆ 
	hitPoints
ˆˆ #
=
ˆˆ$ %
totalHitPoints
ˆˆ& 4
/
ˆˆ5 6

totalCount
ˆˆ7 A
;
ˆˆA B
}
˜˜ 
if
˘˘ 
(
˘˘ 

hasQuality
˘˘ 
&&
˘˘ !
data
˘˘" &
.
˘˘& '
quality
˘˘' .
<
˘˘/ 0
match
˘˘1 6
.
˘˘6 7
quality
˘˘7 >
)
˘˘> ?
{
˙˙ 
match
˚˚ 
.
˚˚ 
quality
˚˚ !
=
˚˚" #
data
˚˚$ (
.
˚˚( )
quality
˚˚) 0
;
˚˚0 1
}
¸¸ 
return
˝˝ 
;
˝˝ 
}
˛˛ 
this
ÅÅ 
.
ÅÅ 
virtualStorage
ÅÅ 
.
ÅÅ  
Add
ÅÅ  #
(
ÅÅ# $
data
ÅÅ$ (
)
ÅÅ( )
;
ÅÅ) *
this
ÇÇ 
.
ÇÇ 

itemLookup
ÇÇ 
[
ÇÇ 
data
ÇÇ  
.
ÇÇ  !
uniqueId
ÇÇ! )
]
ÇÇ) *
=
ÇÇ+ ,
data
ÇÇ- 1
;
ÇÇ1 2
}
ÉÉ 	
private
àà 
Thing
àà $
ExtractItemForReserved
àà ,
(
àà, -
ThingDef
àà- 5
def
àà6 9
,
àà9 :
int
àà; >
count
àà? D
,
ààD E
ThingDef
ààF N
stuff
ààO T
,
ààT U
QualityCategory
ààV e
quality
ààf m
)
ààm n
{
ââ 	
foreach
ää 
(
ää 
StoredItemData
ää #
item
ää$ (
in
ää) +
this
ää, 0
.
ää0 1
virtualStorage
ää1 ?
)
ää? @
{
ãã 
if
åå 
(
åå 
item
åå 
.
åå 
Matches
åå  
(
åå  !
def
åå! $
,
åå$ %
stuff
åå& +
)
åå+ ,
&&
åå- /
item
åå0 4
.
åå4 5
quality
åå5 <
==
åå= ?
quality
åå@ G
&&
ååH J
item
ååK O
.
ååO P

stackCount
ååP Z
>=
åå[ ]
count
åå^ c
)
ååc d
{
çç 
item
éé 
.
éé 

stackCount
éé #
-=
éé$ &
count
éé' ,
;
éé, -
if
êê 
(
êê 
item
êê 
.
êê 

stackCount
êê '
<=
êê( *
$num
êê+ ,
)
êê, -
{
ëë 
this
íí 
.
íí 
virtualStorage
íí +
.
íí+ ,
Remove
íí, 2
(
íí2 3
item
íí3 7
)
íí7 8
;
íí8 9
this
ìì 
.
ìì 

itemLookup
ìì '
.
ìì' (
Remove
ìì( .
(
ìì. /
item
ìì/ 3
.
ìì3 4
uniqueId
ìì4 <
)
ìì< =
;
ìì= >
}
îî 
StoredItemData
ññ "
extractData
ññ# .
=
ññ/ 0
new
ññ1 4
StoredItemData
ññ5 C
{
óó 
def
òò 
=
òò 
item
òò "
.
òò" #
def
òò# &
,
òò& '
stuffDef
ôô  
=
ôô! "
item
ôô# '
.
ôô' (
stuffDef
ôô( 0
,
ôô0 1
quality
öö 
=
öö  !
item
öö" &
.
öö& '
quality
öö' .
,
öö. /
	hitPoints
õõ !
=
õõ" #
item
õõ$ (
.
õõ( )
	hitPoints
õõ) 2
,
õõ2 3

stackCount
úú "
=
úú# $
count
úú% *
}
ùù 
;
ùù 
return
üü 
extractData
üü &
.
üü& '
CreateThing
üü' 2
(
üü2 3
)
üü3 4
;
üü4 5
}
†† 
}
°° 
return
££ 
null
££ 
;
££ 
}
§§ 	
public
©© 
Thing
©© 
ExtractItem
©©  
(
©©  !
ThingDef
©©! )
def
©©* -
,
©©- .
int
©©/ 2
count
©©3 8
,
©©8 9
ThingDef
©©: B
stuff
©©C H
=
©©I J
null
©©K O
)
©©O P
{
™™ 	
int
´´ 
beforeCount
´´ 
=
´´ 
GetItemCount
´´ *
(
´´* +
def
´´+ .
,
´´. /
stuff
´´0 5
)
´´5 6
;
´´6 7
if
≠≠ 
(
≠≠ $
DigitalStorageSettings
≠≠ &
.
≠≠& '
enableDebugLog
≠≠' 5
)
≠≠5 6
{
ÆÆ 
Log
ØØ 
.
ØØ 
Message
ØØ 
(
ØØ 
$"
ØØ 
$str
ØØ 8
{
ØØ8 9
def
ØØ9 <
?
ØØ< =
.
ØØ= >
label
ØØ> C
??
ØØD F
$str
ØØG M
}
ØØM N
$str
ØØN P
{
ØØP Q
count
ØØQ V
}
ØØV W
$str
ØØW _
{
ØØ_ `
stuff
ØØ` e
?
ØØe f
.
ØØf g
label
ØØg l
??
ØØm o
$str
ØØp v
}
ØØv w
$strØØw É
{ØØÉ Ñ
beforeCountØØÑ è
}ØØè ê
"ØØê ë
)ØØë í
;ØØí ì
}
∞∞ 
foreach
≤≤ 
(
≤≤ 
StoredItemData
≤≤ #
item
≤≤$ (
in
≤≤) +
this
≤≤, 0
.
≤≤0 1
virtualStorage
≤≤1 ?
)
≤≤? @
{
≥≥ 
if
¥¥ 
(
¥¥ 
item
¥¥ 
.
¥¥ 
Matches
¥¥  
(
¥¥  !
def
¥¥! $
,
¥¥$ %
stuff
¥¥& +
)
¥¥+ ,
&&
¥¥- /
item
¥¥0 4
.
¥¥4 5

stackCount
¥¥5 ?
>=
¥¥@ B
count
¥¥C H
)
¥¥H I
{
µµ 
item
∂∂ 
.
∂∂ 

stackCount
∂∂ #
-=
∂∂$ &
count
∂∂' ,
;
∂∂, -
if
∏∏ 
(
∏∏ $
DigitalStorageSettings
∏∏ .
.
∏∏. /
enableDebugLog
∏∏/ =
)
∏∏= >
{
ππ 
Log
∫∫ 
.
∫∫ 
Message
∫∫ #
(
∫∫# $
$"
∫∫$ &
$str
∫∫& F
{
∫∫F G
item
∫∫G K
.
∫∫K L

stackCount
∫∫L V
+
∫∫W X
count
∫∫Y ^
}
∫∫^ _
$str
∫∫_ e
{
∫∫e f
item
∫∫f j
.
∫∫j k

stackCount
∫∫k u
}
∫∫u v
$str
∫∫v }
{
∫∫} ~
count∫∫~ É
}∫∫É Ñ
"∫∫Ñ Ö
)∫∫Ö Ü
;∫∫Ü á
}
ªª 
if
ΩΩ 
(
ΩΩ 
item
ΩΩ 
.
ΩΩ 

stackCount
ΩΩ '
<=
ΩΩ( *
$num
ΩΩ+ ,
)
ΩΩ, -
{
ææ 
this
øø 
.
øø 
virtualStorage
øø +
.
øø+ ,
Remove
øø, 2
(
øø2 3
item
øø3 7
)
øø7 8
;
øø8 9
this
¿¿ 
.
¿¿ 

itemLookup
¿¿ '
.
¿¿' (
Remove
¿¿( .
(
¿¿. /
item
¿¿/ 3
.
¿¿3 4
uniqueId
¿¿4 <
)
¿¿< =
;
¿¿= >
if
¬¬ 
(
¬¬ $
DigitalStorageSettings
¬¬ 2
.
¬¬2 3
enableDebugLog
¬¬3 A
)
¬¬A B
{
√√ 
Log
ƒƒ 
.
ƒƒ  
Message
ƒƒ  '
(
ƒƒ' (
$"
ƒƒ( *
$str
ƒƒ* M
"
ƒƒM N
)
ƒƒN O
;
ƒƒO P
}
≈≈ 
}
∆∆ 
StoredItemData
»» "
extractData
»»# .
=
»»/ 0
new
»»1 4
StoredItemData
»»5 C
{
…… 
def
   
=
   
item
   "
.
  " #
def
  # &
,
  & '
stuffDef
ÀÀ  
=
ÀÀ! "
item
ÀÀ# '
.
ÀÀ' (
stuffDef
ÀÀ( 0
,
ÀÀ0 1
quality
ÃÃ 
=
ÃÃ  !
item
ÃÃ" &
.
ÃÃ& '
quality
ÃÃ' .
,
ÃÃ. /
	hitPoints
ÕÕ !
=
ÕÕ" #
item
ÕÕ$ (
.
ÕÕ( )
	hitPoints
ÕÕ) 2
,
ÕÕ2 3

stackCount
ŒŒ "
=
ŒŒ# $
count
ŒŒ% *
}
œœ 
;
œœ 
int
—— 

afterCount
—— "
=
——# $
GetItemCount
——% 1
(
——1 2
def
——2 5
,
——5 6
stuff
——7 <
)
——< =
;
——= >
if
”” 
(
”” $
DigitalStorageSettings
”” .
.
””. /
enableDebugLog
””/ =
)
””= >
{
‘‘ 
Log
’’ 
.
’’ 
Message
’’ #
(
’’# $
$"
’’$ &
$str
’’& H
{
’’H I
beforeCount
’’I T
}
’’T U
$str
’’U _
{
’’_ `

afterCount
’’` j
}
’’j k
$str
’’k p
{
’’p q
beforeCount
’’q |
-
’’} ~

afterCount’’ â
}’’â ä
"’’ä ã
)’’ã å
;’’å ç
}
÷÷ 
return
ÿÿ 
extractData
ÿÿ &
.
ÿÿ& '
CreateThing
ÿÿ' 2
(
ÿÿ2 3
)
ÿÿ3 4
;
ÿÿ4 5
}
ŸŸ 
}
⁄⁄ 
if
‹‹ 
(
‹‹ $
DigitalStorageSettings
‹‹ &
.
‹‹& '
enableDebugLog
‹‹' 5
)
‹‹5 6
{
›› 
Log
ﬁﬁ 
.
ﬁﬁ 
Message
ﬁﬁ 
(
ﬁﬁ 
$"
ﬁﬁ 
$str
ﬁﬁ @
{
ﬁﬁ@ A
def
ﬁﬁA D
?
ﬁﬁD E
.
ﬁﬁE F
label
ﬁﬁF K
??
ﬁﬁL N
$str
ﬁﬁO U
}
ﬁﬁU V
$str
ﬁﬁV X
{
ﬁﬁX Y
count
ﬁﬁY ^
}
ﬁﬁ^ _
"
ﬁﬁ_ `
)
ﬁﬁ` a
;
ﬁﬁa b
}
ﬂﬂ 
return
·· 
null
·· 
;
·· 
}
‚‚ 	
public
ÁÁ 
bool
ÁÁ 
HasItem
ÁÁ 
(
ÁÁ 
ThingDef
ÁÁ $
def
ÁÁ% (
,
ÁÁ( )
ThingDef
ÁÁ* 2
stuff
ÁÁ3 8
=
ÁÁ9 :
null
ÁÁ; ?
)
ÁÁ? @
{
ËË 	
	SlotGroup
ÍÍ 
	slotGroup
ÍÍ 
=
ÍÍ  !
base
ÍÍ" &
.
ÍÍ& '
GetSlotGroup
ÍÍ' 3
(
ÍÍ3 4
)
ÍÍ4 5
;
ÍÍ5 6
if
ÎÎ 
(
ÎÎ 
	slotGroup
ÎÎ 
!=
ÎÎ 
null
ÎÎ !
)
ÎÎ! "
{
ÏÏ 
foreach
ÌÌ 
(
ÌÌ 
Thing
ÌÌ 
thing
ÌÌ $
in
ÌÌ% '
	slotGroup
ÌÌ( 1
.
ÌÌ1 2

HeldThings
ÌÌ2 <
)
ÌÌ< =
{
ÓÓ 
if
ÔÔ 
(
ÔÔ 
thing
ÔÔ 
!=
ÔÔ  
null
ÔÔ! %
&&
ÔÔ& (
thing
ÔÔ) .
.
ÔÔ. /
Spawned
ÔÔ/ 6
&&
ÔÔ7 9
thing
ÔÔ: ?
.
ÔÔ? @
def
ÔÔ@ C
==
ÔÔD F
def
ÔÔG J
&&
ÔÔK M
thing
ÔÔN S
.
ÔÔS T
Stuff
ÔÔT Y
==
ÔÔZ \
stuff
ÔÔ] b
)
ÔÔb c
{
 
return
ÒÒ 
true
ÒÒ #
;
ÒÒ# $
}
ÚÚ 
}
ÛÛ 
}
ÙÙ 
foreach
˜˜ 
(
˜˜ 
StoredItemData
˜˜ #
item
˜˜$ (
in
˜˜) +
this
˜˜, 0
.
˜˜0 1
virtualStorage
˜˜1 ?
)
˜˜? @
{
¯¯ 
if
˘˘ 
(
˘˘ 
item
˘˘ 
.
˘˘ 
Matches
˘˘  
(
˘˘  !
def
˘˘! $
,
˘˘$ %
stuff
˘˘& +
)
˘˘+ ,
&&
˘˘- /
item
˘˘0 4
.
˘˘4 5

stackCount
˘˘5 ?
>
˘˘@ A
$num
˘˘B C
)
˘˘C D
{
˙˙ 
return
˚˚ 
true
˚˚ 
;
˚˚  
}
¸¸ 
}
˝˝ 
return
˛˛ 
false
˛˛ 
;
˛˛ 
}
ˇˇ 	
public
ÑÑ 
int
ÑÑ 
GetItemCount
ÑÑ 
(
ÑÑ  
ThingDef
ÑÑ  (
def
ÑÑ) ,
,
ÑÑ, -
ThingDef
ÑÑ. 6
stuff
ÑÑ7 <
=
ÑÑ= >
null
ÑÑ? C
)
ÑÑC D
{
ÖÖ 	
int
ÜÜ 
total
ÜÜ 
=
ÜÜ 
$num
ÜÜ 
;
ÜÜ 
	SlotGroup
ââ 
	slotGroup
ââ 
=
ââ  !
base
ââ" &
.
ââ& '
GetSlotGroup
ââ' 3
(
ââ3 4
)
ââ4 5
;
ââ5 6
if
ää 
(
ää 
	slotGroup
ää 
!=
ää 
null
ää !
)
ää! "
{
ãã 
foreach
åå 
(
åå 
Thing
åå 
thing
åå $
in
åå% '
	slotGroup
åå( 1
.
åå1 2

HeldThings
åå2 <
)
åå< =
{
çç 
if
éé 
(
éé 
thing
éé 
!=
éé  
null
éé! %
&&
éé& (
thing
éé) .
.
éé. /
Spawned
éé/ 6
&&
éé7 9
thing
éé: ?
.
éé? @
def
éé@ C
==
ééD F
def
ééG J
&&
ééK M
thing
ééN S
.
ééS T
Stuff
ééT Y
==
ééZ \
stuff
éé] b
)
ééb c
{
èè 
total
êê 
+=
êê  
thing
êê! &
.
êê& '

stackCount
êê' 1
;
êê1 2
}
ëë 
}
íí 
}
ìì 
foreach
ññ 
(
ññ 
StoredItemData
ññ #
item
ññ$ (
in
ññ) +
this
ññ, 0
.
ññ0 1
virtualStorage
ññ1 ?
)
ññ? @
{
óó 
if
òò 
(
òò 
item
òò 
.
òò 
Matches
òò  
(
òò  !
def
òò! $
,
òò$ %
stuff
òò& +
)
òò+ ,
)
òò, -
{
ôô 
total
öö 
+=
öö 
item
öö !
.
öö! "

stackCount
öö" ,
;
öö, -
}
õõ 
}
úú 
return
ûû 
total
ûû 
;
ûû 
}
üü 	
public
§§ 
int
§§ "
GetReservedItemCount
§§ '
(
§§' (
ThingDef
§§( 0
def
§§1 4
,
§§4 5
ThingDef
§§6 >
stuff
§§? D
=
§§E F
null
§§G K
)
§§K L
{
•• 	
int
¶¶ 
total
¶¶ 
=
¶¶ 
$num
¶¶ 
;
¶¶ 
	SlotGroup
ßß 
	slotGroup
ßß 
=
ßß  !
base
ßß" &
.
ßß& '
GetSlotGroup
ßß' 3
(
ßß3 4
)
ßß4 5
;
ßß5 6
if
®® 
(
®® 
	slotGroup
®® 
!=
®® 
null
®® !
)
®®! "
{
©© 
foreach
™™ 
(
™™ 
Thing
™™ 
thing
™™ $
in
™™% '
	slotGroup
™™( 1
.
™™1 2

HeldThings
™™2 <
)
™™< =
{
´´ 
if
¨¨ 
(
¨¨ 
thing
¨¨ 
!=
¨¨  
null
¨¨! %
&&
¨¨& (
thing
¨¨) .
.
¨¨. /
Spawned
¨¨/ 6
&&
¨¨7 9
thing
¨¨: ?
.
¨¨? @
def
¨¨@ C
==
¨¨D F
def
¨¨G J
&&
¨¨K M
thing
¨¨N S
.
¨¨S T
Stuff
¨¨T Y
==
¨¨Z \
stuff
¨¨] b
)
¨¨b c
{
≠≠ 
total
ÆÆ 
+=
ÆÆ  
thing
ÆÆ! &
.
ÆÆ& '

stackCount
ÆÆ' 1
;
ÆÆ1 2
}
ØØ 
}
∞∞ 
}
±± 
return
≤≤ 
total
≤≤ 
;
≤≤ 
}
≥≥ 	
public
∏∏ 
Thing
∏∏ 
FindReservedItem
∏∏ %
(
∏∏% &
ThingDef
∏∏& .
def
∏∏/ 2
,
∏∏2 3
ThingDef
∏∏4 <
stuff
∏∏= B
=
∏∏C D
null
∏∏E I
)
∏∏I J
{
ππ 	
	SlotGroup
∫∫ 
	slotGroup
∫∫ 
=
∫∫  !
base
∫∫" &
.
∫∫& '
GetSlotGroup
∫∫' 3
(
∫∫3 4
)
∫∫4 5
;
∫∫5 6
if
ªª 
(
ªª 
	slotGroup
ªª 
!=
ªª 
null
ªª !
)
ªª! "
{
ºº 
foreach
ΩΩ 
(
ΩΩ 
Thing
ΩΩ 
thing
ΩΩ $
in
ΩΩ% '
	slotGroup
ΩΩ( 1
.
ΩΩ1 2

HeldThings
ΩΩ2 <
)
ΩΩ< =
{
ææ 
if
øø 
(
øø 
thing
øø 
!=
øø  
null
øø! %
&&
øø& (
thing
øø) .
.
øø. /
Spawned
øø/ 6
&&
øø7 9
thing
øø: ?
.
øø? @
def
øø@ C
==
øøD F
def
øøG J
&&
øøK M
thing
øøN S
.
øøS T
Stuff
øøT Y
==
øøZ \
stuff
øø] b
)
øøb c
{
¿¿ 
return
¡¡ 
thing
¡¡ $
;
¡¡$ %
}
¬¬ 
}
√√ 
}
ƒƒ 
return
≈≈ 
null
≈≈ 
;
≈≈ 
}
∆∆ 	
private
ÀÀ 
bool
ÀÀ  
IsValidReservation
ÀÀ '
(
ÀÀ' (
Thing
ÀÀ( -
thing
ÀÀ. 3
,
ÀÀ3 4
Map
ÀÀ5 8
map
ÀÀ9 <
)
ÀÀ< =
{
ÃÃ 	
if
ÕÕ 
(
ÕÕ 
thing
ÕÕ 
==
ÕÕ 
null
ÕÕ 
||
ÕÕ  
map
ÕÕ! $
==
ÕÕ% '
null
ÕÕ( ,
||
ÕÕ- /
map
ÕÕ0 3
.
ÕÕ3 4 
reservationManager
ÕÕ4 F
==
ÕÕG I
null
ÕÕJ N
)
ÕÕN O
{
ŒŒ 
return
œœ 
false
œœ 
;
œœ 
}
–– 
foreach
”” 
(
”” 
var
”” 
reservation
”” $
in
””% '
map
””( +
.
””+ , 
reservationManager
””, >
.
””> ?"
ReservationsReadOnly
””? S
)
””S T
{
‘‘ 
if
’’ 
(
’’ 
reservation
’’ 
.
’’  
Target
’’  &
.
’’& '
Thing
’’' ,
==
’’- /
thing
’’0 5
&&
’’6 8
reservation
’’9 D
.
’’D E
Claimant
’’E M
!=
’’N P
null
’’Q U
)
’’U V
{
÷÷ 
Pawn
◊◊ 
claimant
◊◊ !
=
◊◊" #
reservation
◊◊$ /
.
◊◊/ 0
Claimant
◊◊0 8
;
◊◊8 9
Job
ÿÿ 
reservationJob
ÿÿ &
=
ÿÿ' (
reservation
ÿÿ) 4
.
ÿÿ4 5
Job
ÿÿ5 8
;
ÿÿ8 9
if
⁄⁄ 
(
⁄⁄ 
claimant
⁄⁄  
==
⁄⁄! #
null
⁄⁄$ (
||
⁄⁄) +
reservationJob
⁄⁄, :
==
⁄⁄; =
null
⁄⁄> B
)
⁄⁄B C
{
€€ 
continue
‹‹  
;
‹‹  !
}
›› 
if
·· 
(
·· 
claimant
··  
.
··  !
CurJob
··! '
==
··( *
reservationJob
··+ 9
)
··9 :
{
‚‚ 
return
„„ 
true
„„ #
;
„„# $
}
‰‰ 
if
ÁÁ 
(
ÁÁ 
claimant
ÁÁ  
.
ÁÁ  !
jobs
ÁÁ! %
!=
ÁÁ& (
null
ÁÁ) -
&&
ÁÁ. 0
claimant
ÁÁ1 9
.
ÁÁ9 :
jobs
ÁÁ: >
.
ÁÁ> ?
jobQueue
ÁÁ? G
!=
ÁÁH J
null
ÁÁK O
)
ÁÁO P
{
ËË 
foreach
ÈÈ 
(
ÈÈ  !
var
ÈÈ! $
	queuedJob
ÈÈ% .
in
ÈÈ/ 1
claimant
ÈÈ2 :
.
ÈÈ: ;
jobs
ÈÈ; ?
.
ÈÈ? @
jobQueue
ÈÈ@ H
)
ÈÈH I
{
ÍÍ 
if
ÎÎ 
(
ÎÎ  
	queuedJob
ÎÎ  )
.
ÎÎ) *
job
ÎÎ* -
==
ÎÎ. 0
reservationJob
ÎÎ1 ?
)
ÎÎ? @
{
ÏÏ 
return
ÌÌ  &
true
ÌÌ' +
;
ÌÌ+ ,
}
ÓÓ 
}
ÔÔ 
}
 
}
ÒÒ 
}
ÚÚ 
return
ÛÛ 
false
ÛÛ 
;
ÛÛ 
}
ÙÙ 	
public
˘˘ 
IEnumerable
˘˘ 
<
˘˘ 
StoredItemData
˘˘ )
>
˘˘) *
GetAllStoredItems
˘˘+ <
(
˘˘< =
)
˘˘= >
{
˙˙ 	
return
˚˚ 
this
˚˚ 
.
˚˚ 
virtualStorage
˚˚ &
;
˚˚& '
}
¸¸ 	
private
˛˛ 
void
˛˛ 
RebuildLookup
˛˛ "
(
˛˛" #
)
˛˛# $
{
ˇˇ 	
this
ÄÄ 
.
ÄÄ 

itemLookup
ÄÄ 
.
ÄÄ 
Clear
ÄÄ !
(
ÄÄ! "
)
ÄÄ" #
;
ÄÄ# $
foreach
ÅÅ 
(
ÅÅ 
StoredItemData
ÅÅ #
item
ÅÅ$ (
in
ÅÅ) +
this
ÅÅ, 0
.
ÅÅ0 1
virtualStorage
ÅÅ1 ?
)
ÅÅ? @
{
ÇÇ 
if
ÉÉ 
(
ÉÉ 
!
ÉÉ 
string
ÉÉ 
.
ÉÉ 
IsNullOrEmpty
ÉÉ )
(
ÉÉ) *
item
ÉÉ* .
.
ÉÉ. /
uniqueId
ÉÉ/ 7
)
ÉÉ7 8
)
ÉÉ8 9
{
ÑÑ 
this
ÖÖ 
.
ÖÖ 

itemLookup
ÖÖ #
[
ÖÖ# $
item
ÖÖ$ (
.
ÖÖ( )
uniqueId
ÖÖ) 1
]
ÖÖ1 2
=
ÖÖ3 4
item
ÖÖ5 9
;
ÖÖ9 :
}
ÜÜ 
}
áá 
}
àà 	
}
ââ 
}ää 